<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>苇名一心的博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://666wxy666.github.io/"/>
  <updated>2020-07-15T14:49:28.889Z</updated>
  <id>https://666wxy666.github.io/</id>
  
  <author>
    <name>苇名一心</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>计算机系统结构 实验 指令调度与延迟分支</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E6%8C%87%E4%BB%A4%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%BB%B6%E8%BF%9F%E5%88%86%E6%94%AF/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E6%8C%87%E4%BB%A4%E8%B0%83%E5%BA%A6%E4%B8%8E%E5%BB%B6%E8%BF%9F%E5%88%86%E6%94%AF/</id>
    <published>2020-08-24T01:38:51.235Z</published>
    <updated>2020-07-15T14:49:28.889Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于计算机系统结构实验五，指令调度与延迟分支。</p><a id="more"></a><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol><li>加深对指令调度技术的理解。</li><li>加深对延迟分支技术的理解。</li><li>熟练掌握用指令调度技术解决流水线中的数据冲突的方法。</li><li>进一步理解指令调度技术对 CPU 性能的改进。</li><li>进一步理解延迟分支技术对 CPU 性能的改进。</li></ol><h2 id="二、实验步骤及结果分析"><a href="#二、实验步骤及结果分析" class="headerlink" title="二、实验步骤及结果分析"></a>二、实验步骤及结果分析</h2><h3 id="1、启动-MIPSsim。"><a href="#1、启动-MIPSsim。" class="headerlink" title="1、启动 MIPSsim。"></a>1、启动 MIPSsim。</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175631" style="zoom: 50%;"><h3 id="2、根据实验2的相关知识中关于流水线各段操作的描述，进一步理解流水线窗口中各段的功能，掌握各流水线寄存器的含义（双击各段，就可以看到各流水线寄存器中的内容）。"><a href="#2、根据实验2的相关知识中关于流水线各段操作的描述，进一步理解流水线窗口中各段的功能，掌握各流水线寄存器的含义（双击各段，就可以看到各流水线寄存器中的内容）。" class="headerlink" title="2、根据实验2的相关知识中关于流水线各段操作的描述，进一步理解流水线窗口中各段的功能，掌握各流水线寄存器的含义（双击各段，就可以看到各流水线寄存器中的内容）。"></a>2、根据实验2的相关知识中关于流水线各段操作的描述，进一步理解流水线窗口中各段的功能，掌握各流水线寄存器的含义（双击各段，就可以看到各流水线寄存器中的内容）。</h3><h4 id="①IF段："><a href="#①IF段：" class="headerlink" title="①IF段："></a>①IF段：</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200517210511.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517210511.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_210337" style="zoom:80%;"><h4 id="②ID段："><a href="#②ID段：" class="headerlink" title="②ID段："></a>②ID段：</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200517210543.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517210543.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_210358" style="zoom:80%;"><h4 id="③EX段："><a href="#③EX段：" class="headerlink" title="③EX段："></a>③EX段：</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200517210648.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517210648.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_210409" style="zoom:80%;"><h4 id="④MEM段："><a href="#④MEM段：" class="headerlink" title="④MEM段："></a>④MEM段：</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200517210657.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517210657.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_210417" style="zoom:80%;"><h4 id="⑤WB段："><a href="#⑤WB段：" class="headerlink" title="⑤WB段："></a>⑤WB段：</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200517210729.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517210729.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_210423" style="zoom:80%;"><h3 id="3、选择“配置”→“流水方式”选项，使模拟器工作在流水方式下。"><a href="#3、选择“配置”→“流水方式”选项，使模拟器工作在流水方式下。" class="headerlink" title="3、选择“配置”→“流水方式”选项，使模拟器工作在流水方式下。"></a>3、选择“配置”→“流水方式”选项，使模拟器工作在流水方式下。</h3><h3 id="4、用指令调度技术解决流水线中的结构冲突与数据冲突："><a href="#4、用指令调度技术解决流水线中的结构冲突与数据冲突：" class="headerlink" title="4、用指令调度技术解决流水线中的结构冲突与数据冲突："></a>4、用指令调度技术解决流水线中的结构冲突与数据冲突：</h3><ol><li><p>启动 MIPSsim。用 MIPSsim 的“文件”-&gt;“载入程序”选项来加载 schedule.s（在模拟器所在文件夹下的“样例程序”文件夹中）。关闭定向功能，这是通过“配置“-&gt;”定向“选项来实现的。执行所载入的程序，通过查看统计数据和时钟周期图，找出并记录程序执行过程中各种冲突发生的次数，发生冲突的指令组合以及程序执行的总时钟周期数。</p><p>载入的程序：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517211348.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517211348.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_211340" style="zoom:80%;"><p>执行结果：</p><ul><li><p>寄存器的值</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517211749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517211749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_211604" style="zoom:80%;"></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517211814.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517211814.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_211620" style="zoom:80%;"></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517211909.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517211909.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_211525" style="zoom:80%;"><p>发现总共执行了33个周期，执行了15条指令，8次RAW停顿，RAW停顿有16个周期，RAW停顿占周期总数的百分比为48.48485%，所有的停顿为17个周期，占周期总数的百分比为51.51515%。<br>$$<br>吞吐率TP_1=\frac{15}{33\Delta{t}}<br>$$</p><p>$$<br>加速比S_1=\frac{15\times{5\Delta{t}}}{33\Delta{t}}\approx{2.27}<br>$$</p><p>冲突的指令组合：</p><p>1-1和2-1，2-1和2-2，2-2和2-3，3-1和3-2，4-1和4-2，4-2和4-3，4-3和4-4，5-1和5-2共8对冲突，1-5组组内冲突，组间没有关联。</p><p>schedule.s：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU  $r1,$r0,A# 1-1</span><br><span class="line"></span><br><span class="line">LW     $r2,0($r1)# 2-1</span><br><span class="line">ADD    $r4,$r0,$r2# 2-2</span><br><span class="line">SW     $r4,0($r1)# 2-3</span><br><span class="line"></span><br><span class="line">LW     $r6,4($r1)# 3-1</span><br><span class="line">ADD    $r8,$r6,$r1# 3-2</span><br><span class="line"></span><br><span class="line">MUL    $r12,$r10,$r1# 4-1</span><br><span class="line">ADD    $r16,$r12,$r1# 4-2</span><br><span class="line">ADD    $r18,$r16,$r1# 4-3</span><br><span class="line">SW     $r18,16($r1)# 4-4</span><br><span class="line"></span><br><span class="line">LW     $r20,8($r1)# 5-1</span><br><span class="line">MUL    $r22,$r20,$r14# 5-2</span><br><span class="line"></span><br><span class="line">MUL    $r24,$r26,$r14# 6-1</span><br><span class="line"></span><br><span class="line">TEQ    $r0,$r0# 7-1</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">A: </span><br><span class="line">.word 4,6,8</span><br></pre></td></tr></table></figure></li></ul></li></ol><ol start="2"><li><p>自己采用调度技术对程序进行指令调度，消除冲突（自己修改源程序）。将调度（修改）后的程序重新命名为 afer-schedule.s。（注意：调度方法灵活多样，在保证程序正确性的前提下自己随意调度，尽量减少冲突即可，不要求要达到最优。）载入 afer-schedule.s，执行该程序，观察程序在流水线中的执行情况，记录程序执行的总时钟周期数。 比较调度前和调度后的性能，论述指令调度对提高 CPU 性能的作用。</p><p><strong><em>PS：调度后的程序见附录。</em></strong></p><p>载入的程序：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517213848.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517213848.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_213739" style="zoom:80%;"><p>执行结果：</p><ul><li><p>寄存器的值</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517213909.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517213909.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_213757" style="zoom:80%;"><p>与不调度前完全一致，调度没有改变结果，调度正确。</p></li><li><p>时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517214016.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517214016.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_213828" style="zoom:80%;"></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517213944.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517213944.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_213812" style="zoom:80%;"><p>发现总共执行了18个周期，执行了15条指令，1次RAW停顿，RAW停顿有1个周期，RAW停顿占周期总数的百分比为5.555555%，较没有静态调度的48.48485%少了很多，所有的停顿为2个周期，占周期总数的百分比为11.111111%，较没有静态调度的51.51515%也少了很多。<br>$$<br>吞吐率TP_2=\frac{15}{18\Delta{t}}<br>$$</p><p>$$<br>加速比S_2=\frac{15\times{5\Delta{t}}}{18\Delta{t}}\approx{4.17}<br>$$</p><p>吞吐率和加速比是没有静态调度时的$\frac{33}{18}\approx{1.83}$倍。</p></li></ul></li></ol><h3 id="5、用延迟分支技术减少分支指令对性能的影响："><a href="#5、用延迟分支技术减少分支指令对性能的影响：" class="headerlink" title="5、用延迟分支技术减少分支指令对性能的影响："></a>5、用延迟分支技术减少分支指令对性能的影响：</h3><ol><li><p>在 MIPSsim 中载入 branch.s 样例程序（在本模拟器目录的“样例程序”文件夹中。关闭延迟分支功能。这是通过在“配置”-&gt;“延迟槽”选项来实现的。执行该程序，观察并记录发生分支延迟的时刻，记录该程序执行的总时钟周期数。</p><ol><li><p>载入的程序：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517220107.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517220107.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_215518" style="zoom:80%;"><p>执行结果：</p><ul><li><p>寄存器的值</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517220117.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517220117.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_215540" style="zoom:80%;"></li><li><p>部分时钟周期图</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200517220131.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517220131.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_215609"></p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517220148.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517220148.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_215554" style="zoom:80%;"><p>发现总共执行了38个周期，执行了18条指令，8次RAW停顿，RAW停顿有16个周期，RAW停顿占周期总数的百分比为42.10526%，控制停顿有2个周期，占周期总数的百分比为5.263158%，所有的停顿为19个周期，占周期总数的百分比为50%。发生分支延迟的时刻为第15个周期，延迟了2个周期。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517220910.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517220910.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img" style="zoom:80%;">$$吞吐率TP_1=\frac{18}{38\Delta{t}}$$<p>$$<br>加速比S_1=\frac{18\times{5\Delta{t}}}{38\Delta{t}}\approx{2.37}<br>$$</p><p>冲突的指令组合：</p><p>2-1和2-2，2-2和2-3，3-1和3-2，3-2和3-3共4对冲突，2组和3组组内冲突，组间没有关联。</p><p>branch.s：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDI  $r2,$r0,1024# 1-1</span><br><span class="line">ADD   $r3,$r0,$r0# 1-2</span><br><span class="line">ADDI  $r4,$r0,8# 1-3</span><br><span class="line"></span><br><span class="line">loop:  </span><br><span class="line">LW    $r1,0($r2)# 2-1</span><br><span class="line">ADDI  $r1,$r1,1# 2-2</span><br><span class="line">SW    $r1,0($r2)# 2-3</span><br><span class="line"></span><br><span class="line">ADDI  $r3,$r3,4# 3-1</span><br><span class="line">SUB   $r5,$r4,$r3# 3-2</span><br><span class="line">BGTZ  $r5,loop# 3-3</span><br><span class="line"></span><br><span class="line">ADD   $r7,$r0,$r6# 4-1</span><br><span class="line"></span><br><span class="line">TEQ   $r0,$r0# 5-1</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ol><ol start="2"><li><p>假设延迟槽为一个，自己对 branch.s 程序进行指令调度（自己修改源程序），将调度后的程序重新命名为 delayed-branch.s。 载入 delayed-branch.s，打开延迟分支功能，执行该程序，观察其时钟周期图，记录程序执行的总时钟周期数。</p><ol start="2"><li><p><strong><em>PS：调度后的程序见附录。</em></strong></p><p>载入的程序：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517221827.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517221827.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_221307" style="zoom:80%;"><p>执行结果：</p><ul><li><p>寄存器的值</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517221840.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517221840.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_221458" style="zoom:80%;"><p>与不调度前完全一致，调度没有改变结果，调度正确。</p></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517221906.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517221906.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_221439" style="zoom:80%;"></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200517221920.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200517221920.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-17_221507" style="zoom:80%;"><p>发现总共执行了25个周期，执行了19条指令，4次RAW停顿，RAW停顿有4个周期，RAW停顿占周期总数的百分比为16%，较没有静态调度的42.10526%少了很多，控制停顿有0个周期，占周期总数的百分比为0%，比没有使用延迟分支技术的5.263158%少了，所有的停顿为5个周期，占周期总数的百分比为20%，较没有静态调度和延迟分支技术的50%也减少了。可以发现使用延迟分支技术后，控制停顿消失了。<br>$$<br>吞吐率TP_2=\frac{19}{25\Delta{t}}<br>$$</p><p>$$<br>加速比S_2=\frac{19\times{5\Delta{t}}}{25\Delta{t}}={3.8}<br>$$</p><p>吞吐率和加速比是没有静态调度和延迟分支技术时的$\frac{19\times{38}}{25\times{18}}\approx{1.60}$倍。</p></li></ul></li></ol></li></ol><h2 id="四、实验结论"><a href="#四、实验结论" class="headerlink" title="四、实验结论"></a>四、实验结论</h2><p>​        静态调度优化代码和定向技术都能在一定程度上减少甚至消除数据冲突，尤其是RAW停顿，可以很好地提高性能，但是这两种方法对分支控制停顿没有任何帮助。但是延迟分支技术是由编译器通过重排指令序列，在分支指令后紧跟一条或几条延迟槽指令，不管分支是否成功，都顺序执行延迟槽中的指令，从而逻辑上“延长”分支指令的执行时间，减少甚至消除了控制停顿。因此这几种方法都能大幅度的减少停顿，从而提高CPU性能。</p><p>​        在查看延迟分支技术的统计信息时，发现使用延迟分支技术比不使用延迟分支技术多执行了一条指令，可能是由于分支取消机制当分支的实际执行方向和事先所预测的一样时，执行分支延迟槽中的指令，否则就将分支延迟槽中的指令转化成一个空操作，这条指令确实已经执行了，只是分支条件判断完后发现不该执行，然后就将执行的回滚，因此比不使用延迟分支技术多执行了一条指令。</p><h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><h3 id="1、after-schedule-s"><a href="#1、after-schedule-s" class="headerlink" title="1、after-schedule.s"></a>1、after-schedule.s</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU  $r1,$r0,A# 1-1</span><br><span class="line">MUL    $r24,$r26,$r14# 6-1</span><br><span class="line"></span><br><span class="line">MUL    $r12,$r10,$r1# 4-1</span><br><span class="line">LW     $r2,0($r1)# 2-1</span><br><span class="line">LW     $r6,4($r1)# 3-1</span><br><span class="line"></span><br><span class="line">ADD    $r16,$r12,$r1# 4-2</span><br><span class="line">ADD    $r4,$r0,$r2# 2-2</span><br><span class="line">LW     $r20,8($r1)# 5-1</span><br><span class="line"></span><br><span class="line">ADD    $r18,$r16,$r1# 4-3</span><br><span class="line">SW     $r4,0($r1)# 2-3</span><br><span class="line">MUL    $r22,$r20,$r14# 5-2</span><br><span class="line"></span><br><span class="line">SW     $r18,16($r1)# 4-4</span><br><span class="line">ADD    $r8,$r6,$r1# 3-2</span><br><span class="line">TEQ    $r0,$r0# 7-1</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">A: </span><br><span class="line">.word 4,6,8</span><br></pre></td></tr></table></figure><h3 id="2、delay-branch-s"><a href="#2、delay-branch-s" class="headerlink" title="2、delay-branch.s"></a>2、delay-branch.s</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDI  $r2,$r0,1024# 1-1</span><br><span class="line">ADD   $r3,$r0,$r0# 1-2</span><br><span class="line">ADDI  $r4,$r0,8# 1-3</span><br><span class="line"></span><br><span class="line">loop:  </span><br><span class="line">LW    $r1,0($r2)# 2-1</span><br><span class="line">ADDI  $r3,$r3,4# 3-1</span><br><span class="line">ADDI  $r1,$r1,1# 2-2</span><br><span class="line">SUB   $r5,$r4,$r3# 3-2</span><br><span class="line">SW    $r1,0($r2)# 2-3</span><br><span class="line">BGTZ  $r5,loop# 3-3</span><br><span class="line"></span><br><span class="line">ADD   $r7,$r0,$r6# 4-1</span><br><span class="line"></span><br><span class="line">TEQ   $r0,$r0# 5-1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于计算机系统结构实验五，指令调度与延迟分支。&lt;/p&gt;
    
    </summary>
    
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="汇编" scheme="https://666wxy666.github.io/tags/%E6%B1%87%E7%BC%96/"/>
    
      <category term="MIPS" scheme="https://666wxy666.github.io/tags/MIPS/"/>
    
  </entry>
  
  <entry>
    <title>计算机系统结构 实验 使用MIPS指令实现求两个数组的点积</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E4%BD%BF%E7%94%A8MIPS%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E6%B1%82%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E7%82%B9%E7%A7%AF/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E4%BD%BF%E7%94%A8MIPS%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E6%B1%82%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E7%82%B9%E7%A7%AF/</id>
    <published>2020-08-24T01:38:51.226Z</published>
    <updated>2020-07-15T14:49:28.889Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于计算机系统结构实验三，使用MIPS指令实现求两个数组的点积。</p><a id="more"></a><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol><li>通过实验熟悉实验 1 和实验 2 的内容。</li><li>增强汇编语言编程能力。</li><li>学会使用模拟器中的定向功能进行优化。</li><li>了解对代码进行优化的方法。</li></ol><h2 id="二、实验原理"><a href="#二、实验原理" class="headerlink" title="二、实验原理"></a>二、实验原理</h2><p>​        通过编写MIPS汇编程序，实现向量点积的功能。在模拟器MIPSsim上执行所写的汇编程序，连续执行，查看寄存器相关结果，判断所写的汇编程序是否正确。然后观察时钟周期图窗口的执行过程和冲突的指令，查看统计窗口的信息，来判断定向前后和优化前后的执行效率高低。</p><h2 id="三、实验步骤及结果分析"><a href="#三、实验步骤及结果分析" class="headerlink" title="三、实验步骤及结果分析"></a>三、实验步骤及结果分析</h2><h3 id="1、自行编写一个计算两个向量点积的汇编程序，该程序要求可以实现求两个向量点积计算后的结果。"><a href="#1、自行编写一个计算两个向量点积的汇编程序，该程序要求可以实现求两个向量点积计算后的结果。" class="headerlink" title="1、自行编写一个计算两个向量点积的汇编程序，该程序要求可以实现求两个向量点积计算后的结果。"></a>1、自行编写一个计算两个向量点积的汇编程序，该程序要求可以实现求两个向量点积计算后的结果。</h3><p>  向量的点积：假设有两个 n 维向量 a、b，则 a 与 b 的点积为：<br>$$<br>a{\cdot}b=\sum_{i=1}^na_ib_i=a_1b_1+a_2b_2+\cdots+a_nb_n<br>$$<br>两个向量元素使用数组进行数据存储，要求向量的维度不得小于10</p><p><strong><em>PS：汇编程序见附录。</em></strong></p><h3 id="2、启动-MIPSsim。"><a href="#2、启动-MIPSsim。" class="headerlink" title="2、启动 MIPSsim。"></a>2、启动 MIPSsim。</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175631" style="zoom: 50%;"><h3 id="3、载入自己编写的程序，观察流水线输出结果。"><a href="#3、载入自己编写的程序，观察流水线输出结果。" class="headerlink" title="3、载入自己编写的程序，观察流水线输出结果。"></a>3、载入自己编写的程序，观察流水线输出结果。</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200507175822.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175822.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175742" style="zoom: 50%;"><p>载入的代码：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507175853.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175853.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175807" style="zoom:80%;"><p>执行：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507175940.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175940.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175927" style="zoom: 50%;"><p>执行到结束：</p><ul><li><p>寄存器</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507180201.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507180201.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_180059" style="zoom:80%;"><p>我编写的汇编程序是向量$(1,2,3,4,5,6,7,8,9,10,11,12)\cdot(1,2,3,4,5,6,7,8,9,10,11,12)$=650，R7为结果寄存器，发现结果符合预期，说明编写的汇编程序正确。</p></li><li><p>时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507180230.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507180230.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_180040" style="zoom: 50%;"><p>可以看到有较多停顿，主要是LW命令与MUL命令，MUL命令与ADD命令和一些控制停顿。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507180242.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507180242.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_180112" style="zoom:80%;"><p>发现RAW停顿有72个周期，停顿次数较多，可以进行优化。共执行了187个周期，RAW停顿占周期总数的百分比为38.50267%，所有的停顿为84个周期，占周期总数的百分比为44.91978%，效率很低。<br>$$<br>吞吐率TP_1=\frac{102}{187\Delta{t}}<br>$$</p><p>$$<br>加速比S_1=\frac{102\times{5\Delta{t}}}{187\Delta{t}}\approx{2.73}<br>$$</p></li></ul><h3 id="4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。"><a href="#4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。" class="headerlink" title="4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。"></a>4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200507181100.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507181100.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_181050" style="zoom: 50%;"><ul><li><p>寄存器</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507181210.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507181210.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_181031" style="zoom:80%;"><p>结果正确。</p></li><li><p>时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507181322.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507181322.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_181255" style="zoom: 50%;"><p>在使用定向技术后，发现停顿明显减少。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507181345.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507181345.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_181305" style="zoom:80%;"><p>发现RAW停顿有24个周期，停顿次数比没有定向技术时的72个少了很多。共执行了139个周期，比没有定向技术时的187个也少了很多，RAW停顿占周期总数的百分比为17.26619%，所有的停顿为36个周期，占周期总数的百分比为25.89928%，较没有定向技术时的44.91978%也减少了很多。</p></li></ul><p>  $$<br>  吞吐率TP_2=\frac{102}{139\Delta{t}}<br>  $$</p><p>  $$<br>  加速比S_2=\frac{102\times{5\Delta{t}}}{139\Delta{t}}\approx{3.67}<br>  $$<br>  吞吐率和加速比是没有定向技术时的$\frac{187}{139}\approx{1.35}$倍。</p><h3 id="5、采用静态调度方法重排指令序列，减少相关，优化程序"><a href="#5、采用静态调度方法重排指令序列，减少相关，优化程序" class="headerlink" title="5、采用静态调度方法重排指令序列，减少相关，优化程序"></a>5、采用静态调度方法重排指令序列，减少相关，优化程序</h3><p><strong><em>PS：静态调度后的汇编程序见附录。</em></strong></p><ul><li><p>载入代码</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507194134.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507194134.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_193938" style="zoom:80%;"></li><li><p>寄存器</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507194149.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507194149.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_193959" style="zoom:80%;"><p>结果正确。</p></li><li><p>时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507194226.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507194226.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_194041" style="zoom: 50%;"><p>在使用静态调度后，发现停顿几乎没有了。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507194203.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507194203.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_194021" style="zoom:80%;"><p>发现RAW停顿有12个周期，停顿次数比没有静态调度时的72个少了很多。共执行了127个周期，比没有静态调度时的187个也少了很多，RAW停顿占周期总数的百分比为9.448819%，所有的停顿为24个周期，占周期总数的百分比为18.89764%，较没有静态调度时的44.91978%也减少了很多。</p></li></ul><p>  $$<br>  吞吐率TP_3=\frac{102}{127\Delta{t}}<br>  $$</p><p>  $$<br>  加速比S_2=\frac{102\times{5\Delta{t}}}{127\Delta{t}}\approx{4.02}<br>  $$<br>  吞吐率和加速比是没有静态调度时的$\frac{187}{127}\approx{1.47}$倍。</p><h3 id="6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。"><a href="#6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。" class="headerlink" title="6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。"></a>6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。</h3><ul><li><p>寄存器</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507195018.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507195018.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_194713" style="zoom:80%;"><p>结果正确。</p></li><li><p>时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507195031.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507195031.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_194926" style="zoom:50%;"><p>在使用静态调度和分支技术后，发现所有的RAW停顿都没有了，只剩下了控制停顿。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507195110.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507195110.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_195000" style="zoom:80%;"><p>发现没有RAW停顿。共执行了115个周期，比没有静态调度和定向技术时的187个也少了非常多，RAW停顿占周期总数的百分比为0%，所有的停顿为12个周期，全都是控制停顿，占周期总数的百分比为10.43478%，较没有静态调度和定向技术时的44.91978%也减少了非常多，没有RAW停顿也说明这个静态调度是最优调度。</p></li></ul><p>  $$<br>  吞吐率TP_4=\frac{102}{115\Delta{t}}<br>  $$</p><p>  $$<br>  加速比S_2=\frac{102\times{5\Delta{t}}}{115\Delta{t}}\approx{4.43}<br>  $$<br>  吞吐率和加速比是没有静态调度和定向技术时的$\frac{187}{115}\approx{1.63}$倍。</p><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="1、初始的汇编代码"><a href="#1、初始的汇编代码" class="headerlink" title="1、初始的汇编代码"></a>1、初始的汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU $r1,$r0,array1</span><br><span class="line">ADDIU $r2,$r0,array2</span><br><span class="line">ADDIU $r3,$r0,12</span><br><span class="line">ADDIU $r7,$r0,0</span><br><span class="line">loop:</span><br><span class="line">LW $r4,0($r1)</span><br><span class="line">LW $r5,0($r2)</span><br><span class="line">MUL $r6,$r4,$r5</span><br><span class="line">ADD $r7,$r7,$r6</span><br><span class="line">ADDI $r1,$r1,4</span><br><span class="line">ADDI $r2,$r2,4</span><br><span class="line">ADDI $r3,$r3,-1</span><br><span class="line">BGTZ $r3,loop</span><br><span class="line">TEQ $r0,$r0</span><br><span class="line">.data</span><br><span class="line">array1: .word 1,2,3,4,5,6,7,8,9,10,11,12</span><br><span class="line">array2: .word 1,2,3,4,5,6,7,8,9,10,11,12</span><br></pre></td></tr></table></figure><h3 id="2、经过静态调度后的汇编代码"><a href="#2、经过静态调度后的汇编代码" class="headerlink" title="2、经过静态调度后的汇编代码"></a>2、经过静态调度后的汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU $r1,$r0,array1</span><br><span class="line">ADDIU $r2,$r0,array2</span><br><span class="line">ADDIU $r3,$r0,12</span><br><span class="line">ADDIU $r7,$r0,0</span><br><span class="line">loop:</span><br><span class="line">LW $r4,0($r1)</span><br><span class="line">LW $r5,0($r2)</span><br><span class="line">ADDI $r1,$r1,4</span><br><span class="line">ADDI $r2,$r2,4</span><br><span class="line">MUL $r6,$r4,$r5</span><br><span class="line">ADDI $r3,$r3,-1</span><br><span class="line">ADD $r7,$r7,$r6</span><br><span class="line">BGTZ $r3,loop</span><br><span class="line">TEQ $r0,$r0</span><br><span class="line">.data</span><br><span class="line">array1: .word 1,2,3,4,5,6,7,8,9,10,11,12</span><br><span class="line">array2: .word 1,2,3,4,5,6,7,8,9,10,11,12</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于计算机系统结构实验三，使用MIPS指令实现求两个数组的点积。&lt;/p&gt;
    
    </summary>
    
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="汇编" scheme="https://666wxy666.github.io/tags/%E6%B1%87%E7%BC%96/"/>
    
      <category term="MIPS" scheme="https://666wxy666.github.io/tags/MIPS/"/>
    
  </entry>
  
  <entry>
    <title>计算机系统结构 实验 使用MIPS指令实现冒泡排序法</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E4%BD%BF%E7%94%A8MIPS%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E6%B3%95/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-%E4%BD%BF%E7%94%A8MIPS%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E6%B3%95/</id>
    <published>2020-08-24T01:38:51.212Z</published>
    <updated>2020-07-15T14:49:28.888Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于计算机系统结构实验四，使用MIPS指令实现冒泡排序法。</p><a id="more"></a><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol><li>掌握静态调度方法</li><li>增强汇编语言编程能力</li><li>学会使用模拟器中的定向功能进行优化</li></ol><h2 id="二、实验原理"><a href="#二、实验原理" class="headerlink" title="二、实验原理"></a>二、实验原理</h2><p>​        通过编写MIPS汇编程序，实现冒泡排序的功能。在模拟器MIPSsim上执行所写的汇编程序，查看结果，判断所写的汇编程序是否正确。然后观察时钟周期图窗口的执行过程和冲突的指令，查看统计窗口的信息，来判断定向前后和优化前后的执行效率高低。</p><h2 id="三、实验步骤及结果分析"><a href="#三、实验步骤及结果分析" class="headerlink" title="三、实验步骤及结果分析"></a>三、实验步骤及结果分析</h2><h3 id="1、自行编写一个实现冒泡排序的汇编程序，该程序要求可以实现对一维整数数组进行冒泡排序。"><a href="#1、自行编写一个实现冒泡排序的汇编程序，该程序要求可以实现对一维整数数组进行冒泡排序。" class="headerlink" title="1、自行编写一个实现冒泡排序的汇编程序，该程序要求可以实现对一维整数数组进行冒泡排序。"></a>1、自行编写一个实现冒泡排序的汇编程序，该程序要求可以实现对一维整数数组进行冒泡排序。</h3><p>冒泡排序算法的运作如下：</p><ol><li>比较相邻的元素。如果第一个比第二个大，就交换他们两个。</li><li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。在这一点， 最后的元素应该会是最大的数。</li><li>针对所有的元素重复以上的步骤，除了最后一个。</li><li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li></ol><p>要求数组长度不得小于10</p><p><strong><em>PS：汇编程序见附录。</em></strong></p><h3 id="2、启动-MIPSsim。"><a href="#2、启动-MIPSsim。" class="headerlink" title="2、启动 MIPSsim。"></a>2、启动 MIPSsim。</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507175654.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_175631" style="zoom: 50%;"><h3 id="3、载入自己编写的程序，观察流水线输出结果。"><a href="#3、载入自己编写的程序，观察流水线输出结果。" class="headerlink" title="3、载入自己编写的程序，观察流水线输出结果。"></a>3、载入自己编写的程序，观察流水线输出结果。</h3><p>载入的代码：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514192648.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514192648.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_192636" style="zoom:80%;"><p>执行结果：</p><ul><li><p>内存中的数组</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514192757.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514192757.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_192747" style="zoom:80%;"><p>原数组是{5,4,11,3,7,1,10,6,8,9,2}，排序后是{1,2,3,4,5,6,7,8,9,10,11}，结果符合预期，说明编写的汇编程序正确。</p></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514211749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514211749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_193022" style="zoom:80%;"><p>可以看到有非常多的停顿，主要是DSUB命令与BGTZ命令的RAW停顿，还有一些控制停顿。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514211802.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514211802.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_193232" style="zoom:80%;"><p>发现RAW停顿有417个周期，停顿次数非常多，可以进行优化。共执行了1076个周期，RAW停顿占周期总数的百分比为38.75465%，所有的停顿为537个周期，占周期总数的百分比为49.90706%，效率很低。<br>$$<br>吞吐率TP_1=\frac{538}{1076\Delta{t}}<br>$$</p><p>$$<br>加速比S_1=\frac{538\times{5\Delta{t}}}{1076\Delta{t}}={2.5}<br>$$</p></li></ul><h3 id="4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。"><a href="#4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。" class="headerlink" title="4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。"></a>4、使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。</h3><ul><li><p>内存中的数组</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514193632.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514193632.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_193627" style="zoom:80%;"><p>结果正确。</p></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514211946.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514211946.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_193708" style="zoom:80%;"><p>在使用定向技术后，发现停顿明显减少。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514211954.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514211954.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_194050" style="zoom:80%;"><p>发现RAW停顿有175个周期，停顿周期数比没有定向技术时的417个少了很多；</p><p>共执行了834个周期，比没有定向技术时的1076个也少了很多；</p><p>RAW停顿占周期总数的百分比为20.98321%，较没有定向技术时的38.75465%也减少了很多；</p><p>所有的停顿为295个周期，占周期总数的百分比为35.3717%，较没有定向技术时的49.90706%也减少了很多；</p><p>$$<br>吞吐率TP_2=\frac{538}{834\Delta{t}}<br>$$</p><p>$$<br>加速比S_2=\frac{538\times{5\Delta{t}}}{834\Delta{t}}\approx{3.23}<br>$$<br>吞吐率和加速比是没有定向技术时的$\frac{1076}{834}\approx{1.29}$倍。</p></li></ul><h3 id="5、采用静态调度方法重排指令序列，减少相关，优化程序"><a href="#5、采用静态调度方法重排指令序列，减少相关，优化程序" class="headerlink" title="5、采用静态调度方法重排指令序列，减少相关，优化程序"></a>5、采用静态调度方法重排指令序列，减少相关，优化程序</h3><p>因为主要是DSUB命令与BGTZ命令的RAW停顿，分支指令的操作数需要用到前面的结果，因此将后面pass中执行的<code>ADDIU $r4, $r4, 1</code>和<code>DSUB $r8, $r2, $r4</code>拿到loop2中执行，从而减少RAW停顿。</p><p><strong><em>PS：静态调度后的汇编程序见附录。</em></strong></p><ul><li><p>载入代码</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514205322.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514205322.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_205303" style="zoom:80%;"></li><li><p>内存中的数组</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514205458.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514205458.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_205419" style="zoom:80%;"><p>结果正确。</p></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514212233.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514212233.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_211607" style="zoom:80%;"><p>在使用静态调度后，发现停顿少了很多。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514212255.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514212255.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_211624" style="zoom:80%;"><p>发现RAW停顿有142个周期，停顿周期数比没有静态调度时的417个少了很多；</p><p>共执行了801个周期，比没有静态调度时的1076个也少了很多；</p><p>RAW停顿占周期总数的百分比为17.72784%，较没有静态调度时的38.75465%也减少了很多；</p><p>所有的停顿为262个周期，占周期总数的百分比为32.70911%，较没有静态调度时的49.90706%也减少了很多；</p><p>$$<br>吞吐率TP_3=\frac{538}{801\Delta{t}}<br>$$</p><p>$$<br>加速比S_3=\frac{538\times{5\Delta{t}}}{801\Delta{t}}\approx{3.36}<br>$$</p><p>吞吐率和加速比是没有静态调度时的$\frac{1076}{801}\approx{1.34}$倍。</p></li></ul><h3 id="6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。"><a href="#6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。" class="headerlink" title="6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。"></a>6、对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的不同。</h3><ul><li><p>内存中的数组</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514205458.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514205458.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_205419" style="zoom:80%;"><p>结果正确。</p></li><li><p>部分时钟周期图</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514212858.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514212858.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_211701" style="zoom:80%;"><p>在使用静态调度和定向技术后，发现所有的RAW停顿几乎没有了，几乎只剩下了控制停顿。</p></li><li><p>统计</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514212914.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514212914.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-14_211714" style="zoom:80%;"><p>发现RAW停顿有10个周期，停顿周期数比没有静态调度和定向技术时的417个少了非常多；</p><p>共执行了669个周期，比没有静态调度和定向技术时的1076个也少了非常多；</p><p>RAW停顿占周期总数的百分比为1.494768%，较没有静态调度和定向技术时的38.75465%也减少了非常多；</p><p>所有的停顿为130个周期，占周期总数的百分比为19.43199%，较没有静态调度和定向技术时的49.90706%也减少了很多；</p><p>$$<br>吞吐率TP_4=\frac{538}{669\Delta{t}}<br>$$</p><p>$$<br>加速比S_4=\frac{538\times{5\Delta{t}}}{669\Delta{t}}\approx{4.02}<br>$$</p><p>吞吐率和加速比是没有静态调度和定向技术时的$\frac{1076}{669}\approx{1.61}$倍。</p></li></ul><h2 id="四、实验遇到的问题"><a href="#四、实验遇到的问题" class="headerlink" title="四、实验遇到的问题"></a>四、实验遇到的问题</h2><p>​        本次实验中遇到了一个问题，如果main到下一个标签（比如loop1）只有一行汇编代码，在载入程序时，loop1的基地址就会和main重合，变为0x00000000，这样就导致loop1被覆盖，使载入的程序与自己编写的汇编程序不符，产生错误或者结果出错。但是如果&gt;=2行汇编代码就不会有问题，我怀疑是MIPSsim程序的bug。</p><h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><h3 id="1、初始的汇编代码"><a href="#1、初始的汇编代码" class="headerlink" title="1、初始的汇编代码"></a>1、初始的汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU $r1, $r0, 11# 数组长度n&#x3D;11</span><br><span class="line">ADDIU $r2, $r1, -1# 外循环i&#x3D;n-1&#x3D;10</span><br><span class="line"></span><br><span class="line">loop1:</span><br><span class="line">ADDIU $r3, $r0, array# 数组起始地址</span><br><span class="line">ADDIU $r4, $r0, 0# 内循环j&#x3D;0</span><br><span class="line"></span><br><span class="line">loop2:</span><br><span class="line">LW $r5, 0($r3)# a[j]</span><br><span class="line">LW $r6, 4($r3)# a[j+1]</span><br><span class="line">DSUB $r7, $r6, $r5# a[j+1]-a[j]</span><br><span class="line">BGTZ $r7, pass# a[j+1]&gt;a[j]，不交换，跳到pass；</span><br><span class="line"></span><br><span class="line">SW $r6, 0($r3)# a[j+1]&lt;a[j]，交换</span><br><span class="line">SW $r5, 4($r3)</span><br><span class="line"></span><br><span class="line">pass:</span><br><span class="line">ADDIU $r4, $r4, 1# j++</span><br><span class="line">ADDIU $r3, $r3, 4# 取数组的下一个元素</span><br><span class="line">DSUB $r8, $r2, $r4# i-j</span><br><span class="line">BGTZ $r8, loop2# i&gt;j，跳转到loop2，继续内循环</span><br><span class="line"></span><br><span class="line">ADDIU $r2, $r2, -1# i--</span><br><span class="line">BGTZ $r2, loop1# i&gt;0，跳转到loop1，继续外循环</span><br><span class="line"></span><br><span class="line">TEQ $r0, $r0</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">array: .word 5,4,11,3,7,1,10,6,8,9,2</span><br></pre></td></tr></table></figure><h3 id="2、经过静态调度后的汇编代码"><a href="#2、经过静态调度后的汇编代码" class="headerlink" title="2、经过静态调度后的汇编代码"></a>2、经过静态调度后的汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">main:</span><br><span class="line">ADDIU $r1, $r0, 11# 数组长度n&#x3D;11</span><br><span class="line">ADDIU $r2, $r1, -1# 外循环i&#x3D;n-1&#x3D;10</span><br><span class="line"></span><br><span class="line">loop1:</span><br><span class="line">ADDIU $r3, $r0, array# 数组起始地址</span><br><span class="line">ADDIU $r4, $r0, 0# 内循环j&#x3D;0</span><br><span class="line"></span><br><span class="line">loop2:</span><br><span class="line">LW $r5, 0($r3)# a[j]</span><br><span class="line">LW $r6, 4($r3)# a[j+1]</span><br><span class="line">ADDIU $r4, $r4, 1# j++</span><br><span class="line">DSUB $r7, $r6, $r5# a[j+1]-a[j]</span><br><span class="line">DSUB $r8, $r2, $r4# i-j</span><br><span class="line">BGTZ $r7, pass# a[j+1]&gt;a[j]，不交换，跳到pass；</span><br><span class="line"></span><br><span class="line">SW $r6, 0($r3)# a[j+1]&lt;a[j]，交换</span><br><span class="line">SW $r5, 4($r3)</span><br><span class="line"></span><br><span class="line">pass:</span><br><span class="line">ADDIU $r3, $r3, 4# 取数组的下一个元素</span><br><span class="line">BGTZ $r8, loop2# i&gt;j，跳转到loop2，继续内循环</span><br><span class="line"></span><br><span class="line">ADDIU $r2, $r2, -1# i--</span><br><span class="line">BGTZ $r2, loop1# i&gt;0，跳转到loop1，继续外循环</span><br><span class="line"></span><br><span class="line">TEQ $r0, $r0</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">array: .word 5,4,11,3,7,1,10,6,8,9,2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于计算机系统结构实验四，使用MIPS指令实现冒泡排序法。&lt;/p&gt;
    
    </summary>
    
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="汇编" scheme="https://666wxy666.github.io/tags/%E6%B1%87%E7%BC%96/"/>
    
      <category term="MIPS" scheme="https://666wxy666.github.io/tags/MIPS/"/>
    
  </entry>
  
  <entry>
    <title>计算机系统结构 实验 1和2遇到的问题</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-1%E5%92%8C2%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84-%E5%AE%9E%E9%AA%8C-1%E5%92%8C2%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2020-08-24T01:38:51.210Z</published>
    <updated>2020-07-15T14:49:28.888Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于计算机系统结构实验一（MIPS指令系统和MIPS体系结构）和实验二（流水线及流水线中的冲突），遇到的一些问题。</p><a id="more"></a><h2 id="一、关于字"><a href="#一、关于字" class="headerlink" title="一、关于字"></a>一、关于字</h2><p>B:byte 字节指令</p><p>H:half word 半字节指令</p><p>W:word 字节指令</p><h2 id="二、关于访存"><a href="#二、关于访存" class="headerlink" title="二、关于访存"></a>二、关于访存</h2><p>按字或半字访存，无论给定地址是字（半字）中的哪一个字节的地址，都会自动转换为该字（半字）的首字节的地址。例如：MIPS中字长4字节，32位（红色框）；半字2字节，16位（蓝色框）。无论你给定的是第一个红框里的7C(0x00000000)/00(0x00000001)/08(0x00000002)/24(0x00000003)的哪一的地址，只要是按字访存，都会自动转换为7C的地址0x00000000，取出的内容都是2408007C，**<em>一定要注意，这里是小端法存储**</em>。</p><ul><li><p>小端法：高内存地址放整数的高位，低内存地址放整数的低位，这种方式叫倒着放，术语叫小端对齐。电脑X86和手机ARM都是小端对齐的。</p></li><li><p>大端法：高内存地址放整数的低位，低内存地址放整数的高位，这种方式叫正着放，术语叫大端对齐。很多Unix服务器的cpu都是大端对齐的。</p></li></ul><p>大端和小端字节序不是由操作系统决定的，而是由cpu架构决定的。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200419150741.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200419150741.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-19_150338" style="zoom:80%;"><h2 id="三、关于返回地址"><a href="#三、关于返回地址" class="headerlink" title="三、关于返回地址"></a>三、关于返回地址</h2><p>关于这里的**<em>返回地址**</em>，后面的所有其他跳转指令的返回地址均指的是：当前指令的下一条指令的地址，也就是跳转指令如果不跳转（分支失败）的下一条指令的地址。例如：当前的指令的地址是0x00000068，那么返回地址就是0x00000072。还要注意offset要左移两位并进行符号位扩展后才能与PC相加得到转移地址。这里左移两位的目的是，将offset*4，使之成为4的倍数。也就是说PC+offset&lt;&lt;2代表了PC的后offset+1（因为PC+offset&lt;&lt;2的PC已经+1了）条指令为转移指令。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200419152615.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200419152615.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200419152549" style="zoom:80%;"><h2 id="四、关于定向技术"><a href="#四、关于定向技术" class="headerlink" title="四、关于定向技术"></a>四、关于定向技术</h2><p>在定向技术中，因为其采用的是静态指令调度。非运算类指令必须在 ID段 得到之前指令的定向数据。并不能像运算类执行一样在 EX段 得到定向数据；如图所示：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518210441.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518210441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="307-实验二-第二组" style="zoom:80%;"><h2 id="五、关于STALL"><a href="#五、关于STALL" class="headerlink" title="五、关于STALL"></a>五、关于STALL</h2><p>“绿色<font color="red">ID</font>后跟绿色ID” 和 “绿色STALL后跟绿色ID”的区别：<br>绿色<font color="red">ID</font>表示该周期ID可以执行，但是存在RAW冲突，因此执行失败，因此紧接着要做绿色ID；<br>绿色STALL表示该周期由于上一条指令的红色STALL，导致该指令此周期停顿，下一周期执行绿色ID。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于计算机系统结构实验一（MIPS指令系统和MIPS体系结构）和实验二（流水线及流水线中的冲突），遇到的一些问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="计算机系统结构" scheme="https://666wxy666.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"/>
    
      <category term="汇编" scheme="https://666wxy666.github.io/tags/%E6%B1%87%E7%BC%96/"/>
    
      <category term="MIPS" scheme="https://666wxy666.github.io/tags/MIPS/"/>
    
  </entry>
  
  <entry>
    <title>编译原理 词法分析</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/</id>
    <published>2020-08-24T01:38:51.208Z</published>
    <updated>2020-08-24T01:49:01.803Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是编译原理C语言词法分析器的简单实现项目。</strong></p><a id="more"></a><h2 id="一、需求"><a href="#一、需求" class="headerlink" title="一、需求"></a>一、需求</h2><p>词法分析程序的设计和实现。</p><p>设计并实现C语言的词法分析程序，要求如下： </p><ol><li>可以识别出用C语言编写的源程序中的每个单词符号，并以记号的形式输出每个单词符号。</li><li>可以识别并读取源程序中的注释。</li><li>可以统计源程序汇总的语句行数、各类单词的个数、以及字符个数，并输出统计结果。</li><li>检查源程序中存在的词法错误，并报告错误所在的位置。</li><li>对源程序中存在的错误进行适当的恢复，使词法分析可以继续进行，对源程序进行一次扫描即可检查并报告源程序中存在的所有词法错误。</li></ol><h2 id="二、运行环境"><a href="#二、运行环境" class="headerlink" title="二、运行环境"></a>二、运行环境</h2><p>电脑硬件配置：</p><ul><li><p>处理器：Intel i7 7700HQ</p></li><li><p>显卡：NVIDIA GeForce GTX 1050 Ti</p></li><li><p>内存：16GB</p></li></ul><p>软件：</p><ul><li><p>编程语言：C++</p></li><li><p>IDE：Microsoft Visual Studio 2019</p></li><li><p>Windows SDK版本：10.0</p></li><li><p>平台工具集：Visual Studio 2019（v142）</p></li></ul><h2 id="三、核心算法"><a href="#三、核心算法" class="headerlink" title="三、核心算法"></a>三、核心算法</h2><p>读入源程序，将源程序拆分为单词，同时去除空格和空行并存入vector中，一个字符一个字符的读入自动机，文件输出单词和类型，并在最后输出统计结果，在屏幕输出错误。</p><p>PS:不支持中文字符</p><h3 id="源程序的记号和表达式："><a href="#源程序的记号和表达式：" class="headerlink" title="源程序的记号和表达式："></a>源程序的记号和表达式：</h3><ol><li><p>标识符：字母或“_”开头，后跟字母或数字或“_”组成的符号串</p></li><li><p>关键字：标识符集合的子集。C语言有32个关键字，分别为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"do"</span>,<span class="string">"double"</span>,<span class="string">"auto"</span>,<span class="string">"break"</span>,<span class="string">"case"</span>,<span class="string">"char"</span>,<span class="string">"const"</span>,<span class="string">"continue"</span>,<span class="string">"default"</span>,<span class="string">"else"</span>,<span class="string">"enum"</span>,<span class="string">"extern"</span>,<span class="string">"float"</span>,<span class="string">"for"</span>,<span class="string">"goto"</span>,<span class="string">"if"</span>,<span class="string">"int"</span>,<span class="string">"long"</span>,<span class="string">"register"</span>,<span class="string">"return"</span>,<span class="string">"struct"</span>,<span class="string">"switch"</span>,<span class="string">"typedef"</span>,<span class="string">"short"</span>,<span class="string">"signed"</span>,<span class="string">"sizeof"</span>,<span class="string">"static"</span>,<span class="string">"union"</span>,<span class="string">"unsigned"</span>,<span class="string">"void"</span>,<span class="string">"volatile"</span>,<span class="string">"while"</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>数字：由整数部分、可选小数部分和可选整数部分构成</p></li><li><p>运算符：</p></li></ol><pre><code>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ( ) ~ &amp; ^ % &lt;= &lt;&lt; &lt; &gt;= &gt;&gt; &gt; = == / != ! &amp;&amp; &amp; || | -&gt; - : ?</span><br></pre></td></tr></table></figure></code></pre><ol start="5"><li><p>分隔符：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; # ’ ” [ ] &#123; &#125; ,</span><br></pre></td></tr></table></figure></li><li><p>转义符：\</p></li></ol><h3 id="状态转换图："><a href="#状态转换图：" class="headerlink" title="状态转换图："></a>状态转换图：</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200824091143.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824091143.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom: 50%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200824091151.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824091151.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="22" style="zoom: 50%;"><h3 id="输入形式："><a href="#输入形式：" class="headerlink" title="输入形式："></a>输入形式：</h3><p>文件输入。</p><h3 id="输出形式："><a href="#输出形式：" class="headerlink" title="输出形式："></a>输出形式：</h3><p>分两部分：文件输出和屏幕输出。文件输出分析内容，分四部分：按文件顺序输出类型和表达式，每种表达式数量统计，每种类型数量统计，行数、单词数、字符数统计；屏幕输出错误。详见输出样例部分。</p><h2 id="四、变量和函数"><a href="#四、变量和函数" class="headerlink" title="四、变量和函数"></a>四、变量和函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> start = <span class="number">0</span>, over = <span class="number">0</span>, first = <span class="number">0</span>;<span class="comment">//指针</span></span><br><span class="line"><span class="keyword">int</span> letters = <span class="number">0</span>, lines = <span class="number">0</span>, words = <span class="number">0</span>;<span class="comment">//统计单词数，行数和字符数的变量</span></span><br><span class="line"><span class="keyword">int</span> state;<span class="comment">//状态变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">str</span>//单词类</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">int</span> linenum;<span class="comment">//行号</span></span><br><span class="line"><span class="built_in">string</span> Str;<span class="comment">//单词       </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出文件名</span></span><br><span class="line"><span class="built_in">string</span> file_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回单词或符号,从位置i开始查找，引用参数j返回这个单词最后一个字符在str的位置。</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">GetWord</span><span class="params">(<span class="built_in">string</span> str, <span class="keyword">int</span> i, <span class="keyword">int</span>&amp; j)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//除去字符串中连续的空格和换行。第一个参数为目标字符串，第二个参数为开始位置。返回值为第一个有效字符在字符串的位置</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_nbc</span><span class="params">(<span class="built_in">string</span> str, <span class="keyword">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件输出函数，成功输出返回true，失败返回false</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Output</span><span class="params">(<span class="built_in">vector</span>&lt;pair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; &gt; v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//词法分析主要算法函数，返回一个pair型数组</span></span><br><span class="line">vector&lt;pair&lt;string, string&gt; &gt; analyse(vector&lt;str&gt;&amp; vec);</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断str是否为关键字，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsKey</span><span class="params">(<span class="built_in">string</span> str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断C是否为字母，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">letter</span><span class="params">(<span class="keyword">char</span> C)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断C是否为数字，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">digit</span><span class="params">(<span class="keyword">char</span> C)</span></span>;</span><br></pre></td></tr></table></figure><p>详细代码见文末github项目。</p><h2 id="五、测试样例："><a href="#五、测试样例：" class="headerlink" title="五、测试样例："></a>五、测试样例：</h2><table><thead><tr><th><img src="https://gitee.com/wxy_666/images/raw/master/20200824093509.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093509.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="11"></th><th><img src="https://gitee.com/wxy_666/images/raw/master/20200824093524.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093524.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="12" style="zoom: 67%;"></th></tr></thead><tbody><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093559.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093559.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="13" style="zoom:80%;"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093612.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093612.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="14" style="zoom:80%;"></td></tr><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093708.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093708.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="15"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093715.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093715.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="16" style="zoom: 67%;"></td></tr></tbody></table><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><div class="btns rounded center grid1">            <a class="button" href="https://github.com/666WXY666/cifafenxi" target="_blank" rel="external nofollow noopener noreferrer" title="源码仓库"><i class="fas fa-download"></i>源码仓库</a>          </div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是编译原理C语言词法分析器的简单实现项目。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/categories/C-C/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="编译原理" scheme="https://666wxy666.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="词法分析" scheme="https://666wxy666.github.io/tags/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>现代交换原理 MOOC习题 5~6章</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/</id>
    <published>2020-08-24T01:38:51.197Z</published>
    <updated>2020-08-20T07:08:06.904Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。接上一部分<a href="/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/">现代交换原理 MOOC习题 1~4章</a>。</p><a id="more"></a><h2 id="第五章-信令与协议"><a href="#第五章-信令与协议" class="headerlink" title="第五章 信令与协议"></a>第五章 信令与协议</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200518094712.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518094712.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094257" style="zoom:80%;"><blockquote><p>通话所需的媒体资源可以理解为控制呼叫的接续和拆线和通信网管理和维护的信息资源。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518094755.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518094755.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200518094332" style="zoom:80%;"><blockquote><p>通信网中为用户建立连接和拆除连接，需要网中各个相关设备协调工作，为此在各个设备间传输的控制信号和规约称为信令。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095101.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095101.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094308" style="zoom:80%;"><blockquote><p>路由标记供MTP3级进行消息寻址和路由，而MTP3的路由标记是由信令点编码实现的。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095738.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095738.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200518094345" style="zoom:80%;"><blockquote><ol start="4"><li><p>电信网（现代通信网）的三大支撑网络：同步网，管理网，信令网。</p></li><li><p>SIP与普通电话用户进行通话时要进行协议转换，SIP-&gt;七号信令。SIP协议中SDP的媒体端口号由网关（中继网关）保存。中继网关是分组网和电路网边界设备，实现不同媒体协议的转换。</p><p>注意中继网关（Trunk Gateway）跟代理服务器（Proxy Server）不是一个东西。</p><p>中继网关也叫落地设备，简称TG。用于VOIP网络电话系统或呼叫中心、软交换等，将模拟信号与数字信号相互转换。是voip解决方案的重要组成部分，它位于NGN网络的边缘接入层，连接PSTN和voip网络，实现IP包转TDM的功能。 承载着IP域与电路域的语音汇接任务。</p></li><li><p>常识问题。</p></li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095251.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095251.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094440" style="zoom:80%;"><blockquote><ol start="7"><li><p>显然错误，MTP1的通路也要经过TST交换网络。</p></li><li><p>错误，不多解释。</p></li><li><p>模拟用户信令：主要包括用户向交换机发送的监视信令和选择信令，交换机向用户发送的铃流和忙音等音信号。**<em>用于PSTN**</em>。</p><ul><li>状态信令：用户线的忙闲状态，如主、被叫的摘、挂机状态；</li><li>地址信令：主叫所拨的被叫号码，直流脉冲或双音频；</li><li>铃流和信号音：交换机向用户发送的信号。振铃信号、信号音、来电显示的FSK信号；</li></ul><p>数字用户信令：通过消息的形式传送以上信息，**<em>用于ISDN用户**</em>。例如：DSS1 30B+D</p><p>在用户线上传输的信令叫用户线信令，No.7信令是专为电话局之间交互控制信息而设计的，所以是局间信令，也就是在中继线上交互的信令，以数字信号方式传送。它跟能否携带电话号码没关系。</p></li></ol></blockquote><h2 id="第六章-移动交换"><a href="#第六章-移动交换" class="headerlink" title="第六章 移动交换"></a>第六章 移动交换</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200531205352.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531205352.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_205201" style="zoom:80%;"><blockquote><p>MSC是移动交换中心，主要功能有：</p><ol><li>信道的管理和分配；</li><li>呼叫的处理和控制；</li><li>用户位置信息的登记与管理；</li><li>越区切换和漫游的控制；</li><li>号码的登记和管理；</li><li>服务类型的鉴权；</li><li>用户的鉴权；</li><li>提供链路接口；</li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200531210710.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210710.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_205837" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210722.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210722.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210158" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210742.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210742.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210414" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210756.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210756.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210611" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210809.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210809.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210653" style="zoom:80%;"><blockquote><p>相关签约信息及4G位置信息不是存在MME中，而是HSS。</p></blockquote><details><summary> <p>所有的习题：</p> </summary>              <div class="content">              <p><a href="/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/">现代交换原理 MOOC习题 1~4章</a></p><p><a href="/2020/05/18/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/">现代交换原理 MOOC习题 5~6章</a></p>              </div>            </details>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。接上一部分&lt;a href=&quot;/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/&quot;&gt;现代交换原理 MOOC习题 1~4章&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/%E4%B9%A0%E9%A2%98/"/>
    
    
      <category term="习题" scheme="https://666wxy666.github.io/tags/%E4%B9%A0%E9%A2%98/"/>
    
      <category term="易错点" scheme="https://666wxy666.github.io/tags/%E6%98%93%E9%94%99%E7%82%B9/"/>
    
      <category term="网课" scheme="https://666wxy666.github.io/tags/%E7%BD%91%E8%AF%BE/"/>
    
      <category term="MOOC" scheme="https://666wxy666.github.io/tags/MOOC/"/>
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/tags/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>现代交换原理 MOOC习题 1~4章</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/</id>
    <published>2020-08-24T01:38:51.195Z</published>
    <updated>2020-07-15T14:49:28.887Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。</p><a id="more"></a><h2 id="第一章-交换概论"><a href="#第一章-交换概论" class="headerlink" title="第一章 交换概论"></a>第一章 交换概论</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507105053.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507105053.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_104537" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507105117.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507105117.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_104811" style="zoom:80%;"><blockquote><p>都是类似的道理，话音业务需要实时、高可靠、恒定速率，因此电路交换适合，异步显然不适合于话音业务。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507105241.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507105241.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_104943" style="zoom:80%;"><blockquote><p>电路交换是先建立好链路，在进行的交换。路由选择是先进行的，信息转发在建立好的链路上进行。分组交换是上面描述的特点。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507105428.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507105428.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_105021" style="zoom:80%;"><blockquote><p>通信网三要素是：<strong>交换设备</strong>、<strong>传输设备</strong>、<strong>终端设备</strong>。</p><p>交换网络的三要素是：<strong>交换单元</strong>、不同交换单元间的<strong>拓扑连接</strong>、<strong>控制方式</strong>。</p></blockquote><h2 id="第二章-交换网络"><a href="#第二章-交换网络" class="headerlink" title="第二章 交换网络"></a>第二章 交换网络</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507110011.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507110011.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_110001" style="zoom:80%;"><blockquote><p>交换单元的端口类型有两种：控制端口和状态端口。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507110554.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507110554.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_110356" style="zoom:80%;"><blockquote><p>T接线器：</p><ul><li><p>话音存储器（SM）：固定每个存储单元8bit存话音，存储单元的数量m就是时隙数m。</p></li><li><p>控制存储器（CM）：存储单元大小为$\log_2{m}$，所以时隙数一般都是2的幂次，存储单元的数量m也是时隙数m。</p></li></ul></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507110608.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507110608.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_110547" style="zoom:80%;"><blockquote><p>S接线器没有话音存储器，控制存储器（CM），可以把S接线器的所有的控制存储器看成$m\times{n}$个方格，m为时隙数，n为入（出）线数：</p><ul><li>S接线器所含CM的数量就是入（出）线数n，也就是一列为一个CM，共有n列。</li><li>每个CM所含的存储单元的数量为入（出）线的时隙数m，也就是每个格代表一个存储单元，每个CM有m个存储单元，m行。</li><li>每个存储单元的大小为$\log_2{m}$bit。</li></ul></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507114923.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507114923.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_114828" style="zoom:80%;"><blockquote><p>$N\times{N}$的Banyan网络需要$k=\log_2{N}$级，如果要使用$2\times{2}$的交换单元构建，那么每层就需要$\frac{N}{2}$个交换单元，k层共需要$k\times{\frac{N}{2}}=\frac{N}{2}\times{\log_2{N}}$，如果是M层的话，则需要$m\times{\frac{N}{2}\times{\log_2{N}}}$个$2\times{2}$的交换单元。</p><p>因此这个题需要$3\times{\frac{8}{2}\times{\log_2{8}}}=36$个$2\times{2}$的交换单元。</p></blockquote><h2 id="第三章-电路交换"><a href="#第三章-电路交换" class="headerlink" title="第三章 电路交换"></a>第三章 电路交换</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507120505.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120505.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120218" style="zoom:80%;"><blockquote><p>常识知识。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507120512.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120512.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120231" style="zoom:80%;"><blockquote><p>示意图：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518151446.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518151446.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3" style="zoom: 50%;"><p>B+C-&gt;A：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518151822.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518151822.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="第3章 电路交换" style="zoom: 50%;"></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507120522.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120522.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120244" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507120530.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120530.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120310" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507120538.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120538.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120324" style="zoom:80%;"><blockquote><p>这三个题都是基础知识。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507120551.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120551.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120336" style="zoom:80%;"><blockquote><p>直连？应该是可以实现不经过交换设备的语音通信。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507120610.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120610.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120432" style="zoom:80%;"><blockquote><p>用户模块的处理机与区域处理机相连，区域处理机又与其他区域处理机和中央处理机相连。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507120618.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507120618.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120449" style="zoom:80%;"><blockquote><p>周期级程序是按一定周期进行的各种扫描和驱动，例如200ms摘挂机扫描。开通业务应该是基本级程序负责。</p></blockquote><h2 id="第四章-分组交换"><a href="#第四章-分组交换" class="headerlink" title="第四章 分组交换"></a>第四章 分组交换</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507121042.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121042.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120658" style="zoom:80%;"><blockquote><p>TCP连接的建立不是路由器基本功能。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121049.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121049.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120714" style="zoom:80%;"><blockquote><p>ISDN全称是综合业务数字网，不需要支持模拟业务。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121056.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121056.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120733" style="zoom:80%;"><blockquote><p>ATM 适配层（AAL）主要负责百 ATM 层与高层之间的信元转发过程。从上层收到信息后，AAL 将数据分割成 ATM 信元；从 ATM 层收到信息后，AAL 必须重度新组合数据形成一专个上层能够辨识的格式。上述操作称之为分段与重组（SAR），它是 AAL 的主要任务。此外不同的 AAL 支持属不同的流量或服务类型。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121103.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121103.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120808" style="zoom:80%;"><blockquote><p>MPLS标记可以任意级，标记栈实现多级标记，Label可以有多个。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121110.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121110.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_120850" style="zoom:80%;"><blockquote><p>A、MPLS和ATM和帧中继都是路由选择和数据转发分开进行，都是面向连接的，但是不需要为每一次通信业务都建立新的连接；而传统IP网是无连接的，路由选择和数据转发同时进行。</p><p>B、MPLS和ATM都是虚连接，使用时连接，不需要时可以拆除连接，不是永久连接。</p><p>C、MPLS使用的是Label标记方式的逻辑连接，ATM是VPI/VCI方式的逻辑连接，都是逻辑虚连接。</p><p>D、MPLS通过LDP等协议，在LSR和LER、LSR和LSR之间完成标记信息的分发，形成与FEC对应的LSP路径。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121116.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121116.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_121004" style="zoom:80%;"><blockquote><p>同上一个题的D选项。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121127.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121127.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_121012" style="zoom:80%;"><blockquote><ol><li><p>入口LER接收分组，完成第三层功能，判定分组所属的FEC，并给分组加上标记形成MPLS标记分组。</p></li><li><p>LSR依据分组上的标记以及标记转发表通过交换单元对其进行转发，不再进行任何第三层处理，也就是只处理标记部分，不处理IP分组头。</p></li><li><p>出口 LER 将分组中的标记去掉后转发至目的地。</p></li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507121133.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507121133.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_121029" style="zoom:80%;"><blockquote><p>MPLS与ATM/FR类似，标记都是本地（逐段）有效的，需要路由器进行标记转换。</p></blockquote><details><summary> <p>所有的习题：</p> </summary>              <div class="content">              <p><a href="/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/">现代交换原理 MOOC习题 1~4章</a></p><p><a href="/2020/05/18/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/">现代交换原理 MOOC习题 5~6章</a></p>              </div>            </details>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/%E4%B9%A0%E9%A2%98/"/>
    
    
      <category term="习题" scheme="https://666wxy666.github.io/tags/%E4%B9%A0%E9%A2%98/"/>
    
      <category term="易错点" scheme="https://666wxy666.github.io/tags/%E6%98%93%E9%94%99%E7%82%B9/"/>
    
      <category term="网课" scheme="https://666wxy666.github.io/tags/%E7%BD%91%E8%AF%BE/"/>
    
      <category term="MOOC" scheme="https://666wxy666.github.io/tags/MOOC/"/>
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/tags/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>杂项工程项目集锦</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9D%82%E9%A1%B9%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%E9%9B%86%E9%94%A6/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9D%82%E9%A1%B9%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%E9%9B%86%E9%94%A6/</id>
    <published>2020-08-24T01:38:51.194Z</published>
    <updated>2020-07-15T14:49:28.887Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是一些我曾经写过的项目工程集锦。</strong></p><a id="more"></a><p>这些项目的源码、可执行程序、报告等已经存放于我的Github，欢迎下载查看：</p><h2 id="1、Python爬虫、数据处理、数据分析、数据可视化"><a href="#1、Python爬虫、数据处理、数据分析、数据可视化" class="headerlink" title="1、Python爬虫、数据处理、数据分析、数据可视化"></a>1、Python爬虫、数据处理、数据分析、数据可视化</h2><div class="btns rounded center grid3">            <a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E5%AD%A6%E6%A0%A1%E5%92%8C%E6%88%BF%E4%BB%B7%E7%88%AC%E8%99%AB%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="学校和房价爬虫小项目"><i class="fas fa-download"></i>学校和房价爬虫小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="数据预处理小项目"><i class="fas fa-download"></i>数据预处理小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%88%BF%E4%BB%B7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="房价数据分析小项目"><i class="fas fa-download"></i>房价数据分析小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="数据可视化小项目"><i class="fas fa-download"></i>数据可视化小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E4%BA%AC%E4%B8%9C%E6%B7%98%E5%AE%9D%E6%89%8B%E6%9C%BA%E7%88%AC%E8%99%AB%E5%88%86%E6%9E%90%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="京东淘宝手机爬虫分析项目"><i class="fas fa-download"></i>京东淘宝手机爬虫分析项目</a>          </div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是一些我曾经写过的项目工程集锦。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="杂项" scheme="https://666wxy666.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="C" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 知识拓展 条件熵</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%9F%A5%E8%AF%86%E6%8B%93%E5%B1%95-%E6%9D%A1%E4%BB%B6%E7%86%B5/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%9F%A5%E8%AF%86%E6%8B%93%E5%B1%95-%E6%9D%A1%E4%BB%B6%E7%86%B5/</id>
    <published>2020-08-24T01:38:51.184Z</published>
    <updated>2020-07-27T10:06:08.081Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于条件熵的知识拓展。</p><a id="more"></a><h2 id="一、问题："><a href="#一、问题：" class="headerlink" title="一、问题："></a>一、问题：</h2><p>假定数据库有𝑁个人，第𝑛个人的先验概率$\gamma_n$，有𝐾个问题，假定第𝑛个人对第𝑘个问题答案为“是”的概率为$a_{nk}$，请给出给定第𝑘个问题条件下，数据集的条件熵的计算公式。</p><h2 id="二、解析"><a href="#二、解析" class="headerlink" title="二、解析"></a>二、解析</h2><p>原来的条件熵公式为：</p><p>$$<br>H(Y|X)=\sum_{x}{P(x)H(Y|X=x)}<br>$$</p><p>因为此题中X的取值只有两个即‘是’和‘否’，因此公式变为：</p><p>$$<br>H(Y|X)=P(X=是)H(Y|X=是)+P(X=否)H(Y|X=否)<br>$$</p><p>因此先计算对于第k个问题，X=‘是’的样本占总样本的概率P(X=是)和X=‘否’的样本占总样本的概率P(X=否)。</p><p>分子为对于第k个问题回答为‘是’的个数即：</p><p>$$<br>\sum^{N}_{i=1}{(N\times\gamma_i\times a_{ik})}<br>$$</p><p>分母为总数N，因此P(X=是)：</p><p>$$<br>P(X=是)=\frac{\sum^{N}_{i=1}{(N\times\gamma_i\times a_{ik}})}{N}<br>$$</p><p>$$<br>P(X=是)=\sum^{N}_{i=1}{(\gamma_i\times a_{ik})}<br>$$</p><p>同理，P(X=否)：</p><p>$$<br>P(X=否)=\frac{\sum^{N}_{i=1}{[N\times\gamma_i\times (1-a_{ik})}]}{N}<br>$$</p><p>$$<br>P(X=否)=\sum^{N}_{i=1}{[\gamma_i\times (1-a_{ik})]}<br>$$</p><p>然后在计算对于第k个问题，X=‘是’的数据集上Y的信息熵和X=‘否’的数据集上Y的信息熵，也就是：</p><p>$$<br>H(Y|X=是)=-\sum^{N}_{j=1}{(p(x_j)\log p(x_j))}<br>$$</p><p>$$<br>H(Y|X=否)=-\sum^{N}_{j=1}{(q(x_j)\log q(x_j))}<br>$$</p><p>因此要先计算对于第k个问题，X=‘是’的时候，对应每个人‘j’的概率$p(x_j)$。</p><p>分子为对于第k个问题，X=‘是’的时候，‘j’这个人的个数：</p><p>$$<br>N\times\gamma_j\times{a_{jk}}<br>$$</p><p>分母为对于第k个问题所有X=‘是’的个数，也就是上述的P(X=是)的分子：</p><p>$$<br>\sum^{N}_{i=1}{(N\times\gamma_i\times a_{ik})}<br>$$</p><p>或者写为：</p><p>$$<br>P(X=是)\times{N}<br>$$</p><p>因此$p(x_j)$：</p><p>$$<br>p(x_j)=\frac{N\times\gamma_j\times{a_{jk}}}{\sum^{N}_{i=1}{(N\times\gamma_i\times a_{ik}})}<br>$$</p><p>$$<br>p(x_j)=\frac{\gamma_j\times{a_{jk}}}{\sum^{N}_{i=1}{(\gamma_i\times a_{ik})}}<br>$$</p><p>同理X=‘否’的时候，对应每个人‘j’的概率$q(x_j)$：</p><p>$$<br>q(x_j)=\frac{N\times\gamma_j\times{(1-a_{jk})}}{\sum^{N}_{i=1}{[N\times\gamma_i\times (1-a_{jk})}]}<br>$$</p><p>$$<br>q(x_j)=\frac{\gamma_j\times{(1-a_{jk})}}{\sum^{N}_{i=1}{[\gamma_i\times (1-a_{jk})]}}<br>$$</p><p>综上所述，可以得出条件熵的最终公式为：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200727180548.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200727180548.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-27_180446" style="zoom:80%;">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于条件熵的知识拓展。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="知识拓展" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E7%9F%A5%E8%AF%86%E6%8B%93%E5%B1%95/"/>
    
    
      <category term="拓展" scheme="https://666wxy666.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="知识" scheme="https://666wxy666.github.io/tags/%E7%9F%A5%E8%AF%86/"/>
    
      <category term="条件熵" scheme="https://666wxy666.github.io/tags/%E6%9D%A1%E4%BB%B6%E7%86%B5/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 花卉识别</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB/</id>
    <published>2020-08-24T01:38:51.182Z</published>
    <updated>2020-07-27T07:44:02.142Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是机器学习人工智能实验，利用华为云ModelArts平台实现花卉分类识别。</strong></p><a id="more"></a><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><p>通过该实验，实现以下目标</p><ul><li>熟悉ModelArts平台，能够调用平台的简单物体识别算法进行物体检测；</li><li>熟悉ModelArts平台特征提取方法，提取数据集的视觉特征；</li><li>熟悉ModelArts的神经网络架构，改进架构算法，进行目标检测算法的设计与实现。</li><li>学会评价检测算法的基本方法，对所设计的算法进行评估。</li></ul><h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><p>ModelArts平台</p><h2 id="三、实验内容"><a href="#三、实验内容" class="headerlink" title="三、实验内容"></a>三、实验内容</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200715111020.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715111020.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><h2 id="四、实验步骤"><a href="#四、实验步骤" class="headerlink" title="四、实验步骤"></a>四、实验步骤</h2><p>由于时间久远，详细内容请前往Github项目查看实验报告。</p><h2 id="五、项目地址"><a href="#五、项目地址" class="headerlink" title="五、项目地址"></a>五、项目地址</h2><p>本项目的实验报告已经存放于我的Github，欢迎下载查看：</p><div class="btns rounded center grid1">            <a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB" target="_blank" rel="external nofollow noopener noreferrer" title="源码仓库"><i class="fas fa-download"></i>源码仓库</a>          </div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是机器学习人工智能实验，利用华为云ModelArts平台实现花卉分类识别。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="华为云" scheme="https://666wxy666.github.io/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="人工智能" scheme="https://666wxy666.github.io/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"/>
    
      <category term="AI" scheme="https://666wxy666.github.io/tags/AI/"/>
    
      <category term="分类" scheme="https://666wxy666.github.io/tags/%E5%88%86%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 决策树</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E5%86%B3%E7%AD%96%E6%A0%91/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E5%86%B3%E7%AD%96%E6%A0%91/</id>
    <published>2020-08-24T01:38:51.167Z</published>
    <updated>2020-07-15T14:49:28.886Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于20问读心游戏的决策树代码实现。</p><a id="more"></a><h2 id="一、问题："><a href="#一、问题：" class="headerlink" title="一、问题："></a>一、问题：</h2><p>以20问读心游戏为例，以ID3算法（即信息增益算法）为基础，构造并绘制决策树，最后可以进行简单的测试游玩.</p><h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><ul><li>语言：Python 3.6（Anaconda3）</li><li>IDE：PyCharm 2020.1.1 (Professional Edition)</li><li>Packages：<ul><li>python standard library</li><li>numpy：1.16.2</li><li>scipy：1.2.1</li><li>pandas：0.24.2</li><li>networkx：2.4</li><li>graphviz：0.13.2</li><li>matplotlib：3.2.1</li></ul></li></ul><h2 id="三、实验结果"><a href="#三、实验结果" class="headerlink" title="三、实验结果"></a>三、实验结果</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200524143530.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524143530.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_112450" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200524144633.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524144633.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_112723" style="zoom:80%;"><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><p>数据集data_set.txt：</p><p>男    运动员    70后    光头    80后    离婚    选秀    篮球    内地    演员<br>是    是    否    否    是    否    否    是    是    否    姚明<br>是    是    否    否    是    是    否    否    是    否    刘翔<br>是    是    是    是    否    否    否    是    否    否    科比<br>是    是    否    否    是    否    否    否    否    否    c罗<br>是    否    否    否    否    否    否    否    否    是    刘德华<br>是    否    否    否    否    否    是    否    是    否    毛不易<br>是    否    是    否    否    否    否    否    否    是    周杰伦<br>是    否    是    否    否    否    否    否    是    是    黄渤<br>是    否    是    是    否    否    否    否    是    是    徐峥<br>否    是    否    否    是    否    否    否    是    否    张怡宁<br>否    是    否    否    否    是    否    否    是    否    郎平<br>否    是    否    否    否    否    否    否    是    否    朱婷<br>否    否    否    否    否    否    是    否    是    是    杨超越<br>否    否    否    否    是    是    否    否    是    是    杨幂<br>否    否    否    否    否    否    否    否    否    否    邓紫棋<br>否    否    否    否    是    否    是    否    否    否    徐佳莹<br>否    否    否    否    是    否    否    否    是    是    赵丽颖</p><p>代码decision_tree.py：</p><ol start="0"><li><p>全局配置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"># @Project: DecisionTree</span></span><br><span class="line"><span class="comment"># @Description: 以20问读心游戏为例，以ID3算法（即信息增益算法）为基础，构造并绘制决策树，最后进行测试</span></span><br><span class="line"><span class="comment"># @Version: 2.0</span></span><br><span class="line"><span class="comment"># @Author: 苇名一心</span></span><br><span class="line"><span class="comment"># @Date: 2020-03-10 8:30</span></span><br><span class="line"><span class="comment"># @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"># @LastEditTime: 2020-04-05 10:55</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 基本配置</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">'font.sans-serif'</span>] = [<span class="string">'SimHei'</span>]</span><br><span class="line"><span class="comment"># 设置决策树样式</span></span><br><span class="line"><span class="comment"># boxstyle为文本框的类型，sawtooth是锯齿形，fc是边框线粗细</span></span><br><span class="line"><span class="comment"># arrowstyle是树的线为箭头样式</span></span><br><span class="line">decision_node = dict(boxstyle=<span class="string">"sawtooth"</span>, fc=<span class="string">"0.8"</span>)</span><br><span class="line">leaf_node = dict(boxstyle=<span class="string">"round4"</span>, fc=<span class="string">"0.8"</span>)</span><br><span class="line">arrow = dict(arrowstyle=<span class="string">"&lt;-"</span>)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>构造决策树</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 构造决策树</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入并创建数据集</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_data_set</span><span class="params">()</span>:</span></span><br><span class="line">    data_set = []</span><br><span class="line">    <span class="comment"># 数据从文件获取</span></span><br><span class="line">    <span class="comment"># f = open(r'data_set.txt', encoding='UTF-8')</span></span><br><span class="line">    <span class="comment"># text = f.read().splitlines()</span></span><br><span class="line">    <span class="comment"># print("data_set.txt的内容为：")</span></span><br><span class="line">    <span class="comment"># for line in text:</span></span><br><span class="line">    <span class="comment">#     temp = line.split('\t')</span></span><br><span class="line">    <span class="comment">#     print(temp)</span></span><br><span class="line">    <span class="comment">#     data_set.append(temp)</span></span><br><span class="line">    <span class="comment"># 数据在程序中写死</span></span><br><span class="line">    data_set.append([<span class="string">"男"</span>, <span class="string">"运动员"</span>, <span class="string">"70后"</span>, <span class="string">"光头"</span>, <span class="string">"80后"</span>, <span class="string">"离婚"</span>, <span class="string">"选秀"</span>, <span class="string">"篮球"</span>, <span class="string">"内地"</span>, <span class="string">"演员"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"姚明"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"刘翔"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"科比"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"c罗"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"刘德华"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"毛不易"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"周杰伦"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"黄渤"</span>])</span><br><span class="line">    data_set.append([<span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"徐峥"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"张怡宁"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"郎平"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"朱婷"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"杨超越"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"杨幂"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"邓紫棋"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"徐佳莹"</span>])</span><br><span class="line">    data_set.append([<span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"否"</span>, <span class="string">"是"</span>, <span class="string">"是"</span>, <span class="string">"赵丽颖"</span>])</span><br><span class="line">    attr = data_set[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">del</span> (data_set[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">"属性集："</span>)</span><br><span class="line">    print(attr)</span><br><span class="line">    print(<span class="string">"数据集："</span>)</span><br><span class="line">    print(data_set)</span><br><span class="line">    <span class="keyword">return</span> data_set, attr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果数据集中的axis列，值为value，那么取出这一行，且去掉这一列，加入子数据集中</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_data_set</span><span class="params">(data_set, axis, value)</span>:</span></span><br><span class="line">    sub_data_set = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data_set:</span><br><span class="line">        <span class="keyword">if</span> line[axis] == value:</span><br><span class="line">            <span class="comment"># 去掉这一列</span></span><br><span class="line">            <span class="comment"># note: 用循环，较为麻烦</span></span><br><span class="line">            <span class="comment"># newline = []</span></span><br><span class="line">            <span class="comment"># for i in range(len(line)):</span></span><br><span class="line">            <span class="comment">#     if i != axis:</span></span><br><span class="line">            <span class="comment">#         newline.append(line[i])</span></span><br><span class="line">            <span class="comment"># sub_data_set.append(newline)</span></span><br><span class="line">            <span class="comment"># note: 易错点，如果直接newline = line，其实是newline和line指向同一个地址，会修改data_set中的值</span></span><br><span class="line">            newline = line[:]</span><br><span class="line">            <span class="keyword">del</span> newline[axis]</span><br><span class="line">            sub_data_set.append(newline)</span><br><span class="line">    <span class="keyword">return</span> sub_data_set</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算信息熵</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_info_ent</span><span class="params">(data_set)</span>:</span></span><br><span class="line">    <span class="comment"># 数据集样本条数n</span></span><br><span class="line">    num = len(data_set)</span><br><span class="line">    <span class="comment"># 标签计数字典</span></span><br><span class="line">    count = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data_set:</span><br><span class="line">        <span class="comment"># 获取样本最后一列的标签</span></span><br><span class="line">        current_label = i[<span class="number">-1</span>]</span><br><span class="line">        <span class="comment"># 如果当前标签不在计数字典里，则初始化</span></span><br><span class="line">        <span class="keyword">if</span> current_label <span class="keyword">not</span> <span class="keyword">in</span> count.keys():</span><br><span class="line">            count[current_label] = <span class="number">0</span></span><br><span class="line">        count[current_label] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 信息熵初始化</span></span><br><span class="line">    info_ent = <span class="number">0.0</span></span><br><span class="line">    <span class="comment"># 计算信息熵:sum(-P(X)log(P(x)))</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> count.keys():</span><br><span class="line">        <span class="comment"># 计算概率</span></span><br><span class="line">        probability = float(count[key]) / num</span><br><span class="line">        <span class="comment"># -P(X)log(P(x))</span></span><br><span class="line">        info_ent -= probability * log(probability, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> info_ent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选出信息增益最大的最优属性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_split</span><span class="params">(data_set)</span>:</span></span><br><span class="line">    <span class="comment"># 属性个数，data_set最后一列是标签，不是属性</span></span><br><span class="line">    feature_num = len(data_set[<span class="number">0</span>]) - <span class="number">1</span></span><br><span class="line">    <span class="comment"># 初始信息熵,也就是根节点的信息熵</span></span><br><span class="line">    base_ent = calc_info_ent(data_set)</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    best_info_gain = <span class="number">0.0</span></span><br><span class="line">    best_index = <span class="number">-1</span></span><br><span class="line">    <span class="comment"># axis为列号</span></span><br><span class="line">    <span class="keyword">for</span> axis <span class="keyword">in</span> range(feature_num):</span><br><span class="line">        <span class="comment"># 获取每一列数据并去重</span></span><br><span class="line">        row = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> data_set:</span><br><span class="line">            row.append(line[axis])</span><br><span class="line">        unique_row = set(row)</span><br><span class="line">        new_ent = <span class="number">0.0</span></span><br><span class="line">        <span class="comment"># value为列可能的取值，在20问读心游戏里为：是/否</span></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> unique_row:</span><br><span class="line">            <span class="comment"># 取出axis列的值为value的子数据集</span></span><br><span class="line">            sub_data_set = split_data_set(data_set, axis, value)</span><br><span class="line">            <span class="comment"># 计算条件概率</span></span><br><span class="line">            probability = float(len(sub_data_set)) / len(data_set)</span><br><span class="line">            <span class="comment"># 计算条件熵</span></span><br><span class="line">            new_ent += probability * calc_info_ent(sub_data_set)</span><br><span class="line">        <span class="comment"># 计算信息增益</span></span><br><span class="line">        info_gain = base_ent - new_ent</span><br><span class="line">        <span class="keyword">if</span> info_gain &gt; best_info_gain:</span><br><span class="line">            best_info_gain = info_gain</span><br><span class="line">            best_index = axis</span><br><span class="line">    <span class="keyword">return</span> best_index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归方式创建决策树</span></span><br><span class="line"><span class="comment"># data_set为当前数据集，attr为剩余的还未用过的属性集</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_tree</span><span class="params">(data_set, attr)</span>:</span></span><br><span class="line">    <span class="comment"># 获取标签，data_set的最后一列</span></span><br><span class="line">    <span class="comment"># note: 因为递归，data_set会改变，每次要从新的data_set中获取</span></span><br><span class="line">    true_labels = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data_set:</span><br><span class="line">        true_labels.append(line[<span class="number">-1</span>])</span><br><span class="line">    <span class="comment"># 递归终止条件：标签全部相同（例如全是‘姚明’），或者只有一个标签，没必要再进行下去，直接返回这个标签</span></span><br><span class="line">    <span class="keyword">if</span> true_labels.count(true_labels[<span class="number">0</span>]) == len(true_labels):</span><br><span class="line">        <span class="keyword">return</span> true_labels[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 递归终止条件：数据集中只有一个属性（只有一列，标签列，实际没有意义），没必要继续下去，直接返回列中相同值最多的标签</span></span><br><span class="line">    <span class="keyword">if</span> len(data_set[<span class="number">0</span>]) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> max(true_labels, key=true_labels.count)</span><br><span class="line">    <span class="comment"># 从当前数据集和剩余的属性集attr中获取最优属性(信息增益最大)的索引和属性名</span></span><br><span class="line">    best_index = best_split(data_set)</span><br><span class="line">    best_attr = attr[best_index]</span><br><span class="line">    <span class="comment"># 开始创建决策树</span></span><br><span class="line">    <span class="comment"># 初始化字典，创建根节点，第一个属性对应的也是一个字典</span></span><br><span class="line">    root = &#123;best_attr: &#123;&#125;&#125;</span><br><span class="line">    <span class="comment"># 获取最优属性对应的列并去重</span></span><br><span class="line">    best_row = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data_set:</span><br><span class="line">        best_row.append(line[best_index])</span><br><span class="line">    unique_row = set(best_row)</span><br><span class="line">    <span class="comment"># value为列可能的取值，在20问读心游戏里为：是/否</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> unique_row:</span><br><span class="line">        <span class="comment"># 新建子属性集合，并且将用完的属性从属性集中删除</span></span><br><span class="line">        <span class="comment"># note: 最好是不要改变attr的内容，新建一个sub_attr拷贝attr，对sub_attr做删除操作</span></span><br><span class="line">        sub_attr = attr[:]</span><br><span class="line">        <span class="keyword">del</span> sub_attr[best_index]</span><br><span class="line">        <span class="comment"># 递归构造决策树</span></span><br><span class="line">        <span class="comment"># note: root[best_attr]是一个字典</span></span><br><span class="line">        <span class="comment">#  根据当前best_attr属性的所有可能的取值value进行构造，在20问读心游戏里为：是/否</span></span><br><span class="line">        <span class="comment">#  也就是说构造出的决策树是二叉树</span></span><br><span class="line">        root[best_attr][value] = create_tree(split_data_set(data_set, best_index, value), sub_attr)</span><br><span class="line">    <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>绘制决策树</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 绘制决策树（ps: 为了让画出来的树更美观，借鉴学习了《机器学习实战》中的好思路）</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取树的层数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_depth</span><span class="params">(decision_tree)</span>:</span></span><br><span class="line">    max_depth = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 将决策树dict的key转化为list并获取根结点属性名称</span></span><br><span class="line">    root_attr = list(decision_tree.keys())[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 根据根节点属性获取子树</span></span><br><span class="line">    sub_tree = decision_tree[root_attr]</span><br><span class="line">    <span class="comment"># 对子树字典所有的key，也就是root_attr所有的取值（在20问读心游戏里为：是/否）遍历</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> sub_tree.keys():</span><br><span class="line">        <span class="comment"># 如果是字典对象，说明还未到叶子，继续递归</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(sub_tree[key], dict):</span><br><span class="line">            depth = get_depth(sub_tree[key]) + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 如果不是字典对象，说明已经到达叶子，停止递归</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            depth = <span class="number">1</span></span><br><span class="line">        <span class="comment"># 判断深度是否大于最大深度</span></span><br><span class="line">        <span class="keyword">if</span> depth &gt; max_depth:</span><br><span class="line">            max_depth = depth</span><br><span class="line">    <span class="keyword">return</span> max_depth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取树的叶子节点个数，也就是标签数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_leaf_num</span><span class="params">(decision_tree)</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 将决策树dict的key转化为list并获取根结点属性名称</span></span><br><span class="line">    root_attr = list(decision_tree.keys())[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 根据根节点属性获取子树</span></span><br><span class="line">    sub_tree = decision_tree[root_attr]</span><br><span class="line">    <span class="comment"># 对子树字典所有的key，也就是root_attr所有的取值（在20问读心游戏里为：是/否）遍历</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> sub_tree.keys():</span><br><span class="line">        <span class="comment"># 如果是字典对象，说明还未到叶子，继续递归</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(sub_tree[key], dict):</span><br><span class="line">            num += get_leaf_num(sub_tree[key])</span><br><span class="line">        <span class="comment"># 如果不是字典对象，说明已经到达叶子，停止递归</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图对象，初始化，画图</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_plot</span><span class="params">(decision_tree)</span>:</span></span><br><span class="line">    <span class="comment"># 定义一个背景为白色的画布，并把画布清空</span></span><br><span class="line">    fig = plt.figure(<span class="number">1</span>, facecolor=<span class="string">'white'</span>)</span><br><span class="line">    fig.clf()</span><br><span class="line">    <span class="comment"># ax_prop为图形的样式，没有坐标轴标签</span></span><br><span class="line">    ax_prop = dict(xticks=[], yticks=[])</span><br><span class="line">    <span class="comment"># 使用subplot为定义了一个图，一行一列一个图，</span></span><br><span class="line">    <span class="comment"># frameon=False代表没有矩形边框</span></span><br><span class="line">    <span class="comment"># note: 在python里，[函数名称].[变量名]相当于是全局变量</span></span><br><span class="line">    <span class="comment"># ax1相当于是图对象，在其它函数中使用</span></span><br><span class="line">    create_plot.ax1 = plt.subplot(<span class="number">111</span>, frameon=<span class="literal">False</span>, **ax_prop)</span><br><span class="line">    <span class="comment"># total_width和total_depth分别代表初始决策树的叶子节点数目和深度，不改变</span></span><br><span class="line">    plot_tree.total_width = float(get_leaf_num(decision_tree))</span><br><span class="line">    plot_tree.total_depth = float(get_depth(decision_tree))</span><br><span class="line">    <span class="comment"># 图的大小是长0~1，宽0~1</span></span><br><span class="line">    <span class="comment"># note: x_offset实质是每个叶子的x坐标的位置</span></span><br><span class="line">    <span class="comment">#  第一片叶子的x为0.5/叶子数目，因此初始的x_offset设为-0.5/叶子数目</span></span><br><span class="line">    <span class="comment">#  每次将x_offset+(1/x_offset)，也就是第一个叶子不紧贴边框，有0.5/叶子数目的内边距</span></span><br><span class="line">    <span class="comment">#  例如绘制3个叶子，坐标应为1/3、2/3、3/3</span></span><br><span class="line">    <span class="comment">#  但这样整个图形会偏右，因此将初始的x_offset设为-0.5/3</span></span><br><span class="line">    <span class="comment">#  这样的话，每个叶子向左移了0.5/3，坐标变成了0.5/3、1.5/3、2.5/3，就刚好让图形在正中间了</span></span><br><span class="line">    <span class="comment">#  初始的y_offset显然为1，也就是最高点，每下降一层将y_offset-(1/深度)即可</span></span><br><span class="line">    plot_tree.x_offset = <span class="number">-0.5</span> / plot_tree.total_width</span><br><span class="line">    plot_tree.y_offset = <span class="number">1.0</span></span><br><span class="line">    <span class="comment"># 初始根节点位置为图形的正中间最上方，即(0.5, 1.0)</span></span><br><span class="line">    <span class="comment"># 初始节点文本为空，等待获取</span></span><br><span class="line">    plot_tree(decision_tree, (<span class="number">0.5</span>, <span class="number">1.0</span>), <span class="string">''</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归画出决策树</span></span><br><span class="line"><span class="comment"># parent_pos为父节点位置，也就是当前决策树根节点的父节点位置</span></span><br><span class="line"><span class="comment"># arrow_text为父节点指来的箭头上的内容（在20问读心游戏里为：是/否）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_tree</span><span class="params">(decision_tree, parent_pos, arrow_text)</span>:</span></span><br><span class="line">    <span class="comment"># 获取当前决策树叶子数目</span></span><br><span class="line">    <span class="comment"># note: leaf_num与plot_tree.total_depth不同，前者针对的是当前的决策树，后者是针对的原来的整个决策树</span></span><br><span class="line">    leaf_num = get_leaf_num(decision_tree)</span><br><span class="line">    <span class="comment"># 将决策树dict的key转化为list并获取根结点属性名称</span></span><br><span class="line">    root_attr = list(decision_tree.keys())[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># root_pos为当前决策树的根节点的位置</span></span><br><span class="line">    <span class="comment"># note: 计算方法为</span></span><br><span class="line">    <span class="comment">#  拆分为三部分：</span></span><br><span class="line">    <span class="comment">#  1. plot_tree.x_offset：初始的x偏移，基准值</span></span><br><span class="line">    <span class="comment">#  2. float(numLeafs) / 2.0 / plotTree.totalW：</span></span><br><span class="line">    <span class="comment">#       float(numLeafs) * (1 / plotTree.totalW)为该决策树所包含的所有叶子所占的横坐标宽度</span></span><br><span class="line">    <span class="comment">#       / 2.0就是这个宽度的中间点</span></span><br><span class="line">    <span class="comment">#  3. 0.5 / plotTree.totalW：因为x_offset初始有-0.5/plotTree.totalW的偏移</span></span><br><span class="line">    <span class="comment">#       导致该节点并不是在区域中点，而是向左有个0.5/plotTree.totalW偏移</span></span><br><span class="line">    <span class="comment">#       因此+0.5 / plotTree.totalW，使其位于区域正中</span></span><br><span class="line">    <span class="comment">#  最终的公式经过合并就是下式：</span></span><br><span class="line">    root_pos = (plot_tree.x_offset + (<span class="number">1.0</span> + float(leaf_num)) / <span class="number">2.0</span> / plot_tree.total_width, plot_tree.y_offset)</span><br><span class="line">    <span class="comment"># 画出由当前子决策树父节点指来的箭头和箭头上的文本（在20问读心游戏里为：是/否）以及箭头指向的当前决策树的根节点</span></span><br><span class="line">    plot_arrow_text(root_pos, parent_pos, arrow_text)</span><br><span class="line">    <span class="comment"># 节点类型为决策类型decision_node，不是叶子</span></span><br><span class="line">    plot_node(root_pos, parent_pos, decision_node, root_attr)</span><br><span class="line">    <span class="comment"># 根据根节点属性获取子树</span></span><br><span class="line">    sub_tree = decision_tree[root_attr]</span><br><span class="line">    <span class="comment"># note: 每下降一层，将y_offset减1.0 / plot_tree.total_depth</span></span><br><span class="line">    plot_tree.y_offset = plot_tree.y_offset - <span class="number">1.0</span> / plot_tree.total_depth</span><br><span class="line">    <span class="comment"># 对子树字典所有的key，也就是root_attr所有的取值（在20问读心游戏里为：是/否）遍历</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> sub_tree.keys():</span><br><span class="line">        <span class="comment"># 如果是字典对象，说明还未到叶子，继续递归</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(sub_tree[key], dict):</span><br><span class="line">            <span class="comment"># note: 子决策树为sub_tree[key]</span></span><br><span class="line">            <span class="comment">#  子决策树的父节点为当前决策树的根节点</span></span><br><span class="line">            <span class="comment">#  当前决策树指向子决策树的箭头上的文本为key，因为key不是字符串，要进行类型转换</span></span><br><span class="line">            plot_tree(sub_tree[key], root_pos, str(key))</span><br><span class="line">        <span class="comment"># 如果不是字典对象，说明已经到达叶子，停止递归</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 每到一个叶子，就把x_offset加1.0 / plot_tree.total_width</span></span><br><span class="line">            plot_tree.x_offset = plot_tree.x_offset + <span class="number">1.0</span> / plot_tree.total_width</span><br><span class="line">            <span class="comment"># 画出叶子、箭头</span></span><br><span class="line">            <span class="comment"># (plot_tree.x_offset, plot_tree.y_offset)刚好是叶子的坐标</span></span><br><span class="line">            <span class="comment"># root_pos为当前决策树的根节点坐标</span></span><br><span class="line">            <span class="comment"># 节点类型为叶子类型leaf_node</span></span><br><span class="line">            <span class="comment"># 因为是叶子，sub_tree[key]为字符串类型，也就是标签</span></span><br><span class="line">            plot_node((plot_tree.x_offset, plot_tree.y_offset), root_pos, leaf_node, sub_tree[key])</span><br><span class="line">            <span class="comment"># 画出箭头上的文本</span></span><br><span class="line">            <span class="comment"># 当前决策树指向叶子的箭头上的文本为key，因为key不是字符串，要进行类型转换</span></span><br><span class="line">            plot_arrow_text((plot_tree.x_offset, plot_tree.y_offset), root_pos, str(key))</span><br><span class="line">    <span class="comment"># note: 易错点，每次递归结束需要将y_offset加1.0 / plot_tree.total_depth，回到上一层</span></span><br><span class="line">    plot_tree.y_offset = plot_tree.y_offset + <span class="number">1.0</span> / plot_tree.total_depth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画节点和指向节点的箭头的函数</span></span><br><span class="line"><span class="comment"># root_pos为子节点的位置，也就是箭头指向的位置</span></span><br><span class="line"><span class="comment"># parent_pos为父节点的位置，也就是箭头尾部所在的位置</span></span><br><span class="line"><span class="comment"># node_type为节点类型，两种：决策节点（decision_node）和叶节点（leaf_node）</span></span><br><span class="line"><span class="comment"># node_text为要显示的文本，也就是节点的内容，即属性的名称（例如：男、运动员……）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_node</span><span class="params">(root_pos, parent_pos, node_type, node_text)</span>:</span></span><br><span class="line">    <span class="comment"># note: annotate用于在图形上给数据添加文本注解，支持带箭头的划线工具</span></span><br><span class="line">    <span class="comment">#  参数如下：</span></span><br><span class="line">    <span class="comment">#  s：注释文本的内容</span></span><br><span class="line">    <span class="comment">#  xy：被注释的坐标点，二维元组形如(x,y)</span></span><br><span class="line">    <span class="comment">#  xytext：注释文本的坐标点，也就是文本写的地方，也是二维元组，默认与xy相同</span></span><br><span class="line">    <span class="comment">#  xycoords：被注释点的坐标系属性，axes fraction是以子绘图区左下角为参考，单位是百分比</span></span><br><span class="line">    <span class="comment">#  textcoords：注释文本的坐标系属性，默认与xycoords属性值相同</span></span><br><span class="line">    <span class="comment">#  va="center"，ha="center"表示注释的坐标以注释框的正中心为准，而不是注释框的左下角(v代表垂直方向，h代表水平方向)</span></span><br><span class="line">    <span class="comment">#  bbox是注释框的风格和颜色深度，fc越小，注释框的颜色越深，支持输入一个字典</span></span><br><span class="line">    <span class="comment">#  arrowprops：箭头的样式，字典型数据，在画图的开头定义了</span></span><br><span class="line">    create_plot.ax1.annotate(node_text, xy=parent_pos, xycoords=<span class="string">'axes fraction'</span>,</span><br><span class="line">                             xytext=root_pos, textcoords=<span class="string">'axes fraction'</span>,</span><br><span class="line">                             va=<span class="string">"center"</span>, ha=<span class="string">"center"</span>, bbox=node_type, arrowprops=arrow)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画箭头上文本的函数</span></span><br><span class="line"><span class="comment"># root_pos为子节点的位置，也就是箭头指向的位置</span></span><br><span class="line"><span class="comment"># parent_pos为父节点的位置，也就是箭头尾部所在的位置</span></span><br><span class="line"><span class="comment"># text为要显示的文本，也就是箭头上写的内容，即属性的取值（在20问读心游戏里为：是/否）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_arrow_text</span><span class="params">(root_pos, parent_pos, arrow_text)</span>:</span></span><br><span class="line">    <span class="comment"># 文本的位置应该处于箭头中间，也就是文本坐标=箭头头坐标+（箭头尾坐标-箭头头坐标）/2，因为箭头是向下指的</span></span><br><span class="line">    x_mid = root_pos[<span class="number">0</span>] + (parent_pos[<span class="number">0</span>] - root_pos[<span class="number">0</span>]) / <span class="number">2.0</span></span><br><span class="line">    y_mid = root_pos[<span class="number">1</span>] + (parent_pos[<span class="number">1</span>] - root_pos[<span class="number">1</span>]) / <span class="number">2.0</span></span><br><span class="line">    create_plot.ax1.text(x_mid, y_mid, arrow_text, va=<span class="string">"center"</span>, ha=<span class="string">"center"</span>, rotation=<span class="number">30</span>)</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>测试函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 测试函数</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据决策树decision_tree(决策树字典对象)和标签列表labels对输入的测试向量test进行分类，输出类别</span></span><br><span class="line"><span class="comment"># test为列表，样例：['是', '否', '否', '否', '否', '否', '否', '否', '否', '是']</span></span><br><span class="line"><span class="comment"># note: 与决策树建立一样，也是使用递归，从根节点查起，直到叶子</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify</span><span class="params">(decision_tree, labels, test)</span>:</span></span><br><span class="line">    <span class="comment"># 将决策树dict的key转化为list并获取根结点属性名称</span></span><br><span class="line">    <span class="comment"># note: 易错点，如果不转化为list会产生错误：</span></span><br><span class="line">    <span class="comment">#  TypeError: 'dict_keys' object does not support indexing</span></span><br><span class="line">    <span class="comment">#  原因是python3改变了dict.keys，返回的是dict_keys对象，支持iterable</span></span><br><span class="line">    <span class="comment">#  但不支持indexable，我们可以将其明确的转化成list来解决</span></span><br><span class="line">    root_attr = list(decision_tree.keys())[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 根据根节点属性获取子树</span></span><br><span class="line">    <span class="comment"># note: 子树也是一个字典对象，key为该属性的取值（在20问读心游戏里为：是/否）</span></span><br><span class="line">    <span class="comment">#  value也是一个字典对象，key为下一个属性，value为下一个属性对应的子树</span></span><br><span class="line">    sub_tree = decision_tree[root_attr]</span><br><span class="line">    <span class="comment"># 根据根节点属性名称获取在标签列表中对应的索引，并根据索引获取测试向量test该属性对应的值（在20问读心游戏里为：是/否）</span></span><br><span class="line">    value = test[labels.index(root_attr)]</span><br><span class="line">    <span class="comment"># 根据value的值（在20问读心游戏里为：是/否）获取决策树的子树字典</span></span><br><span class="line">    tree_of_value = sub_tree[value]</span><br><span class="line">    <span class="comment"># 用isinstance判断得到的对象是不是字典对象</span></span><br><span class="line">    <span class="comment"># 如果是字典，就不是叶子，继续递归</span></span><br><span class="line">    <span class="comment"># 如果不是字典，就是叶子，停止递归，tree_of_value就是分类结果</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(tree_of_value, dict):</span><br><span class="line">        label = classify(tree_of_value, labels, test)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        label = tree_of_value</span><br><span class="line">    <span class="keyword">return</span> label</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>开始运行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 开始运行</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读入并创建数据集和属性集</span></span><br><span class="line">data_set, attr = create_data_set()</span><br><span class="line"><span class="comment"># 复制一份属性集attr用于递归，因为递归会将attr内容改变</span></span><br><span class="line">attr_copy = attr.copy()</span><br><span class="line">decision_tree = create_tree(data_set, attr_copy)</span><br><span class="line">print(<span class="string">"决策树结构为："</span>)</span><br><span class="line">print(decision_tree)</span><br><span class="line"><span class="comment"># 绘制决策树</span></span><br><span class="line">print(<span class="string">"绘制决策树……"</span>)</span><br><span class="line">create_plot(decision_tree)</span><br><span class="line">print(<span class="string">"决策树的深度为：%d"</span> % get_depth(decision_tree))</span><br><span class="line">print(<span class="string">"决策树叶子数目为：%d"</span> % get_leaf_num(decision_tree))</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>测试游玩</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"是否要进行测试（1是，0否）："</span>)</span><br><span class="line">flag = int(input())</span><br><span class="line"><span class="keyword">while</span> flag == <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">"请输入测试向量（以空格分隔每个问题的答案）："</span>)</span><br><span class="line">    test = input().split()</span><br><span class="line">    result = classify(decision_tree, attr, test)</span><br><span class="line">    print(<span class="string">"测试结果为：%s"</span> % result)</span><br><span class="line">    print(<span class="string">"是否要进行测试（1是，0否）："</span>)</span><br><span class="line">    flag = int(input())</span><br><span class="line">print(<span class="string">"程序成功退出，感谢使用……"</span>)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于20问读心游戏的决策树代码实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="决策树" scheme="https://666wxy666.github.io/tags/%E5%86%B3%E7%AD%96%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 RNN 为baby起名字</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-RNN-%E4%B8%BAbaby%E8%B5%B7%E5%90%8D%E5%AD%97/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-RNN-%E4%B8%BAbaby%E8%B5%B7%E5%90%8D%E5%AD%97/</id>
    <published>2020-08-24T01:38:51.164Z</published>
    <updated>2020-07-15T14:49:28.885Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典RNN的应用为baby起名字的代码实现。</p><a id="more"></a><h2 id="一、任务定义"><a href="#一、任务定义" class="headerlink" title="一、任务定义"></a>一、任务定义</h2><p><strong>采用 RNN 为小 Baby 起个英文名字吧</strong></p><p>神经网络语言模型，即通过神经网络，计算一项自然语言（例如一条句子）的出现概率，或者根据上文中的词推断句子中某个词的出现概率。例如，下图采用了一个具有一个输入层、一个隐藏层和一个输出层的 MLP 网络，建模三元文法模型：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605202820.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605202820.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200605202820810" style="zoom:80%;"><p>本作业提供了8000多个英文名字，试训练一个环神经网络语言模型，进而给定若干个开始字母，由语言模型自动生成后续的字母，直到生成一个名字的结束符。从模型生成的名字中，挑选你最喜欢的一个，并采用一种可视化技术，绘制出模型为每个时刻预测的前5个最可能的候选字母。</p><p>事实上，你也可以给定结尾的若干个字母，或者随意给出中间的若干个字母，让 RNN  补全其它字母，从而得到一个完整的名字。因此，你也可以尝试设计并实现一个这样的 RNN 模型，从模型生成的名字中，挑选你最喜欢的一个，并采用可视化技术，绘制出模型为每个时刻预测的前5个最可能的候选字母。</p><h2 id="二、输入输出"><a href="#二、输入输出" class="headerlink" title="二、输入输出"></a>二、输入输出</h2><h3 id="1、输入"><a href="#1、输入" class="headerlink" title="1、输入"></a>1、输入</h3><ul><li><p>male和female数据集作为训练集。</p><p><strong><em>【PS】注意，两个数据集的格式必须是一行一个英文名字，不能有其他文字说明，在使用前请先将male.txt和female.txt中的文字说明删除，例如：</em></strong></p><img src="https://gitee.com/wxy_666/images/raw/master/20200605203846.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605203846.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_203831" style="zoom:80%;"></li><li><p>超参数总迭代次数，打印精度（每隔多少次迭代打印一次损失日志），绘图精度（每隔多少次迭代求和取平均作为一个数据点）。</p></li><li><p>（类别，姓名的起始字母）对。</p></li></ul><h3 id="2、输出"><a href="#2、输出" class="headerlink" title="2、输出"></a>2、输出</h3><ul><li>RNN神经网络模型。</li><li>该模型的损失等日志信息。</li><li>该模型的损失-(迭代次数/画图精度)函数图像。</li><li>根据这个神经网络模型和输入的（类别，姓名的起始字母）对生成的姓名。</li></ul><h2 id="三、实验环境"><a href="#三、实验环境" class="headerlink" title="三、实验环境"></a>三、实验环境</h2><p>硬件：</p><ul><li>处理器：Intel i7 7700HQ</li><li>显卡：NVIDIA GeForce GTX 1050 Ti</li><li>内存：16GB</li></ul><p>软件：</p><ul><li><p>编程语言：</p><p>Python 3.7（Anaconda3）</p></li><li><p>模块：</p><ul><li>pytorch 1.5</li><li>numpy 1.18.1</li><li>matplotlib 3.1.3</li></ul></li><li><p>编译器：</p><p>PyCharm 2020.1.1 (Professional Edition)<br>Build #PY-201.7223.92, built on April 30, 2020<br>For educational use only.<br>Runtime version: 11.0.6+8-b765.40 amd64<br>VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o<br>Windows 10 10.0<br>GC: ParNew, ConcurrentMarkSweep<br>Memory: 725M<br>Cores: 8<br>Registry: ide.balloon.shadow.size=0<br>Non-Bundled Plugins: com.dubreuia, GrepConsole, Statistic, com.chrisrm.idea.MaterialThemeUI, org.intellij.gitee, com.mallowigi, com.wakatime.intellij.plugin, mobi.hsz.idea.gitignore, net.vektah.codeglance, tanvd.grazi, com.jetbrains.intellij.datalore, izhangzhihao.rainbow.brackets, cn.yiiguxing.plugin.translate, org.nik.presentation-assistant</p></li></ul><h2 id="四、方法描述"><a href="#四、方法描述" class="headerlink" title="四、方法描述"></a>四、方法描述</h2><h4 id="1、数据集处理"><a href="#1、数据集处理" class="headerlink" title="1、数据集处理"></a>1、数据集处理</h4><p>对老师的male.txt和female.txt数据集进行处理，保证每行只能由一个姓名，不得出现其他类似下图的说明信息。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605210431.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605210431.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p>我们将行分割成数组, 并把 Unicode 转换成 ASCII 编码, 最后放进一个字典里 <code>{language: [names ...]}</code></p><h4 id="2、创建网络"><a href="#2、创建网络" class="headerlink" title="2、创建网络"></a>2、创建网络</h4><p>输出设定为下一个字母的概率，采样测试的时候，概率最大的输出字母被当做下一个输入。</p><p>输出层采用softmax函数，为了让网络更加有效工作，添加了第二个线性层o2o（在合并了隐藏层和输出层的后面）。还有一个 Dropout 层，使输入的部分值以给定的概率值随机的变成 0（这里概率取0.1）, 为了模糊输入以防止过拟合，在网络的最末端使用它，从而故意添加一些混乱和增加采样的多样化。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605213206.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605213206.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_213141" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200605213119.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605213119.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="28a4f1426695fb55f1f6bc86278f6547" style="zoom:80%;"><h4 id="3、训练前的准备"><a href="#3、训练前的准备" class="headerlink" title="3、训练前的准备"></a>3、训练前的准备</h4><p>首先读取文件，产生随机的（类别，文件行[也就是姓名]）对。对每一个时间点（也就是说在训练集中词的每个字母）网络的输入是（类别，当前字母，隐藏层状态），输出是（下一个字母，下一个隐藏层状态）。</p><p>因为在每一步，我们从当前的字母预测下一个字母，这样的字母对是在原有行中连续字母的集合，例如：</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200605210640.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605210640.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>类别张量是一个大小为$1\times{categories}$的one-hot tensor张量，在训练的每一个时间点把它提供给网络。</p><h4 id="4、开始训练"><a href="#4、开始训练" class="headerlink" title="4、开始训练"></a>4、开始训练</h4><p>使用自动求导（autograd）辅助计算损失。循环调用train，每隔一段时间打印损失等Log，直到到达规定输入的迭代次数。在训练完成后绘制损失-(迭代次数/画图精度)函数图像折线图，用于性能评估分析。</p><h4 id="5、测试采样"><a href="#5、测试采样" class="headerlink" title="5、测试采样"></a>5、测试采样</h4><p>输入（类别，姓名起始字母）对，返回生成的姓名。</p><h2 id="五、结果分析与性能评价"><a href="#五、结果分析与性能评价" class="headerlink" title="五、结果分析与性能评价"></a>五、结果分析与性能评价</h2><p><strong>PS: []中的为每一次迭代的最可能的字母前五，如果为空，就是已经到达迭代终点。</strong></p><p>下面是100000次迭代的测试采样结果，可以发现生成的姓名非常好，完全符合日常的姓名样式，RNN神经网络性能很好。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151627.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151627.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151534" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200612151702.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151702.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151553" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200612151715.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151715.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151606" style="zoom:80%;"><p>100次的因为迭代次数太少，网络非常不好，完全不能生成所需的姓名：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151824.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151824.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151807" style="zoom:80%;"><p>1000次还算可以接受：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151959.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151959.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151926" style="zoom:80%;"><p>如果是10000次迭代，基本能满足生成姓名的要求:</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612152344.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612152344.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_152300" style="zoom:80%;"><p>观察并对比不同迭代次数的损失-(迭代次数/画图精度)函数折线图可以看出迭代次数越多损失越小，性能越好，且一开始损失下降较快，当迭代次数大到一定程度后，损失下降较慢。</p><table><thead><tr><th align="center">100次</th><th align="center">1000次</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215413.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215413.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215151" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215423.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215423.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215250" style="zoom:80%;"></td></tr><tr><td align="center"><strong>10000次</strong></td><td align="center"><strong>100000次</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215931.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215931.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215459" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605214735.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605214735.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_202039" style="zoom:80%;"></td></tr></tbody></table><p>查看并对比不同迭代次数的损失日志输出，很明显能发现最大的区别就是训练时间。可以看出迭代次数越多花费时间越多，所需的电脑性能显然也需要更高，100次和1000次由于网络不好，可以先排除在外。100000次迭代的所需时间是10min左右，而10000次迭代所需的时间为1min左右，相差10倍，如果迭代次数更多，可能相差更多，因此选择合适的迭代次数很重要，避免不必要的性能时间浪费。</p><table><thead><tr><th align="center">100次</th><th align="center">1000次</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605220024.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605220024.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215139" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605220009.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605220009.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215232" style="zoom:80%;"></td></tr><tr><td align="center"><strong>10000次</strong></td><td align="center"><strong>100000次</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215950.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215950.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215450" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605214944.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605214944.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_202109" style="zoom:80%;"></td></tr></tbody></table><h2 id="七、附录"><a href="#七、附录" class="headerlink" title="七、附录"></a>七、附录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 王兴宇 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: rnn-name</span></span><br><span class="line"><span class="string">@Description: 用RNN网络为baby起名字</span></span><br><span class="line"><span class="string">@Version: 1.0</span></span><br><span class="line"><span class="string">@Author: 王兴宇</span></span><br><span class="line"><span class="string">@Date: 2020-06-05 17:13</span></span><br><span class="line"><span class="string">@LastEditors: 王兴宇</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-05 17:13</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals, print_function, division</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> open</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 全局参数</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line">all_letters = string.ascii_letters + <span class="string">" .,;'-"</span></span><br><span class="line">n_letters = len(all_letters) + <span class="number">1</span></span><br><span class="line">criterion = nn.NLLLoss()</span><br><span class="line">learning_rate = <span class="number">0.0005</span>  <span class="comment"># 学习率</span></span><br><span class="line">max_length = <span class="number">20</span></span><br><span class="line">path = <span class="string">"data/names/*.txt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 数据集操作</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 将Unicode转为ASCII</span></span><br><span class="line"><span class="comment"># https://stackoverflow.com/a/518232/2809427</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Unicode_to_ASCII</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(</span><br><span class="line">        c <span class="keyword">for</span> c <span class="keyword">in</span> unicodedata.normalize(<span class="string">'NFD'</span>, s)</span><br><span class="line">        <span class="keyword">if</span> unicodedata.category(c) != <span class="string">'Mn'</span></span><br><span class="line">        <span class="keyword">and</span> c <span class="keyword">in</span> all_letters</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将行分割成数组, 并把 Unicode 转换成 ASCII 编码, 最后放进一个字典里 &#123;category: [names ...]&#125;</span></span><br><span class="line">category_lines = &#123;&#125;</span><br><span class="line">all_categories = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> glob.glob(path):</span><br><span class="line">    category = os.path.splitext(os.path.basename(file_name))[<span class="number">0</span>]</span><br><span class="line">    all_categories.append(category)</span><br><span class="line">    line_list = open(file_name, encoding=<span class="string">'utf-8'</span>).read().strip().split(<span class="string">'\n'</span>)</span><br><span class="line">    lines = [Unicode_to_ASCII(line) <span class="keyword">for</span> line <span class="keyword">in</span> line_list]</span><br><span class="line">    category_lines[category] = lines</span><br><span class="line"></span><br><span class="line">category_num = len(all_categories)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> category_num == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">"未找到数据集！"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"数据集类别："</span>, category_num, all_categories)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 构建RNN网络</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_size, hidden_size, output_size)</span>:</span></span><br><span class="line">        super(RNN, self).__init__()</span><br><span class="line">        self.hidden_size = hidden_size</span><br><span class="line"></span><br><span class="line">        self.i2h = nn.Linear(category_num + input_size + hidden_size, hidden_size)</span><br><span class="line">        self.i2o = nn.Linear(category_num + input_size + hidden_size, output_size)</span><br><span class="line">        self.o2o = nn.Linear(hidden_size + output_size, output_size)</span><br><span class="line">        self.dropout = nn.Dropout(<span class="number">0.1</span>)</span><br><span class="line">        self.softmax = nn.LogSoftmax(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, category, input, hidden)</span>:</span></span><br><span class="line">        input_combined = torch.cat((category, input, hidden), <span class="number">1</span>)</span><br><span class="line">        hidden = self.i2h(input_combined)</span><br><span class="line">        output = self.i2o(input_combined)</span><br><span class="line">        output_combined = torch.cat((hidden, output), <span class="number">1</span>)</span><br><span class="line">        output = self.o2o(output_combined)</span><br><span class="line">        output = self.dropout(output)</span><br><span class="line">        output = self.softmax(output)</span><br><span class="line">        <span class="keyword">return</span> output, hidden</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> torch.zeros(<span class="number">1</span>, self.hidden_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 训练前的准备</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 输入串从第一个字母到最后一个字母（不包括 EOS ）的 one-hot 矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_input_tensor</span><span class="params">(letters)</span>:</span></span><br><span class="line">    tensor = torch.zeros(len(letters), <span class="number">1</span>, n_letters)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(letters)):</span><br><span class="line">        letter = letters[i]</span><br><span class="line">        tensor[i][<span class="number">0</span>][all_letters.find(letter)] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标的第k个字母到结尾（EOS）的 LongTensor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_target_Tensor</span><span class="params">(letters)</span>:</span></span><br><span class="line">    letter_indexes = [all_letters.find(letters[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(letters))]</span><br><span class="line">    letter_indexes.append(n_letters - <span class="number">1</span>)  <span class="comment"># EOS</span></span><br><span class="line">    <span class="keyword">return</span> torch.LongTensor(letter_indexes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类别的One-hot向量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_category_tensor</span><span class="params">(category)</span>:</span></span><br><span class="line">    i = all_categories.index(category)</span><br><span class="line">    tensor = torch.zeros(<span class="number">1</span>, category_num)</span><br><span class="line">    tensor[<span class="number">0</span>][i] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用辅助函数从数据集中获取随机的category和line</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_pair</span><span class="params">()</span>:</span></span><br><span class="line">    category = all_categories[random.randint(<span class="number">0</span>, len(all_categories) - <span class="number">1</span>)]</span><br><span class="line">    line = category_lines[category][random.randint(<span class="number">0</span>, len(category_lines[category]) - <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> category, line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从随机的（category, line）对中生成 category, input, 和 target Tensor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomTrainingExample</span><span class="params">()</span>:</span></span><br><span class="line">    category, line = random_pair()</span><br><span class="line">    category_tensor = generate_category_tensor(category)</span><br><span class="line">    input_tensor = generate_input_tensor(line)</span><br><span class="line">    target_tensor = generate_target_Tensor(line)</span><br><span class="line">    <span class="keyword">return</span> category_tensor, input_tensor, target_tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 训练RNN网络</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(category_tensor, input_tensor, target_tensor)</span>:</span></span><br><span class="line">    target_tensor.unsqueeze_(<span class="number">-1</span>)</span><br><span class="line">    hidden = rnn.init_hidden()</span><br><span class="line"></span><br><span class="line">    rnn.zero_grad()</span><br><span class="line"></span><br><span class="line">    loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(input_tensor.size(<span class="number">0</span>)):</span><br><span class="line">        output, hidden = rnn(category_tensor, input_tensor[i], hidden)</span><br><span class="line">        l = criterion(output, target_tensor[i])</span><br><span class="line">        loss += l</span><br><span class="line"></span><br><span class="line">    loss.backward()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> rnn.parameters():</span><br><span class="line">        p.data.add_(p.grad.data, alpha=-learning_rate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output, loss.item() / input_tensor.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 秒转时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_format</span><span class="params">(since)</span>:</span></span><br><span class="line">    now = time.time()</span><br><span class="line">    s = now - since</span><br><span class="line">    m = math.floor(s / <span class="number">60</span>)</span><br><span class="line">    s -= m * <span class="number">60</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%dm %ds'</span> % (m, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从一个类中获取一个以start_letters开头的名字</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sample</span><span class="params">(category, start_letters=<span class="string">'Al'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        category_tensor = generate_category_tensor(category)</span><br><span class="line">        input = generate_input_tensor(start_letters)</span><br><span class="line">        hidden = rnn.init_hidden()</span><br><span class="line"></span><br><span class="line">        output_name = start_letters</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(max_length):</span><br><span class="line">            output, hidden = rnn(category_tensor, input[<span class="number">0</span>], hidden)</span><br><span class="line">            topv, topi_temp = output.topk(<span class="number">5</span>)</span><br><span class="line">            topi = topi_temp[<span class="number">0</span>][<span class="number">0</span>].item()</span><br><span class="line">            <span class="keyword">if</span> topi == n_letters - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"["</span>, end=<span class="string">""</span>)</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">                    <span class="keyword">if</span> j != <span class="number">4</span>:</span><br><span class="line">                        <span class="keyword">if</span> topi_temp[<span class="number">0</span>][j].item() &gt;= n_letters - <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">" "</span>, end=<span class="string">","</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            print(all_letters[topi_temp[<span class="number">0</span>][j].item()], end=<span class="string">","</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">if</span> topi_temp[<span class="number">0</span>][j].item() &gt;= n_letters - <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">" "</span>, end=<span class="string">"]\n"</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            print(all_letters[topi_temp[<span class="number">0</span>][j].item()], end=<span class="string">"]\n"</span>)</span><br><span class="line">                letter = all_letters[topi]</span><br><span class="line">                output_name += letter</span><br><span class="line">            input = generate_input_tensor(letter)</span><br><span class="line">        print(output_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 开始运行</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line">rnn = RNN(n_letters, <span class="number">128</span>, n_letters)</span><br><span class="line"></span><br><span class="line">all_losses = []</span><br><span class="line">total_loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 超参数参考值</span></span><br><span class="line"><span class="comment"># n_its = 100000</span></span><br><span class="line"><span class="comment"># print_every = 5000</span></span><br><span class="line"><span class="comment"># plot_every = 500</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"请分别输入总迭代次数,打印精度,绘图精度(按空格分隔): "</span>, end=<span class="string">""</span>)</span><br><span class="line">n_its, print_every, plot_every = map(int, input().split())</span><br><span class="line">print(<span class="string">"开始训练......"</span>)</span><br><span class="line">start = time.time()</span><br><span class="line">print(<span class="string">"[时间戳]\t\t百分比\t\t已迭代数\t\t损失"</span>)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> range(<span class="number">1</span>, n_its + <span class="number">1</span>):</span><br><span class="line">    output, loss = train(*randomTrainingExample())</span><br><span class="line">    total_loss += loss</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> it % print_every == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"[%10s]  &lt;%3d%%&gt;  %10d  %.4f"</span> % (time_format(start), it / n_its * <span class="number">100</span>, it, loss))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> it % plot_every == <span class="number">0</span>:</span><br><span class="line">        all_losses.append(total_loss / plot_every)</span><br><span class="line">        total_loss = <span class="number">0</span></span><br><span class="line">print(<span class="string">"训练完成！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画出损失图像</span></span><br><span class="line">print(<span class="string">"绘制损失图像......"</span>)</span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(all_losses)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成测试</span></span><br><span class="line">print(<span class="string">"请输入是否要进行网络采样测试(1,是;0,否): "</span>, end=<span class="string">""</span>)</span><br><span class="line">flag = int(input())</span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    print(<span class="string">"请输入类别和姓名首字母(按空格分割,例: female Al): "</span>, end=<span class="string">""</span>)</span><br><span class="line">    cat, letters = input().split()</span><br><span class="line">    sample(cat, letters)</span><br><span class="line">    print(<span class="string">"要继续吗(1,继续;0,停止)？"</span>, end=<span class="string">""</span>)</span><br><span class="line">    flag = int(input())</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典RNN的应用为baby起名字的代码实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="RNN" scheme="https://666wxy666.github.io/tags/RNN/"/>
    
      <category term="起名字" scheme="https://666wxy666.github.io/tags/%E8%B5%B7%E5%90%8D%E5%AD%97/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 K-Means聚类</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-K-Means%E8%81%9A%E7%B1%BB/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-K-Means%E8%81%9A%E7%B1%BB/</id>
    <published>2020-08-24T01:38:51.163Z</published>
    <updated>2020-07-15T14:49:28.884Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典聚类算法K-Means的代码实现。</p><a id="more"></a><h2 id="一、实验目标"><a href="#一、实验目标" class="headerlink" title="一、实验目标"></a>一、实验目标</h2><p>数据说明：目标是对 cluster.dat 里的数据进行聚类分析。其中，cluster.dat 包含了若干二维输入数据（但不包含其输出）。</p><ul><li><p>使用 K-means 模型进行聚类，尝试使用不同的类别个数 K，并分析聚类结果。 </p></li><li><p>按照 8:2 的比例随机将数据划分为训练集和测试集，至少尝试 3 个不同的 K 值，并画出不同 K 下的聚类结果，及不同模型在训练集和测试集上的损失。对结果进行讨论，发现能解释数据的最好的 K值。</p></li></ul><h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><ul><li>语言：Python 3.7（Anaconda3）</li><li>IDE：PyCharm 2020.1.1 (Professional Edition)</li><li>Packages：<ul><li>numpy：1.18.1</li><li>matplotlib：3.1.3</li></ul></li></ul><h2 id="三、算法原理"><a href="#三、算法原理" class="headerlink" title="三、算法原理"></a>三、算法原理</h2><p>聚类是一种典型无监督学习，K-means算法是聚类的经典算法。目标是将原始数据集划分为k个簇，最小化损失函数（目标函数）是：<br>$$<br>SSE=\sum_{n=1}^{N}\sum_{k=1}^{K}r_{nk}dist(x_n-\mu_k)<br>$$</p><ul><li>$\mu_k$表示簇$C_k$的中心点（或其他能代表$C_k$的点）。</li><li>$x_n$被划分到簇$C_k$则$r_{nk}=1$，否则$r_{nk}=0$。</li><li>目标是找到簇的中心点$\mu_k$及簇的划分$r_{nk}$使得目标函数SSE最小。</li></ul><p>要解决上述问题就需要遍历所有可能的簇划分，显然这是不合适的。K-means算法使用了贪心策略求一个近似解，具体步骤如下：</p><ol><li>将全部数据随机分为k类，计算每类的重心作为初始点。</li><li>计算所有数据点与各个簇中心之间的距离，将数据点划到与它距离最近的簇中。</li><li>根据簇中已有的样本点，重新计算簇中心（一般使用重心）。</li><li>重复2、3，直到数据点的簇划分不在变化或者达到了规定的最大迭代次数。</li></ol><p>这是k-means算法的基本步骤，但是，这个算法有个很严重的问题，就是在将数据点划到与它距离最近的簇后，由于初始簇心选择不当，可能产生空簇，导致计算簇中心无法进行（簇的size=0，除数为0），我的解决方法是在计算簇心时，如果簇的size=0就先忽略，后面单独处理。计算完非空簇心后，依次选取与自己簇中心最远、次远……的点（因为距离自己的簇心越远，这个点分到该簇的概率越低）作为空簇的簇心，直到没有空簇，即所有的簇都有簇心，然后继续算法。</p><h2 id="四、算法流程图"><a href="#四、算法流程图" class="headerlink" title="四、算法流程图"></a>四、算法流程图</h2><p>这只是算法函数（algorithm）和其他一些部分的流程图，不是整个程序的流程图，整个程序要更复杂。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524095524.svg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524095524.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="程序流程图" style="zoom: 67%;"><h2 id="五、实验结果及分析"><a href="#五、实验结果及分析" class="headerlink" title="五、实验结果及分析"></a>五、实验结果及分析</h2><ol><li><p>输入k的范围是[2,10]，测试集所占比例为0.2，最大迭代次数为20。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524104752.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104752.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104724" style="zoom:50%;"></li><li><p>聚类结果</p><table><thead><tr><th align="center">k=2</th><th align="center">k=3</th><th align="center">k=4</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104824.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104824.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104436" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104838.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104838.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104447" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104853.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104853.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104456" style="zoom: 67%;"></td></tr><tr><td align="center"><strong>k=5</strong></td><td align="center"><strong>k=6</strong></td><td align="center"><strong>k=7</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104910.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104910.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104505" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104921.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104921.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104521" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104933.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104933.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104543" style="zoom:67%;"></td></tr><tr><td align="center"><strong>k=8</strong></td><td align="center"><strong>k=9</strong></td><td align="center"><strong>k=10</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104954.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104954.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104555" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524105001.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105001.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104607" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524105008.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105008.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104617" style="zoom:67%;"></td></tr></tbody></table></li></ol><ol start="3"><li><p>k从2~10的数据集、训练集和测试集的SSE如图：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524105029.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105029.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104656" style="zoom: 67%;"></li><li><p>可以发现k=2~4时SSE下降较快，k=4~10时下降较慢，由于我们的目标是使SSE减小，因此由图可以得出k=4为解释数据较好的k。并且在k=2时，重复实验甚至会出现完全不同的聚类结果，说明k=2太小。在k&gt;=6之后，SSE基本不下降，说明k再加大没有多大意义。</p></li></ol><h2 id="六、附录"><a href="#六、附录" class="headerlink" title="六、附录"></a>六、附录</h2><p>kmeans.py：</p><ol start="0"><li><p>基本配置、全局参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: kmeans</span></span><br><span class="line"><span class="string">@Description: k-means算法</span></span><br><span class="line"><span class="string">@Version: 1.0</span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-05-22 21:25</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-05-22 21:25</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 全局变量</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">'font.sans-serif'</span>] = [<span class="string">'SimHei'</span>]</span><br><span class="line"><span class="comment"># 显示负号</span></span><br><span class="line">plt.rcParams[<span class="string">'axes.unicode_minus'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 簇个数范围</span></span><br><span class="line">k_min = <span class="number">1</span></span><br><span class="line">k_max = <span class="number">1</span></span><br><span class="line">max_iteration = <span class="number">10</span>  <span class="comment"># 最大迭代次数</span></span><br><span class="line">test_rate = <span class="number">0.2</span>  <span class="comment"># 训练集所占比例</span></span><br><span class="line">all_point_num = <span class="number">0</span></span><br><span class="line">data_x = []  <span class="comment"># 点的x坐标列表</span></span><br><span class="line">data_y = []  <span class="comment"># 点的y坐标列表</span></span><br><span class="line">data_SSE_list = []  <span class="comment"># 数据集损失目标函数列表</span></span><br><span class="line">train_SSE_list = []  <span class="comment"># 训练集损失目标函数列表</span></span><br><span class="line">test_SSE_list = []  <span class="comment"># 测试集损失目标函数列表</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>读入数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 读入数据</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_data</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> all_point_num</span><br><span class="line">    <span class="keyword">global</span> test_rate</span><br><span class="line">    <span class="keyword">global</span> max_iteration</span><br><span class="line">    <span class="keyword">global</span> k_min</span><br><span class="line">    <span class="keyword">global</span> k_max</span><br><span class="line">    data = open(path)  <span class="comment"># 打开数据文件</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        <span class="comment"># 将数据文件的每一行按空格分隔，分别添加到x,y列表</span></span><br><span class="line">        data_x.append(float(line.split()[<span class="number">0</span>]))</span><br><span class="line">        data_y.append(float(line.split()[<span class="number">1</span>]))</span><br><span class="line">        all_point_num += <span class="number">1</span></span><br><span class="line">    print(<span class="string">"请输入k的范围（空格分隔，例如2 5，代表闭区间[2,5]）："</span>, end=<span class="string">""</span>)</span><br><span class="line">    k_min, k_max = map(int, input().split())</span><br><span class="line">    <span class="keyword">if</span> k_min &gt; k_max <span class="keyword">or</span> k_min &lt; <span class="number">1</span> <span class="keyword">or</span> k_max &lt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 簇的个数输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"请输入测试集所占比例："</span>, end=<span class="string">""</span>)</span><br><span class="line">    test_rate = float(input())</span><br><span class="line">    <span class="keyword">if</span> test_rate &lt; <span class="number">0</span> <span class="keyword">or</span> test_rate &gt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 测试集所占比例输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"请输入最大迭代次数："</span>, end=<span class="string">""</span>)</span><br><span class="line">    max_iteration = int(input())</span><br><span class="line">    <span class="keyword">if</span> max_iteration &lt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 最大迭代次数输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>算法计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 算法</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">algorithm</span><span class="params">(x, y, k)</span>:</span></span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    n = <span class="number">0</span>  <span class="comment"># 迭代次数</span></span><br><span class="line">    SSE = <span class="number">0</span>  <span class="comment"># 损失（目标）函数</span></span><br><span class="line">    point_array = np.array([x, y])  <span class="comment"># 生成点的numpy数组，例如三个点(1，-1),(2，-2),(3，-3)生成[[ 1  2  3 ][ -1 -2 -3 ]]</span></span><br><span class="line">    point_num = point_array.shape[<span class="number">1</span>]  <span class="comment"># 获取点的个数，所给的数据集为1000个点，取0.8为800个</span></span><br><span class="line">    <span class="comment"># 如果点的个数&lt;簇的个数，则报错异常退出</span></span><br><span class="line">    <span class="keyword">if</span> point_num &lt; k:</span><br><span class="line">        print(<span class="string">"ERROR: 点的个数&lt;簇的个数！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    distance = np.zeros(k)  <span class="comment"># 初始化k维0向量，用来存储这个点到的k个簇中心的距离</span></span><br><span class="line">    point_distance = np.zeros(point_num)  <span class="comment"># 初始化point_num维0向量，用来存储每个点到其簇中心的距离</span></span><br><span class="line">    center = np.zeros((<span class="number">2</span>, k))  <span class="comment"># 生成2*k的零矩阵，初始化k个簇的中心点，后面将先计算每个簇的重心作为初始簇中心</span></span><br><span class="line">    point_k1 = np.arange(<span class="number">0</span>, k, <span class="number">1</span>)  <span class="comment"># 先生成0~k-1的数组，保证每个簇至少有一个点</span></span><br><span class="line">    point_k2 = np.random.randint(<span class="number">0</span>, k, size=point_num - k)  <span class="comment"># 将剩下的点随机分到任意一个簇，返回长度为point_num-k的向量，每个为0~k-1的随机整数</span></span><br><span class="line">    point_k = np.concatenate((point_k1, point_k2))  <span class="comment"># 将前两个数组合成为一个</span></span><br><span class="line">    np.random.shuffle(point_k)  <span class="comment"># 最后再打乱一次point_k数组，保证随机性</span></span><br><span class="line">    point_k_bak = point_k.copy()  <span class="comment"># point_k的备份，用于判断前后两次迭代是否发生变化</span></span><br><span class="line">    <span class="comment"># 输出相关信息</span></span><br><span class="line">    print(<span class="string">"点个数为："</span>, point_num, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 开始K-means算法的迭代</span></span><br><span class="line">    <span class="comment"># 只要迭代次数没有超过最大迭代次数上限max_iteration并且两次迭代的结果还有变化，就继续迭代</span></span><br><span class="line">    <span class="keyword">while</span> n &lt;= max_iteration:</span><br><span class="line">        <span class="comment"># 计算每个簇的中心</span></span><br><span class="line">        size = np.bincount(point_k, minlength=k)  <span class="comment"># 计算每个簇的规模，k维向量，每一维为每个簇里点的个数</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k):  <span class="comment"># 对于k个簇中的每一个簇i</span></span><br><span class="line">            <span class="comment"># 不是空簇，防止出现除数为0，空簇下面单独处理</span></span><br><span class="line">            <span class="keyword">if</span> size[i] != <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># point_sum是一个二维向量，代表i簇中的所有点的x,y坐标值的和</span></span><br><span class="line">                point_sum = np.zeros(<span class="number">2</span>)  <span class="comment"># 初始化为0</span></span><br><span class="line">                <span class="comment"># 计算i簇中的所有点的x,y坐标值的和</span></span><br><span class="line">                <span class="keyword">for</span> point <span class="keyword">in</span> range(point_num):  <span class="comment"># 对于每一个点point</span></span><br><span class="line">                    <span class="keyword">if</span> point_k[point] == i:  <span class="comment"># 如果这个点point属于簇i</span></span><br><span class="line">                        point_sum = point_sum + point_array[:, point]  <span class="comment"># 将这个点的x,y坐标加到point_sum上</span></span><br><span class="line">                        <span class="comment"># note: array[:, i]就是取array的第i列，刚好就是这个点</span></span><br><span class="line">                <span class="comment"># 求平均数，因此要/这个簇中点的个数size[i]</span></span><br><span class="line">                <span class="comment"># 将计算出的簇中心存在center矩阵中的第i列，代表第i个簇的中心点</span></span><br><span class="line">                center[:, i] = point_sum / size[i]</span><br><span class="line">        <span class="comment"># 对所有的空簇单独处理</span></span><br><span class="line">        <span class="comment"># 处理方式为把与自己所在的簇中心距离最大的点作为空簇的簇中心</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> np.where(size == <span class="number">0</span>)[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># 将距离最大的点的所在簇改为空簇的簇号</span></span><br><span class="line">            point_k[np.argmax(point_distance)] = c</span><br><span class="line">            <span class="comment"># 将空簇中心改为这个点</span></span><br><span class="line">            center[:, c] = point_array[:, np.argmax(point_distance)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将每一个点分到与簇中心最近的簇</span></span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> range(point_num):  <span class="comment"># 对于每一个点point</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(k):  <span class="comment"># 对于k个簇中的每一个簇i</span></span><br><span class="line">                <span class="comment"># 计算该点point到该簇i的距离</span></span><br><span class="line">                <span class="comment"># note: 使用矩阵的2范式，来计算欧氏距离</span></span><br><span class="line">                <span class="comment">#  point_array[:, point] - center[:, i]得到向量[p_x-c_x, p_y-c_y]</span></span><br><span class="line">                <span class="comment">#  对该向量求2范式刚好是欧式距离sqrt((p_x-c_x)^2+(p_y-c_y)^2)</span></span><br><span class="line">                distance[i] = np.linalg.norm(point_array[:, point] - center[:, i])</span><br><span class="line">            <span class="comment"># 使用numpy的argmin()返回distance中最小值的下标，也就是点point到簇中心距离最小的簇</span></span><br><span class="line">            point_k[point] = np.argmin(distance)</span><br><span class="line">            <span class="comment"># 将该点到其簇中心的距离记录下来</span></span><br><span class="line">            point_distance[point] = distance[point_k[point]]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 迭代次数+1</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 判断两次迭代是否有变化，没有变化就跳出迭代循环</span></span><br><span class="line">        <span class="keyword">if</span> (point_k == point_k_bak).all():</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 将point_k备份</span></span><br><span class="line">        point_k_bak = point_k.copy()</span><br><span class="line">        <span class="comment"># 输出每次迭代目标函数值</span></span><br><span class="line">        SSE = np.sum(point_distance)</span><br><span class="line">        print(<span class="string">"n="</span>, n - <span class="number">1</span>, <span class="string">"，SSE="</span>, SSE, sep=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出相关信息</span></span><br><span class="line">    print(<span class="string">"总迭代次数为："</span>, n - <span class="number">1</span>, sep=<span class="string">""</span>)</span><br><span class="line">    print(<span class="string">"每个簇的中心："</span>, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        print(<span class="string">"("</span>, center[<span class="number">0</span>, i], <span class="string">","</span>, center[<span class="number">1</span>, i], <span class="string">")"</span>, sep=<span class="string">""</span>)</span><br><span class="line">    print(<span class="string">"==================================================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> SSE, point_k</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>画图展示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 画图展示</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 根据每个点所在的簇，获取点的颜色，返回一个列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_color_list</span><span class="params">(point_k, k)</span>:</span></span><br><span class="line">    <span class="comment"># 随机生成k个颜色</span></span><br><span class="line">    RGB = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>]</span><br><span class="line">    colors = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; k:</span><br><span class="line">        color = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">            color += RGB[random.randint(<span class="number">0</span>, <span class="number">14</span>)]</span><br><span class="line">        <span class="comment"># 只有随机产生的颜色不相同，才加到colors中，颜色个数+1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"#"</span> + color <span class="keyword">not</span> <span class="keyword">in</span> colors <span class="keyword">and</span> color != <span class="string">"FFFFFF"</span>:</span><br><span class="line">            colors.append(<span class="string">"#"</span> + color)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 对每个点，根据point_k中记录的点所在的簇，将颜色添加到列表中</span></span><br><span class="line">    color_list = []</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> point_k:</span><br><span class="line">        color_list.append(colors[c])</span><br><span class="line">    <span class="keyword">return</span> color_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画散点图展示聚类结果（数据集，训练集、测试集）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(x, y, result, x1, y1, result1, x2, y2, result2, k)</span>:</span></span><br><span class="line">    <span class="comment"># 数据集图</span></span><br><span class="line">    plt.subplot(<span class="number">131</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means数据集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    <span class="comment"># note: scatter函数支持传入颜色列表，对每一个点使用列表相应下标对应的颜色</span></span><br><span class="line">    plt.scatter(x, y, c=get_color_list(result, k))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练集图</span></span><br><span class="line">    plt.subplot(<span class="number">132</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means训练集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    plt.scatter(x1, y1, c=get_color_list(result1, k))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试集图</span></span><br><span class="line">    plt.subplot(<span class="number">133</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means测试集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    plt.scatter(x2, y2, c=get_color_list(result2, k))</span><br><span class="line">    <span class="comment"># 展示散点图</span></span><br><span class="line"></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画折线图展示SSE对比</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_SSE</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means在不同k下的损失"</span>)</span><br><span class="line">    <span class="comment"># 设置x轴坐标</span></span><br><span class="line">    plt.xlim(k_min - <span class="number">1</span>, k_max + <span class="number">2</span>)</span><br><span class="line">    plt.xlabel(<span class="string">"k"</span>)  <span class="comment"># 设置x轴标注</span></span><br><span class="line">    plt.ylabel(<span class="string">"SSE"</span>)  <span class="comment"># 设置y轴标注</span></span><br><span class="line">    <span class="comment"># 绘制K-Means在不同k下训练集和测试集的损失</span></span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), data_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'blue'</span>, marker=<span class="string">'v'</span>, ms=<span class="number">4</span>, label=<span class="string">'数据集'</span>)</span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), train_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'red'</span>, marker=<span class="string">'s'</span>, ms=<span class="number">4</span>, label=<span class="string">'训练集'</span>)</span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), test_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'green'</span>, marker=<span class="string">'o'</span>, label=<span class="string">'测试集'</span>)</span><br><span class="line">    plt.legend()  <span class="comment"># 图例</span></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>开始运行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 开始运行</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 读入数据</span></span><br><span class="line">read_data(<span class="string">"cluster.dat"</span>)</span><br><span class="line"><span class="comment"># 划分训练集和测试集</span></span><br><span class="line">train_x, test_x, train_y, test_y = train_test_split(data_x, data_y, test_size=test_rate, random_state=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 对k从2~5进行聚类</span></span><br><span class="line"><span class="keyword">for</span> k_num <span class="keyword">in</span> range(k_min, k_max + <span class="number">1</span>):</span><br><span class="line">    print(<span class="string">"###################################################"</span>)</span><br><span class="line">    print(<span class="string">"簇个数为："</span>, k_num, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 数据集</span></span><br><span class="line">    print(<span class="string">"数据集："</span>)</span><br><span class="line">    data_SSE, data_result = algorithm(data_x, data_y, k_num)</span><br><span class="line">    data_SSE_list.append(data_SSE)</span><br><span class="line">    <span class="comment"># 训练集</span></span><br><span class="line">    print(<span class="string">"训练集："</span>)</span><br><span class="line">    train_SSE, train_result = algorithm(train_x, train_y, k_num)</span><br><span class="line">    train_SSE_list.append(train_SSE)</span><br><span class="line">    <span class="comment"># 测试集</span></span><br><span class="line">    print(<span class="string">"测试集："</span>)</span><br><span class="line">    test_SSE, test_result = algorithm(test_y, test_y, k_num)</span><br><span class="line">    test_SSE_list.append(test_SSE)</span><br><span class="line">    <span class="comment"># 输出平均SSE</span></span><br><span class="line">    print(<span class="string">"数据集最终平均损失函数AVG_SSE："</span>, data_SSE / all_point_num)</span><br><span class="line">    print(<span class="string">"训练集最终平均损失函数AVG_SSE："</span>, train_SSE / (all_point_num * (<span class="number">1</span> - test_rate)))</span><br><span class="line">    print(<span class="string">"测试集最终平均损失函数AVG_SSE："</span>, test_SSE / (all_point_num * test_rate))</span><br><span class="line">    <span class="comment"># 画图</span></span><br><span class="line">    show(data_x, data_y, data_result, train_x, train_y, train_result, test_x, test_y, test_result, k_num)</span><br><span class="line"><span class="comment"># 画图展示SSE</span></span><br><span class="line">show_SSE()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典聚类算法K-Means的代码实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="K-Means" scheme="https://666wxy666.github.io/tags/K-Means/"/>
    
      <category term="聚类" scheme="https://666wxy666.github.io/tags/%E8%81%9A%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 DNN 手写识别</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-DNN-%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-DNN-%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/</id>
    <published>2020-08-24T01:38:51.154Z</published>
    <updated>2020-07-15T14:49:28.884Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典深度神经网络DNN的应用手写识别的思路样例。</p><a id="more"></a><h2 id="一、题目"><a href="#一、题目" class="headerlink" title="一、题目"></a>一、题目</h2><p>请描述一个深度神经网络模型解决实际问题的例子。</p><p>包括问题描述，输入输出数据，训练、测试数据集，深度网络模型结构图，损失函数，训练方法，以及其他需要说明的内容。</p><h2 id="二、问题描述"><a href="#二、问题描述" class="headerlink" title="二、问题描述"></a>二、问题描述</h2><p>下面将描述一个深度神经网络的典型经典例子：手写数字识别（OCR）。</p><p>⼈类视觉系统是世界上众多奇迹之一。下面的手写数字序列：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><p>大多数人毫不费力就能够认出这些数字为 504192。识别手写数字不是一件简单的事。尽管⼈类在理解我们眼睛展示出来的信息上非常擅长，但如果你尝试写出计算机程序来识别诸如上面的数字，就会明显感受到视觉模式识别的困难。看起来人类一下子就能完成的任务变得特别困难。关于我们识别形状——“9 顶上有一个圈，右下方则是一条竖线”这样的简单直觉——实际上算法上就很难轻易表达出来了。而在你试着让这些识别规则越发精准时，就会很快陷入各种混乱的异常或者特殊情形的困境中。实现一个可以识别手写数字的神经网络。这个神经网络不需要人类帮助便可以超过 96% 的准确率识别数字。实际上，最优的商业神经网络已经足够好到被银行和邮局分别用在账单核查和识别地址上了。</p><h2 id="二、输入输出数据"><a href="#二、输入输出数据" class="headerlink" title="二、输入输出数据"></a>二、输入输出数据</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200605100130.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100130.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><h3 id="1、输入数据"><a href="#1、输入数据" class="headerlink" title="1、输入数据"></a>1、输入数据</h3><p>一系列手写的数字，例如：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><h3 id="2、输出数据"><a href="#2、输出数据" class="headerlink" title="2、输出数据"></a>2、输出数据</h3><p>识别出的数字：504192</p><h2 id="三、训练、测试数据集"><a href="#三、训练、测试数据集" class="headerlink" title="三、训练、测试数据集"></a>三、训练、测试数据集</h2><p>使用经典的<em>MNIST</em> 数据集作为数据源。MNIST 数据分为两个部分。第一部分包含 60,000 幅用于训练数据的图像。这些图像扫描⾃250 ⼈的手写样本。这些图像是28 × 28 ⼤小的灰度图像。第二部分是 10,000 幅用于测试数据的图像，同样是 28 × 28 的灰度图像。</p><h3 id="训练集测试集样例"><a href="#训练集测试集样例" class="headerlink" title="训练集测试集样例"></a>训练集测试集样例</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200605100239.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100239.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="fc73217ae57f451a89badc801a903bb742e42eabd9434ecc8089efe19a66c076" style="zoom:80%;"><p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103228.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103228.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="神经网络与深度学习1"></p><h2 id="四、深度网络模型结构图"><a href="#四、深度网络模型结构图" class="headerlink" title="四、深度网络模型结构图"></a>四、深度网络模型结构图</h2><p>我们可以把识别手写数字的问题分成两个子问题。首先，我们希望有个方式把包含许多数字的图像分成一系列单独的图像，每个包含单个数字。例如，我们想要把图像</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><p>分成六个单独的图像</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601104635.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601104635.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits_separate" style="zoom:80%;"><p>一旦图像被分割，那么程序需要把每个单独的数字分类。例如，我们想要我们的程序能识别上面的第一个数字是 5。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601104811.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601104811.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="mnist_first_digit" style="zoom:80%;"><p>有很多途径可以解决分割的问题。一种方法是尝试不同比分割方式，用数字分类器对每一个切分片段打分。如果数字分类器对每一个片段的置信度都较高，那么这个分割方式就能得到较高的分数；如果数字分类器在一或多个片段中出现问题，那么这种分割方式就会得到较低的分数。这种方法的思想是，如果分类器有问题，那么很可能是由于图像分割出错导致的。这种思想以及它的变化形式能够比较好地解决分割问题。因此，与其关心分割问题，我们不如把精力集中在解决第二个问题即分类单独的数字。</p><p>我们可以使用一个三层神经网络来识别单个数字：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601105123.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601105123.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200601105123061" style="zoom:80%;"><p>标准的DNN的模型结构：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605101604.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605101604.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p>网络的输入层包含给输入像素的值进行编码的神经元。我们给网络的训练数据会有很多扫描得到的 28 × 28 的手写数字的图像组成，所有输入层包含有 784 = 28 × 28个神经元。为了简化，上图中我已经忽略了 784 中⼤部分的输入神经元。输入像素是灰度级的，值为 0.0 表示白色，值为 1.0 表示黑色，中间数值表示逐渐暗淡的灰色。</p><p>网络的中间层是隐藏层。我们用 n 来表示神经元的数量，我们将给 n 实验不同的数值。示例中用一个小的隐藏层来说明，仅仅包含 n = 15 个神经元。</p><p>网络的输出层包含有 10 个神经元。如果第一个神经元激活，即输出$\approx1$，那么表明网络认为数字是一个 0。如果第二个神经元激活，就表明网络认为数字是一个 1。依此类推。更确切地说，我们把输出神经元的输出赋予编号 0 到 9，并计算出那个神经元有最高的激活值。比如，如果编号为 6 的神经元激活，那么我们的网络会猜到输入的数字是 6。其它神经元相同。</p><p>这里使用 10 个输出神经元，因为任务是能让神经网络告诉我们哪个数字（0, 1, 2, . . . , 9 ）能和输入图片匹配，但是使用 4 个输出神经元，即把每一个当做一个二进制值，结果取决于它的输出更靠近 0 还是 1 。四个神经元足够编码这个问题了，因为 24 = 16 ⼤于 10 种可能的输入。但是10 个输出神经元的神经网络比 4 个的识别效果更好。</p><p>在上述的三层神经网络加一个额外的一层就可以实现按位表示数字。额外的一层把原来的输出层转化为一个二进制表示：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601105740.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601105740.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200601105739985" style="zoom:80%;"><p>将上述网络详细展开来说，我们可以选择两个大小为100的隐层和一个大小为10的输出层，因为MNIST数据集是手写0到9的灰度图像，类别有10个，所以最后的输出大小是10。隐层的激活函数可以使用ReLU，最后输出层的激活函数是Softmax，所以最后的输出层相当于一个分类器。加上一个输入层的话，多层感知器的结构是：输入层–&gt;隐层–&gt;隐层–&gt;输出层。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605100555.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100555.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="cb69f928778c4299b75814179607a89eea770bdc409d4e08a87e2975cb96b19b" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200605100939.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100939.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="123" style="zoom:67%;"><h2 id="五、损失函及训练方法"><a href="#五、损失函及训练方法" class="headerlink" title="五、损失函及训练方法"></a>五、损失函及训练方法</h2><p>我们使用DNN反向传播算法和梯度下降算法进行学习训练。我们将用符号$x$来表示一个训练输入。为了方便，把每个训练输入$x$看作一个表示$28\times28=784$维的向量。每个向量中的项目代表图像中单个像素的灰度值。我们用$y=y(x)$表示对应的期望输出，这里$y$是一个 10 维的向量。例如，如果有一个特定的画成6的训练图像$x$，那么$y(x) = (0, 0, 0, 0, 0, 0, 1, 0, 0, 0)^T$则是网络的期望输出。</p><p>我们希望有一个算法，能让我们找到权重和偏置，以⾄于网络的输出$y(x)$能够拟合所有的训练输入$x$。为了量化我们如何实现这个目标，我们定义一个代价损失函数：<br>$$<br>C(w,b)\equiv{\frac{1}{2n}}\sum_x||y(x)-a||^2<br>$$<br>这里$w$表示所有的网络中权重的集合，$b$是所有的偏置，$n$是训练输入数据的个数，$a$是表示当输入为 $x$时输出的向量，输出$a$取决于$x$，$w$和$b$，求和则是在总的训练输入$x$上进行的。符号$||v||$是指向量 v 的模。我们的训练算法的目的是最小化权重和偏置的代价函数$C(w,b)$。换句话说，我们想要找到一系列能让代价尽可能小的权重和偏置。</p><p>也可以使用的是交叉熵损失函数，该函数在分类任务上比较常用。定义了一个损失函数之后，还有对它求平均值，训练程序必须返回平均损失作为第一个返回值，因为它会被后面反向传播算法所用到。同时我们还可以定义一个准确率函数，这个可以在我们训练的时候输出分类的准确率。<br>$$<br>H(p,q)=-\sum_{i=1}^{n}p(x_i)\log(q(x_i))<br>$$</p><p>梯度下降算法的基本步骤：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605102348.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605102348.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200601112017" style="zoom:80%;"><h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>上述神经网络在测试集的准确度能达到95%左右，非常准确。</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200601113522.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601113522.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="regularized_full"></p><p>相较于SVM，准确度和性能均有较大提升。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601113339.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601113339.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="more_data_comparison" style="zoom:80%;"><p>深度神经网络（Deep Neural Networks，DNN）是一个非常有前景和创新的研究方向。除了手写识别（OCR），还有各个行业的经典样例，比如：图像方面的黑白照片变彩色照片的图像着色（LetThereBeColor）、图像风格化，将一幅图像的内容与另一幅图像的风格相结合（neural-style）、通过深度学习极大提高模糊图片的分辨率（srez）、实时捕获面部表情，调换到另外一个人的面部（Face2Face）、雅虎出品的成人图片分类器（open_nsfw）、成人视频分类器（Miles Deep）等等，就不一一列举了。总之深度神经网络和深度学习给出了在图像识别、语音识别和自然语言处理领域中众多问题的最好解决方案，重要性不言而喻。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典深度神经网络DNN的应用手写识别的思路样例。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="DNN" scheme="https://666wxy666.github.io/tags/DNN/"/>
    
      <category term="手写识别" scheme="https://666wxy666.github.io/tags/%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/"/>
    
  </entry>
  
  <entry>
    <title>Hello Blog</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</id>
    <published>2020-08-24T01:38:51.142Z</published>
    <updated>2020-07-15T14:49:28.883Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p class="p center large">HELLO BLOG</p><p>欢迎来到我的博客，这是我的第一篇博客测试文章。</p><a id="more"></a><p>如果有什么问题，欢迎到我的Github提问我。</p>]]></content>
    
    <summary type="html">
    
      &lt;p class=&quot;p center large&quot;&gt;HELLO BLOG&lt;/p&gt;

&lt;p&gt;欢迎来到我的博客，这是我的第一篇博客测试文章。&lt;/p&gt;
    
    </summary>
    
    
      <category term="其他" scheme="https://666wxy666.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="first" scheme="https://666wxy666.github.io/tags/first/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark 自选日志分析</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E8%87%AA%E9%80%89%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E8%87%AA%E9%80%89%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/</id>
    <published>2020-08-24T01:38:51.125Z</published>
    <updated>2020-07-15T14:49:28.883Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Java进行Spark编程实现自选日志处理分析。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Spark版本：Apache Spark 2.1.1</li><li>Eclipse版本：Neno.3 （4.6.3）</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>收集一组自选日志，构造mydata.log数据集，上传到实验环境中，重新完成对自选日志分析。</li></ul><h2 id="三、主要步骤："><a href="#三、主要步骤：" class="headerlink" title="三、主要步骤："></a>三、主要步骤：</h2><ul><li>获取自选数据集</li><li>自选数据集计算的需求分析</li><li>编程设计实现</li><li>运行程序</li></ul><h2 id="四、实验步骤："><a href="#四、实验步骤：" class="headerlink" title="四、实验步骤："></a>四、实验步骤：</h2><h3 id="4-1获取自选数据集以及数据字段格式解释说明"><a href="#4-1获取自选数据集以及数据字段格式解释说明" class="headerlink" title="4.1获取自选数据集以及数据字段格式解释说明"></a>4.1获取自选数据集以及数据字段格式解释说明</h3><p>我受到平台的第一个实验和uber日志文件的启发，想到了自己用python生成uber日志文件，首先是日志的格式：</p><table><thead><tr><th align="center">字段</th><th align="center">数据类型</th><th align="center">说明信息</th></tr></thead><tbody><tr><td align="center">dispatching_base_number</td><td align="center">String</td><td align="center">区域编号</td></tr><tr><td align="center">date</td><td align="center">String</td><td align="center">日期</td></tr><tr><td align="center">active_vehicles</td><td align="center">int</td><td align="center">使用的机动车数量</td></tr><tr><td align="center">trips</td><td align="center">int</td><td align="center">旅游次数</td></tr></tbody></table><p>定义好了日志的格式，只要编写python程序，让他自己按照这个格式生产日志即可，具体代码见附录，下面是部分代码截图和运行结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603145855.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603145855.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_145833" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603145923.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603145923.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_145917" style="zoom:80%;"><h3 id="4-2自选数据集计算的需求分析"><a href="#4-2自选数据集计算的需求分析" class="headerlink" title="4.2自选数据集计算的需求分析"></a>4.2自选数据集计算的需求分析</h3><p>因为是汽车和旅游日志信息，并且有不同日期，不同地区的信息，主要需求就是选取从开始时间到截止时间使用的机动车数量和旅游次数最多的前10个地区，以及他们的机动车总数量和旅游总次数。</p><p>主要步骤就是（与实验一大体相同，又有所区别）：</p><ol><li><p>按照 Serrializable 接口实现自定义排序的 Key；</p></li><li><p>将要进行二次排序的文件加载进来生成 key-value 类型的 RDD</p></li><li><p>使用 sortByKey 基于自定义的 Key 进行二次排序</p></li><li><p>去除掉排序的 key，只保留排序结果</p><p>排序规则如下：</p><p>以区域编号dispatching_base_number为基准，分别按照active_vehicles，trips，date进行降序排序。即先按照active_vehicles排序，如果active_vehicles相同，再比较trips，如果trips相同，再比较date，最后选择前10条记录输出。</p></li></ol><h3 id="4-3编程设计实现"><a href="#4-3编程设计实现" class="headerlink" title="4.3编程设计实现"></a>4.3编程设计实现</h3><h4 id="4-3-1创建工程"><a href="#4-3-1创建工程" class="headerlink" title="4.3.1创建工程"></a>4.3.1创建工程</h4><p>4.3.1.1打开Eclipse IDE</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd eclipse/</span><br><span class="line">./eclipse &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102818" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102840" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102917" style="zoom:80%;"><p>4.3.1.2点击 File -&gt; New -&gt;Other</p><p>4.3.1.3搜索 maven -&gt; 点击 Maven Project -&gt; Next-&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103021" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103035" style="zoom:80%;"><p>4.3.1.4选中maven-archetype-quickstart -&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103051" style="zoom:80%;"><p>4.3.1.5输入Group Id 为 org.zkpk；Artifact Id 为 spark ；Package为org.zkpk.spark；-&gt;Finish</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103201" style="zoom:80%;"><p>4.3.1.6升级maven工程</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103247" style="zoom:80%;"><p>升级完成：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103513" style="zoom:80%;"><p>4.3.1.7更改JRE，右键JRE System Library-&gt; Properties</p><p>4.3.1.8选中jdk1.8.0_131-&gt; OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103535" style="zoom:80%;"><p>4.3.1.9点击spark项目-&gt;修改pom.xml-&gt; 保存会自动下载jar包</p><p>4.3.1.10下载Jar包：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103915" style="zoom:80%;"><p>4.3.1.11最终 pom.xml 如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-hive_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-flume_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/main/test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span><span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">executable</span>&gt;</span>java<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeProjectDependencies</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeProjectDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includePluginDependencies</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includePluginDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathScope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">classpathScope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>cn.com.syl.spark.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.3.1.12删除工程生成的App.java和AppTest.java</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_104358" style="zoom:80%;"><p>利用实验一的实验环境编写java程序，同样是SecondarySortKey.java和SecondarySortDemo.java两个java文件。其中SecondarySortKey.java中有两个类，一个是serDemo类，用于存储未排序的数据，一个是SecondarySortKey类，里面重写了一系列排序函数，用于按照自己的规则排序；SecondarySortDemo.java有一个类SecondarySortDemo，里面有主函数和创建Spark RDD，求和，sortByKey等函数，是主要的逻辑运行的地方。</p><h4 id="4-3-2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录："><a href="#4-3-2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录：" class="headerlink" title="4.3.2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录："></a>4.3.2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录：</h4><p>这是排序的数据存放的类，有三个字段，全参构造函数，getter和setter，以及toString，hashCode和equal方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SecondarySortKey that = (SecondarySortKey) o;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles == that.activeVehicles &amp;&amp;</span><br><span class="line">                trips == that.trips &amp;&amp;</span><br><span class="line">                Objects.equals(date, that.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(date, activeVehicles, trips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult&#123;"</span> +</span><br><span class="line">                <span class="string">"截止日期："</span> + date +</span><br><span class="line">                <span class="string">", 使用的机动车总数量："</span> + activeVehicles +</span><br><span class="line">                <span class="string">", 旅游总次数："</span> + trips +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最主要的是$greater，$less等一系列比较函数和compare和compareTo函数用于RDD的sortByKey。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &gt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &gt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>下面的类是主方法所在的类，也是主要的对数据进行处理计算的类：</p><p>他有四个函数（算上主函数），分别为：</p><ul><li><p>main：</p><p>用于打开文件，创建SparkConf和SparkContext对象，调用函数对RDD进行操作，并输出结果。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">       JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">       jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">       JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/mydata.log"</span>);</span><br><span class="line">       JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">       JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByDeviceID(pairRdd);</span><br><span class="line">       JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">       JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">       List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">       System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">       <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">           System.out.println(<span class="string">"区域编号："</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">       &#125;</span><br><span class="line">       jsc.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>mapTfRDD2Pair：</p><p>用于从文件中读取数据，并将其转化为JavaPairRDD，key为区域编号dispatchingBaseNumber，value为以文件每一行生成的serDemo对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String[] split = lines.split(<span class="string">","</span>);</span><br><span class="line">                String dispatchingBaseNumber = split[<span class="number">0</span>];</span><br><span class="line">                String date = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = Integer.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">int</span> trips = Integer.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(date, activeVehicles, trips);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(dispatchingBaseNumber, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>aggregateByRegionID：</p><p>用于将mapTfRDD2Pair生成好的JavaPairRDD按照key对使用的机动车数量activeVehicles和旅游次数trips求和，获得JavaPairRDD，key为区域编号dispatchingBaseNumber，value为已经求和聚集完成的serDemo对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByDeviceID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            String date = d1.getDate().compareTo(d2.getDate()) &gt; <span class="number">0</span> ? d1.getDate() : d2.getDate();</span><br><span class="line">            <span class="keyword">int</span> activeVehicles = d1.getActiveVehicles() + d2.getActiveVehicles();</span><br><span class="line">            <span class="keyword">int</span> trips = d1.getTrips() + d2.getTrips();</span><br><span class="line">            serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">            accessLogInfo.setDate(date);</span><br><span class="line">            accessLogInfo.setActiveVehicles(activeVehicles);</span><br><span class="line">            accessLogInfo.setTrips(trips);</span><br><span class="line">            <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>mapRDDKey2SortKey：</p><p>用于将aggregateByRegionID生成好的JavaPairRDD按照上面定义好的规则进行排序，获得排好序的JavaPairRDD，用于输出。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">            <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">  </span><br><span class="line">                <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    String dispatchingBaseNumber = tuple._1;</span><br><span class="line">                    serDemo accessLogInfo = tuple._2;</span><br><span class="line">                    SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getDate(), accessLogInfo.getActiveVehicles(),</span><br><span class="line">                            accessLogInfo.getTrips());</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, dispatchingBaseNumber);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-4运行程序"><a href="#4-4运行程序" class="headerlink" title="4.4运行程序"></a>4.4运行程序</h3><h4 id="4-4-1将生成好的mydata-log发送到平台。"><a href="#4-4-1将生成好的mydata-log发送到平台。" class="headerlink" title="4.4.1将生成好的mydata.log发送到平台。"></a>4.4.1将生成好的mydata.log发送到平台。</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200603153734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603153734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_125258" style="zoom:80%;"><h4 id="4-4-2运行程序，查看结果。"><a href="#4-4-2运行程序，查看结果。" class="headerlink" title="4.4.2运行程序，查看结果。"></a>4.4.2运行程序，查看结果。</h4><p>可以发现，程序正常运行得出了结果，并且已经求和和排序，成功！</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603154055.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603154055.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ截图20200603142255" style="zoom:80%;"><h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><h3 id="1、SecondarySortKey-java"><a href="#1、SecondarySortKey-java" class="headerlink" title="1、SecondarySortKey.java"></a>1、SecondarySortKey.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.math.Ordered;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">serDemo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5749943279909593929L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveVehicles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActiveVehicles</span><span class="params">(<span class="keyword">int</span> activeVehicles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTrips</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTrips</span><span class="params">(<span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveVehicles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActiveVehicles</span><span class="params">(<span class="keyword">int</span> activeVehicles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTrips</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTrips</span><span class="params">(<span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &gt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &gt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($greater(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &lt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &lt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($less(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SecondarySortKey that = (SecondarySortKey) o;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles == that.activeVehicles &amp;&amp;</span><br><span class="line">                trips == that.trips &amp;&amp;</span><br><span class="line">                Objects.equals(date, that.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(date, activeVehicles, trips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult&#123;"</span> +</span><br><span class="line">                <span class="string">"截止日期："</span> + date +</span><br><span class="line">                <span class="string">", 使用的机动车总数量："</span> + activeVehicles +</span><br><span class="line">                <span class="string">", 旅游总次数："</span> + trips +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、SecondarySortDemo-java"><a href="#2、SecondarySortDemo-java" class="headerlink" title="2、SecondarySortDemo.java"></a>2、SecondarySortDemo.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaSparkContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.Function2;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.PairFunction;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">        JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">        jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">        JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/mydata.log"</span>);</span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByRegionID(pairRdd);</span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">        List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">            System.out.println(<span class="string">"区域编号："</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">        &#125;</span><br><span class="line">        jsc.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从文件读取生成PairRDD</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String[] split = lines.split(<span class="string">","</span>);</span><br><span class="line">                String dispatchingBaseNumber = split[<span class="number">0</span>];</span><br><span class="line">                String date = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = Integer.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">int</span> trips = Integer.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(date, activeVehicles, trips);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(dispatchingBaseNumber, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对PairRDD进行reduceByKey聚集操作求和</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByRegionID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String date = d1.getDate().compareTo(d2.getDate()) &gt; <span class="number">0</span> ? d1.getDate() : d2.getDate();</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = d1.getActiveVehicles() + d2.getActiveVehicles();</span><br><span class="line">                <span class="keyword">int</span> trips = d1.getTrips() + d2.getTrips();</span><br><span class="line">                serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">                accessLogInfo.setDate(date);</span><br><span class="line">                accessLogInfo.setActiveVehicles(activeVehicles);</span><br><span class="line">                accessLogInfo.setTrips(trips);</span><br><span class="line">                <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对PairRDD进行排序，用于最后输出</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">                <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        String dispatchingBaseNumber = tuple._1;</span><br><span class="line">                        serDemo accessLogInfo = tuple._2;</span><br><span class="line">                        SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getDate(), accessLogInfo.getActiveVehicles(),</span><br><span class="line">                                accessLogInfo.getTrips());</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, dispatchingBaseNumber);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、log-generate-py"><a href="#3、log-generate-py" class="headerlink" title="3、log_generate.py"></a>3、log_generate.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 王兴宇 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: log_generate</span></span><br><span class="line"><span class="string">@Description: </span></span><br><span class="line"><span class="string">@Version: </span></span><br><span class="line"><span class="string">@Author: 王兴宇</span></span><br><span class="line"><span class="string">@Date: 2020-06-03 11:20</span></span><br><span class="line"><span class="string">@LastEditors: 王兴宇</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-03 11:20</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">"mydata.log"</span>, mode=<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">ch = string.ascii_uppercase</span><br><span class="line">dispatching_base_number_list = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    dispatching_base_number_list.append(random.choice(ch) + str(random.randint(<span class="number">1</span>, <span class="number">9</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> dispatching_base_number <span class="keyword">in</span> dispatching_base_number_list:</span><br><span class="line">        file.write(dispatching_base_number + <span class="string">","</span> +</span><br><span class="line">                   time.strftime(<span class="string">"%Y-%m-%d"</span>,</span><br><span class="line">                                 time.gmtime(</span><br><span class="line">                                     time.mktime(</span><br><span class="line">                                         time.strptime(<span class="string">"2020-01-02"</span>, <span class="string">"%Y-%m-%d"</span>)) + <span class="number">86400</span> * i)) + <span class="string">","</span> +</span><br><span class="line">                   str(random.randint(<span class="number">100</span>, <span class="number">10000</span>)) + <span class="string">","</span> +</span><br><span class="line">                   str(random.randint(<span class="number">1000</span>, <span class="number">100000</span>)) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">99</span> <span class="keyword">and</span> dispatching_base_number == dispatching_base_number_list[len(dispatching_base_number_list) - <span class="number">1</span>]:</span><br><span class="line">            file.write(dispatching_base_number + <span class="string">","</span> +</span><br><span class="line">                       time.strftime(<span class="string">"%Y-%m-%d"</span>,</span><br><span class="line">                                     time.gmtime(</span><br><span class="line">                                         time.mktime(</span><br><span class="line">                                             time.strptime(<span class="string">"2020-01-02"</span>, <span class="string">"%Y-%m-%d"</span>)) + <span class="number">86400</span> * i)) + <span class="string">","</span> +</span><br><span class="line">                       str(random.randint(<span class="number">100</span>, <span class="number">10000</span>)) + <span class="string">","</span> +</span><br><span class="line">                       str(random.randint(<span class="number">1000</span>, <span class="number">100000</span>)))</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Java进行Spark编程实现自选日志处理分析。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="单词计数" scheme="https://666wxy666.github.io/tags/%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    
      <category term="Scala" scheme="https://666wxy666.github.io/tags/Scala/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="Kafka" scheme="https://666wxy666.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark 分析流量日志</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E5%88%86%E6%9E%90%E6%B5%81%E9%87%8F%E6%97%A5%E5%BF%97/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E5%88%86%E6%9E%90%E6%B5%81%E9%87%8F%E6%97%A5%E5%BF%97/</id>
    <published>2020-08-24T01:38:51.122Z</published>
    <updated>2020-07-15T14:49:28.883Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Java进行Spark编程实现日志处理分析。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Spark版本：Apache Spark 2.1.1</li><li>Eclipse版本：Neno.3 （4.6.3）</li></ul><h2 id="二、实验目的："><a href="#二、实验目的：" class="headerlink" title="二、实验目的："></a>二、实验目的：</h2><p>掌握</p><ul><li>Spark原理</li><li>Hadoop原理</li><li>Shell</li><li>Spark Streaming</li><li>二次排序</li><li>序列化</li><li>Spark RDD</li></ul><h2 id="三、实验结果："><a href="#三、实验结果：" class="headerlink" title="三、实验结果："></a>三、实验结果：</h2><ul><li><p>以下是分析后的流量日志结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603142941.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603142941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7b6022296ee8fef49cd725321a76c1da" style="zoom:80%;"></li></ul><h2 id="四、实验内容："><a href="#四、实验内容：" class="headerlink" title="四、实验内容："></a>四、实验内容：</h2><ul><li>使用SparkStreaming构建实时数据处理系统，来分析手机流量日志。</li></ul><h2 id="五、主要步骤："><a href="#五、主要步骤：" class="headerlink" title="五、主要步骤："></a>五、主要步骤：</h2><ul><li>日志分析</li><li>代码实现</li><li>运行程序</li></ul><h2 id="六、实验步骤："><a href="#六、实验步骤：" class="headerlink" title="六、实验步骤："></a>六、实验步骤：</h2><h3 id="6-1数据日志介绍"><a href="#6-1数据日志介绍" class="headerlink" title="6.1数据日志介绍"></a>6.1数据日志介绍</h3><p>6.1.1数据字段</p><p>6.1.1.1reportTime（报告时间戳）</p><p>6.1.1.2telNum（手机号）</p><p>6.1.1.3upwardflow（上行总流量）</p><p>6.1.1.4downwardflow（下行总流量）</p><h3 id="6-2需求分析"><a href="#6-2需求分析" class="headerlink" title="6.2需求分析"></a>6.2需求分析</h3><p>6.2.1对文本中数据记录进行排序，排序规则如下：</p><p>以telNum为基准，分别按照 upwardflow，downwardflow，reportTime进行降序排序，即先按照upwardflow排序，如果upwardflow相同，再比较downwardflow，如果downwardflow相同，再比较reportTime，最后选择前10条记录输出。</p><p>6.2.2具体实现步骤：</p><p>6.2.2.1按照 Serrializable 接口实现自定义排序的 Key</p><p>6.2.2.2将要进行二次排序的文件加载进来生成 key-value 类型的 RDD</p><p>6.2.2.3使用 sortByKey 基于自定义的 Key 进行二次排序</p><p>6.2.2.4去除掉排序的 key，只保留排序结果</p><h3 id="6-3代码实现："><a href="#6-3代码实现：" class="headerlink" title="6.3代码实现："></a>6.3代码实现：</h3><h4 id="6-3-1创建maven项目"><a href="#6-3-1创建maven项目" class="headerlink" title="6.3.1创建maven项目"></a>6.3.1创建maven项目</h4><p>6.3.1.1打开Eclipse IDE</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd eclipse/</span><br><span class="line">./eclipse &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102818" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102840" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102917" style="zoom:80%;"><p>6.3.1.2点击 File -&gt; New -&gt;Other</p><p>6.3.1.3搜索 maven -&gt; 点击 Maven Project -&gt; Next-&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103021" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103035" style="zoom:80%;"><p>6.3.1.4选中maven-archetype-quickstart -&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103051" style="zoom:80%;"><p>6.3.1.5输入Group Id 为 org.zkpk；Artifact Id 为 spark ；Package为org.zkpk.spark；-&gt;Finish</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103201" style="zoom:80%;"><p>6.3.1.6升级maven工程</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103247" style="zoom:80%;"><p>升级完成：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103513" style="zoom:80%;"><p>6.3.1.7更改JRE，右键JRE System Library-&gt; Properties</p><p>6.3.1.8选中jdk1.8.0_131-&gt; OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103535" style="zoom:80%;"><p>6.3.1.9点击spark项目-&gt;修改pom.xml-&gt; 保存会自动下载jar包</p><p>6.3.1.10下载Jar包：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103915" style="zoom:80%;"><p>6.3.1.11最终 pom.xml 如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-hive_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-flume_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/main/test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span><span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">executable</span>&gt;</span>java<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeProjectDependencies</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeProjectDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includePluginDependencies</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includePluginDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathScope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">classpathScope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>cn.com.syl.spark.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.3.1.12删除工程生成的App.java和AppTest.java</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_104358" style="zoom:80%;"><h4 id="6-3-2编写代码"><a href="#6-3-2编写代码" class="headerlink" title="6.3.2编写代码"></a>6.3.2编写代码</h4><p>6.3.2.1在src/main/java中创建类，并命名为SecondarySortKey.java，然后按Finish</p><p>6.3.2.1.1创建SecondarySortKey.java，代码见附录</p><p>6.3.2.1.2在src/main/java中创建类，并命名为SecondarySortDemo，然后按Finish</p><p>6.3.2.1.3创建SecondarySortDemo.java代码见附录</p><p>6.3.2.1.4运行SecondarySortDemo，观察控制台输出</p><p>6.3.2.1.5右键SecondarySortDemo.java -&gt; Run As -&gt; Java Application</p><p>最终结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200603110720" style="zoom:67%;"><h2 id="七、附录"><a href="#七、附录" class="headerlink" title="七、附录"></a>七、附录</h2><h3 id="1、SecondarySortKey-java"><a href="#1、SecondarySortKey-java" class="headerlink" title="1、SecondarySortKey.java"></a>1、SecondarySortKey.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> scala.math.Ordered;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">serDemo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5749943279909593929L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> reportTime;        <span class="comment">// 时间戳</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> upwardflow;        <span class="comment">// 上行总流量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> downwardflow;    <span class="comment">// 下行总流量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">(<span class="keyword">long</span> reportTime, <span class="keyword">long</span> upwardflow, <span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getReportTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReportTime</span><span class="params">(<span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUpwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpwardflow</span><span class="params">(<span class="keyword">long</span> upwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDownwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownwardflow</span><span class="params">(<span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialversionuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> upwardflow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> downwardflow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> reportTime;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(<span class="keyword">long</span> upwardflow, <span class="keyword">long</span> downwardflow, <span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUpwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpwardflow</span><span class="params">(<span class="keyword">long</span> upwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDownwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownwardflow</span><span class="params">(<span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getReportTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReportTime</span><span class="params">(<span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialversionuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow &gt; other.upwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow &gt; other.downwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime &gt; other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>($greater(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime == other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow &lt; other.upwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow &lt; other.downwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime &lt; other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>($less(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime == other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow - other.upwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (upwardflow - other.upwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(downwardflow - other.downwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (downwardflow - other.downwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(reportTime - other.reportTime != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (reportTime - other.reportTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow - other.upwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (upwardflow - other.upwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(downwardflow - other.downwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (downwardflow - other.downwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(reportTime - other.reportTime != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (reportTime - other.reportTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (downwardflow );</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (reportTime );</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (upwardflow );</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        SecondarySortKey other = (SecondarySortKey) obj;</span><br><span class="line">        <span class="keyword">if</span> (downwardflow != other.downwardflow)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (reportTime != other.reportTime)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (upwardflow != other.upwardflow)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult： [上行总流量： "</span> + upwardflow + <span class="string">", 下行总流量：  "</span> + downwardflow + <span class="string">", 时间戳："</span></span><br><span class="line">                + reportTime + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、SecondarySortDemo-java"><a href="#2、SecondarySortDemo-java" class="headerlink" title="2、SecondarySortDemo.java"></a>2、SecondarySortDemo.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaSparkContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.Function2;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.PairFunction;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 创建sparkcontext对象，sparkcontext是程序的唯一入口</span></span><br><span class="line">        SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">        JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">        <span class="comment">// 去掉WARN类的输出信息</span></span><br><span class="line">        jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">        <span class="comment">// 调用textFile()方法，读取日志文件，这里指定本地磁盘文件</span></span><br><span class="line">        JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/data.log"</span>);</span><br><span class="line">        <span class="comment">// 调用mapTfRDD2Pair方法 将tf映射为键值对</span></span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">        <span class="comment">// 获取每个手机号的总上行流量、总下行流量、最早报告时间戳</span></span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByDeviceID(pairRdd);</span><br><span class="line">        <span class="comment">// 聚合，封装的RDD作为key,手机号作为值</span></span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">        <span class="comment">// 依次按照上行流量、下行流量以及时间戳倒序排序</span></span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 根据您的需要获得输出，这里仅显示前10行</span></span><br><span class="line">        List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">            System.out.println(<span class="string">"telNum: "</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行结束关闭资源</span></span><br><span class="line">        jsc.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mapTfRDD2Pair方法，封装键值对</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">// 根据数据格式进行切分</span></span><br><span class="line">                String[] split = lines.split(<span class="string">"\t"</span>);</span><br><span class="line">                <span class="comment">// 获取切分的字段</span></span><br><span class="line">                <span class="keyword">long</span> reportTime = Long.valueOf(split[<span class="number">0</span>]);</span><br><span class="line">                String telNum = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">long</span> upwardflow = Long.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">long</span> downwardflow = Long.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                <span class="comment">// 创建cmbInfo对象，有参构造 ，将上行流量、下行流量，报告时间戳封装为自定义的可序列化对象</span></span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(reportTime, upwardflow, downwardflow);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(telNum, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据手机号进行聚合，依次按照上行流量、下行流量以及报告时间戳倒序排序</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByDeviceID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">long</span> reportTime = d1.getReportTime() &lt; d2.getReportTime() ? d1.getReportTime() : d2.getReportTime();</span><br><span class="line">                <span class="keyword">long</span> upwardflow = d1.getUpwardflow() + d2.getUpwardflow();</span><br><span class="line">                <span class="keyword">long</span> downwardflow = d1.getDownwardflow() + d2.getDownwardflow();</span><br><span class="line">                serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">                accessLogInfo.setReportTime(reportTime);</span><br><span class="line">                accessLogInfo.setUpwardflow(upwardflow);</span><br><span class="line">                accessLogInfo.setDownwardflow(downwardflow);</span><br><span class="line">                <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 二次排序，手机号作为值</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">                <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">// 获取元祖里的数据</span></span><br><span class="line">                        String telNum = tuple._1;</span><br><span class="line">                        serDemo accessLogInfo = tuple._2;</span><br><span class="line">                        <span class="comment">// 封装为二次排序key</span></span><br><span class="line">                        SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getUpwardflow(),</span><br><span class="line">                                accessLogInfo.getDownwardflow(), accessLogInfo.getReportTime());</span><br><span class="line">                        <span class="comment">// 返回新的Tuple</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, telNum);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Java进行Spark编程实现日志处理分析。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="Java" scheme="https://666wxy666.github.io/tags/Java/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="日志分析" scheme="https://666wxy666.github.io/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark Streaming 实时计算Kafka数据</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Streaming-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97Kafka%E6%95%B0%E6%8D%AE/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Streaming-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97Kafka%E6%95%B0%E6%8D%AE/</id>
    <published>2020-08-24T01:38:51.111Z</published>
    <updated>2020-07-15T14:49:28.881Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Spark Streaming实现流计算Kafka数据进行单词计数。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：3(一主两从，主机名分别为：master、slave01、slave02)</li><li>系统版本：Centos 7.5</li><li>Zookeeper版本： Apache Zookeeper 3.4.10</li><li>Kafka版本：kafka_2.11-0.10.2.1</li><li>Spark版本：Apache Spark 2.1.1</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>通过创建Kafka topic，使用Kafka Producer产生消息，然后通过编写spark<br>Streaming程序处理这些消息。</li><li>主要步骤：<ul><li>创建Spark Streaming项目工程</li><li>编写streaming程序</li><li>启动Zookeeper，Kafka集群</li><li>创建topic</li><li>启动Kafka生产者</li><li>准备作业环境</li><li>提交作业</li></ul></li></ul><h2 id="三、实验步骤："><a href="#三、实验步骤：" class="headerlink" title="三、实验步骤："></a>三、实验步骤：</h2><h3 id="3-1打开IDEA软件"><a href="#3-1打开IDEA软件" class="headerlink" title="3.1打开IDEA软件"></a>3.1打开IDEA软件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">cd idea-IC-172.4574.19/</span><br><span class="line">bin/idea.sh &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200518184342.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184342.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_160617" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200518184356.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184356.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_160648" style="zoom:80%;"><h3 id="3-2创建项目"><a href="#3-2创建项目" class="headerlink" title="3.2创建项目"></a>3.2创建项目</h3><p>3.2.1创建同之前章节结构一致的项目spark_test, 设置语言级别为8。</p><p>3.2.2点击 Create New Project，进入如下图界面，按照图标依次点击，最后点击next。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185224" style="zoom:80%;"><p>3.2.3依次输入GroupId和ArtifactId和Version的值，随后点击next。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185405" style="zoom:80%;"><p>3.2.4进入如下界面，设置本地Maven项目的setting.xml文件和warehouse仓库，点击next按钮。</p><p>3.2.4.1本地setting.xml文件在/home/zkpk/apache-maven-3.5.0/conf目录下。</p><p>3.2.4.2本地仓库文件夹warehouse在/home/zkpk/apache-maven-3.5.0/warehouse。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185452" style="zoom:80%;"><p>3.2.5进入如下界面，输入工程名称spark_test，然后点击next，OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185533" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185546" style="zoom:80%;"><p>3.2.6工程创建完成后会自动打开一个名为zkpk的xml文件，按照以下修改：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk.lab<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkpk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">inceptionYear</span>&gt;</span>2008<span class="tag">&lt;/<span class="name">inceptionYear</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scala.version</span>&gt;</span>2.11.11<span class="tag">&lt;/<span class="name">scala.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spark.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">spark.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hadoop.version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">hadoop.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kafka.version</span>&gt;</span>0.10.2.1<span class="tag">&lt;/<span class="name">kafka.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka-0-10_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;kafka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/scala<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>testCompile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>-target:jvm-1.5<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-eclipse-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">downloadSources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">downloadSources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">buildcommand</span>&gt;</span>ch.epfl.lamp.sdt.core.scalabuilder<span class="tag">&lt;/<span class="name">buildcommand</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">projectnature</span>&gt;</span>ch.epfl.lamp.sdt.core.scalanature<span class="tag">&lt;/<span class="name">projectnature</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>org.eclipse.jdt.launching.JRE_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>ch.epfl.lamp.sdt.launching.SCALA_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.2.7保存修改的pom.xml文件后，点击工程名，依次选择Maven——&gt;Reimport，即可根据pom.xml文件导入依赖包。</p><p>3.2.8设置语言环境language level，点击菜单栏中的file，选择Project Structure，弹出如下对话框，选择Modules，选择Language level为8，然后点击Apply，点击OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190537" style="zoom:80%;"><p>3.2.9设置Java Compiler环境，点击菜单栏中的file，选择Setting，弹出如下对话框，依次选择Build，Execution——&gt;Compiler——&gt;Java Compiler，设置图中的Project bytecode version为1.8，设置图中的Target bytecode version为1.8，然后依次点击Apply和OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190657" style="zoom:80%;"><p>至此，Spark Maven工程创建完毕。</p><p>3.2.10在项目sclaa文件下的org.zkpk.lab下新建“kafka_streaming”Object。</p><p>创建完成后的工程结构：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184547.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184547.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_163207" style="zoom:80%;"><h3 id="3-3编写scala代码"><a href="#3-3编写scala代码" class="headerlink" title="3.3编写scala代码"></a>3.3编写scala代码</h3><p>下面是部分代码截图，具体代码在本文的附录中。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184610.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184610.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170115" style="zoom:80%;"><h3 id="3-4使用maven打包程序"><a href="#3-4使用maven打包程序" class="headerlink" title="3.4使用maven打包程序"></a>3.4使用maven打包程序</h3><p>开始打包。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170203" style="zoom:80%;"><p>打包完成。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184800.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184800.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170204" style="zoom:80%;"><h3 id="3-5启动Zookeeper集群"><a href="#3-5启动Zookeeper集群" class="headerlink" title="3.5启动Zookeeper集群"></a>3.5启动Zookeeper集群</h3><p>3.5.1分别登录master和slave01、slave02节点，进入zookeeper安装目录，启动服务。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184917.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184917.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170527" style="zoom:80%;"><p>3.5.2在三个节点上分别运行<code>bin/zkServer.sh status</code>命令查看状态，出现follower或leader表示ZK启动成功。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518185007.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518185007.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170817" style="zoom:80%;"><h3 id="3-6启动Kafka集群"><a href="#3-6启动Kafka集群" class="headerlink" title="3.6启动Kafka集群"></a>3.6启动Kafka集群</h3><p>在 master 和 slave01、slave02节点分别启动 Kafka。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518185051.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518185051.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171119" style="zoom:80%;"><h3 id="3-7创建Kafka-topic"><a href="#3-7创建Kafka-topic" class="headerlink" title="3.7创建Kafka topic"></a>3.7创建Kafka topic</h3><p>名称需要和代码中保持一致。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191546.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191546.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171340" style="zoom:80%;"><h3 id="3-8在一个终端上启动一个生产者-准备生产"><a href="#3-8在一个终端上启动一个生产者-准备生产" class="headerlink" title="3.8在一个终端上启动一个生产者,准备生产"></a>3.8在一个终端上启动一个生产者,准备生产</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200518191639.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191639.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171502" style="zoom:80%;"><h3 id="3-9使用spark-submit提交spark-应用"><a href="#3-9使用spark-submit提交spark-应用" class="headerlink" title="3.9使用spark-submit提交spark 应用"></a>3.9使用spark-submit提交spark 应用</h3><p>3.9.1将生成的jar包文件复制到/home/zkpk下。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191855.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191855.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171718" style="zoom:80%;"><p>3.9.2提交sparkjob之前需要将spark-streaming-kafka-0-10_2.11-2.1.0，kafka-clients-0.10.2.这两个jar添加到spark_home/jars/路径下，否则程序提交会报错。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191929.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191929.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_172111" style="zoom:80%;"><p>3.9.3新开一个终端，在/home/zkpk目录下提交程序。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --class org.zkpk.lab.kafka_streaming zkpk-1.0.jar</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200518191955.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191955.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174524" style="zoom:80%;"><h3 id="3-10输入内容，查看结果"><a href="#3-10输入内容，查看结果" class="headerlink" title="3.10输入内容，查看结果"></a>3.10输入内容，查看结果</h3><p>切换到之前的Kafka生产者终端中输入如下内容，然后切换到sparkStreaming任务界面查看结果。</p><ul><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192227.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192227.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174619" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192249.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192249.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174609" style="zoom:80%;"></li><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192408.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192408.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174732" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192418.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192418.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174721" style="zoom:80%;"></li><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174825" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192450.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192450.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174817" style="zoom:80%;"></li></ul><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="kafka-streaming-scala"><a href="#kafka-streaming-scala" class="headerlink" title="kafka_streaming.scala"></a>kafka_streaming.scala</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.lab</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.<span class="type">StringDeserializer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.<span class="type">LocationStrategies</span>.<span class="type">PreferConsistent</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.<span class="type">ConsumerStrategies</span>.<span class="type">Subscribe</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">kafka_streaming</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">"local[2]"</span>).setAppName(<span class="string">"kafka_test"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(conf, <span class="type">Seconds</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> kafkaParams = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Object</span>](</span><br><span class="line">      <span class="string">"bootstrap.servers"</span> -&gt; <span class="string">"master:9092"</span>,</span><br><span class="line">      <span class="string">"key.deserializer"</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">"value.deserializer"</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">"group.id"</span> -&gt; <span class="string">"example"</span>,</span><br><span class="line">      <span class="string">"auto.offset.reset"</span> -&gt; <span class="string">"latest"</span>,</span><br><span class="line">      <span class="string">"enable.auto.commit"</span> -&gt; (<span class="literal">false</span>: java.lang.<span class="type">Boolean</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> topics = <span class="type">List</span>(<span class="string">"test_kafka"</span>).toSet</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream = <span class="type">KafkaUtils</span>.createDirectStream</span><br><span class="line">      [<span class="type">String</span>,<span class="type">String</span>](</span><br><span class="line">        ssc,</span><br><span class="line">        <span class="type">PreferConsistent</span>,</span><br><span class="line">        <span class="type">Subscribe</span>[<span class="type">String</span>,<span class="type">String</span>](topics,kafkaParams)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> lines = stream.map(_.value)</span><br><span class="line">    <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>))</span><br><span class="line">    <span class="keyword">val</span> wordcounts = words.map((_,<span class="number">1</span>)).reduceByKey(_+_)</span><br><span class="line">    wordcounts.print()</span><br><span class="line"></span><br><span class="line">    ssc.start()</span><br><span class="line">    ssc.awaitTermination()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Spark Streaming实现流计算Kafka数据进行单词计数。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="单词计数" scheme="https://666wxy666.github.io/tags/%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    
      <category term="Scala" scheme="https://666wxy666.github.io/tags/Scala/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="Kafka" scheme="https://666wxy666.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark Java单词计数</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Java%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Java%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/</id>
    <published>2020-08-24T01:38:51.091Z</published>
    <updated>2020-07-15T14:49:28.881Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Spark实现Java单词计数。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Spark版本：Apache Spark 2.1.1</li><li>JDK版本： jdk-8u131-linux-x64</li><li>IDEA版本：ideaIC-2017.2.7</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>创建spark项目</li><li>使用Java API 编写wordcount</li><li>打印结果</li></ul><h2 id="三、实验步骤："><a href="#三、实验步骤：" class="headerlink" title="三、实验步骤："></a>三、实验步骤：</h2><h3 id="3-1新建数据源"><a href="#3-1新建数据源" class="headerlink" title="3.1新建数据源"></a>3.1新建数据源</h3><p>3.1.1在/home/zkpk目录下创建worddata.txt文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">vim worddata.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200423203009.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423203009.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_184840" style="zoom:80%;"><p>3.1.2输入以下内容作为JavaWordCount程序的源数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hello hi hi spark</span><br><span class="line">hello spark hello hi sparksql</span><br><span class="line">hello hi hi sparkstreaming</span><br><span class="line">hello hi sparkgraphx</span><br><span class="line">hello hello world</span><br><span class="line">hello java c python</span><br><span class="line">hello scala go html</span><br><span class="line">hi hi hello spark hdfs</span><br><span class="line">hello hadoop</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200423211155.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211155.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_184956" style="zoom:80%;"><p>3.1.3打开IDEA，创建Java任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">cd idea-IC-172.4574.19/</span><br><span class="line">bin/idea.sh &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200423211241.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211241.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185042" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200423211258.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211258.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185058" style="zoom:80%;"><h3 id="3-2创建Spark-Maven工程，使用Java-API-编写wordcount"><a href="#3-2创建Spark-Maven工程，使用Java-API-编写wordcount" class="headerlink" title="3.2创建Spark Maven工程，使用Java API 编写wordcount"></a>3.2创建Spark Maven工程，使用Java API 编写wordcount</h3><p>3.2.1点击 Create New Project</p><p>3.2.2进入如下图界面，按照图标依次点击，最后点击next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185224" style="zoom:80%;"><p>3.2.3依次输入GroupId和ArtifactId和Version的值，随后点击next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185405" style="zoom:80%;"><p>3.2.4进入如下界面，设置本地Maven项目的setting.xml文件和warehouse仓库，点击next按钮</p><p>3.2.4.1本地setting.xml文件在/home/zkpk/apache-maven-3.5.0/conf目录下</p><p>3.2.4.2本地仓库文件夹warehouse在/home/zkpk/apache-maven-3.5.0/warehouse</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185452" style="zoom:80%;"><p>3.2.5进入如下界面，输入工程名称spark_test，然后点击next，OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185533" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185546" style="zoom:80%;"><p>3.2.6工程创建完成后会自动打开一个名为zkpk的xml文件，按照以下修改：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk.lab<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkpk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">inceptionYear</span>&gt;</span>2008<span class="tag">&lt;/<span class="name">inceptionYear</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scala.version</span>&gt;</span>2.11.11<span class="tag">&lt;/<span class="name">scala.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spark.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">spark.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/scala<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/test/scala<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>testCompile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>-target:jvm-1.5<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-eclipse-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">downloadSources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">downloadSources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">buildcommand</span>&gt;</span>ch.epfl.lamp.sdt.core.scalabuilder<span class="tag">&lt;/<span class="name">buildcommand</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">projectnature</span>&gt;</span>ch.epfl.lamp.sdt.core.scalanature<span class="tag">&lt;/<span class="name">projectnature</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>org.eclipse.jdt.launching.JRE_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>ch.epfl.lamp.sdt.launching.SCALA_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.2.7保存修改的pom.xml文件后，点击工程名，依次选择Maven——&gt;Reimport，即可根据pom.xml文件导入依赖包，出现下图就代表正在导入依赖包</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212207.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212207.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190350"></p><p>3.2.8设置语言环境language level，点击菜单栏中的file，选择Project Structure，弹出如下对话框，选择Modules，选择Language level为8，然后点击Apply，点击OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190537" style="zoom:80%;"><p>3.2.9设置Java Compiler环境，点击菜单栏中的file，选择Setting，弹出如下对话框，依次选择Build，Execution——&gt;Compiler——&gt;Java Compiler，设置图中的Project bytecode version为1.8，设置图中的Target bytecode version为1.8，然后依次点击Apply和OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190657" style="zoom:80%;"><p>至此，Spark Maven工程创建完毕</p><p>3.2.10在main文件夹下新建文件夹，在弹出的对话框中，输入新文件夹名称为java，点击ok</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212556.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212556.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190754" style="zoom:80%;"><p>3.2.11右击先创建的java目录，依次选择Mark Directory as—&gt;Sources Root，此时就可以在java目录中创建类了，我们右键点击java目录，依次选择New——&gt;Java——&gt;Class，弹出对话框，输入Java Class的名字：JavaWordCount，然后点击ok</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212726.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212726.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190850" style="zoom:80%;"><p>3.2.12编写如下Java代码，实现词频统计，我在原有的参考答案上又新增了可以根据次品的大小，从大到小排序展示的功能，下面是代码截图，具体代码在本文的附录中</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423213015.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423213015.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_192501" style="zoom:80%;"><h3 id="3-3运行程序，查看结果"><a href="#3-3运行程序，查看结果" class="headerlink" title="3.3运行程序，查看结果"></a>3.3运行程序，查看结果</h3><p>选中程序JavaWordCount，在代码界面点击鼠标右键，出现如下提示框，选择并点击Run JavaWordCount.main()，运行程序，并在终端界面查看程序输出结果</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423213208.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423213208.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_192611" style="zoom:80%;"><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="1、JavaWordCount-java"><a href="#1、JavaWordCount-java" class="headerlink" title="1、JavaWordCount.java"></a>1、JavaWordCount.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaWordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern SPACE = Pattern.compile(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        SparkSession ss = SparkSession</span><br><span class="line">                .builder()</span><br><span class="line">                .master(<span class="string">"local"</span>)</span><br><span class="line">                .appName(<span class="string">"JavaWordCount"</span>)</span><br><span class="line">                .getOrCreate();</span><br><span class="line"></span><br><span class="line">        JavaRDD&lt;String&gt; lines =</span><br><span class="line">                ss.read().textFile(<span class="string">"file:///home/zkpk/worddata.txt"</span>).javaRDD();</span><br><span class="line"></span><br><span class="line">        JavaRDD&lt;String&gt; words =</span><br><span class="line">                lines.flatMap(s -&gt; Arrays.asList(SPACE.split(s)).iterator());</span><br><span class="line"></span><br><span class="line">        JavaPairRDD&lt;String, Integer&gt; wordAndOne =</span><br><span class="line">                words.mapToPair(s -&gt; <span class="keyword">new</span> Tuple2&lt;&gt;(s, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        JavaPairRDD&lt;String, Integer&gt; wordAndNum =</span><br><span class="line">                wordAndOne.reduceByKey((i1, i2) -&gt; i1 + i2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//自己额外实现了可以根据词频的大小，从大到小排序展示的功能</span></span><br><span class="line">        List&lt;Tuple2&lt;String, Integer&gt;&gt; result = wordAndNum</span><br><span class="line">                <span class="comment">//先将key和value交换</span></span><br><span class="line">                .mapToPair((row) -&gt;  <span class="keyword">new</span> Tuple2&lt;&gt;(row._2,row._1))</span><br><span class="line">                <span class="comment">//按照交换后的key也就是词频倒排序</span></span><br><span class="line">                .sortByKey(<span class="keyword">false</span>)</span><br><span class="line">                <span class="comment">//再将key和value交换回来，回到单词在前，词频在后的状态</span></span><br><span class="line">                .mapToPair((row) -&gt;  <span class="keyword">new</span> Tuple2&lt;&gt;(row._2,row._1))</span><br><span class="line">                .collect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;?,?&gt; tuple : result)&#123;</span><br><span class="line">            System.out.println(tuple._1() + <span class="string">": "</span> + tuple._2());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ss.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、ScalaWordCount-scala"><a href="#2、ScalaWordCount-scala" class="headerlink" title="2、ScalaWordCount.scala"></a>2、ScalaWordCount.scala</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.lab</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalaWordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ScalaWordCount</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="string">"hello hi hi spark "</span>,</span><br><span class="line">      <span class="string">"hello spark hello hi sparksql "</span>,</span><br><span class="line">      <span class="string">"hello hi hi sparkstreaming "</span>,</span><br><span class="line">      <span class="string">"hello hi sparkgraphx"</span>)</span><br><span class="line">    <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"word-count"</span>).setMaster(<span class="string">"local[*]"</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(sparkConf)</span><br><span class="line">    <span class="keyword">val</span> lines: <span class="type">RDD</span>[<span class="type">String</span>] = sc.parallelize(list)</span><br><span class="line">    <span class="keyword">val</span> words: <span class="type">RDD</span>[<span class="type">String</span>] =</span><br><span class="line">        lines.flatMap((line: <span class="type">String</span>) =&gt; &#123;line.split(<span class="string">" "</span>)&#125;)</span><br><span class="line">    <span class="keyword">val</span> wordAndOne: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">Int</span>)] =</span><br><span class="line">        words.map((word: <span class="type">String</span>) =&gt; &#123;(word, <span class="number">1</span>)&#125;)</span><br><span class="line">    <span class="keyword">val</span> wordAndNum: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">Int</span>)] =</span><br><span class="line">      wordAndOne.reduceByKey((count1: <span class="type">Int</span>, count2: <span class="type">Int</span>) =&gt; &#123;count1+ count2&#125;)</span><br><span class="line">    <span class="keyword">val</span> ret = wordAndNum.sortBy(kv =&gt; kv._2, <span class="literal">false</span>)</span><br><span class="line">    println(ret.collect().mkString(<span class="string">","</span>))</span><br><span class="line">    ret.saveAsTextFile(args(<span class="number">0</span>))</span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Spark实现Java单词计数。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="单词计数" scheme="https://666wxy666.github.io/tags/%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    
      <category term="Java" scheme="https://666wxy666.github.io/tags/Java/"/>
    
      <category term="Scala" scheme="https://666wxy666.github.io/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Python可视化 Matplotlib可视化</title>
    <link href="https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Python%E5%8F%AF%E8%A7%86%E5%8C%96-Matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <id>https://666wxy666.github.io/2020/08/24/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Python%E5%8F%AF%E8%A7%86%E5%8C%96-Matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96/</id>
    <published>2020-08-24T01:38:51.077Z</published>
    <updated>2020-07-15T14:49:28.880Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Python的Matplotlib实现数据可视化。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Anaconda版本：4.4.0</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>通过创建Kafka topic，使用Kafka Producer产生消息，然后通过编写spark<br>Streaming程序处理这些消息。</li><li>主要步骤：<ul><li>Matplotlib的介绍</li><li>基本绘图函数</li><li>图表的修饰项介绍</li><li>子图绘制</li><li>图像的保存</li></ul></li></ul><h2 id="三、实验步骤："><a href="#三、实验步骤：" class="headerlink" title="三、实验步骤："></a>三、实验步骤：</h2><h3 id="3-1Matplotlib的介绍："><a href="#3-1Matplotlib的介绍：" class="headerlink" title="3.1Matplotlib的介绍："></a>3.1Matplotlib的介绍：</h3><p>在Python中，主要运用matplotlib库进行数据可视化。matplotlib是Python最著名的绘图库，它提供了一整套和matlab相似的命令API，十分适合交互式地进行制图。而且也可以方便地将它作为绘图控件，嵌入GUI应用程序中。</p><h3 id="3-2基本绘图函数："><a href="#3-2基本绘图函数：" class="headerlink" title="3.2基本绘图函数："></a>3.2基本绘图函数：</h3><p>matplotlib的pyplot子库提供了和matlab类似的绘图API，方便用户快速绘制2D图表。pyplot模块中常见的用来绘制图形的主要有以下几种函数：</p><p>3.2.1<strong>plot</strong>:常用于绘制线型图，该方法具有可变长参数，参数color指定颜色，参数linestyle设置线的样式、参数marker设置标记类型，结果返回一个lines.Line2D对象的列表，lines.Line2D对象的属性可通过plot的关键字参数设置。</p><p>3.2.2<strong>scatter</strong>: 用于绘制散点图；</p><p>3.2.3<strong>hist</strong>:用于绘制直方图，其参数中较为重要的是bins，该参数指定bin(箱子)的个数，即柱状图中柱子的总数，该值默认为10；</p><p>3.2.4<strong>show</strong>: 显示图像。</p><h3 id="3-3图表的修饰项介绍："><a href="#3-3图表的修饰项介绍：" class="headerlink" title="3.3图表的修饰项介绍："></a>3.3图表的修饰项介绍：</h3><p>对于大多数的图表装饰项，其主要实现方式主要有使用过程型的pyplot接口和面向对象的原生matplotlib API两种，分别对应的是函数编程和对象编程两种思想。</p><p>3.3.1<strong>title</strong>：设置或者获取图表标题；</p><p>3.3.2<strong>xlim</strong>：设置或者获取X轴范围；</p><p>3.3.3<strong>xlabel</strong>：设置或者获取X轴标签；</p><p>3.3.4**xticks(&lt;刻度&gt;,&lt;标签&gt;)**：设置或者获取X轴刻度和刻度标签；</p><p>3.3.5**text(x,y,z)**：将文本z绘制在图表的指定坐标(x,y)</p><p>3.3.6<strong>legend</strong>：自动创建图例，可以通过设置loc参数指定图例的位置。需要事先在添加图像时设置label参数。</p><p>3.3.7**twinx(ax)**：返回一个与子图对象ax的x轴一致y轴在右侧的子图对象ax2，用于绘制双轴图表。使用实例方法的形式为<code>ax2=ax.twinx()</code>。</p><p>3.3.8除了上面特别说明的，其它方法各自对应子图对象的的两个实例方法，以xlim为例，就是Axes.get_xlim和Axes.set_xlim。</p><h3 id="3-4子图绘制："><a href="#3-4子图绘制：" class="headerlink" title="3.4子图绘制："></a>3.4子图绘制：</h3><p>简单类型的Artists为标准的绘图元件，例如Line2D、Rectangle、Text、AxesImage等等。而<strong>容器类型</strong>则可以包含许多简单类型的Artists，使它们组织成一个整体，例如Axis、Axes、Figure等。</p><p>3.4.1<strong>figure</strong>：用来创建一个绘图对象，通常也可以不创建绘图对象而调用plot之类的函数直接绘图，matplotlib会自动创建一个绘图对象。通过figsize参数可以指定绘图对象的宽度和高度。如果需要同时绘制多幅图表的话，可以是给figure传递一个整数参数指定图表的序号，如果所指定序号的绘图对象已经存在的话，将不创建新的对象，而只是让它成为当前绘图对象；</p><p>3.4.2<strong>subplot</strong>：创建一个新的Figure，并返回一个含有已创建的subplot对象的NumPy数组。该方法的调用形式为：subplot(numRows,numCols, plotNum)，将整个绘图区域等分为numRows行、numCols列个<strong>子区域</strong>，然后按照从左到右，从上到下的顺序对每个子区域进行编号，左上的子区域的编号为1。如果numRows，numCols和plotNum的值都小于10，可以把它们缩写为一个整数，例如 subplot(321)和subplot(3,2,1)是相同的；对于绘图对象有add_subplot方法用于添加subplot对象；</p><p>3.4.3<strong>subplots</strong>：创建一个包含多个子图的Figure，返回Figure和一个或多个ax（子图）对象，可以通过设置sharex/sharey参数指定共享x轴/y轴；</p><p>3.4.4<strong>axes</strong>：同样往图表添加子图，不同之处在于子图可以设定在绘图区域的任意位置，axes的参数是一个形如[left,bottom, width,height]的列表，这些数值分别指定所创建的Axes对象相对于绘图对象的位置和大小，取值范围都在0到1之间。对于绘图对象有add_axes方法用于添加subplot对象。</p><h3 id="3-5图像的保存："><a href="#3-5图像的保存：" class="headerlink" title="3.5图像的保存："></a>3.5图像的保存：</h3><p>利用<code>plt.savefig</code>可以将当前图表保存到文件，该方法相当于Figure对象的实例方法savefig。具体参数如下：</p><p>3.5.1 fname：含有文件路径的字符串或Python的文件型对象；</p><p>3.5.2 dpi：图像分辨率（每英寸点数），默认为100；</p><p>3.5.3 facecolor，edgecolor，图像的背景色，默认为”w”，即白色；</p><p>3.5.4 format：显式设置文件格式（”png”、”pdf”、”svg”等）；</p><p>3.5.5 bbox_inches：图表需要保存的部分。</p><h3 id="3-6Matplotlib-绘图示例"><a href="#3-6Matplotlib-绘图示例" class="headerlink" title="3.6Matplotlib 绘图示例"></a>3.6Matplotlib 绘图示例</h3><p>3.6.1执行如下命令打开编程环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">ipython</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123119.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123119.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_110843" style="zoom:80%;"><p>3.6.2绘制世界人口与年份的关系图：</p><p>3.6.2.1导入实验所需的库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.dates <span class="keyword">as</span> mdates</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123234.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123234.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_111044" style="zoom:80%;"><p>3.6.2.2year 和pop为年份和对应的全世界人口数辆（单位10亿）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yearInt = [<span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2007</span>, <span class="number">2008</span>, <span class="number">2009</span>, <span class="number">2010</span>, <span class="number">2011</span>, <span class="number">2012</span>, <span class="number">2013</span>, <span class="number">2014</span>, <span class="number">2015</span>, <span class="number">2016</span>, <span class="number">2017</span>, <span class="number">2018</span>, <span class="number">2019</span>, <span class="number">2020</span>]</span><br><span class="line">year = [str(item) <span class="keyword">for</span> item <span class="keyword">in</span> yearInt]  <span class="comment"># 将yearInt中的数字转换成str</span></span><br><span class="line">pop = [<span class="number">6.49</span>, <span class="number">6.558</span>, <span class="number">6.656</span>, <span class="number">6.725</span>, <span class="number">6.804</span>, <span class="number">6.884</span>, <span class="number">6.965</span>, <span class="number">7.043</span>, <span class="number">7.125</span>, <span class="number">7.207</span>, <span class="number">7.356</span>, <span class="number">7.380</span>, <span class="number">7.405</span>, <span class="number">7.440</span>, <span class="number">7.468</span>, <span class="number">8.020</span>]</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123248.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123248.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_114653" style="zoom:80%;"><p>3.6.2.3绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xs = [datetime.strptime(d, <span class="string">'%Y'</span>).date() <span class="keyword">for</span> d <span class="keyword">in</span> year]  <span class="comment"># 将year中的每个如'2005'的字符串转换成只包含年的日期</span></span><br><span class="line">plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="string">'%Y'</span>))  <span class="comment"># gca()获得坐标轴；</span></span><br><span class="line">plt.gca().xaxis.set_major_locator(mdates.YearLocator())  <span class="comment"># 年份</span></span><br><span class="line">plt.plot(xs, pop)  <span class="comment"># 绘制图表</span></span><br><span class="line">plt.gcf().autofmt_xdate()  <span class="comment"># 将x轴的日期自动旋转角度</span></span><br><span class="line">plt.show()  <span class="comment"># 显示图表</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123256.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123256.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115550" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123321.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123321.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115609" style="zoom:80%;"><h3 id="3-7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项"><a href="#3-7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项" class="headerlink" title="3.7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项"></a>3.7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项</h3><p>3.7.1添加中国人口数量关系</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.figure()</span><br><span class="line">pop_cn = [<span class="number">1.30756</span>, <span class="number">1.31448</span>, <span class="number">1.32129</span>, <span class="number">1.32802</span>, <span class="number">1.33450</span>, <span class="number">1.34091</span>, <span class="number">1.34735</span>, <span class="number">1.35404</span>, <span class="number">1.36072</span>, <span class="number">1.36782</span>, <span class="number">1.36790</span>, <span class="number">1.36801</span>,</span><br><span class="line">          <span class="number">1.36813</span>, <span class="number">1.36832</span>, <span class="number">1.36845</span>, <span class="number">1.36860</span>]</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123409.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123409.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115923" style="zoom:80%;"><p>3.7.2绘制人口数量和年份关系；year与pop仍然用之前的数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">plt.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123441.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120014" style="zoom:80%;"><p>3.7.3添加修饰项</p><p>3.7.3.1添加x，y轴标签</p><p>3.7.3.2添加注解。注解点为(2008, 6.725)，内容为年(2013)</p><p>3.7.3.3添加图例，loc=1,表示图例出现在恰当的位置</p><p>3.7.3.4添加title</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel(<span class="string">'year'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Population'</span>)</span><br><span class="line">plt.text(<span class="string">'2008'</span>, <span class="number">6.725</span>, <span class="string">'2013'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"World Population Summary"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123531.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123531.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120228" style="zoom:80%;"><p>3.7.4显示图片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123539.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123539.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120321" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123546.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123546.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120300" style="zoom:80%;"><h3 id="3-8子图的绘制："><a href="#3-8子图的绘制：" class="headerlink" title="3.8子图的绘制："></a>3.8子图的绘制：</h3><p>利用plt.subplots函数创建包含多个子图的绘图对象，还可以设置子图个数。</p><p>3.8.1绘制x轴共享子图，</p><p>3.8.1.1子图个数设置为2，并且共享x轴</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f, (ax1, ax2) = plt.subplots(<span class="number">2</span>, sharex=<span class="literal">True</span>)  <span class="comment"># f是Figure对象；ax1,ax2分别是Axes</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123723.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123723.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120441" style="zoom:80%;"><p>3.8.1.2使用散点图绘制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax1.scatter(year, pop)  <span class="comment"># 绘制散点图</span></span><br><span class="line">ax2.scatter(year, pop_cn)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123731.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123731.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120452" style="zoom:80%;"><p>3.8.1.3添加修饰项：标题，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax1.set_title(<span class="string">'World Population Summary'</span>)  <span class="comment"># 设置标题</span></span><br><span class="line">ax2.set_title(<span class="string">"China Population Summary"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123737.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123737.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120501" style="zoom:80%;"><p>3.8.1.4显示图像</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123745.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123745.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120725" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123752.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123752.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120708" style="zoom:80%;"><p>3.8.2绘制双y轴子图，共享x轴。</p><p>3.8.2.1创建绘图对象fig</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123926.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123926.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120843" style="zoom:80%;"><p>3.8.2.2使用fig.add_subplot函数为绘图对象fig添加两个子图，ax4通过使用ax3的twinx方法创建，且与ax3共享x中，放置在y轴右侧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)  <span class="comment"># 参数是1个3位的整数或3个分隔的整数，描述子图的位置，分别是nrows,ncols,index</span></span><br><span class="line">ax4 = ax3.twinx()  <span class="comment"># 创建一个x轴，并创建一个与原y轴处于相对位置的新y轴</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123932.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123932.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120854" style="zoom:80%;"><p>3.8.2.3绘制子图ax3， ax4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123937.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123937.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120905" style="zoom:80%;"><p>3.8.2.4添加修饰项：添加x,y轴标签、 标题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123942.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123942.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121021" style="zoom:80%;"><p>3.8.2.5显示图像</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123949.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123949.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121101" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123955.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123955.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121049" style="zoom:80%;"><h3 id="3-9图像的保存："><a href="#3-9图像的保存：" class="headerlink" title="3.9图像的保存："></a>3.9图像的保存：</h3><p>3.9.1代码使用双y轴的代码，代码末尾show（）方法改成保存方法即可</p><p>3.9.2使用plt.savfig()函数保存图像</p><p>3.9.2.1制定保存的名称，格式，像素，以及是否修渐空白区域。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4 = ax3.twinx()</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.savefig(<span class="string">'figure.pdf'</span>, dpi=<span class="number">400</span>, bbox_inches=<span class="string">'tight'</span>)  <span class="comment"># 去除空白区域</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602124041.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124041.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121228" style="zoom: 80%;"><p>3.9.2.2点击关闭弹出的效果图</p><p>3.9.2.3查看保存的文件：打开火狐浏览器，地址栏键入如下内容（生成图片的绝对路径）</p><img src="https://gitee.com/wxy_666/images/raw/master/20200602124053.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124053.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121449" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602124102.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124102.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121529" style="zoom:80%;"><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="所有的代码汇总plt-py"><a href="#所有的代码汇总plt-py" class="headerlink" title="所有的代码汇总plt.py"></a>所有的代码汇总plt.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: plt_5</span></span><br><span class="line"><span class="string">@Description: </span></span><br><span class="line"><span class="string">@Version: </span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-06-02 11:46</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-02 11:46</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.dates <span class="keyword">as</span> mdates</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">yearInt = [<span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2007</span>, <span class="number">2008</span>, <span class="number">2009</span>, <span class="number">2010</span>, <span class="number">2011</span>, <span class="number">2012</span>, <span class="number">2013</span>, <span class="number">2014</span>, <span class="number">2015</span>, <span class="number">2016</span>, <span class="number">2017</span>, <span class="number">2018</span>, <span class="number">2019</span>, <span class="number">2020</span>]</span><br><span class="line">year = [str(item) <span class="keyword">for</span> item <span class="keyword">in</span> yearInt]  <span class="comment"># 将yearInt中的数字转换成str</span></span><br><span class="line">pop = [<span class="number">6.49</span>, <span class="number">6.558</span>, <span class="number">6.656</span>, <span class="number">6.725</span>, <span class="number">6.804</span>, <span class="number">6.884</span>, <span class="number">6.965</span>, <span class="number">7.043</span>, <span class="number">7.125</span>, <span class="number">7.207</span>, <span class="number">7.356</span>, <span class="number">7.380</span>, <span class="number">7.405</span>, <span class="number">7.440</span>, <span class="number">7.468</span>, <span class="number">8.020</span>]</span><br><span class="line">xs = [datetime.strptime(d, <span class="string">'%Y'</span>).date() <span class="keyword">for</span> d <span class="keyword">in</span> year]  <span class="comment"># 将year中的每个如'2005'的字符串转换成只包含年的日期</span></span><br><span class="line">plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="string">'%Y'</span>))  <span class="comment"># gca()获得坐标轴；</span></span><br><span class="line">plt.gca().xaxis.set_major_locator(mdates.YearLocator())  <span class="comment"># 年份</span></span><br><span class="line">plt.plot(xs, pop)  <span class="comment"># 绘制图表</span></span><br><span class="line">plt.gcf().autofmt_xdate()  <span class="comment"># 将x轴的日期自动旋转角度</span></span><br><span class="line">plt.show()  <span class="comment"># 显示图表</span></span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line">pop_cn = [<span class="number">1.30756</span>, <span class="number">1.31448</span>, <span class="number">1.32129</span>, <span class="number">1.32802</span>, <span class="number">1.33450</span>, <span class="number">1.34091</span>, <span class="number">1.34735</span>, <span class="number">1.35404</span>, <span class="number">1.36072</span>, <span class="number">1.36782</span>, <span class="number">1.36790</span>, <span class="number">1.36801</span>,</span><br><span class="line">          <span class="number">1.36813</span>, <span class="number">1.36832</span>, <span class="number">1.36845</span>, <span class="number">1.36860</span>]</span><br><span class="line">plt.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">plt.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">plt.xlabel(<span class="string">'year'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Population'</span>)</span><br><span class="line">plt.text(<span class="string">'2008'</span>, <span class="number">6.725</span>, <span class="string">'2013'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"World Population Summary"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">f, (ax1, ax2) = plt.subplots(<span class="number">2</span>, sharex=<span class="literal">True</span>)  <span class="comment"># f是Figure对象；ax1,ax2分别是Axes</span></span><br><span class="line">ax1.scatter(year, pop)  <span class="comment"># 绘制散点图</span></span><br><span class="line">ax2.scatter(year, pop_cn)</span><br><span class="line">ax1.set_title(<span class="string">'World Population Summary'</span>)  <span class="comment"># 设置标题</span></span><br><span class="line">ax2.set_title(<span class="string">"China Population Summary"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)  <span class="comment"># 参数是1个3位的整数或3个分隔的整数，描述子图的位置，分别是nrows,ncols,index</span></span><br><span class="line">ax4 = ax3.twinx()  <span class="comment"># 创建一个x轴，并创建一个与原y轴处于相对位置的新y轴</span></span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4 = ax3.twinx()</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.savefig(<span class="string">'figure.pdf'</span>, dpi=<span class="number">400</span>, bbox_inches=<span class="string">'tight'</span>)  <span class="comment"># 去除空白区域</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Python的Matplotlib实现数据可视化。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="可视化" scheme="https://666wxy666.github.io/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
      <category term="iPython" scheme="https://666wxy666.github.io/tags/iPython/"/>
    
      <category term="Matplotlib" scheme="https://666wxy666.github.io/tags/Matplotlib/"/>
    
  </entry>
  
</feed>
