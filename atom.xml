<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>苇名一心的博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://666wxy666.github.io/"/>
  <updated>2020-09-02T01:54:09.069Z</updated>
  <id>https://666wxy666.github.io/</id>
  
  <author>
    <name>苇名一心</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>编译原理 语法分析 LL1</title>
    <link href="https://666wxy666.github.io/2020/09/02/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90-LL1/"/>
    <id>https://666wxy666.github.io/2020/09/02/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90-LL1/</id>
    <published>2020-09-01T16:00:00.000Z</published>
    <updated>2020-09-02T01:54:09.069Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是编译原理C语言LL1语法分析器的简单实现项目。</strong></p><a id="more"></a><h2 id="一、需求"><a href="#一、需求" class="headerlink" title="一、需求"></a>一、需求</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200831111408.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831111408.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="需求" style="zoom:80%;"><p><strong>拓展需求：</strong>还能自动够造LL1文法的first集和follow集，为LL1文法自动构造预测分析表。</p><h2 id="二、运行环境"><a href="#二、运行环境" class="headerlink" title="二、运行环境"></a>二、运行环境</h2><p>电脑硬件配置：</p><ul><li><p>处理器：Intel i7 7700HQ</p></li><li><p>显卡：NVIDIA GeForce GTX 1050 Ti</p></li><li><p>内存：16GB</p></li></ul><p>软件：</p><ul><li><p>编程语言：C++</p></li><li><p>IDE：Microsoft Visual Studio 2019</p></li><li><p>Windows SDK版本：10.0</p></li><li><p>平台工具集：Visual Studio 2019（v142）</p></li></ul><h2 id="三、核心算法"><a href="#三、核心算法" class="headerlink" title="三、核心算法"></a>三、核心算法</h2><h3 id="1、整个程序的模型如图所示"><a href="#1、整个程序的模型如图所示" class="headerlink" title="1、整个程序的模型如图所示"></a>1、整个程序的模型如图所示</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200831111906.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831111906.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p>分析栈、分析表的数据结构详见【变量和函数】。</p><h3 id="2、first集的构造"><a href="#2、first集的构造" class="headerlink" title="2、first集的构造"></a>2、first集的构造</h3><p>使用深度优先遍历递归的方法，当遍历完所有的非终结符的产生式右部，first集构造完成。详见注释。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200831112033.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112033.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200831112041.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112041.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3" style="zoom:80%;"><h3 id="3、follow集的构造"><a href="#3、follow集的构造" class="headerlink" title="3、follow集的构造"></a>3、follow集的构造</h3><p>不能采用深度优先遍历的方法，否则求给出的测试样例【其它文法1】会无限循环，因为非终结符之间的follow集是互相依赖的，因而采用了另一种方法解决了这个问题。就是无限循环求所有非终结符的follow集，直到所有的follow集都不再增大为止，跳出循环。详见注释。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200831112144.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112144.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200831112152.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112152.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200831112200.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200831112212.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7" style="zoom:80%;"><h3 id="4、预测分析表的构造算法"><a href="#4、预测分析表的构造算法" class="headerlink" title="4、预测分析表的构造算法"></a>4、预测分析表的构造算法</h3><p>利用课本上的算法4.2</p><img src="https://gitee.com/wxy_666/images/raw/master/20200831112256.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112256.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="8" style="zoom:80%;"><h3 id="5、预测分析控制程序算法"><a href="#5、预测分析控制程序算法" class="headerlink" title="5、预测分析控制程序算法"></a>5、预测分析控制程序算法</h3><p>利用课本上的算法</p><img src="https://gitee.com/wxy_666/images/raw/master/20200831112400.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831112400.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="9" style="zoom:80%;"><p>但是该算法有点小瑕疵，就是最后while循环的出口判断条件有问题，不应该是只是【栈顶文法符号X不为‘$’】，而应为【栈顶文法符号X不为‘$’&amp;&amp;所指向的输入符号a不为‘$’】。</p><h3 id="6、输入形式："><a href="#6、输入形式：" class="headerlink" title="6、输入形式："></a>6、输入形式：</h3><p>先输入文法的产生式个数，然后输入产生式，该文法必须为LL1文法（消除左递归和左公因子），然后输入1或0，决定是否要进行分析，然后再输入要分析的字符串，该字符串需要用i代表数字，以‘$’结尾。<br>输入的文法默认第一个输入的产生式的左部为起始符，非终结符仅为一个大写字母，终结符仅为一个小写字母和各种符号，且用~代替epsilon,且输入的文法必须满足LL1文法的条件。输入的要分析的字符串需要用i代表数字，以‘$’结尾。我认为没有必要把i也就是题目中的num细化为数字，因为这些操作已经在词法分析中完成了，语法分析只需完成分析类似于这种字符串的输入是否被接受就可以了。</p><h3 id="7、输出形式："><a href="#7、输出形式：" class="headerlink" title="7、输出形式："></a>7、输出形式：</h3><p>先输出该文法的first集和follow集，再输出该文法的LL1预测分析表，最后输出用户输入的待分析字符串的分析过程</p><h2 id="四、变量和函数"><a href="#四、变量和函数" class="headerlink" title="四、变量和函数"></a>四、变量和函数</h2><h3 id="1、类"><a href="#1、类" class="headerlink" title="1、类"></a>1、类</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PF</span>//<span class="title">Production</span> <span class="title">formula</span>,产生式的类</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">string</span> left;<span class="comment">//产生式的左部</span></span><br><span class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; right;<span class="comment">//产生式的右部</span></span><br><span class="line">PF(<span class="keyword">char</span> s[])<span class="comment">//构造函数，确定产生式左部</span></span><br><span class="line">&#123;</span><br><span class="line">left = s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> s[])</span><span class="comment">//插入产生式右部的函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">right.insert(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2、全局变量"><a href="#2、全局变量" class="headerlink" title="2、全局变量"></a>2、全局变量</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;PF&gt; PF_vector;<span class="comment">//产生式</span></span><br><span class="line">使用一个<span class="built_in">vector</span>数组，每个元素为PF类的对象，来存放输入的产生式。</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; &gt; first;<span class="comment">//first集</span></span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; &gt; follow;<span class="comment">//follow集</span></span><br><span class="line">使用了<span class="built_in">map</span>哈希key的类型为<span class="built_in">string</span>，存放产生式的左部，value的类型为<span class="keyword">char</span>的<span class="built_in">set</span>,用来存放对应key的first集和follow集。</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="built_in">string</span>&gt;&gt; predict_table;<span class="comment">//LL1分析表</span></span><br><span class="line"><span class="comment">//使用一个vector数组，每个元素为一个map，该vector的每一个map分别对应PF_vector中每个产生式的左部的非终结符所在的预测分析表的行，map的key为终结符，value为对应表项中的产生式的右部</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; A;<span class="comment">//分析栈</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; B;<span class="comment">//剩余串</span></span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; PF_map;<span class="comment">//存储每个非终结符对应的编号，key为非终结符，value为编号</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; letter;<span class="comment">//所有的终结符,在构造预测分析表的时候创建完毕</span></span><br><span class="line"><span class="keyword">int</span> B_point = <span class="number">0</span>, input_len = <span class="number">0</span>;<span class="comment">//B_point为输入串指针，input_len为输入串长度</span></span><br></pre></td></tr></table></figure><h3 id="3、函数"><a href="#3、函数" class="headerlink" title="3、函数"></a>3、函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//first集的构造：</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">first_construction</span><span class="params">()</span> <span class="comment">//构造并输出first集</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> x)</span><span class="comment">//为构造first集深度优先遍历PF，递归调用</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//follow集的构造：</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">follow_construction</span><span class="params">()</span><span class="comment">//构造并输出follow集</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_follow</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str1, <span class="keyword">const</span> <span class="built_in">string</span>&amp; str2)</span><span class="comment">//将str1的follow集加入到str2的follow集中</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//预测分析表的构造：</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">predict_table_construction</span><span class="params">()</span><span class="comment">//构造并输出LL1分析表</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_first</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str, <span class="keyword">char</span> ch)</span><span class="comment">//检查ch是否属于str的FIRST集合</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_follow</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; str, <span class="keyword">char</span> ch)</span><span class="comment">//检查ch是否属于str的FOLLOW集合</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//预测分析控制程序：</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">analyse</span><span class="params">()</span><span class="comment">//预测分析控制程序</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_A</span><span class="params">()</span><span class="comment">//输出分析栈</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_B</span><span class="params">()</span><span class="comment">//输出剩余串</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//主函数：</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>PS：关于每个函数内部详细实现详见main.cpp中写好了详细的注释，我几乎对每一步操作的目的和函数的目的都写了详细的注释。</p><h2 id="五、测试样例："><a href="#五、测试样例：" class="headerlink" title="五、测试样例："></a>五、测试样例：</h2><p>这个语法分析程序普适性较高，不仅对课本上的算数运算文法能实现求first集和follow集，自动生成预测分析表，以及对字符串进行分析，还对几乎所有的LL1文法都可以实现，只要输入的文法按照【核心算法】中的【输入形式】的要求即可。</p><p>在这里我以课本上的算数运算文法为例。其它文法1为follow集循环依赖文法（求follow集不可以用递归求，否则该文法会无限循环），其它文法2为起始符可推空文法（如果不按严格算法4.2构造分析表，也就是作业中把A-&gt;~产生式加入到A的follow集所对应的终结符的表项中的做法其实是不准确的，而应把A可以推空的产生式加入到A的follow集所对应的终结符的表项中，否则就会导致无法识别某些字符串的错误，例如其它文法2就是无法识别空串的错误，但该文法确实可以识别空串）。</p><table><thead><tr><th><img src="https://gitee.com/wxy_666/images/raw/master/20200831181454.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181454.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数in0" style="zoom:80%;"></th><th><img src="https://gitee.com/wxy_666/images/raw/master/20200831181512.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181512.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out0" style="zoom:80%;"></th></tr></thead><tbody><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200831181527.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181527.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out1" style="zoom:80%;"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200831181541.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181541.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out2" style="zoom:80%;"></td></tr><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200831181551.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181551.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out3" style="zoom:80%;"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200831181559.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181559.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out4" style="zoom:80%;"></td></tr><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200831181615.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200831181615.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="算数out5" style="zoom:80%;"></td><td></td></tr></tbody></table><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/yufafenxi-LL1" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=yufafenxi-LL1&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=yufafenxi-LL1&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是编译原理C语言LL1语法分析器的简单实现项目。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/categories/C-C/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="编译原理" scheme="https://666wxy666.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="语法分析" scheme="https://666wxy666.github.io/tags/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/"/>
    
      <category term="LL1" scheme="https://666wxy666.github.io/tags/LL1/"/>
    
  </entry>
  
  <entry>
    <title>编译原理 语法分析 LR</title>
    <link href="https://666wxy666.github.io/2020/09/02/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90-LR/"/>
    <id>https://666wxy666.github.io/2020/09/02/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90-LR/</id>
    <published>2020-09-01T16:00:00.000Z</published>
    <updated>2020-09-02T01:54:18.747Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是编译原理C语言LR语法分析器的简单实现项目。</strong></p><a id="more"></a><h2 id="一、需求"><a href="#一、需求" class="headerlink" title="一、需求"></a>一、需求</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200902092212.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902092212.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p><strong>拓展需求：</strong>除题目的基础要求外，还额外实现了对任意SLR1文法，自动生成拓广文法，且求该文法的first集和follow集，并且自动生成LR0项目集规范簇和识别该文法所有活前缀的DFA，然后根据该DFA自动生成SLR1分析表。</p><h2 id="二、运行环境"><a href="#二、运行环境" class="headerlink" title="二、运行环境"></a>二、运行环境</h2><p>电脑硬件配置：</p><ul><li><p>处理器：Intel i7 7700HQ</p></li><li><p>显卡：NVIDIA GeForce GTX 1050 Ti</p></li><li><p>内存：16GB</p></li></ul><p>软件：</p><ul><li><p>编程语言：C++</p></li><li><p>IDE：Microsoft Visual Studio 2019</p></li><li><p>Windows SDK版本：10.0</p></li><li><p>平台工具集：Visual Studio 2019（v142）</p></li></ul><h2 id="三、核心算法"><a href="#三、核心算法" class="headerlink" title="三、核心算法"></a>三、核心算法</h2><h3 id="1、整个程序的模型如图所示"><a href="#1、整个程序的模型如图所示" class="headerlink" title="1、整个程序的模型如图所示"></a>1、整个程序的模型如图所示</h3><h4 id="手动分析："><a href="#手动分析：" class="headerlink" title="手动分析："></a>手动分析：</h4><ol><li><p>首先对文法进行拓广，求first集和follow集，发现该文法是一个SLR1文法。</p></li><li><p>构造LR0项目集规范簇及识别该文法所有活前缀的DFA</p></li><li><p>构造识别该文法的SLR0分析表</p><table><thead><tr><th><img src="https://gitee.com/wxy_666/images/raw/master/20200902092905.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902092905.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2" style="zoom: 67%;"></th><th><img src="https://gitee.com/wxy_666/images/raw/master/20200902093010.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093010.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></th></tr></thead><tbody><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200902093023.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093023.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200902093052.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093052.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5" style="zoom: 50%;"></td></tr></tbody></table></li></ol><ol start="4"><li><p>整个程序的模型如图所示</p><img src="https://gitee.com/wxy_666/images/raw/master/20200902093306.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093306.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6" style="zoom:80%;"></li><li><p>预测分析控制程序算法</p><img src="https://gitee.com/wxy_666/images/raw/master/20200902093330.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093330.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7" style="zoom:80%;"></li></ol><h3 id="6、输入形式："><a href="#6、输入形式：" class="headerlink" title="6、输入形式："></a>6、输入形式：</h3><p>文件输入，格式为：</p><p>产生式个数n</p><p>{</p><p>……</p><p>第i(1&lt;=i&lt;=n)个产生式（例如A-&gt;a，按照输入顺序分别从1到n编号，拓广产生式为0号，规定终结符和非终结符都是一个字符且非终结符都为大写字母）</p><p>……</p><p>}</p><p>要分析的字符串个数n</p><p>{</p><p>……</p><p>第i(1&lt;=i&lt;=n)个要分析的字符串（要求以$结尾）</p><p>……</p><p>}</p><img src="https://gitee.com/wxy_666/images/raw/master/20200902093444.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093444.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="8" style="zoom:80%;"><h3 id="7、输出形式："><a href="#7、输出形式：" class="headerlink" title="7、输出形式："></a>7、输出形式：</h3><p>先输出该文法的拓广文法，再输出该拓广文法的first集和follow集，再输出SLR0分析表，然后输出用户输入的待分析字符串的分析过程。</p><h2 id="四、变量和函数"><a href="#四、变量和函数" class="headerlink" title="四、变量和函数"></a>四、变量和函数</h2><h3 id="1、类和枚举："><a href="#1、类和枚举：" class="headerlink" title="1、类和枚举："></a>1、类和枚举：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> RS<span class="comment">//动作的枚举</span></span><br><span class="line">&#123;</span><br><span class="line">shift,<span class="comment">//移进</span></span><br><span class="line">reduce,<span class="comment">//规约</span></span><br><span class="line">accept<span class="comment">//接受</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//假定非终结符仅为一个大写字母，终结符仅为一个小写字母和各种符号，且用~代替epsilon</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PF</span>//<span class="title">Production</span> <span class="title">formula</span>,产生式的类</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">char</span> left;<span class="comment">//产生式的左部</span></span><br><span class="line"><span class="built_in">string</span> right;<span class="comment">//产生式的右部</span></span><br><span class="line">PF(<span class="keyword">char</span> l, <span class="built_in">string</span> r)<span class="comment">//构造函数</span></span><br><span class="line">&#123;</span><br><span class="line">left = l;</span><br><span class="line">right = r;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ITEM</span>//项目集</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">ITEM();<span class="comment">//默认构造函数</span></span><br><span class="line">ITEM(<span class="keyword">int</span> NO);<span class="comment">//构造函数</span></span><br><span class="line"><span class="keyword">int</span> NO;<span class="comment">//项目集编号</span></span><br><span class="line"><span class="built_in">set</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; production;<span class="comment">//项目，第一个int代表产生式编号，第二个int代表.的位置</span></span><br><span class="line"><span class="built_in">set</span>&lt;pair&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;&gt; go_to;<span class="comment">//该项目集指向的项目集，第一个char代表箭头上的字符，第二个int代表指向的项目集编号</span></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> ITEM&amp; item)<span class="keyword">const</span>;<span class="comment">//重载&lt;操作符，以便使用set</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">action</span>//动作类</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">action(RS rs,<span class="keyword">int</span> num);<span class="comment">//重写构造函数</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">ret_action</span><span class="params">()</span></span>;<span class="comment">//返回该动作</span></span><br><span class="line">action();<span class="comment">//初始</span></span><br><span class="line">RS rs;<span class="comment">//动作</span></span><br><span class="line"><span class="keyword">int</span> num;<span class="comment">//移进到哪个状态，或者用哪个产生式规约</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2、全局变量"><a href="#2、全局变量" class="headerlink" title="2、全局变量"></a>2、全局变量</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;PF&gt; PF_vector;<span class="comment">//产生式</span></span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; &gt; first;<span class="comment">//first集</span></span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; &gt; follow;<span class="comment">//follow集</span></span><br><span class="line"><span class="built_in">set</span>&lt;ITEM&gt; DFA;<span class="comment">//DFA项目集规范簇</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">map</span>&lt;<span class="keyword">char</span>, action&gt;&gt; predict_table_action;<span class="comment">//SLR1分析表action</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt;&gt; predict_table_goto;<span class="comment">//SLR1分析表goto</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; A_1;<span class="comment">//符号栈</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; A_2;<span class="comment">//状态栈</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; B;<span class="comment">//剩余串</span></span><br><span class="line"><span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; terminal;<span class="comment">//所有的终结符+'$'</span></span><br><span class="line"><span class="built_in">set</span>&lt;<span class="keyword">char</span>&gt; non_terminal;<span class="comment">//所有的非终结符</span></span><br><span class="line"><span class="keyword">int</span> B_point = <span class="number">0</span>, input_len = <span class="number">0</span>;<span class="comment">//B_point为输入串指针，input_len为输入串长度</span></span><br></pre></td></tr></table></figure><h3 id="3、函数"><a href="#3、函数" class="headerlink" title="3、函数"></a>3、函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ITEM::ITEM()<span class="comment">//默认构造函数</span></span><br><span class="line">ITEM::ITEM(<span class="keyword">int</span> NO)<span class="comment">//构造函数</span></span><br><span class="line"><span class="keyword">bool</span> ITEM::<span class="keyword">operator</span>&lt;(<span class="keyword">const</span> ITEM&amp; item)<span class="keyword">const</span><span class="comment">//重载&lt;操作符，以便使用set</span></span><br><span class="line">action::action(RS rs, <span class="keyword">int</span> num) <span class="comment">//构造函数</span></span><br><span class="line">action::action()<span class="comment">//默认构造函数</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">action::ret_action</span><span class="params">()</span><span class="comment">//返回该动作</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">first_construction</span><span class="params">()</span><span class="comment">//构造并输出first集</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_follow</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>&amp; ch1, <span class="keyword">const</span> <span class="keyword">char</span>&amp; ch2)</span><span class="comment">//将ch1的follow集加入到ch2的follow集中</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">follow_construction</span><span class="params">()</span><span class="comment">//构造并输出follow集</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFA_construction</span><span class="params">()</span><span class="comment">//构造DFA</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">predict_table_construction</span><span class="params">()</span><span class="comment">//构造并输出SLR1预测分析表</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_A</span><span class="params">()</span><span class="comment">//输出分析栈</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_B</span><span class="params">()</span><span class="comment">//输出剩余串</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">analyse</span><span class="params">()</span><span class="comment">//预测分析控制程序</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>PS：关于每个函数内部详细实现详见main.cpp中写好了详细的注释，我几乎对每一步操作的目的和函数的目的都写了详细的注释。</p><h2 id="五、测试样例："><a href="#五、测试样例：" class="headerlink" title="五、测试样例："></a>五、测试样例：</h2><table><thead><tr><th><img src="https://gitee.com/wxy_666/images/raw/master/20200902093741.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093741.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"></th><th><img src="https://gitee.com/wxy_666/images/raw/master/20200902093801.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093801.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2" style="zoom:80%;"></th></tr></thead><tbody><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200902093811.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093811.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3" style="zoom:80%;"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200902093822.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093822.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4" style="zoom:80%;"></td></tr><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200902093830.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200902093830.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5" style="zoom:80%;"></td><td></td></tr></tbody></table><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/yufafenxi-LR" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=yufafenxi-LR&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=yufafenxi-LR&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是编译原理C语言LR语法分析器的简单实现项目。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/categories/C-C/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="编译原理" scheme="https://666wxy666.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="语法分析" scheme="https://666wxy666.github.io/tags/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/"/>
    
      <category term="LR" scheme="https://666wxy666.github.io/tags/LR/"/>
    
  </entry>
  
  <entry>
    <title>编译原理 词法分析</title>
    <link href="https://666wxy666.github.io/2020/09/01/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/"/>
    <id>https://666wxy666.github.io/2020/09/01/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2020-09-02T01:53:58.318Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是编译原理C语言词法分析器的简单实现项目。</strong></p><a id="more"></a><h2 id="一、需求"><a href="#一、需求" class="headerlink" title="一、需求"></a>一、需求</h2><p>词法分析程序的设计和实现。</p><p>设计并实现C语言的词法分析程序，要求如下： </p><ol><li>可以识别出用C语言编写的源程序中的每个单词符号，并以记号的形式输出每个单词符号。</li><li>可以识别并读取源程序中的注释。</li><li>可以统计源程序汇总的语句行数、各类单词的个数、以及字符个数，并输出统计结果。</li><li>检查源程序中存在的词法错误，并报告错误所在的位置。</li><li>对源程序中存在的错误进行适当的恢复，使词法分析可以继续进行，对源程序进行一次扫描即可检查并报告源程序中存在的所有词法错误。</li></ol><h2 id="二、运行环境"><a href="#二、运行环境" class="headerlink" title="二、运行环境"></a>二、运行环境</h2><p>电脑硬件配置：</p><ul><li><p>处理器：Intel i7 7700HQ</p></li><li><p>显卡：NVIDIA GeForce GTX 1050 Ti</p></li><li><p>内存：16GB</p></li></ul><p>软件：</p><ul><li><p>编程语言：C++</p></li><li><p>IDE：Microsoft Visual Studio 2019</p></li><li><p>Windows SDK版本：10.0</p></li><li><p>平台工具集：Visual Studio 2019（v142）</p></li></ul><h2 id="三、核心算法"><a href="#三、核心算法" class="headerlink" title="三、核心算法"></a>三、核心算法</h2><p>读入源程序，将源程序拆分为单词，同时去除空格和空行并存入vector中，一个字符一个字符的读入自动机，文件输出单词和类型，并在最后输出统计结果，在屏幕输出错误。</p><p>PS:不支持中文字符</p><h3 id="源程序的记号和表达式："><a href="#源程序的记号和表达式：" class="headerlink" title="源程序的记号和表达式："></a>源程序的记号和表达式：</h3><ol><li><p>标识符：字母或“_”开头，后跟字母或数字或“_”组成的符号串</p></li><li><p>关键字：标识符集合的子集。C语言有32个关键字，分别为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"do"</span>,<span class="string">"double"</span>,<span class="string">"auto"</span>,<span class="string">"break"</span>,<span class="string">"case"</span>,<span class="string">"char"</span>,<span class="string">"const"</span>,<span class="string">"continue"</span>,<span class="string">"default"</span>,<span class="string">"else"</span>,<span class="string">"enum"</span>,<span class="string">"extern"</span>,<span class="string">"float"</span>,<span class="string">"for"</span>,<span class="string">"goto"</span>,<span class="string">"if"</span>,<span class="string">"int"</span>,<span class="string">"long"</span>,<span class="string">"register"</span>,<span class="string">"return"</span>,<span class="string">"struct"</span>,<span class="string">"switch"</span>,<span class="string">"typedef"</span>,<span class="string">"short"</span>,<span class="string">"signed"</span>,<span class="string">"sizeof"</span>,<span class="string">"static"</span>,<span class="string">"union"</span>,<span class="string">"unsigned"</span>,<span class="string">"void"</span>,<span class="string">"volatile"</span>,<span class="string">"while"</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>数字：由整数部分、可选小数部分和可选整数部分构成</p></li><li><p>运算符：</p></li></ol><pre><code>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ( ) ~ &amp; ^ % &lt;= &lt;&lt; &lt; &gt;= &gt;&gt; &gt; = == / != ! &amp;&amp; &amp; || | -&gt; - : ?</span><br></pre></td></tr></table></figure></code></pre><ol start="5"><li><p>分隔符：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; # ’ ” [ ] &#123; &#125; ,</span><br></pre></td></tr></table></figure></li><li><p>转义符：\</p></li></ol><h3 id="状态转换图："><a href="#状态转换图：" class="headerlink" title="状态转换图："></a>状态转换图：</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200824091143.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824091143.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom: 50%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200824091151.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824091151.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="22" style="zoom: 50%;"><h3 id="输入形式："><a href="#输入形式：" class="headerlink" title="输入形式："></a>输入形式：</h3><p>文件输入。</p><h3 id="输出形式："><a href="#输出形式：" class="headerlink" title="输出形式："></a>输出形式：</h3><p>分两部分：文件输出和屏幕输出。文件输出分析内容，分四部分：按文件顺序输出类型和表达式，每种表达式数量统计，每种类型数量统计，行数、单词数、字符数统计；屏幕输出错误。详见输出样例部分。</p><h2 id="四、变量和函数"><a href="#四、变量和函数" class="headerlink" title="四、变量和函数"></a>四、变量和函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> start = <span class="number">0</span>, over = <span class="number">0</span>, first = <span class="number">0</span>;<span class="comment">//指针</span></span><br><span class="line"><span class="keyword">int</span> letters = <span class="number">0</span>, lines = <span class="number">0</span>, words = <span class="number">0</span>;<span class="comment">//统计单词数，行数和字符数的变量</span></span><br><span class="line"><span class="keyword">int</span> state;<span class="comment">//状态变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">str</span>//单词类</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">int</span> linenum;<span class="comment">//行号</span></span><br><span class="line"><span class="built_in">string</span> Str;<span class="comment">//单词       </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出文件名</span></span><br><span class="line"><span class="built_in">string</span> file_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回单词或符号,从位置i开始查找，引用参数j返回这个单词最后一个字符在str的位置。</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">GetWord</span><span class="params">(<span class="built_in">string</span> str, <span class="keyword">int</span> i, <span class="keyword">int</span>&amp; j)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//除去字符串中连续的空格和换行。第一个参数为目标字符串，第二个参数为开始位置。返回值为第一个有效字符在字符串的位置</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_nbc</span><span class="params">(<span class="built_in">string</span> str, <span class="keyword">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件输出函数，成功输出返回true，失败返回false</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Output</span><span class="params">(<span class="built_in">vector</span>&lt;pair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; &gt; v)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//词法分析主要算法函数，返回一个pair型数组</span></span><br><span class="line">vector&lt;pair&lt;string, string&gt; &gt; analyse(vector&lt;str&gt;&amp; vec);</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断str是否为关键字，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsKey</span><span class="params">(<span class="built_in">string</span> str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断C是否为字母，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">letter</span><span class="params">(<span class="keyword">char</span> C)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此函数判断C是否为数字，是的话，返回真，反之返回假</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">digit</span><span class="params">(<span class="keyword">char</span> C)</span></span>;</span><br></pre></td></tr></table></figure><p>详细代码见文末github项目。</p><h2 id="五、测试样例："><a href="#五、测试样例：" class="headerlink" title="五、测试样例："></a>五、测试样例：</h2><table><thead><tr><th><img src="https://gitee.com/wxy_666/images/raw/master/20200824093509.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093509.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="11"></th><th><img src="https://gitee.com/wxy_666/images/raw/master/20200824093524.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093524.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="12" style="zoom: 67%;"></th></tr></thead><tbody><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093559.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093559.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="13" style="zoom:80%;"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093612.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093612.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="14" style="zoom:80%;"></td></tr><tr><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093708.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093708.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="15"></td><td><img src="https://gitee.com/wxy_666/images/raw/master/20200824093715.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200824093715.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="16" style="zoom: 67%;"></td></tr></tbody></table><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/cifafenxi" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=cifafenxi&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=cifafenxi&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是编译原理C语言词法分析器的简单实现项目。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/categories/C-C/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="编译原理" scheme="https://666wxy666.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="词法分析" scheme="https://666wxy666.github.io/tags/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>杂项工程项目集锦</title>
    <link href="https://666wxy666.github.io/2020/08/15/%E6%9D%82%E9%A1%B9%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%E9%9B%86%E9%94%A6/"/>
    <id>https://666wxy666.github.io/2020/08/15/%E6%9D%82%E9%A1%B9%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%E9%9B%86%E9%94%A6/</id>
    <published>2020-08-14T16:00:00.000Z</published>
    <updated>2020-09-02T02:07:35.156Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是一些我曾经写过的项目工程集锦。</strong></p><a id="more"></a><p>这些项目的源码、可执行程序、报告等已经存放于我的Github，欢迎下载查看：</p><h2 id="1、Python爬虫、数据处理、数据分析、数据可视化"><a href="#1、Python爬虫、数据处理、数据分析、数据可视化" class="headerlink" title="1、Python爬虫、数据处理、数据分析、数据可视化"></a>1、Python爬虫、数据处理、数据分析、数据可视化</h2><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/MiscellaneousProjects" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=MiscellaneousProjects&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=MiscellaneousProjects&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a><div class="btns rounded center grid3">            <a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E5%AD%A6%E6%A0%A1%E5%92%8C%E6%88%BF%E4%BB%B7%E7%88%AC%E8%99%AB%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="学校和房价爬虫小项目"><i class="fas fa-download"></i>学校和房价爬虫小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="数据预处理小项目"><i class="fas fa-download"></i>数据预处理小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%88%BF%E4%BB%B7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="房价数据分析小项目"><i class="fas fa-download"></i>房价数据分析小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B0%8F%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="数据可视化小项目"><i class="fas fa-download"></i>数据可视化小项目</a><a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/Python/%E4%BA%AC%E4%B8%9C%E6%B7%98%E5%AE%9D%E6%89%8B%E6%9C%BA%E7%88%AC%E8%99%AB%E5%88%86%E6%9E%90%E9%A1%B9%E7%9B%AE" target="_blank" rel="external nofollow noopener noreferrer" title="京东淘宝手机爬虫分析项目"><i class="fas fa-download"></i>京东淘宝手机爬虫分析项目</a>          </div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是一些我曾经写过的项目工程集锦。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="杂项" scheme="https://666wxy666.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="C" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 花卉识别</title>
    <link href="https://666wxy666.github.io/2020/08/10/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB/"/>
    <id>https://666wxy666.github.io/2020/08/10/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB/</id>
    <published>2020-08-09T16:00:00.000Z</published>
    <updated>2020-09-02T02:06:00.331Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是机器学习人工智能实验，利用华为云ModelArts平台实现花卉分类识别。</strong></p><a id="more"></a><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><p>通过该实验，实现以下目标</p><ul><li>熟悉ModelArts平台，能够调用平台的简单物体识别算法进行物体检测；</li><li>熟悉ModelArts平台特征提取方法，提取数据集的视觉特征；</li><li>熟悉ModelArts的神经网络架构，改进架构算法，进行目标检测算法的设计与实现。</li><li>学会评价检测算法的基本方法，对所设计的算法进行评估。</li></ul><h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><p>ModelArts平台</p><h2 id="三、实验内容"><a href="#三、实验内容" class="headerlink" title="三、实验内容"></a>三、实验内容</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200715111020.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715111020.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><h2 id="四、实验步骤"><a href="#四、实验步骤" class="headerlink" title="四、实验步骤"></a>四、实验步骤</h2><p>由于时间久远，详细内容请前往Github项目查看实验报告。</p><h2 id="五、项目地址"><a href="#五、项目地址" class="headerlink" title="五、项目地址"></a>五、项目地址</h2><p>本项目的实验报告已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/MiscellaneousProjects" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=MiscellaneousProjects&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=MiscellaneousProjects&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a><div class="btns rounded center grid1">            <a class="button" href="https://github.com/666WXY666/MiscellaneousProjects/tree/master/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-%E8%8A%B1%E5%8D%89%E8%AF%86%E5%88%AB" target="_blank" rel="external nofollow noopener noreferrer" title="源码仓库"><i class="fas fa-download"></i>源码仓库</a>          </div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是机器学习人工智能实验，利用华为云ModelArts平台实现花卉分类识别。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="华为云" scheme="https://666wxy666.github.io/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91/"/>
    
      <category term="人工智能" scheme="https://666wxy666.github.io/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"/>
    
      <category term="AI" scheme="https://666wxy666.github.io/tags/AI/"/>
    
      <category term="分类" scheme="https://666wxy666.github.io/tags/%E5%88%86%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark 自选日志分析</title>
    <link href="https://666wxy666.github.io/2020/07/21/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E8%87%AA%E9%80%89%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    <id>https://666wxy666.github.io/2020/07/21/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E8%87%AA%E9%80%89%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/</id>
    <published>2020-07-20T16:00:00.000Z</published>
    <updated>2020-09-02T02:05:18.459Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Java进行Spark编程实现自选日志处理分析。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Spark版本：Apache Spark 2.1.1</li><li>Eclipse版本：Neno.3 （4.6.3）</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>收集一组自选日志，构造mydata.log数据集，上传到实验环境中，重新完成对自选日志分析。</li></ul><h2 id="三、主要步骤："><a href="#三、主要步骤：" class="headerlink" title="三、主要步骤："></a>三、主要步骤：</h2><ul><li>获取自选数据集</li><li>自选数据集计算的需求分析</li><li>编程设计实现</li><li>运行程序</li></ul><h2 id="四、实验步骤："><a href="#四、实验步骤：" class="headerlink" title="四、实验步骤："></a>四、实验步骤：</h2><h3 id="4-1获取自选数据集以及数据字段格式解释说明"><a href="#4-1获取自选数据集以及数据字段格式解释说明" class="headerlink" title="4.1获取自选数据集以及数据字段格式解释说明"></a>4.1获取自选数据集以及数据字段格式解释说明</h3><p>我受到平台的第一个实验和uber日志文件的启发，想到了自己用python生成uber日志文件，首先是日志的格式：</p><table><thead><tr><th align="center">字段</th><th align="center">数据类型</th><th align="center">说明信息</th></tr></thead><tbody><tr><td align="center">dispatching_base_number</td><td align="center">String</td><td align="center">区域编号</td></tr><tr><td align="center">date</td><td align="center">String</td><td align="center">日期</td></tr><tr><td align="center">active_vehicles</td><td align="center">int</td><td align="center">使用的机动车数量</td></tr><tr><td align="center">trips</td><td align="center">int</td><td align="center">旅游次数</td></tr></tbody></table><p>定义好了日志的格式，只要编写python程序，让他自己按照这个格式生产日志即可，具体代码见附录，下面是部分代码截图和运行结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603145855.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603145855.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_145833" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603145923.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603145923.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_145917" style="zoom:80%;"><h3 id="4-2自选数据集计算的需求分析"><a href="#4-2自选数据集计算的需求分析" class="headerlink" title="4.2自选数据集计算的需求分析"></a>4.2自选数据集计算的需求分析</h3><p>因为是汽车和旅游日志信息，并且有不同日期，不同地区的信息，主要需求就是选取从开始时间到截止时间使用的机动车数量和旅游次数最多的前10个地区，以及他们的机动车总数量和旅游总次数。</p><p>主要步骤就是（与实验一大体相同，又有所区别）：</p><ol><li><p>按照 Serrializable 接口实现自定义排序的 Key；</p></li><li><p>将要进行二次排序的文件加载进来生成 key-value 类型的 RDD</p></li><li><p>使用 sortByKey 基于自定义的 Key 进行二次排序</p></li><li><p>去除掉排序的 key，只保留排序结果</p><p>排序规则如下：</p><p>以区域编号dispatching_base_number为基准，分别按照active_vehicles，trips，date进行降序排序。即先按照active_vehicles排序，如果active_vehicles相同，再比较trips，如果trips相同，再比较date，最后选择前10条记录输出。</p></li></ol><h3 id="4-3编程设计实现"><a href="#4-3编程设计实现" class="headerlink" title="4.3编程设计实现"></a>4.3编程设计实现</h3><h4 id="4-3-1创建工程"><a href="#4-3-1创建工程" class="headerlink" title="4.3.1创建工程"></a>4.3.1创建工程</h4><p>4.3.1.1打开Eclipse IDE</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd eclipse/</span><br><span class="line">./eclipse &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102818" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102840" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102917" style="zoom:80%;"><p>4.3.1.2点击 File -&gt; New -&gt;Other</p><p>4.3.1.3搜索 maven -&gt; 点击 Maven Project -&gt; Next-&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103021" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103035" style="zoom:80%;"><p>4.3.1.4选中maven-archetype-quickstart -&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103051" style="zoom:80%;"><p>4.3.1.5输入Group Id 为 org.zkpk；Artifact Id 为 spark ；Package为org.zkpk.spark；-&gt;Finish</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103201" style="zoom:80%;"><p>4.3.1.6升级maven工程</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103247" style="zoom:80%;"><p>升级完成：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103513" style="zoom:80%;"><p>4.3.1.7更改JRE，右键JRE System Library-&gt; Properties</p><p>4.3.1.8选中jdk1.8.0_131-&gt; OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103535" style="zoom:80%;"><p>4.3.1.9点击spark项目-&gt;修改pom.xml-&gt; 保存会自动下载jar包</p><p>4.3.1.10下载Jar包：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103915" style="zoom:80%;"><p>4.3.1.11最终 pom.xml 如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-hive_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-flume_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/main/test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span><span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">executable</span>&gt;</span>java<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeProjectDependencies</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeProjectDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includePluginDependencies</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includePluginDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathScope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">classpathScope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>cn.com.syl.spark.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.3.1.12删除工程生成的App.java和AppTest.java</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_104358" style="zoom:80%;"><p>利用实验一的实验环境编写java程序，同样是SecondarySortKey.java和SecondarySortDemo.java两个java文件。其中SecondarySortKey.java中有两个类，一个是serDemo类，用于存储未排序的数据，一个是SecondarySortKey类，里面重写了一系列排序函数，用于按照自己的规则排序；SecondarySortDemo.java有一个类SecondarySortDemo，里面有主函数和创建Spark RDD，求和，sortByKey等函数，是主要的逻辑运行的地方。</p><h4 id="4-3-2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录："><a href="#4-3-2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录：" class="headerlink" title="4.3.2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录："></a>4.3.2这里只挑出关键的代码进行解释注释和说明，详细的带注释的代码见附录：</h4><p>这是排序的数据存放的类，有三个字段，全参构造函数，getter和setter，以及toString，hashCode和equal方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SecondarySortKey that = (SecondarySortKey) o;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles == that.activeVehicles &amp;&amp;</span><br><span class="line">                trips == that.trips &amp;&amp;</span><br><span class="line">                Objects.equals(date, that.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(date, activeVehicles, trips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult&#123;"</span> +</span><br><span class="line">                <span class="string">"截止日期："</span> + date +</span><br><span class="line">                <span class="string">", 使用的机动车总数量："</span> + activeVehicles +</span><br><span class="line">                <span class="string">", 旅游总次数："</span> + trips +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最主要的是$greater，$less等一系列比较函数和compare和compareTo函数用于RDD的sortByKey。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &gt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &gt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>下面的类是主方法所在的类，也是主要的对数据进行处理计算的类：</p><p>他有四个函数（算上主函数），分别为：</p><ul><li><p>main：</p><p>用于打开文件，创建SparkConf和SparkContext对象，调用函数对RDD进行操作，并输出结果。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">       JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">       jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">       JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/mydata.log"</span>);</span><br><span class="line">       JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">       JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByDeviceID(pairRdd);</span><br><span class="line">       JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">       JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">       List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">       System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">       <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">           System.out.println(<span class="string">"区域编号："</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">       &#125;</span><br><span class="line">       jsc.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>mapTfRDD2Pair：</p><p>用于从文件中读取数据，并将其转化为JavaPairRDD，key为区域编号dispatchingBaseNumber，value为以文件每一行生成的serDemo对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String[] split = lines.split(<span class="string">","</span>);</span><br><span class="line">                String dispatchingBaseNumber = split[<span class="number">0</span>];</span><br><span class="line">                String date = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = Integer.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">int</span> trips = Integer.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(date, activeVehicles, trips);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(dispatchingBaseNumber, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>aggregateByRegionID：</p><p>用于将mapTfRDD2Pair生成好的JavaPairRDD按照key对使用的机动车数量activeVehicles和旅游次数trips求和，获得JavaPairRDD，key为区域编号dispatchingBaseNumber，value为已经求和聚集完成的serDemo对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByDeviceID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            String date = d1.getDate().compareTo(d2.getDate()) &gt; <span class="number">0</span> ? d1.getDate() : d2.getDate();</span><br><span class="line">            <span class="keyword">int</span> activeVehicles = d1.getActiveVehicles() + d2.getActiveVehicles();</span><br><span class="line">            <span class="keyword">int</span> trips = d1.getTrips() + d2.getTrips();</span><br><span class="line">            serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">            accessLogInfo.setDate(date);</span><br><span class="line">            accessLogInfo.setActiveVehicles(activeVehicles);</span><br><span class="line">            accessLogInfo.setTrips(trips);</span><br><span class="line">            <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>mapRDDKey2SortKey：</p><p>用于将aggregateByRegionID生成好的JavaPairRDD按照上面定义好的规则进行排序，获得排好序的JavaPairRDD，用于输出。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">            <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">  </span><br><span class="line">                <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    String dispatchingBaseNumber = tuple._1;</span><br><span class="line">                    serDemo accessLogInfo = tuple._2;</span><br><span class="line">                    SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getDate(), accessLogInfo.getActiveVehicles(),</span><br><span class="line">                            accessLogInfo.getTrips());</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, dispatchingBaseNumber);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-4运行程序"><a href="#4-4运行程序" class="headerlink" title="4.4运行程序"></a>4.4运行程序</h3><h4 id="4-4-1将生成好的mydata-log发送到平台。"><a href="#4-4-1将生成好的mydata-log发送到平台。" class="headerlink" title="4.4.1将生成好的mydata.log发送到平台。"></a>4.4.1将生成好的mydata.log发送到平台。</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200603153734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603153734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_125258" style="zoom:80%;"><h4 id="4-4-2运行程序，查看结果。"><a href="#4-4-2运行程序，查看结果。" class="headerlink" title="4.4.2运行程序，查看结果。"></a>4.4.2运行程序，查看结果。</h4><p>可以发现，程序正常运行得出了结果，并且已经求和和排序，成功！</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603154055.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603154055.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ截图20200603142255" style="zoom:80%;"><h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><h3 id="1、SecondarySortKey-java"><a href="#1、SecondarySortKey-java" class="headerlink" title="1、SecondarySortKey.java"></a>1、SecondarySortKey.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.math.Ordered;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">serDemo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5749943279909593929L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveVehicles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActiveVehicles</span><span class="params">(<span class="keyword">int</span> activeVehicles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTrips</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTrips</span><span class="params">(<span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//使用的机动车数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> activeVehicles;</span><br><span class="line">    <span class="comment">//旅游次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> trips;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(String date, <span class="keyword">int</span> activeVehicles, <span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialVersionUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDate</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getActiveVehicles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActiveVehicles</span><span class="params">(<span class="keyword">int</span> activeVehicles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.activeVehicles = activeVehicles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTrips</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTrips</span><span class="params">(<span class="keyword">int</span> trips)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.trips = trips;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &gt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &gt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($greater(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles &lt; other.activeVehicles) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips &lt; other.trips) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($less(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (activeVehicles == other.activeVehicles &amp;&amp;</span><br><span class="line">                trips == other.trips &amp;&amp;</span><br><span class="line">                date.compareTo(other.date) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (activeVehicles - other.activeVehicles != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> activeVehicles - other.activeVehicles;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trips - other.trips != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> trips - other.trips;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SecondarySortKey that = (SecondarySortKey) o;</span><br><span class="line">        <span class="keyword">return</span> activeVehicles == that.activeVehicles &amp;&amp;</span><br><span class="line">                trips == that.trips &amp;&amp;</span><br><span class="line">                Objects.equals(date, that.date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(date, activeVehicles, trips);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult&#123;"</span> +</span><br><span class="line">                <span class="string">"截止日期："</span> + date +</span><br><span class="line">                <span class="string">", 使用的机动车总数量："</span> + activeVehicles +</span><br><span class="line">                <span class="string">", 旅游总次数："</span> + trips +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、SecondarySortDemo-java"><a href="#2、SecondarySortDemo-java" class="headerlink" title="2、SecondarySortDemo.java"></a>2、SecondarySortDemo.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaSparkContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.Function2;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.PairFunction;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">        JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">        jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">        JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/mydata.log"</span>);</span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByRegionID(pairRdd);</span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">        List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">            System.out.println(<span class="string">"区域编号："</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">        &#125;</span><br><span class="line">        jsc.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从文件读取生成PairRDD</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String[] split = lines.split(<span class="string">","</span>);</span><br><span class="line">                String dispatchingBaseNumber = split[<span class="number">0</span>];</span><br><span class="line">                String date = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = Integer.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">int</span> trips = Integer.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(date, activeVehicles, trips);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(dispatchingBaseNumber, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对PairRDD进行reduceByKey聚集操作求和</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByRegionID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String date = d1.getDate().compareTo(d2.getDate()) &gt; <span class="number">0</span> ? d1.getDate() : d2.getDate();</span><br><span class="line">                <span class="keyword">int</span> activeVehicles = d1.getActiveVehicles() + d2.getActiveVehicles();</span><br><span class="line">                <span class="keyword">int</span> trips = d1.getTrips() + d2.getTrips();</span><br><span class="line">                serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">                accessLogInfo.setDate(date);</span><br><span class="line">                accessLogInfo.setActiveVehicles(activeVehicles);</span><br><span class="line">                accessLogInfo.setTrips(trips);</span><br><span class="line">                <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//对PairRDD进行排序，用于最后输出</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">                <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        String dispatchingBaseNumber = tuple._1;</span><br><span class="line">                        serDemo accessLogInfo = tuple._2;</span><br><span class="line">                        SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getDate(), accessLogInfo.getActiveVehicles(),</span><br><span class="line">                                accessLogInfo.getTrips());</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, dispatchingBaseNumber);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、log-generate-py"><a href="#3、log-generate-py" class="headerlink" title="3、log_generate.py"></a>3、log_generate.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: log_generate</span></span><br><span class="line"><span class="string">@Description: </span></span><br><span class="line"><span class="string">@Version: </span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-06-03 11:20</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-03 11:20</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">"mydata.log"</span>, mode=<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">ch = string.ascii_uppercase</span><br><span class="line">dispatching_base_number_list = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    dispatching_base_number_list.append(random.choice(ch) + str(random.randint(<span class="number">1</span>, <span class="number">9</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> dispatching_base_number <span class="keyword">in</span> dispatching_base_number_list:</span><br><span class="line">        file.write(dispatching_base_number + <span class="string">","</span> +</span><br><span class="line">                   time.strftime(<span class="string">"%Y-%m-%d"</span>,</span><br><span class="line">                                 time.gmtime(</span><br><span class="line">                                     time.mktime(</span><br><span class="line">                                         time.strptime(<span class="string">"2020-01-02"</span>, <span class="string">"%Y-%m-%d"</span>)) + <span class="number">86400</span> * i)) + <span class="string">","</span> +</span><br><span class="line">                   str(random.randint(<span class="number">100</span>, <span class="number">10000</span>)) + <span class="string">","</span> +</span><br><span class="line">                   str(random.randint(<span class="number">1000</span>, <span class="number">100000</span>)) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">99</span> <span class="keyword">and</span> dispatching_base_number == dispatching_base_number_list[len(dispatching_base_number_list) - <span class="number">1</span>]:</span><br><span class="line">            file.write(dispatching_base_number + <span class="string">","</span> +</span><br><span class="line">                       time.strftime(<span class="string">"%Y-%m-%d"</span>,</span><br><span class="line">                                     time.gmtime(</span><br><span class="line">                                         time.mktime(</span><br><span class="line">                                             time.strptime(<span class="string">"2020-01-02"</span>, <span class="string">"%Y-%m-%d"</span>)) + <span class="number">86400</span> * i)) + <span class="string">","</span> +</span><br><span class="line">                       str(random.randint(<span class="number">100</span>, <span class="number">10000</span>)) + <span class="string">","</span> +</span><br><span class="line">                       str(random.randint(<span class="number">1000</span>, <span class="number">100000</span>)))</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Java进行Spark编程实现自选日志处理分析。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="单词计数" scheme="https://666wxy666.github.io/tags/%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    
      <category term="Scala" scheme="https://666wxy666.github.io/tags/Scala/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="Kafka" scheme="https://666wxy666.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark 分析流量日志</title>
    <link href="https://666wxy666.github.io/2020/07/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E5%88%86%E6%9E%90%E6%B5%81%E9%87%8F%E6%97%A5%E5%BF%97/"/>
    <id>https://666wxy666.github.io/2020/07/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-%E5%88%86%E6%9E%90%E6%B5%81%E9%87%8F%E6%97%A5%E5%BF%97/</id>
    <published>2020-07-19T16:00:00.000Z</published>
    <updated>2020-09-02T02:05:09.581Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Java进行Spark编程实现日志处理分析。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Spark版本：Apache Spark 2.1.1</li><li>Eclipse版本：Neno.3 （4.6.3）</li></ul><h2 id="二、实验目的："><a href="#二、实验目的：" class="headerlink" title="二、实验目的："></a>二、实验目的：</h2><p>掌握</p><ul><li>Spark原理</li><li>Hadoop原理</li><li>Shell</li><li>Spark Streaming</li><li>二次排序</li><li>序列化</li><li>Spark RDD</li></ul><h2 id="三、实验结果："><a href="#三、实验结果：" class="headerlink" title="三、实验结果："></a>三、实验结果：</h2><ul><li><p>以下是分析后的流量日志结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603142941.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603142941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7b6022296ee8fef49cd725321a76c1da" style="zoom:80%;"></li></ul><h2 id="四、实验内容："><a href="#四、实验内容：" class="headerlink" title="四、实验内容："></a>四、实验内容：</h2><ul><li>使用SparkStreaming构建实时数据处理系统，来分析手机流量日志。</li></ul><h2 id="五、主要步骤："><a href="#五、主要步骤：" class="headerlink" title="五、主要步骤："></a>五、主要步骤：</h2><ul><li>日志分析</li><li>代码实现</li><li>运行程序</li></ul><h2 id="六、实验步骤："><a href="#六、实验步骤：" class="headerlink" title="六、实验步骤："></a>六、实验步骤：</h2><h3 id="6-1数据日志介绍"><a href="#6-1数据日志介绍" class="headerlink" title="6.1数据日志介绍"></a>6.1数据日志介绍</h3><p>6.1.1数据字段</p><p>6.1.1.1reportTime（报告时间戳）</p><p>6.1.1.2telNum（手机号）</p><p>6.1.1.3upwardflow（上行总流量）</p><p>6.1.1.4downwardflow（下行总流量）</p><h3 id="6-2需求分析"><a href="#6-2需求分析" class="headerlink" title="6.2需求分析"></a>6.2需求分析</h3><p>6.2.1对文本中数据记录进行排序，排序规则如下：</p><p>以telNum为基准，分别按照 upwardflow，downwardflow，reportTime进行降序排序，即先按照upwardflow排序，如果upwardflow相同，再比较downwardflow，如果downwardflow相同，再比较reportTime，最后选择前10条记录输出。</p><p>6.2.2具体实现步骤：</p><p>6.2.2.1按照 Serrializable 接口实现自定义排序的 Key</p><p>6.2.2.2将要进行二次排序的文件加载进来生成 key-value 类型的 RDD</p><p>6.2.2.3使用 sortByKey 基于自定义的 Key 进行二次排序</p><p>6.2.2.4去除掉排序的 key，只保留排序结果</p><h3 id="6-3代码实现："><a href="#6-3代码实现：" class="headerlink" title="6.3代码实现："></a>6.3代码实现：</h3><h4 id="6-3-1创建maven项目"><a href="#6-3-1创建maven项目" class="headerlink" title="6.3.1创建maven项目"></a>6.3.1创建maven项目</h4><p>6.3.1.1打开Eclipse IDE</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd eclipse/</span><br><span class="line">./eclipse &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143358.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102818" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143419.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102840" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_102917" style="zoom:80%;"><p>6.3.1.2点击 File -&gt; New -&gt;Other</p><p>6.3.1.3搜索 maven -&gt; 点击 Maven Project -&gt; Next-&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143443.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103021" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143500.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103035" style="zoom:80%;"><p>6.3.1.4选中maven-archetype-quickstart -&gt;Next</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143535.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103051" style="zoom:80%;"><p>6.3.1.5输入Group Id 为 org.zkpk；Artifact Id 为 spark ；Package为org.zkpk.spark；-&gt;Finish</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143603.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103201" style="zoom:80%;"><p>6.3.1.6升级maven工程</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143618.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103247" style="zoom:80%;"><p>升级完成：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143638.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103513" style="zoom:80%;"><p>6.3.1.7更改JRE，右键JRE System Library-&gt; Properties</p><p>6.3.1.8选中jdk1.8.0_131-&gt; OK</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143649.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103535" style="zoom:80%;"><p>6.3.1.9点击spark项目-&gt;修改pom.xml-&gt; 保存会自动下载jar包</p><p>6.3.1.10下载Jar包：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143734.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_103915" style="zoom:80%;"><p>6.3.1.11最终 pom.xml 如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spark<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-hive_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-flume_2.10<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    </span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/main/test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span><span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">executable</span>&gt;</span>java<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeProjectDependencies</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeProjectDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includePluginDependencies</span>&gt;</span>false<span class="tag">&lt;/<span class="name">includePluginDependencies</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathScope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">classpathScope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>cn.com.syl.spark.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.3.1.12删除工程生成的App.java和AppTest.java</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143746.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_104358" style="zoom:80%;"><h4 id="6-3-2编写代码"><a href="#6-3-2编写代码" class="headerlink" title="6.3.2编写代码"></a>6.3.2编写代码</h4><p>6.3.2.1在src/main/java中创建类，并命名为SecondarySortKey.java，然后按Finish</p><p>6.3.2.1.1创建SecondarySortKey.java，代码见附录</p><p>6.3.2.1.2在src/main/java中创建类，并命名为SecondarySortDemo，然后按Finish</p><p>6.3.2.1.3创建SecondarySortDemo.java代码见附录</p><p>6.3.2.1.4运行SecondarySortDemo，观察控制台输出</p><p>6.3.2.1.5右键SecondarySortDemo.java -&gt; Run As -&gt; Java Application</p><p>最终结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200603143924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603143924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200603110720" style="zoom:67%;"><h2 id="七、附录"><a href="#七、附录" class="headerlink" title="七、附录"></a>七、附录</h2><h3 id="1、SecondarySortKey-java"><a href="#1、SecondarySortKey-java" class="headerlink" title="1、SecondarySortKey.java"></a>1、SecondarySortKey.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> scala.math.Ordered;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">serDemo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">5749943279909593929L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> reportTime;        <span class="comment">// 时间戳</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> upwardflow;        <span class="comment">// 上行总流量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> downwardflow;    <span class="comment">// 下行总流量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">serDemo</span><span class="params">(<span class="keyword">long</span> reportTime, <span class="keyword">long</span> upwardflow, <span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getReportTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReportTime</span><span class="params">(<span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUpwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpwardflow</span><span class="params">(<span class="keyword">long</span> upwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDownwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownwardflow</span><span class="params">(<span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialversionuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortKey</span> <span class="keyword">implements</span> <span class="title">Ordered</span>&lt;<span class="title">SecondarySortKey</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3702442700882342403L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> upwardflow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> downwardflow;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> reportTime;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondarySortKey</span><span class="params">(<span class="keyword">long</span> upwardflow, <span class="keyword">long</span> downwardflow, <span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getUpwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpwardflow</span><span class="params">(<span class="keyword">long</span> upwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.upwardflow = upwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDownwardflow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownwardflow</span><span class="params">(<span class="keyword">long</span> downwardflow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downwardflow = downwardflow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getReportTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReportTime</span><span class="params">(<span class="keyword">long</span> reportTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.reportTime = reportTime;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getSerialversionuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialVersionUID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow &gt; other.upwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow &gt; other.downwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime &gt; other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $greater$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>($greater(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime == other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow &lt; other.upwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow &lt; other.downwardflow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime &lt; other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> $less$eq(SecondarySortKey other) &#123;</span><br><span class="line">        <span class="keyword">if</span>($less(other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(upwardflow == other.upwardflow &amp;&amp;</span><br><span class="line">                downwardflow == other.downwardflow &amp;&amp;</span><br><span class="line">                reportTime == other.reportTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow - other.upwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (upwardflow - other.upwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(downwardflow - other.downwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (downwardflow - other.downwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(reportTime - other.reportTime != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (reportTime - other.reportTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(SecondarySortKey other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(upwardflow - other.upwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (upwardflow - other.upwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(downwardflow - other.downwardflow != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (downwardflow - other.downwardflow);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(reportTime - other.reportTime != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (reportTime - other.reportTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> prime = <span class="number">31</span>;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (downwardflow );</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (reportTime );</span><br><span class="line">        result = prime * result + (<span class="keyword">int</span>) (upwardflow );</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        SecondarySortKey other = (SecondarySortKey) obj;</span><br><span class="line">        <span class="keyword">if</span> (downwardflow != other.downwardflow)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (reportTime != other.reportTime)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (upwardflow != other.upwardflow)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SortResult： [上行总流量： "</span> + upwardflow + <span class="string">", 下行总流量：  "</span> + downwardflow + <span class="string">", 时间戳："</span></span><br><span class="line">                + reportTime + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、SecondarySortDemo-java"><a href="#2、SecondarySortDemo-java" class="headerlink" title="2、SecondarySortDemo.java"></a>2、SecondarySortDemo.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.spark;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaSparkContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.Function2;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.PairFunction;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondarySortDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 创建sparkcontext对象，sparkcontext是程序的唯一入口</span></span><br><span class="line">        SparkConf conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"SecondarySortDemo"</span>).setMaster(<span class="string">"local"</span>);</span><br><span class="line">        JavaSparkContext jsc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">        <span class="comment">// 去掉WARN类的输出信息</span></span><br><span class="line">        jsc.setLogLevel(<span class="string">"WARN"</span>);</span><br><span class="line">        <span class="comment">// 调用textFile()方法，读取日志文件，这里指定本地磁盘文件</span></span><br><span class="line">        JavaRDD&lt;String&gt; textfile = jsc.textFile(<span class="string">"/home/zkpk/experiment/data.log"</span>);</span><br><span class="line">        <span class="comment">// 调用mapTfRDD2Pair方法 将tf映射为键值对</span></span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; pairRdd = mapTfRDD2Pair(textfile);</span><br><span class="line">        <span class="comment">// 获取每个手机号的总上行流量、总下行流量、最早报告时间戳</span></span><br><span class="line">        JavaPairRDD&lt;String, serDemo&gt; getlines = aggregateByDeviceID(pairRdd);</span><br><span class="line">        <span class="comment">// 聚合，封装的RDD作为key,手机号作为值</span></span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; telval = mapRDDKey2SortKey(getlines);</span><br><span class="line">        <span class="comment">// 依次按照上行流量、下行流量以及时间戳倒序排序</span></span><br><span class="line">        JavaPairRDD&lt;SecondarySortKey, String&gt; sortedRdd = telval.sortByKey(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 根据您的需要获得输出，这里仅显示前10行</span></span><br><span class="line">        List&lt;Tuple2&lt;SecondarySortKey, String&gt;&gt; getTop = sortedRdd.take(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"============ result ============"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;SecondarySortKey, String&gt; dt : getTop) &#123;</span><br><span class="line">            System.out.println(<span class="string">"telNum: "</span> + dt._2 + <span class="string">", "</span> + dt._1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行结束关闭资源</span></span><br><span class="line">        jsc.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mapTfRDD2Pair方法，封装键值对</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">mapTfRDD2Pair</span><span class="params">(JavaRDD&lt;String&gt; accessLogRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, serDemo&gt; <span class="title">call</span><span class="params">(String lines)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">// 根据数据格式进行切分</span></span><br><span class="line">                String[] split = lines.split(<span class="string">"\t"</span>);</span><br><span class="line">                <span class="comment">// 获取切分的字段</span></span><br><span class="line">                <span class="keyword">long</span> reportTime = Long.valueOf(split[<span class="number">0</span>]);</span><br><span class="line">                String telNum = split[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">long</span> upwardflow = Long.valueOf(split[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">long</span> downwardflow = Long.valueOf(split[<span class="number">3</span>]);</span><br><span class="line">                <span class="comment">// 创建cmbInfo对象，有参构造 ，将上行流量、下行流量，报告时间戳封装为自定义的可序列化对象</span></span><br><span class="line">                serDemo dataInfo = <span class="keyword">new</span> serDemo(reportTime, upwardflow, downwardflow);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, serDemo&gt;(telNum, dataInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据手机号进行聚合，依次按照上行流量、下行流量以及报告时间戳倒序排序</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;String, serDemo&gt; <span class="title">aggregateByDeviceID</span><span class="params">(JavaPairRDD&lt;String, serDemo&gt; accessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accessLogPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;serDemo, serDemo, serDemo&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> serDemo <span class="title">call</span><span class="params">(serDemo d1, serDemo d2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">long</span> reportTime = d1.getReportTime() &lt; d2.getReportTime() ? d1.getReportTime() : d2.getReportTime();</span><br><span class="line">                <span class="keyword">long</span> upwardflow = d1.getUpwardflow() + d2.getUpwardflow();</span><br><span class="line">                <span class="keyword">long</span> downwardflow = d1.getDownwardflow() + d2.getDownwardflow();</span><br><span class="line">                serDemo accessLogInfo = <span class="keyword">new</span> serDemo();</span><br><span class="line">                accessLogInfo.setReportTime(reportTime);</span><br><span class="line">                accessLogInfo.setUpwardflow(upwardflow);</span><br><span class="line">                accessLogInfo.setDownwardflow(downwardflow);</span><br><span class="line">                <span class="keyword">return</span> accessLogInfo;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 二次排序，手机号作为值</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JavaPairRDD&lt;SecondarySortKey, String&gt; <span class="title">mapRDDKey2SortKey</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            JavaPairRDD&lt;String, serDemo&gt; aggrAccessLogPairRDD)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aggrAccessLogPairRDD.mapToPair(</span><br><span class="line">                <span class="keyword">new</span> PairFunction&lt;Tuple2&lt;String, serDemo&gt;, SecondarySortKey, String&gt;() &#123;</span><br><span class="line">                    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Tuple2&lt;SecondarySortKey, String&gt; <span class="title">call</span><span class="params">(Tuple2&lt;String, serDemo&gt; tuple)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">// 获取元祖里的数据</span></span><br><span class="line">                        String telNum = tuple._1;</span><br><span class="line">                        serDemo accessLogInfo = tuple._2;</span><br><span class="line">                        <span class="comment">// 封装为二次排序key</span></span><br><span class="line">                        SecondarySortKey accessLogSortKey = <span class="keyword">new</span> SecondarySortKey(accessLogInfo.getUpwardflow(),</span><br><span class="line">                                accessLogInfo.getDownwardflow(), accessLogInfo.getReportTime());</span><br><span class="line">                        <span class="comment">// 返回新的Tuple</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;SecondarySortKey, String&gt;(accessLogSortKey, telNum);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Java进行Spark编程实现日志处理分析。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="Java" scheme="https://666wxy666.github.io/tags/Java/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="日志分析" scheme="https://666wxy666.github.io/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>C和C++的struct使用总结</title>
    <link href="https://666wxy666.github.io/2020/07/15/C%E5%92%8CC++%E7%9A%84struct%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <id>https://666wxy666.github.io/2020/07/15/C%E5%92%8CC++%E7%9A%84struct%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/</id>
    <published>2020-07-14T16:00:00.000Z</published>
    <updated>2020-09-02T01:48:36.334Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>简单的写了一下关于C语言和C++中的Struct结构体的定义的疑惑点和C99新增的柔性数组的使用和理解。</p><a id="more"></a><h2 id="一、关于C语言和C-中的Struct结构体的定义"><a href="#一、关于C语言和C-中的Struct结构体的定义" class="headerlink" title="一、关于C语言和C++中的Struct结构体的定义"></a>一、关于C语言和C++中的Struct结构体的定义</h2><h3 id="1、C语言"><a href="#1、C语言" class="headerlink" title="1、C语言"></a>1、C语言</h3><p>对于C语言，结构体的定义可以是以下的标准定义法：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:29:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span> <span class="title">test</span>;</span></span><br><span class="line">    test.a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, test.a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>像这样就定义了一个结构体TEST，在声明新结构体变量时，需要使用“struct TEST test”，“struct”必须有，不写会报错，“struct TEST”就相当于是“int”。</p><p>直接在结构体里赋初值是不允许的，例如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:32:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span> <span class="title">test</span>;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, test.a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>会产生如下错误：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200715113328.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715113328.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_113313" style="zoom:80%;"><p>另外，除了标准定义法，C语言还支持直接在定义结构体的时候声明变量，以及给结构体重命名：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:37:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TEST1</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125; test1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST2</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125; TEST2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST1</span> <span class="title">test11</span>;</span></span><br><span class="line">    TEST2 test2;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST2</span> <span class="title">test22</span>;</span></span><br><span class="line">    test1.a = <span class="number">1</span>;</span><br><span class="line">    test2.a = <span class="number">2</span>;</span><br><span class="line">    test11.a = <span class="number">11</span>;</span><br><span class="line">    test22.a = <span class="number">22</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d,%d,%d\n"</span>, test1.a, test2.a, test11.a, test22.a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715113946.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715113946.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_113933" style="zoom: 80%;"><p>可以看出，TEST1是直接在定义结构体时就声明了一个变量test1，在下面可以直接使用test1访问结构体成员a，另外你仍然可以在后面使用标准方法定义新的TEST1结构体。</p><p>而对于TEST2，则是使用“typedef”将“struct TEST2”起了个别名叫“TEST2”，因此后面既可以使用struct TEST2”也可以使用“TEST2”声明TEST2结构体变量。</p><p>在定义结构体的时候，你也可以省略TEST1或者TEST2不写，但是这样对于没有起别名的TEST1就只能在定义结构体的时候声明结构体变量，在后面不能定义（因为没有名字，很好理解），相当于是一次性的结构体。但是对于起了别名的TEST2，在后面就只能使用TEST2来声明结构体变量，而不能再使用标准的“struct TEST2”。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:52:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125; test1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125; TEST2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TEST2 test2;</span><br><span class="line">    test1.a = <span class="number">1</span>;</span><br><span class="line">    test2.a = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d\n"</span>, test1.a, test2.a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715115648.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715115648.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_115639" style="zoom:80%;"><h3 id="2、C"><a href="#2、C" class="headerlink" title="2、C++"></a>2、C++</h3><p>对于C++，因为C++是面向对象的程序设计语言，结构体struct就相当于是C++的类class，只是默认继承访问权限不同，class默认的是private，strcut默认的是public。你甚至可以在结构体定义函数，这是在C语言里不允许的，并且C++也允许声明结构体变量时省略“struct”，这个在C语言里也不允许，除非使用typedef起别名。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:28:24</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:48:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span> <span class="title">test1</span>;</span></span><br><span class="line">    TEST test2;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; test1.a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    test2.hello();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715115111.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715115111.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_115102" style="zoom:80%;"><p>当然，C++也允许对类或者结构体起别名：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:28:24</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:58:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span> <span class="title">test1</span>;</span></span><br><span class="line">    TEST test2;</span><br><span class="line">    T test3;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; test1.a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    test2.hello();</span><br><span class="line">    test3.hello();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715120041.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715120041.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_120016" style="zoom:80%;"><p>直接在定义结构体的时候声明变量也可以：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:28:24</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 11:59:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; test3;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span> <span class="title">test1</span>;</span></span><br><span class="line">    TEST test2;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; test1.a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    test2.hello();</span><br><span class="line">    test3.hello();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715120047.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715120047.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_120029" style="zoom:80%;"><h2 id="二、关于C99新增的柔性数组"><a href="#二、关于C99新增的柔性数组" class="headerlink" title="二、关于C99新增的柔性数组"></a>二、关于C99新增的柔性数组</h2><p>在C99中，结构中的最后一个元素允许是未知大小的数组，这就叫做柔性数组成员，但结构中的柔性数组成员前面必须至少一个其他成员。柔性数组成员允许结构中包含一个大小可变的数组。sizeof返回的这种结构大小不包括柔性数组的内存。包含柔性数组成员的结构用malloc函数进行内存的动态分配，并且分配的内存应该大于结构的大小，以适应柔性数组的预期大小。</p><p>例如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 12:12:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b[];</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T test;</span><br><span class="line">    T *test_ptr;</span><br><span class="line">    test.a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d,%d,%d\n"</span>, test.a, <span class="keyword">sizeof</span>(T), <span class="keyword">sizeof</span>(test), <span class="keyword">sizeof</span>(*test_ptr));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715121026.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715121026.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_121020" style="zoom: 80%;"><p>我们可以发现，结构体的大小确实等于一个整型的大小4字节，也就是a的大小，b数组是没有占空间的。对于编译器来说，此时长度为0的数组并不占用空间，因为数组名本身不占空间，它只是一个偏移量，数组名这个符号本身代表了一个不可修改的地址常量 ，但对于这个数组的大小，我们可以进行动态分配。当我们对结构体指针test_ptr进行malloc分配内存空间，分配的空间减去sizeof(T)就是柔性数组b的空间，我们就可以对b操作了。其实，b就是柔性数组，或者叫动态数组。这个操作常用于缓冲区或者网络通信中构造不定长数据包。</p><p>例如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description:</span></span><br><span class="line"><span class="comment"> * @Version:</span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 12:20:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b[];</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T* test_ptr;</span><br><span class="line">    test_ptr = (T*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(T) + <span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    test_ptr-&gt;a = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(test_ptr-&gt;b, <span class="string">"aaaaaaaaa"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d,%s\n"</span>, <span class="keyword">sizeof</span>(*test_ptr), test_ptr-&gt;a, test_ptr-&gt;b);</span><br><span class="line">    <span class="built_in">free</span>(test_ptr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715122752.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715122752.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_122744" style="zoom:80%;"><p>可以发现T的大小依然是4字节，因此b明确来说不算是结构体成员。但是我们却可以使用长度为10的数组b。但为什么我只能复制9个a到数组b呢，其实9个a的字符串长度就是10，因为常量字符串最后一个字符是‘\0’，用于标志字符串而结束，因此实际上b[9]是‘\0’。那如果我们此时强制访问越界会怎么样呢？</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description:</span></span><br><span class="line"><span class="comment"> * @Version:</span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 12:20:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b[];</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T* test_ptr;</span><br><span class="line">    test_ptr = (T*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(T) + <span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    test_ptr-&gt;a = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(test_ptr-&gt;b, <span class="string">"aaaaaaaaabbbbbbbbbb"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d,%s\n"</span>, <span class="keyword">sizeof</span>(*test_ptr), test_ptr-&gt;a, test_ptr-&gt;b);</span><br><span class="line">    <span class="built_in">free</span>(test_ptr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715130032.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715130032.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_130000" style="zoom:80%;"><p>可以发现产生了异常，但是后面的b却被成功打印了出来。经过调试，发现是free语句产生的异常，如果我们把free语句注释掉，就能正常跑了，但是显然不应该这么做，原因是什么呢？</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description:</span></span><br><span class="line"><span class="comment"> * @Version:</span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-07-15 08:17:32</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-07-15 12:20:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TEST</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">char</span> b[];</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T* test_ptr;</span><br><span class="line">    test_ptr = (T*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(T) + <span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    test_ptr-&gt;a = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(test_ptr-&gt;b, <span class="string">"aaaaaaaaabbbbbbbbbb"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d,%d,%s\n"</span>, <span class="keyword">sizeof</span>(*test_ptr), test_ptr-&gt;a, test_ptr-&gt;b);</span><br><span class="line">    <span class="comment">// free(test_ptr);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200715130305.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715130305.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-07-15_130244" style="zoom:80%;"><p>其实，在动态分配的时候，会在数组界限外加一个用来标识数组范围的标志，例如b数组，就会在b[-1]和b[10]有两个标志，如果我们在这两个位置赋值，赋值和调用时并不会出错，而是在freed掉b申请的内存时出错，错误的名称就是“before Normal block”或“after Normal block”，一般是后者居多。</p><p>那么这个柔性数组相比与在结构体里的动态数组有什么优势呢？从上面的代码也能看出，如果使用普通的动态数组，需要分配两块内存，即动态数组的内存和结构体的内存，在释放时也要先释放b的内存，再释放test_ptr的内存，比较麻烦。但是柔性数组就完全不需要，直接申请结构体的内存即可，释放时也只需要释放结构体申请的内存，非常方便。</p><p>还有一点要说明的是：在C99之前是不支持灵活数组成员（Fleible Array Member，int a[]）的，C99把它作为一种特例加入了标准。但是，C99所支持的是Incomplete Type（int a[]），而不是Zero Array（int a[0]）。也就是说类似“int a[0];”这种形式是非法的，只不过有些编译器把“int a[0];”作为非标准扩展来支持，而且在C99发布之前已经有了这种非标准扩展了，C99发布之后，有些编译器把两者合而为一了而已。 </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单的写了一下关于C语言和C++中的Struct结构体的定义的疑惑点和C99新增的柔性数组的使用和理解。&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="拓展学习" scheme="https://666wxy666.github.io/categories/C-C/%E6%8B%93%E5%B1%95%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="C" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="难点" scheme="https://666wxy666.github.io/tags/%E9%9A%BE%E7%82%B9/"/>
    
      <category term="C99" scheme="https://666wxy666.github.io/tags/C99/"/>
    
      <category term="Struct" scheme="https://666wxy666.github.io/tags/Struct/"/>
    
  </entry>
  
  <entry>
    <title>C++工程项目 单词消除游戏</title>
    <link href="https://666wxy666.github.io/2020/07/12/C++%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE-%E5%8D%95%E8%AF%8D%E6%B6%88%E9%99%A4%E6%B8%B8%E6%88%8F/"/>
    <id>https://666wxy666.github.io/2020/07/12/C++%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE-%E5%8D%95%E8%AF%8D%E6%B6%88%E9%99%A4%E6%B8%B8%E6%88%8F/</id>
    <published>2020-07-11T16:00:00.000Z</published>
    <updated>2020-09-02T01:58:51.050Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是C++面向对象的程序设计实战项目，实现单词消除游戏，具体项目及要求请点击查看。</strong></p><a id="more"></a><h2 id="一、单词消除游戏总体要求"><a href="#一、单词消除游戏总体要求" class="headerlink" title="一、单词消除游戏总体要求"></a>一、单词消除游戏总体要求</h2><p>单词消除游戏由两类参与者组成：闯关者（即游戏玩家），出题者（为游戏增加游戏中使用单词）。游戏规则为，游戏每一轮，程序会根据该关卡难度，显示一个单词，一定时间后单词消失。闯关者需要在相应地方输入刚刚显示并消失的单词，如果闯关者输入正确（即闯关者输入的单词与刚刚显示的单词完全一致，包含大小写）则为通过。一关可以由一轮或者多轮组成。</p><h2 id="二、单词消除游戏具体要求"><a href="#二、单词消除游戏具体要求" class="headerlink" title="二、单词消除游戏具体要求"></a>二、单词消除游戏具体要求</h2><ol><li><p>Version1</p><ul><li>实现闯关者，出题者本地的注册、登录。</li><li>程序支持多人注册，同一时间只有一人可以登录。</li><li>实现游戏规则：出题者增加游戏中使用单词。游戏每一关，程序会根据该关卡难度，显示一个单词，一定时间后单词消失。闯关者需要在相应地方输入刚刚显示并消失的单词，如果闯关者输入正确则为通过。</li><li>任何角色均可查询所有闯关者、出题者，按照属性查找相应闯关者、出题者。</li><li>采用面向对象的方式，使用类设计。</li><li>在设计类时请注意类的继承关系，关注闯关者、出题者的关联（闯关者与出题者有共同的基类）。</li><li>使用文件或者数据库作为存储对象，自行设计文件格式，或者数据库表结构。</li></ul></li><li><p>Version2</p><p>在Version1的基础上增加：</p><ul><li>可以根据闯关者闯过关卡数、经验、等级等对闯关者排名，根据出题者出题数目、等级对出题者排名。</li><li>请根据要求设计每一关的出题方式，注意随着关卡数增加，题目难度增加</li><li>计闯关者经验值，等级增加策略。设计出题者等级升级策略。</li></ul></li><li><p>Version3</p><p>在Version2的基础上增加：</p><ul><li>使用socket进行通信，实现局域网通信游玩。</li><li>需要完成服务器端程序，以及客户端程序。客户端可以启动多个同时与服务器交互，要求服务器具有并发处理能力。</li><li>在题目的要求下自行扩展功能，功能扩展适当者酌情加分。</li></ul></li></ol><h2 id="三、运行环境"><a href="#三、运行环境" class="headerlink" title="三、运行环境"></a>三、运行环境</h2><p>电脑硬件配置：</p><ul><li><p>处理器：Intel i7 7700HQ</p></li><li><p>显卡：NVIDIA GeForce GTX 1050 Ti</p></li><li><p>内存：16GB</p></li></ul><p>编程语言：C++</p><p>QT：Qt Creator 4.11.1 Based on Qt 5.14.1 (MSVC 2017, 32 bit)</p><p>编译器：Desktop Qt 5.14.2 MinGW 7.3.0 64-bit</p><p>数据库：mysql Ver 8.0.20 for Win64 on x86_64 (MySQL Community Server - GPL)</p><p>其它说明：</p><ul><li><p>关于QT数据库驱动</p><ul><li><p>libmysql.dll和libqsqlmysql.a放入【…\Qt5.14.2\5.14.2\mingw73_64\bin】下。</p></li><li><p>qsqlmysql.dll和qsqlmysql.dll.debug放入【…\Qt5.14.2\5.14.2\mingw73_64\plugins\sqldrivers】下。</p></li></ul></li><li><p>数据库信息：</p><p>需要修改请自行修改代码，以下是默认用户名和密码。</p><ul><li>用户名：wxy</li><li>密码：123456</li></ul></li><li><p>由于QT的限制，编译构建时路径不允许有中文。</p></li><li><p>服务器默认IP地址是本地127.0.0.1，有需要请自行修改代码。</p></li></ul><h2 id="四、模块设计"><a href="#四、模块设计" class="headerlink" title="四、模块设计"></a>四、模块设计</h2><h3 id="1、游戏客户端"><a href="#1、游戏客户端" class="headerlink" title="1、游戏客户端"></a>1、游戏客户端</h3><h4 id="模块清单"><a href="#模块清单" class="headerlink" title="模块清单"></a>模块清单</h4><table><thead><tr><th>编号</th><th>模块名称</th><th>模块标识</th><th>模块功能</th></tr></thead><tbody><tr><td>1</td><td>主界面模块</td><td>Widget</td><td>主界面，包括登录等</td></tr><tr><td>2</td><td>用户类模块</td><td>User</td><td>闯关者，出题人类</td></tr><tr><td>3</td><td>注册模块</td><td>Register</td><td>注册用户</td></tr><tr><td>4</td><td>用户信息模块</td><td>Info</td><td>展示用户信息，包括等级、经验等</td></tr><tr><td>5</td><td>游戏模块</td><td>Game</td><td>单词消除游戏游玩界面</td></tr><tr><td>6</td><td>出题模块</td><td>Create</td><td>出题人出题界面</td></tr><tr><td>7</td><td>查询模块</td><td>Check</td><td>查询用户，排名界面</td></tr></tbody></table><h4 id="用户界面"><a href="#用户界面" class="headerlink" title="用户界面"></a>用户界面</h4><h5 id="1、主界面"><a href="#1、主界面" class="headerlink" title="1、主界面"></a>1、主界面</h5><img src="https://gitee.com/wxy_666/images/raw/master/20200715102903.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715102903.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><h5 id="2、注册界面"><a href="#2、注册界面" class="headerlink" title="2、注册界面"></a>2、注册界面</h5><img src="https://gitee.com/wxy_666/images/raw/master/20200715103047.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103047.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2" style="zoom:80%;"><h5 id="3、用户信息界面（出题人与闯关者文字略有不同）"><a href="#3、用户信息界面（出题人与闯关者文字略有不同）" class="headerlink" title="3、用户信息界面（出题人与闯关者文字略有不同）"></a>3、用户信息界面（出题人与闯关者文字略有不同）</h5><img src="https://gitee.com/wxy_666/images/raw/master/20200715103058.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103058.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3" style="zoom:80%;"><h5 id="4、游戏界面"><a href="#4、游戏界面" class="headerlink" title="4、游戏界面"></a>4、游戏界面</h5><img src="https://gitee.com/wxy_666/images/raw/master/20200715103347.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103347.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4" style="zoom:80%;"><h5 id="5、出题界面"><a href="#5、出题界面" class="headerlink" title="5、出题界面"></a>5、出题界面</h5><ul><li><p>Version2：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200715103355.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103355.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5" style="zoom:80%;"></li><li><p>Version3：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200715103405.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103405.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6" style="zoom:80%;"></li></ul><h5 id="6、查询界面"><a href="#6、查询界面" class="headerlink" title="6、查询界面"></a>6、查询界面</h5><img src="https://gitee.com/wxy_666/images/raw/master/20200715103416.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715103416.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7" style="zoom:80%;"><h4 id="函数具体功能"><a href="#函数具体功能" class="headerlink" title="函数具体功能"></a>函数具体功能</h4><h5 id="1、Widget"><a href="#1、Widget" class="headerlink" title="1、Widget"></a>1、Widget</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">user_registe_show</span><span class="params">()</span></span>;<span class="comment">//显示闯关者注册界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">creater_registe_show</span><span class="params">()</span></span>;<span class="comment">//显示出题人注册界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_user_show</span><span class="params">()</span></span>;<span class="comment">//显示查询闯关者界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_creater_show</span><span class="params">()</span></span>;<span class="comment">//显示查询出题人界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">info_show</span><span class="params">()</span></span>;<span class="comment">//显示用户信息界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_close</span><span class="params">()</span></span>;<span class="comment">//关闭查询界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">registe_close</span><span class="params">()</span></span>;<span class="comment">//关闭注册界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">info_close</span><span class="params">()</span></span>;<span class="comment">//关闭用户信息界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">type_changed</span><span class="params">()</span></span>;<span class="comment">//闯关者，出题人切换</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_database</span><span class="params">()</span></span>;<span class="comment">//初始化数据库</span></span><br></pre></td></tr></table></figure><h5 id="2、user"><a href="#2、user" class="headerlink" title="2、user"></a>2、user</h5><p>player和creater继承于user类，升级函数采用虚函数，分别在各自类中实现。</p><h5 id="3、register"><a href="#3、register" class="headerlink" title="3、register"></a>3、register</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_change_signal</span><span class="params">()</span></span>;<span class="comment">//改变界面信号</span></span><br></pre></td></tr></table></figure><h5 id="4、info"><a href="#4、info" class="headerlink" title="4、info"></a>4、info</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_change_signal</span><span class="params">()</span></span>;<span class="comment">//改变界面信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">game_show</span><span class="params">()</span></span>;<span class="comment">//游戏界面显示</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">game_close</span><span class="params">()</span></span>;<span class="comment">//游戏界面关闭</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create_show</span><span class="params">()</span></span>;<span class="comment">//出题界面显示    </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create_close</span><span class="params">()</span></span>;<span class="comment">//出题界面关闭</span></span><br></pre></td></tr></table></figure><h5 id="5、game"><a href="#5、game" class="headerlink" title="5、game"></a>5、game</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_change_signal</span><span class="params">()</span></span>;<span class="comment">//改变界面信</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_timer</span><span class="params">()</span></span>;<span class="comment">//计时器初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_ms_timer</span><span class="params">()</span></span>;<span class="comment">//计时器初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">timeup</span><span class="params">()</span></span>;<span class="comment">//超时</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ms_timeup</span><span class="params">()</span></span>;<span class="comment">//超时</span></span><br></pre></td></tr></table></figure><h5 id="6、create"><a href="#6、create" class="headerlink" title="6、create"></a>6、create</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_change_signal</span><span class="params">()</span></span>;<span class="comment">//改变界面信号</span></span><br></pre></td></tr></table></figure><h5 id="6、check"><a href="#6、check" class="headerlink" title="6、check"></a>6、check</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect_event</span><span class="params">()</span></span>;<span class="comment">//信号，槽函数链接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//显示界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close_Widget</span><span class="params">()</span></span>;<span class="comment">//关闭界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_change_signal</span><span class="params">()</span></span>;<span class="comment">//改变界面信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">()</span></span>;<span class="comment">//搜索信息</span></span><br></pre></td></tr></table></figure><h3 id="2、服务器端"><a href="#2、服务器端" class="headerlink" title="2、服务器端"></a>2、服务器端</h3><h4 id="模块清单-1"><a href="#模块清单-1" class="headerlink" title="模块清单"></a>模块清单</h4><table><thead><tr><th>编号</th><th>模块名称</th><th>模块标识</th><th>模块功能</th></tr></thead><tbody><tr><td>1</td><td>主界面模块</td><td>Widget</td><td>主界面</td></tr><tr><td>2</td><td>线程模块</td><td>My_thread</td><td>实现多线程</td></tr></tbody></table><h4 id="用户界面-1"><a href="#用户界面-1" class="headerlink" title="用户界面"></a>用户界面</h4><img src="https://gitee.com/wxy_666/images/raw/master/20200715104043.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200715104043.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="8" style="zoom:80%;"><h4 id="函数具体功能-1"><a href="#函数具体功能-1" class="headerlink" title="函数具体功能"></a>函数具体功能</h4><h5 id="1、Widget-1"><a href="#1、Widget-1" class="headerlink" title="1、Widget"></a>1、Widget</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_UI</span><span class="params">()</span></span>;<span class="comment">//初始化图形界面</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tcpserver_connect</span><span class="params">()</span></span>;<span class="comment">//tcpserver连接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tcpsocket_connect</span><span class="params">()</span></span>;<span class="comment">//tcpsocket连接</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showEvent</span><span class="params">(QShowEvent *)</span></span>;<span class="comment">//界面显示</span></span><br></pre></td></tr></table></figure><h5 id="2、My-thread"><a href="#2、My-thread" class="headerlink" title="2、My_thread"></a>2、My_thread</h5><p>当收到客户端的请求后，根据客户端发送的字符串判断是什么请求，在屏幕上输出，同时新建线程，在线程中处理这些请求，从而实现并发处理。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_database</span><span class="params">()</span></span>;<span class="comment">//初始化数据库</span></span><br></pre></td></tr></table></figure><h2 id="五、项目地址"><a href="#五、项目地址" class="headerlink" title="五、项目地址"></a>五、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/WordGame" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=WordGame&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=WordGame&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是C++面向对象的程序设计实战项目，实现单词消除游戏，具体项目及要求请点击查看。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="C/C++" scheme="https://666wxy666.github.io/categories/C-C/"/>
    
      <category term="项目" scheme="https://666wxy666.github.io/categories/C-C/%E9%A1%B9%E7%9B%AE/"/>
    
    
      <category term="C++" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="工程" scheme="https://666wxy666.github.io/tags/%E5%B7%A5%E7%A8%8B/"/>
    
      <category term="QT" scheme="https://666wxy666.github.io/tags/QT/"/>
    
      <category term="小游戏" scheme="https://666wxy666.github.io/tags/%E5%B0%8F%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
  <entry>
    <title>Python 爬虫小Demo 学堂在线课程</title>
    <link href="https://666wxy666.github.io/2020/07/05/Python-%E7%88%AC%E8%99%AB%E5%B0%8FDemo-%E5%AD%A6%E5%A0%82%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B/"/>
    <id>https://666wxy666.github.io/2020/07/05/Python-%E7%88%AC%E8%99%AB%E5%B0%8FDemo-%E5%AD%A6%E5%A0%82%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B/</id>
    <published>2020-07-04T16:00:00.000Z</published>
    <updated>2020-09-02T02:02:06.495Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是关于Python中的Spider的小Demo，通过Python的scrapy爬取学堂在线课程的相关数据。</strong></p><a id="more"></a><h2 id="一、编译环境："><a href="#一、编译环境：" class="headerlink" title="一、编译环境："></a>一、编译环境：</h2><p>PyCharm 2019.3.4 (Professional Edition)</p><p>Build #PY-193.6911.25, built on March 18, 2020</p><p>Runtime version: 11.0.6+8-b520.43 amd64</p><p>VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o</p><p>Windows 10 10.0</p><p>GC: ParNew, ConcurrentMarkSweep</p><p>Memory: 725M</p><p>Cores: 8</p><p>Registry: ide.balloon.shadow.size=0</p><p>Non-Bundled Plugins: </p><p>GrepConsole,Statistic,cn.yiiguxing.plugin.translate,com.chrisrm.idea.MaterialThemeUI,com.notime.intellijPlugin.backgroundImagePlus,com.wakatime.intellij.plugin,izhangzhihao.rainbow.brackets,mobi.hsz.idea.gitignore, net.vektah.codeglance, org.intellij.gitee</p><p>Python Version：3.7（Anaconda3）</p><p>Package：</p><p>scrapy==2.0.1</p><h2 id="二、详细步骤"><a href="#二、详细步骤" class="headerlink" title="二、详细步骤"></a>二、详细步骤</h2><h3 id="①准备工作"><a href="#①准备工作" class="headerlink" title="①准备工作"></a>①准备工作</h3><ol><li>在Pycharm中新建一个Pure Python项目（记得要按照一中的要求配好Python环境）。</li></ol><img src="https://gitee.com/wxy_666/images/raw/master/20200407214757.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200407214757.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-07_214715" style="zoom:67%;"><ol start="2"><li>打开Pycharm的下方的终端（Terminal），当然这些也可以在系统终端里操作，不过可能需要的步骤多一些，还是直接在Pycharm里方便一些。</li></ol><p><img src="https://gitee.com/wxy_666/images/raw/master/20200408164806.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408164806.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_164744"></p><ol start="3"><li><p>在终端里输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject myScrapy</span><br></pre></td></tr></table></figure><p>本来是可以在我们刚刚创建的项目里新建一个名为“myScrapy”的scrapy项目的，但是不知道为什么竟然报错了：</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200408190345.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408190345.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_190330"></p><p>这是什么奇奇怪怪的错误，我都没有“d:\bld\scrapy_1584555997548_h_env\python.exe”这个目录，经过查找相关问题的资料，问题可能是出在Python环境上，因为我上一次新建项目时并没有报错，这一次我直接用的上一个项目的环境，网上还有一种说法是Scrapy的bug，详见</p><p><a href="https://github.com/scrapy/scrapy/issues/4289" target="_blank" rel="external nofollow noopener noreferrer">Fatal error launching scrapy&gt;1.6.0 from Anaconda Prompt</a></p><p><a href="https://github.com/conda-forge/scrapy-feedstock/issues/37" target="_blank" rel="external nofollow noopener noreferrer">Issue with conda-forge scrapy&gt;1.6.0 on Windows</a></p><p>目前找到了两种解决方案：</p><ol><li><p>把python环境复制到报错的那个目录（d:\bld\scrapy_1584555997548_h_env\python.exe），然后在创建scrapy项目，但这个解决方法有点愚蠢，就没有采用。</p></li><li><p>在scrapy命令前面添加“python -m”选项：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m scrapy startproject myScrapy</span><br></pre></td></tr></table></figure><p>就可以正常创建了。</p><p>关于Python的-m选项，官方给出的解释是“run library module as a script”，简单来说就是将库中的Python模块当作脚本去运行。</p><p>特别感谢简书的大佬<a href="https://www.jianshu.com/p/323fc9a1d7d2" target="_blank" rel="external nofollow noopener noreferrer">ccw1078</a>提供的解释，很清晰明了，有兴趣的可以去瞅一下，因为和本文的主题爬虫没啥关系，在这里就不赘述了。</p></li></ol></li></ol><ol start="4"><li><p>出现这些提示就代表创建成功了。</p><p> <img src="https://gitee.com/wxy_666/images/raw/master/20200408192211.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408192211.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_192151"></p><p> 然后在spiders文件里新建一个spider.py文件，用于写爬虫。</p></li><li><p>我们来看一下目前scrapy项目的目录结构。</p> <img src="https://gitee.com/wxy_666/images/raw/master/20200408203358.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408203358.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_203310" style="zoom: 67%;"><p> __init__.py：pycharm生成的文件，简化导入语句用的，可以忽略，没啥用，建议删了，留着可能会出问题。</p><p> spiders：存放你Spider爬虫源文件</p><p> ​        spider.py：代码主要在这里写。</p><p> items.py：数据容器。</p><p> middlewares.py：Downloader Middlewares(下载器中间件)和Spider Middlewares(蜘蛛中间件)实现的地方。</p><p> pipelines.py：项目管道文件，相当于数据中转站。实现数据的清洗，储存，验证。</p><p> settings.py：scrapy的全局配置。</p><p> scrapy.cfg：配置文件。</p><p> scrapy已经帮我们把大体框架写好了，我们主要要修改的文件是spider.py，items.py，pipelines.py，settings.py。</p></li><li><p>这是爬虫spider的基本工作方式，想要深入了解的可以去网上查找资料。</p></li></ol><img src="https://gitee.com/wxy_666/images/raw/master/20200408201638.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408201638.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="scrapy" style="zoom: 33%;"><h3 id="②开始写代码"><a href="#②开始写代码" class="headerlink" title="②开始写代码"></a>②开始写代码</h3><ol><li><p>先来写items.py。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyscrapyItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    school = scrapy.Field()</span><br><span class="line">    num = scrapy.Field()</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p>再来搞settings.py，这个只需要找到这个注释掉的语句，把#去掉就OK了，就像这样：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408210722.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408210722.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_210710" style="zoom: 67%;"></li><li><p>pipelines.py就很好写了，基本可以当模板来用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyscrapyPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 这个就是爬虫生成的文件，可以支持好多种格式，这里使用的是json文件</span></span><br><span class="line">            self.file = open(<span class="string">'MyData.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            print(err)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        dict_item = dict(item)</span><br><span class="line">        json_str = json.dumps(dict_item, ensure_ascii=<span class="literal">False</span>) + <span class="string">"\n"</span></span><br><span class="line">        self.file.write(json_str)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure></li><li><p>spider.py是我们主要写的核心部分。这里需要一些html的xpath相关知识来对项进行定位，可以自行查找相关资料。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: xuetangzaixian</span></span><br><span class="line"><span class="string">@Description: </span></span><br><span class="line"><span class="string">@Version: </span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-04-08 20:31</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-04-08 20:31</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> myScrapy.myScrapy.items <span class="keyword">import</span> MyscrapyItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mySpider</span><span class="params">(scrapy.spiders.Spider)</span>:</span></span><br><span class="line">    <span class="comment"># spider的名字</span></span><br><span class="line">    name = <span class="string">"xuetang"</span></span><br><span class="line">    <span class="comment"># 限制spider爬取的域名</span></span><br><span class="line">    allowed_domains = [<span class="string">"www.xuetangx.com/"</span>]</span><br><span class="line"><span class="comment"># 爬虫要爬取的网页，是一个列表，按顺序爬取</span></span><br><span class="line">    start_urls = [<span class="string">"http://www.xuetangx.com/partners"</span>]</span><br><span class="line"><span class="comment"># 这是一种方式，可以爬取网页中所有的项</span></span><br><span class="line">    <span class="comment"># def parse(self, response):</span></span><br><span class="line">    <span class="comment">#     item = MyscrapyItem()</span></span><br><span class="line">    <span class="comment">#     for each in response.xpath("/html/body/article[1]/section/ul/*"):</span></span><br><span class="line">    <span class="comment">#         item['school'] = each.xpath("a/div[2]/h3/text()").extract()</span></span><br><span class="line">    <span class="comment">#         item['num'] = each.xpath("a/div[2]/p[1]/text()").extract()</span></span><br><span class="line">    <span class="comment">#         if item['num']:</span></span><br><span class="line">    <span class="comment">#             item['num'] = re.findall(r'\d+', item['num'][0])</span></span><br><span class="line">    <span class="comment">#         if item['school'] and item['num']:</span></span><br><span class="line">    <span class="comment">#             yield (item)</span></span><br><span class="line">    <span class="comment"># 这是第二种方式，使用for循环，制定爬取项的数目</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        item = MyscrapyItem()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">144</span>):</span><br><span class="line">            item[<span class="string">'school'</span>] = response.xpath \</span><br><span class="line">                (<span class="string">"/html/body/article[1]/section/ul/li[&#123;&#125;]/a/div[2]/h3/text()"</span>.format(i)).extract()</span><br><span class="line">            item[<span class="string">'num'</span>] = response.xpath \</span><br><span class="line">                (<span class="string">"/html/body/article[1]/section/ul/li[&#123;&#125;]/a/div[2]/p[1]/text()"</span>.format(i)).extract()</span><br><span class="line">            <span class="comment"># 判断爬取的项目是否为空，把非空的项目提交</span></span><br><span class="line">            <span class="keyword">if</span> item[<span class="string">'school'</span>] <span class="keyword">and</span> item[<span class="string">'num'</span>]:</span><br><span class="line">                <span class="keyword">yield</span> (item)</span><br></pre></td></tr></table></figure></li></ol><h3 id="③可以开始运行啦"><a href="#③可以开始运行啦" class="headerlink" title="③可以开始运行啦"></a>③可以开始运行啦</h3><ol><li><p>在运行前要先在项目根目录下建立一个begin.py文件来控制scrapy爬虫的运行。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408212615.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408212615.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_212604" style="zoom: 80%;"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"><span class="comment"># "xuetang"是我们上面spider.py中定义的爬虫名</span></span><br><span class="line">cmdline.execute(<span class="string">"scrapy crawl xuetang"</span>.split())</span><br></pre></td></tr></table></figure></li><li><p>最终的项目结构（__init__.py没啥用，删了）：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408212844.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408212844.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_212834" style="zoom:67%;"></li><li><p>运行begin.py就可以开始爬虫了。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408212955.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408212955.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_212946" style="zoom:67%;"><p>出现这些提示就表示成功了，运行完毕后会发现项目根目录出现了我们在pipelines.py中设置好的MyData.json。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408222346.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408222346.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_222333" style="zoom:67%;"></li><li><p>打开MyData.json看一下，Perfect！</p><img src="https://gitee.com/wxy_666/images/raw/master/20200408222427.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200408222427.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-08_222417" style="zoom:67%;"><p>有了这个json文件，我们就可以利用Python的pandas、numpy等工具进行各种处理，然后用matplotlib等模块进行画图了。</p></li></ol><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>本文只是对Python的scrapy爬虫进行了简单的介绍和用一个小Demo讲述了如何使用scrapy爬取网页数据，希望对你有所帮助。</p><h2 id="四、项目地址"><a href="#四、项目地址" class="headerlink" title="四、项目地址"></a>四、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/xuetangzaixian" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=xuetangzaixian&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=xuetangzaixian&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是关于Python中的Spider的小Demo，通过Python的scrapy爬取学堂在线课程的相关数据。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/categories/Python/"/>
    
      <category term="爬虫" scheme="https://666wxy666.github.io/categories/Python/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="爬虫" scheme="https://666wxy666.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="数据处理" scheme="https://666wxy666.github.io/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/"/>
    
      <category term="学堂在线" scheme="https://666wxy666.github.io/tags/%E5%AD%A6%E5%A0%82%E5%9C%A8%E7%BA%BF/"/>
    
      <category term="课程" scheme="https://666wxy666.github.io/tags/%E8%AF%BE%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 RNN 为baby起名字</title>
    <link href="https://666wxy666.github.io/2020/07/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-RNN-%E4%B8%BAbaby%E8%B5%B7%E5%90%8D%E5%AD%97/"/>
    <id>https://666wxy666.github.io/2020/07/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-RNN-%E4%B8%BAbaby%E8%B5%B7%E5%90%8D%E5%AD%97/</id>
    <published>2020-07-02T16:00:00.000Z</published>
    <updated>2020-09-02T02:07:10.419Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典RNN的应用为baby起名字的代码实现。</p><a id="more"></a><h2 id="一、任务定义"><a href="#一、任务定义" class="headerlink" title="一、任务定义"></a>一、任务定义</h2><p><strong>采用 RNN 为小 Baby 起个英文名字吧</strong></p><p>神经网络语言模型，即通过神经网络，计算一项自然语言（例如一条句子）的出现概率，或者根据上文中的词推断句子中某个词的出现概率。例如，下图采用了一个具有一个输入层、一个隐藏层和一个输出层的 MLP 网络，建模三元文法模型：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605202820.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605202820.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200605202820810" style="zoom:80%;"><p>本作业提供了8000多个英文名字，试训练一个环神经网络语言模型，进而给定若干个开始字母，由语言模型自动生成后续的字母，直到生成一个名字的结束符。从模型生成的名字中，挑选你最喜欢的一个，并采用一种可视化技术，绘制出模型为每个时刻预测的前5个最可能的候选字母。</p><p>事实上，你也可以给定结尾的若干个字母，或者随意给出中间的若干个字母，让 RNN  补全其它字母，从而得到一个完整的名字。因此，你也可以尝试设计并实现一个这样的 RNN 模型，从模型生成的名字中，挑选你最喜欢的一个，并采用可视化技术，绘制出模型为每个时刻预测的前5个最可能的候选字母。</p><h2 id="二、输入输出"><a href="#二、输入输出" class="headerlink" title="二、输入输出"></a>二、输入输出</h2><h3 id="1、输入"><a href="#1、输入" class="headerlink" title="1、输入"></a>1、输入</h3><ul><li><p>male和female数据集作为训练集。</p><p><strong><em>【PS】注意，两个数据集的格式必须是一行一个英文名字，不能有其他文字说明，在使用前请先将male.txt和female.txt中的文字说明删除，例如：</em></strong></p><img src="https://gitee.com/wxy_666/images/raw/master/20200605203846.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605203846.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_203831" style="zoom:80%;"></li><li><p>超参数总迭代次数，打印精度（每隔多少次迭代打印一次损失日志），绘图精度（每隔多少次迭代求和取平均作为一个数据点）。</p></li><li><p>（类别，姓名的起始字母）对。</p></li></ul><h3 id="2、输出"><a href="#2、输出" class="headerlink" title="2、输出"></a>2、输出</h3><ul><li>RNN神经网络模型。</li><li>该模型的损失等日志信息。</li><li>该模型的损失-(迭代次数/画图精度)函数图像。</li><li>根据这个神经网络模型和输入的（类别，姓名的起始字母）对生成的姓名。</li></ul><h2 id="三、实验环境"><a href="#三、实验环境" class="headerlink" title="三、实验环境"></a>三、实验环境</h2><p>硬件：</p><ul><li>处理器：Intel i7 7700HQ</li><li>显卡：NVIDIA GeForce GTX 1050 Ti</li><li>内存：16GB</li></ul><p>软件：</p><ul><li><p>编程语言：</p><p>Python 3.7（Anaconda3）</p></li><li><p>模块：</p><ul><li>pytorch 1.5</li><li>numpy 1.18.1</li><li>matplotlib 3.1.3</li></ul></li><li><p>编译器：</p><p>PyCharm 2020.1.1 (Professional Edition)<br>Build #PY-201.7223.92, built on April 30, 2020<br>For educational use only.<br>Runtime version: 11.0.6+8-b765.40 amd64<br>VM: OpenJDK 64-Bit Server VM by JetBrains s.r.o<br>Windows 10 10.0<br>GC: ParNew, ConcurrentMarkSweep<br>Memory: 725M<br>Cores: 8<br>Registry: ide.balloon.shadow.size=0<br>Non-Bundled Plugins: com.dubreuia, GrepConsole, Statistic, com.chrisrm.idea.MaterialThemeUI, org.intellij.gitee, com.mallowigi, com.wakatime.intellij.plugin, mobi.hsz.idea.gitignore, net.vektah.codeglance, tanvd.grazi, com.jetbrains.intellij.datalore, izhangzhihao.rainbow.brackets, cn.yiiguxing.plugin.translate, org.nik.presentation-assistant</p></li></ul><h2 id="四、方法描述"><a href="#四、方法描述" class="headerlink" title="四、方法描述"></a>四、方法描述</h2><h4 id="1、数据集处理"><a href="#1、数据集处理" class="headerlink" title="1、数据集处理"></a>1、数据集处理</h4><p>对老师的male.txt和female.txt数据集进行处理，保证每行只能由一个姓名，不得出现其他类似下图的说明信息。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605210431.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605210431.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p>我们将行分割成数组, 并把 Unicode 转换成 ASCII 编码, 最后放进一个字典里 <code>{language: [names ...]}</code></p><h4 id="2、创建网络"><a href="#2、创建网络" class="headerlink" title="2、创建网络"></a>2、创建网络</h4><p>输出设定为下一个字母的概率，采样测试的时候，概率最大的输出字母被当做下一个输入。</p><p>输出层采用softmax函数，为了让网络更加有效工作，添加了第二个线性层o2o（在合并了隐藏层和输出层的后面）。还有一个 Dropout 层，使输入的部分值以给定的概率值随机的变成 0（这里概率取0.1）, 为了模糊输入以防止过拟合，在网络的最末端使用它，从而故意添加一些混乱和增加采样的多样化。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605213206.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605213206.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_213141" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200605213119.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605213119.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="28a4f1426695fb55f1f6bc86278f6547" style="zoom:80%;"><h4 id="3、训练前的准备"><a href="#3、训练前的准备" class="headerlink" title="3、训练前的准备"></a>3、训练前的准备</h4><p>首先读取文件，产生随机的（类别，文件行[也就是姓名]）对。对每一个时间点（也就是说在训练集中词的每个字母）网络的输入是（类别，当前字母，隐藏层状态），输出是（下一个字母，下一个隐藏层状态）。</p><p>因为在每一步，我们从当前的字母预测下一个字母，这样的字母对是在原有行中连续字母的集合，例如：</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200605210640.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605210640.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>类别张量是一个大小为$1\times{categories}$的one-hot tensor张量，在训练的每一个时间点把它提供给网络。</p><h4 id="4、开始训练"><a href="#4、开始训练" class="headerlink" title="4、开始训练"></a>4、开始训练</h4><p>使用自动求导（autograd）辅助计算损失。循环调用train，每隔一段时间打印损失等Log，直到到达规定输入的迭代次数。在训练完成后绘制损失-(迭代次数/画图精度)函数图像折线图，用于性能评估分析。</p><h4 id="5、测试采样"><a href="#5、测试采样" class="headerlink" title="5、测试采样"></a>5、测试采样</h4><p>输入（类别，姓名起始字母）对，返回生成的姓名。</p><h2 id="五、结果分析与性能评价"><a href="#五、结果分析与性能评价" class="headerlink" title="五、结果分析与性能评价"></a>五、结果分析与性能评价</h2><p><strong>PS: []中的为每一次迭代的最可能的字母前五，如果为空，就是已经到达迭代终点。</strong></p><p>下面是100000次迭代的测试采样结果，可以发现生成的姓名非常好，完全符合日常的姓名样式，RNN神经网络性能很好。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151627.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151627.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151534" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200612151702.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151702.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151553" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200612151715.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151715.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151606" style="zoom:80%;"><p>100次的因为迭代次数太少，网络非常不好，完全不能生成所需的姓名：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151824.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151824.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151807" style="zoom:80%;"><p>1000次还算可以接受：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612151959.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612151959.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_151926" style="zoom:80%;"><p>如果是10000次迭代，基本能满足生成姓名的要求:</p><img src="https://gitee.com/wxy_666/images/raw/master/20200612152344.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200612152344.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-12_152300" style="zoom:80%;"><p>观察并对比不同迭代次数的损失-(迭代次数/画图精度)函数折线图可以看出迭代次数越多损失越小，性能越好，且一开始损失下降较快，当迭代次数大到一定程度后，损失下降较慢。</p><table><thead><tr><th align="center">100次</th><th align="center">1000次</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215413.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215413.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215151" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215423.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215423.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215250" style="zoom:80%;"></td></tr><tr><td align="center"><strong>10000次</strong></td><td align="center"><strong>100000次</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215931.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215931.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215459" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605214735.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605214735.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_202039" style="zoom:80%;"></td></tr></tbody></table><p>查看并对比不同迭代次数的损失日志输出，很明显能发现最大的区别就是训练时间。可以看出迭代次数越多花费时间越多，所需的电脑性能显然也需要更高，100次和1000次由于网络不好，可以先排除在外。100000次迭代的所需时间是10min左右，而10000次迭代所需的时间为1min左右，相差10倍，如果迭代次数更多，可能相差更多，因此选择合适的迭代次数很重要，避免不必要的性能时间浪费。</p><table><thead><tr><th align="center">100次</th><th align="center">1000次</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605220024.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605220024.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215139" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605220009.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605220009.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215232" style="zoom:80%;"></td></tr><tr><td align="center"><strong>10000次</strong></td><td align="center"><strong>100000次</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605215950.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605215950.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_215450" style="zoom:80%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200605214944.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605214944.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-05_202109" style="zoom:80%;"></td></tr></tbody></table><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/RNN-name" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=RNN-name&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=RNN-name&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a><h2 id="七、附录"><a href="#七、附录" class="headerlink" title="七、附录"></a>七、附录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: rnn-name</span></span><br><span class="line"><span class="string">@Description: 用RNN网络为baby起名字</span></span><br><span class="line"><span class="string">@Version: 1.0</span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-06-05 17:13</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-05 17:13</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals, print_function, division</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> open</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 全局参数</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line">all_letters = string.ascii_letters + <span class="string">" .,;'-"</span></span><br><span class="line">n_letters = len(all_letters) + <span class="number">1</span></span><br><span class="line">criterion = nn.NLLLoss()</span><br><span class="line">learning_rate = <span class="number">0.0005</span>  <span class="comment"># 学习率</span></span><br><span class="line">max_length = <span class="number">20</span></span><br><span class="line">path = <span class="string">"data/names/*.txt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 数据集操作</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 将Unicode转为ASCII</span></span><br><span class="line"><span class="comment"># https://stackoverflow.com/a/518232/2809427</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Unicode_to_ASCII</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(</span><br><span class="line">        c <span class="keyword">for</span> c <span class="keyword">in</span> unicodedata.normalize(<span class="string">'NFD'</span>, s)</span><br><span class="line">        <span class="keyword">if</span> unicodedata.category(c) != <span class="string">'Mn'</span></span><br><span class="line">        <span class="keyword">and</span> c <span class="keyword">in</span> all_letters</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将行分割成数组, 并把 Unicode 转换成 ASCII 编码, 最后放进一个字典里 &#123;category: [names ...]&#125;</span></span><br><span class="line">category_lines = &#123;&#125;</span><br><span class="line">all_categories = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> glob.glob(path):</span><br><span class="line">    category = os.path.splitext(os.path.basename(file_name))[<span class="number">0</span>]</span><br><span class="line">    all_categories.append(category)</span><br><span class="line">    line_list = open(file_name, encoding=<span class="string">'utf-8'</span>).read().strip().split(<span class="string">'\n'</span>)</span><br><span class="line">    lines = [Unicode_to_ASCII(line) <span class="keyword">for</span> line <span class="keyword">in</span> line_list]</span><br><span class="line">    category_lines[category] = lines</span><br><span class="line"></span><br><span class="line">category_num = len(all_categories)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> category_num == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">"未找到数据集！"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"数据集类别："</span>, category_num, all_categories)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 构建RNN网络</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_size, hidden_size, output_size)</span>:</span></span><br><span class="line">        super(RNN, self).__init__()</span><br><span class="line">        self.hidden_size = hidden_size</span><br><span class="line"></span><br><span class="line">        self.i2h = nn.Linear(category_num + input_size + hidden_size, hidden_size)</span><br><span class="line">        self.i2o = nn.Linear(category_num + input_size + hidden_size, output_size)</span><br><span class="line">        self.o2o = nn.Linear(hidden_size + output_size, output_size)</span><br><span class="line">        self.dropout = nn.Dropout(<span class="number">0.1</span>)</span><br><span class="line">        self.softmax = nn.LogSoftmax(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, category, input, hidden)</span>:</span></span><br><span class="line">        input_combined = torch.cat((category, input, hidden), <span class="number">1</span>)</span><br><span class="line">        hidden = self.i2h(input_combined)</span><br><span class="line">        output = self.i2o(input_combined)</span><br><span class="line">        output_combined = torch.cat((hidden, output), <span class="number">1</span>)</span><br><span class="line">        output = self.o2o(output_combined)</span><br><span class="line">        output = self.dropout(output)</span><br><span class="line">        output = self.softmax(output)</span><br><span class="line">        <span class="keyword">return</span> output, hidden</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> torch.zeros(<span class="number">1</span>, self.hidden_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 训练前的准备</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 输入串从第一个字母到最后一个字母（不包括 EOS ）的 one-hot 矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_input_tensor</span><span class="params">(letters)</span>:</span></span><br><span class="line">    tensor = torch.zeros(len(letters), <span class="number">1</span>, n_letters)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(letters)):</span><br><span class="line">        letter = letters[i]</span><br><span class="line">        tensor[i][<span class="number">0</span>][all_letters.find(letter)] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标的第k个字母到结尾（EOS）的 LongTensor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_target_Tensor</span><span class="params">(letters)</span>:</span></span><br><span class="line">    letter_indexes = [all_letters.find(letters[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(letters))]</span><br><span class="line">    letter_indexes.append(n_letters - <span class="number">1</span>)  <span class="comment"># EOS</span></span><br><span class="line">    <span class="keyword">return</span> torch.LongTensor(letter_indexes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类别的One-hot向量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_category_tensor</span><span class="params">(category)</span>:</span></span><br><span class="line">    i = all_categories.index(category)</span><br><span class="line">    tensor = torch.zeros(<span class="number">1</span>, category_num)</span><br><span class="line">    tensor[<span class="number">0</span>][i] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用辅助函数从数据集中获取随机的category和line</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_pair</span><span class="params">()</span>:</span></span><br><span class="line">    category = all_categories[random.randint(<span class="number">0</span>, len(all_categories) - <span class="number">1</span>)]</span><br><span class="line">    line = category_lines[category][random.randint(<span class="number">0</span>, len(category_lines[category]) - <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> category, line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从随机的（category, line）对中生成 category, input, 和 target Tensor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomTrainingExample</span><span class="params">()</span>:</span></span><br><span class="line">    category, line = random_pair()</span><br><span class="line">    category_tensor = generate_category_tensor(category)</span><br><span class="line">    input_tensor = generate_input_tensor(line)</span><br><span class="line">    target_tensor = generate_target_Tensor(line)</span><br><span class="line">    <span class="keyword">return</span> category_tensor, input_tensor, target_tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 训练RNN网络</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(category_tensor, input_tensor, target_tensor)</span>:</span></span><br><span class="line">    target_tensor.unsqueeze_(<span class="number">-1</span>)</span><br><span class="line">    hidden = rnn.init_hidden()</span><br><span class="line"></span><br><span class="line">    rnn.zero_grad()</span><br><span class="line"></span><br><span class="line">    loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(input_tensor.size(<span class="number">0</span>)):</span><br><span class="line">        output, hidden = rnn(category_tensor, input_tensor[i], hidden)</span><br><span class="line">        l = criterion(output, target_tensor[i])</span><br><span class="line">        loss += l</span><br><span class="line"></span><br><span class="line">    loss.backward()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> rnn.parameters():</span><br><span class="line">        p.data.add_(p.grad.data, alpha=-learning_rate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output, loss.item() / input_tensor.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 秒转时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_format</span><span class="params">(since)</span>:</span></span><br><span class="line">    now = time.time()</span><br><span class="line">    s = now - since</span><br><span class="line">    m = math.floor(s / <span class="number">60</span>)</span><br><span class="line">    s -= m * <span class="number">60</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%dm %ds'</span> % (m, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从一个类中获取一个以start_letters开头的名字</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sample</span><span class="params">(category, start_letters=<span class="string">'Al'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        category_tensor = generate_category_tensor(category)</span><br><span class="line">        input = generate_input_tensor(start_letters)</span><br><span class="line">        hidden = rnn.init_hidden()</span><br><span class="line"></span><br><span class="line">        output_name = start_letters</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(max_length):</span><br><span class="line">            output, hidden = rnn(category_tensor, input[<span class="number">0</span>], hidden)</span><br><span class="line">            topv, topi_temp = output.topk(<span class="number">5</span>)</span><br><span class="line">            topi = topi_temp[<span class="number">0</span>][<span class="number">0</span>].item()</span><br><span class="line">            <span class="keyword">if</span> topi == n_letters - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"["</span>, end=<span class="string">""</span>)</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">                    <span class="keyword">if</span> j != <span class="number">4</span>:</span><br><span class="line">                        <span class="keyword">if</span> topi_temp[<span class="number">0</span>][j].item() &gt;= n_letters - <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">" "</span>, end=<span class="string">","</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            print(all_letters[topi_temp[<span class="number">0</span>][j].item()], end=<span class="string">","</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">if</span> topi_temp[<span class="number">0</span>][j].item() &gt;= n_letters - <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">" "</span>, end=<span class="string">"]\n"</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            print(all_letters[topi_temp[<span class="number">0</span>][j].item()], end=<span class="string">"]\n"</span>)</span><br><span class="line">                letter = all_letters[topi]</span><br><span class="line">                output_name += letter</span><br><span class="line">            input = generate_input_tensor(letter)</span><br><span class="line">        print(output_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># 开始运行</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line">rnn = RNN(n_letters, <span class="number">128</span>, n_letters)</span><br><span class="line"></span><br><span class="line">all_losses = []</span><br><span class="line">total_loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 超参数参考值</span></span><br><span class="line"><span class="comment"># n_its = 100000</span></span><br><span class="line"><span class="comment"># print_every = 5000</span></span><br><span class="line"><span class="comment"># plot_every = 500</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"请分别输入总迭代次数,打印精度,绘图精度(按空格分隔): "</span>, end=<span class="string">""</span>)</span><br><span class="line">n_its, print_every, plot_every = map(int, input().split())</span><br><span class="line">print(<span class="string">"开始训练......"</span>)</span><br><span class="line">start = time.time()</span><br><span class="line">print(<span class="string">"[时间戳]\t\t百分比\t\t已迭代数\t\t损失"</span>)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> range(<span class="number">1</span>, n_its + <span class="number">1</span>):</span><br><span class="line">    output, loss = train(*randomTrainingExample())</span><br><span class="line">    total_loss += loss</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> it % print_every == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"[%10s]  &lt;%3d%%&gt;  %10d  %.4f"</span> % (time_format(start), it / n_its * <span class="number">100</span>, it, loss))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> it % plot_every == <span class="number">0</span>:</span><br><span class="line">        all_losses.append(total_loss / plot_every)</span><br><span class="line">        total_loss = <span class="number">0</span></span><br><span class="line">print(<span class="string">"训练完成！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画出损失图像</span></span><br><span class="line">print(<span class="string">"绘制损失图像......"</span>)</span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(all_losses)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成测试</span></span><br><span class="line">print(<span class="string">"请输入是否要进行网络采样测试(1,是;0,否): "</span>, end=<span class="string">""</span>)</span><br><span class="line">flag = int(input())</span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    print(<span class="string">"请输入类别和姓名首字母(按空格分割,例: female Al): "</span>, end=<span class="string">""</span>)</span><br><span class="line">    cat, letters = input().split()</span><br><span class="line">    sample(cat, letters)</span><br><span class="line">    print(<span class="string">"要继续吗(1,继续;0,停止)？"</span>, end=<span class="string">""</span>)</span><br><span class="line">    flag = int(input())</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典RNN的应用为baby起名字的代码实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="RNN" scheme="https://666wxy666.github.io/tags/RNN/"/>
    
      <category term="起名字" scheme="https://666wxy666.github.io/tags/%E8%B5%B7%E5%90%8D%E5%AD%97/"/>
    
  </entry>
  
  <entry>
    <title>Linux 拓展学习</title>
    <link href="https://666wxy666.github.io/2020/06/24/Linux-%E6%8B%93%E5%B1%95%E5%AD%A6%E4%B9%A0/"/>
    <id>https://666wxy666.github.io/2020/06/24/Linux-%E6%8B%93%E5%B1%95%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-06-23T16:00:00.000Z</published>
    <updated>2020-09-02T02:01:39.322Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>简单的写了一些Linux的课外拓展学习的相关知识和问题。</p><a id="more"></a><h2 id="一、命令的参数"><a href="#一、命令的参数" class="headerlink" title="一、命令的参数"></a>一、命令的参数</h2><p>编写一个小程序，可以显示命令的选项和参数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; argc; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d:%p [%s]\n"</span>, i, argv[i], argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429205057.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429205057.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_205032" style="zoom:80%;"><h2 id="二、关于控制printf输出的颜色"><a href="#二、关于控制printf输出的颜色" class="headerlink" title="二、关于控制printf输出的颜色"></a>二、关于控制printf输出的颜色</h2><p>编写程序hello.c，编译和运行程序，得到类似以下结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429204547.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429204547.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="图片1" style="zoom:80%;"><p>可以通过</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="number">033</span>[</span><br></pre></td></tr></table></figure><p>来控制printf输出的颜色，格式为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[字背景颜色;字体颜色m 字符串 \033[0m"</span> );</span><br></pre></td></tr></table></figure><p>注意，一定要在printf最后使用</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="number">033</span>[<span class="number">0</span>m</span><br></pre></td></tr></table></figure><p>来消除前面的作用，否则前面的设置对后面的printf都有效果。</p><table><thead><tr><th align="center">ANSI控制码</th><th align="center">效果</th></tr></thead><tbody><tr><td align="center">\033[0m</td><td align="center">关闭所有属性</td></tr><tr><td align="center">\033[1m</td><td align="center">设置高亮度</td></tr><tr><td align="center">\033[4m</td><td align="center">下划线</td></tr><tr><td align="center">\033[5m</td><td align="center">闪烁</td></tr><tr><td align="center">\033[7m</td><td align="center">反显</td></tr><tr><td align="center">\033[8m</td><td align="center">消隐</td></tr><tr><td align="center">\033[30m —\033[37m</td><td align="center">设置前景色</td></tr><tr><td align="center">\033[40m—\033[47m</td><td align="center">设置背景色</td></tr><tr><td align="center">\033[nA</td><td align="center">光标上移n行</td></tr><tr><td align="center">\03[nB</td><td align="center">光标下移n行</td></tr><tr><td align="center">\033[nC</td><td align="center">光标右移n行</td></tr><tr><td align="center">\033[nD</td><td align="center">光标左移n行</td></tr></tbody></table><p>字背景颜色范围: 40–49</p><p>字颜色范围: 30—39</p><table><thead><tr><th align="center">字背景颜色代号</th><th align="center">字背景颜色</th><th align="center">字颜色代号</th><th align="center">字颜色</th></tr></thead><tbody><tr><td align="center">40</td><td align="center">黑</td><td align="center">30</td><td align="center">黑</td></tr><tr><td align="center">41</td><td align="center">红</td><td align="center">31</td><td align="center">红</td></tr><tr><td align="center">42</td><td align="center">绿</td><td align="center">32</td><td align="center">绿</td></tr><tr><td align="center">43</td><td align="center">黄</td><td align="center">33</td><td align="center">黄</td></tr><tr><td align="center">44</td><td align="center">蓝</td><td align="center">34</td><td align="center">蓝</td></tr><tr><td align="center">45</td><td align="center">紫</td><td align="center">35</td><td align="center">紫</td></tr><tr><td align="center">46</td><td align="center">青</td><td align="center">36</td><td align="center">青</td></tr><tr><td align="center">47</td><td align="center">白</td><td align="center">37</td><td align="center">白</td></tr></tbody></table><p>小程序具体代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NONE <span class="meta-string">"\e[0m"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RED <span class="meta-string">"\e[0;31m"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CYAN <span class="meta-string">"\e[0;36m"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(RED <span class="string">"Hello "</span> CYAN <span class="string">"World!\n"</span> NONE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\e[0;31mHello \e[0;36mWorld!\n\e[0m"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里\e和\033是一个意思，e的八进制代码就是033，这两个print其实效果是一样的，前面那个printf中多个连续的“xxx”字符串会被自动整合为一个字符串，其实最终执行的就是第二个printf。</p><p>效果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429211041.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429211041.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_210711"><h2 id="三、关于Linux中bash的变量、替换和元字符"><a href="#三、关于Linux中bash的变量、替换和元字符" class="headerlink" title="三、关于Linux中bash的变量、替换和元字符"></a>三、关于Linux中bash的变量、替换和元字符</h2><p>要求只列出所有bash进程的状态，使用命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep bash</span><br></pre></td></tr></table></figure><p>但grep进程自身也被输出了：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429211423.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429211423.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211412" style="zoom:80%;"><p>使用以下的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep [b]ash</span><br><span class="line">ps -ef | grep \\bash</span><br><span class="line">ps -ef | grep b\\ash</span><br><span class="line">ps -ef | grep b\ash</span><br><span class="line">ps -ef | grep ba\\sh</span><br></pre></td></tr></table></figure><ol><li><p>可以</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429211802.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429211802.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211631" style="zoom:80%;"><p>上面这5个命令的核心目的其实是改变grep在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure><p>命令中的显示形式，例如这一个，我们使用三通（tee）命令将在grep命令过滤之前的输出定向到一个文件中。</p><p>先将原命令试一下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep bash</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429214710.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429214710.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_214703" style="zoom:80%;"><p>与1这个命令进行一下对比：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep [b]ash</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429212708.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429212708.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_212451" style="zoom:80%;"><p>我们可以很明显的看到，grep命令确实改变了，因为正则表达式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[b]ash</span><br></pre></td></tr></table></figure><p>是可以匹配bash的，但是却不能匹配[b]ash，因此第一行的-bash这一行被取了出来，而最后grep这一行，由于不匹配[b]ash，就取不出来了，刚好实现了我们只列出所有bash进程的状态的目的，下面的几个命令大同小异。</p></li><li><p>不可以</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429211917.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429211917.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211651" style="zoom:80%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep \\bash</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429213025.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429213025.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_213015" style="zoom:80%;"><p>首先，\是Shell的元字符，先被\转义为真正的单个字符\，因此传给grep的正则表达式其实是\bash，而在正则表达式中，\b有特殊含义，是单词边界，因此就连bash和\bash全部都没有匹配到。</p></li><li><p>可以</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429211852.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429211852.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211709" style="zoom:80%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep b\\ash</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429213823.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429213823.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_213811" style="zoom:80%;"><p>和2一样，传给grep的正则表达式为b\ash，在正则表达式中\a是没有意义的，因此\被丢弃，正则表达式其实就是bash，所以第一行的-bash这一行被取了出来，而最后grep这一行，由于不匹配b\ash，就取不出来了。</p></li><li><p>不可以</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429212003.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429212003.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211730" style="zoom:80%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep b\ash</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429214303.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429214303.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_214256" style="zoom:80%;"><p>首先，\a先经过Shell的替换，因\a是没有特殊含义的，因此\被直接丢掉，传给grep的正则表达式为bash，这就和使用这个命令是一样的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep bash</span><br></pre></td></tr></table></figure><p>显然是不能实现目的。</p></li><li><p>不可以</p><img src="https://gitee.com/wxy_666/images/raw/master/20200429212010.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429212010.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_211747" style="zoom:80%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | tee 1.txt | grep ba\\sh</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200429214922.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200429214922.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-29_214914" style="zoom:80%;"><p>这个和2基本是一样的，和3唯一的区别就是，第3个中\a对正则表达式而言是没有特殊含义的，但是\s对正则表达式而言是有特殊含义的，\s代表空白字符（可能是空格、制表符、其他空白），也就是说，grep匹配到的应该是类似于：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ba h</span><br></pre></td></tr></table></figure><p>这种的字符串，显然-bash和ba\sh都不符合，因此就什么都没取到。</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单的写了一些Linux的课外拓展学习的相关知识和问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://666wxy666.github.io/categories/Linux/"/>
    
      <category term="拓展学习" scheme="https://666wxy666.github.io/categories/Linux/%E6%8B%93%E5%B1%95%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="C" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="难点" scheme="https://666wxy666.github.io/tags/%E9%9A%BE%E7%82%B9/"/>
    
      <category term="Linux" scheme="https://666wxy666.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://666wxy666.github.io/tags/Shell/"/>
    
      <category term="拓展" scheme="https://666wxy666.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>Linux MOOC习题 11~15章</title>
    <link href="https://666wxy666.github.io/2020/06/20/Linux-MOOC%E4%B9%A0%E9%A2%98-11~15%E7%AB%A0/"/>
    <id>https://666wxy666.github.io/2020/06/20/Linux-MOOC%E4%B9%A0%E9%A2%98-11~15%E7%AB%A0/</id>
    <published>2020-06-19T16:00:00.000Z</published>
    <updated>2020-09-02T01:58:23.943Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己随便整理了一下在学习Linux网课时遇到的一些习题，易错点之类的，接上文<a href="/2020/04/29/Linux-MOOC%E4%B9%A0%E9%A2%98-6~10%E7%AB%A0/">Linux MOOC习题 6~10章</a>。</p><a id="more"></a><h2 id="十一、进程的基本概念"><a href="#十一、进程的基本概念" class="headerlink" title="十一、进程的基本概念"></a>十一、进程的基本概念</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507102145.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507102145.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_095819" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507102202.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507102202.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_095837" style="zoom:80%;"><blockquote><ul><li><code>int a[N] = { 2 };</code>的意思是把<code>a[N]</code>第一个元素赋值为2，其他的赋值为0，也就是说，所有的元素都被赋值了，因此占空间很大。</li><li><code>int a[N];</code>的<code>a[N]</code>没有赋初值，只需记录a的长度即可，占用空间很小。</li></ul><p>从图中（test是第一种赋值的，test2是第二种不赋值的）也可以看出，差别巨大：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200507103601.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507103601.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_103457" style="zoom:80%;"></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200507102210.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507102210.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-07_100015" style="zoom:80%;"><blockquote><p>忙等待主要是占用CPU，和内存没啥关系。</p></blockquote><h2 id="十二、进程的创建和重定向"><a href="#十二、进程的创建和重定向" class="headerlink" title="十二、进程的创建和重定向"></a>十二、进程的创建和重定向</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200511192429.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200511192429.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-11_192030" style="zoom: 80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200511192503.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200511192503.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-11_192056" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200511192519.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200511192519.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-11_192111" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200511192659.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200511192659.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-11_192207" style="zoom:80%;"><blockquote><p>注意，这个程序是持续不间断运行的，也就是说，不能停止后再重启，但是重定向是只能在程序运行的时候进行的操作，程序一旦开始运行就没办法重定向了，因此不能实现。并且重定向是“当前进程”做的，不是父进程做的。但是如果foo可以终止后重启，确实可以用shell脚本等程序实现上述功能。修改foo程序也可以实现上述功能。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200511192733.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200511192733.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-11_192222" style="zoom: 80%;"><blockquote><p>执行的大致流程，只是各进程执行情况，并不代表真实执行顺序：</p><p><strong><em>父进程（0）：</em></strong></p><ul><li><p>输出：<code>i=0</code></p></li><li><p>父进程0产生第一个子进程0-1</p><p> <strong><em>0-1：</em></strong></p><ul><li><p>到下一轮for循环，i=1</p></li><li><p>输出：<code>i=1</code></p></li><li><p>子进程0-1产生第一个子进程0-1-1</p><p> <strong><em>0-1-1：</em></strong></p><ul><li><p>到下一轮for循环，i=2</p></li><li><p>输出：<code>i=2</code></p></li><li><p>进程0-1-1产生第一个子进程0-1-1-1</p><p><strong><em>0-1-1-1：</em></strong></p><ul><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-1-1-1产生第一个子进程0-1-1-1-1</p><p><strong><em>0-1-1-1-1：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-1-1-1-1结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-1-1-1结束</p></li></ul></li><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-1-1产生第二个子进程0-1-1-2</p><p><strong><em>0-1-1-2：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-1-1-2结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-1-1结束</p></li></ul></li><li><p>到下一轮for循环，i=2</p></li><li><p>输出：<code>i=2</code></p></li><li><p>子进程0-1产生第二个子进程0-1-2</p><p> <strong><em>0-1-2：</em></strong></p><ul><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-1-2产生第一个子进程0-1-2-1</p><p><strong><em>0-1-2-1：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-1-2-1结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-1-2结束</p></li></ul></li><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>子进程0-1产生第三个子进程0-1-3</p><p> <strong><em>0-1-3：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-1-3结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-1结束</p></li></ul></li><li><p>到下一轮for循环，i=1</p></li><li><p>输出：<code>i=1</code></p></li><li><p>父进程0产生第二个子进程0-2</p><p> <strong><em>0-2：</em></strong></p><ul><li><p>到下一轮for循环，i=2</p></li><li><p>输出：<code>i=2</code></p></li><li><p>进程0-2产生第一个子进程0-2-1</p><p><strong><em>0-2-1：</em></strong></p><ul><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-2-1产生第一个子进程0-2-1-1</p><p><strong><em>0-2-1-1：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-2-1-1结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-2-1结束</p></li></ul></li><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-2产生第二个子进程0-2-2</p><p><strong><em>0-2-2：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-2-2结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-2结束</p></li></ul></li><li><p>到下一轮for循环，i=2</p></li><li><p>输出：<code>i=2</code></p></li><li><p>父进程0产生第三个子进程0-3</p><p> <strong><em>0-3：</em></strong></p><ul><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>进程0-3产生第一个子进程0-3-1</p><p><strong><em>0-3-1：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-3-1结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>0-3结束</p></li></ul></li><li><p>到下一轮for循环，i=3</p></li><li><p>输出：<code>i=3</code></p></li><li><p>父进程0产生第四个子进程0-4</p><p> <strong><em>0-4：</em></strong></p><ul><li>到下一轮for循环，i=4</li><li>0-4结束</li></ul></li><li><p>到下一轮for循环，i=4</p></li><li><p>父进程0结束</p></li></ul><p>共15行输出，分别为：</p><table><thead><tr><th align="center">输出</th><th align="center">次数</th></tr></thead><tbody><tr><td align="center">i=0</td><td align="center">$2^0=1$</td></tr><tr><td align="center">i=1</td><td align="center">$2^1=2$</td></tr><tr><td align="center">i=2</td><td align="center">$2^2=4$</td></tr><tr><td align="center">i=3</td><td align="center">$2^3=8$</td></tr></tbody></table><p>在linux下的实际执行情况：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514110539.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514110539.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img" style="zoom:80%;"><p>可以发现确实是15行，但是却有两个问题：</p><ol><li><p>为什么最后产生了一个空行，在等待用户输入？</p><p>shell提示符其实是主进程死了以后，shell给出来的。因为实际运行结果是子进程死得晚，父进程死的早。其实，你不按回车，大家也都运行结束了，只是shell提示符出现得比某个子进程早。你看起来这个效果，其实这个提示符已经在上面显示了，那个时候主进程结束，shell给出了提示符，但此时子进程还没有结束，因此会继续输出，但这个时候shell已经进入了等待下一个命令的状态了，就像这样：</p></li></ol><img src="https://gitee.com/wxy_666/images/raw/master/20200514111514.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514111514.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200514111508" style="zoom:80%;"><p>​        可以发现，echo命令已经可以被shell接受了。</p><ol start="2"><li><p>程序为什么分两部分输出了？</p><p>这是因为后面的子进程因为他的父进程先死掉了，变成了孤儿进程，打印出他们的父进程pid，发现是1，也证明了这一点：</p></li></ol><img src="https://gitee.com/wxy_666/images/raw/master/20200514110755.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514110755.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200514110749" style="zoom:80%;"><p>因此我们可以对程序进行如下修改：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-11 20:02:00</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-05-14 11:18:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,status,wait_pid;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"i=%d,pid=%d,ppid=%d\n"</span>, i,getpid(),getppid());</span><br><span class="line">        <span class="keyword">if</span>(fork()&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            wait_pid = wait(&amp;status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对每个fork加上wait语句，就可以完全按照上面的进程树执行顺序执行，且不会有任何问题了。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200514112003.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200514112003.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200514111958" style="zoom:80%;"><p>PS：对于wait，如果其所有子进程都还在运行，则阻塞；如果是一部分子进程终止，而另一部分还在运行，那么父进程还会阻塞吗？答案是不会，只要有一个进程终止，wait就会返回。也就是说只要wait接收到一个SIGCHLD信号，wait()就会返回。对于两个或多个子进程的情况，需要调用wait两次或多次。说白了在每一个fork后面的父进程分支中都要有一个wait与之对应。与wait相关的详细知识请参照这位兄弟的博客：<a href="https://www.cnblogs.com/black-mamba/p/6886434.html" target="_blank" rel="external nofollow noopener noreferrer">wait()函数的详细分析</a>。</p></blockquote><h2 id="十三、重定向和管道，信号"><a href="#十三、重定向和管道，信号" class="headerlink" title="十三、重定向和管道，信号"></a>十三、重定向和管道，信号</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200521095329.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200521095329.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-21_094112" style="zoom:80%;"><blockquote><p>xsh2.c是一个简易的模拟shell程序。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: </span></span><br><span class="line"><span class="comment"> * @Version: </span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-21 09:44:26</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-05-21 09:51:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">256</span>], *argv1[<span class="number">256</span>], **p, *cmd2, *argv2[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> sv, fd[<span class="number">2</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (;;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"=&gt; "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fgets(buf, <span class="keyword">sizeof</span>(buf), <span class="built_in">stdin</span>) == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((cmd2 = <span class="built_in">strstr</span>(buf, <span class="string">"|"</span>)) == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        *cmd2++ = <span class="string">'\0'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (p = &amp;argv1[<span class="number">0</span>], *p = strtok(buf, <span class="string">" \t\n"</span>); *p != <span class="literal">NULL</span>; *++p = strtok(<span class="literal">NULL</span>, <span class="string">" \t\n"</span>))</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (p = &amp;argv2[<span class="number">0</span>], *p = strtok(cmd2, <span class="string">" \t\n"</span>); *p != <span class="literal">NULL</span>; *++p = strtok(<span class="literal">NULL</span>, <span class="string">" \t\n"</span>))</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (argv1[<span class="number">0</span>] == <span class="literal">NULL</span> || argv2[<span class="number">0</span>] == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        pipe(fd);</span><br><span class="line">        <span class="keyword">if</span> (fork() == <span class="number">0</span>)<span class="comment">// | 左边的写端进程</span></span><br><span class="line">        &#123;</span><br><span class="line">            dup2(fd[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">            execvp(argv1[<span class="number">0</span>], argv1);</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"** bad command 1: %m\n"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fork() == <span class="number">0</span>)<span class="comment">// | 右边的读端进程</span></span><br><span class="line">        &#123;</span><br><span class="line">            dup2(fd[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">1</span>]);<span class="comment">// 和第二题的类似，也不能省略</span></span><br><span class="line">            execvp(argv2[<span class="number">0</span>], argv2);</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"** bad command 2: %m\n"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">close</span>(fd[<span class="number">0</span>]);<span class="comment">// 第一题要省略的操作</span></span><br><span class="line">        <span class="built_in">close</span>(fd[<span class="number">1</span>]);<span class="comment">// 第二题要省略的操作</span></span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>如果省略了这一条，对程序执行是没有什么影响的，但是循环多次以后，文件描述符一直不会被回收，导致资源耗尽，程序无法正常运行。</li><li>如果省略了这一条，就会产生重大问题。在写端进程写入结束后正常退出，读端在读取管道时，因为有个写入端一直没有关闭，导致读端的管道一直收不到结束信号，一直在等待读取，导致了死锁，读端程序不能正常结束。</li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200521100519.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200521100519.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-21_094136" style="zoom:80%;"><blockquote><p>goto只能在函数内跳转，全局跳转则可以跳转到保存的程序运行状态（包括堆栈等），就可以理解为玩游戏的SavePoint。但是如果你没保存，那就没法跳转，因此全局跳转只能跳转到执行过的位置。但是这个题目是有点问题的，goto语句也可以向前和向后跳转，因此此题可以忽略。</p></blockquote><h2 id="十四、进程间协作，Socket概述"><a href="#十四、进程间协作，Socket概述" class="headerlink" title="十四、进程间协作，Socket概述"></a>十四、进程间协作，Socket概述</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200529100058.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529100058.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094202" style="zoom:80%;"><blockquote><p>也就是说，<code>mmap()</code>需要一个已经打开的文件的文件描述符，当然需要<code>open()</code>打开文件，至于为什么需要，解析说的很明白。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200529100352.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529100352.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094455" style="zoom:80%;"><blockquote><p>如果你打开的文件不关闭，你的程序一直执行，一直打开文件，打开的太多就会导致文件描述符资源耗尽，无法打开文件，但是当你程序退出时（正常退出或者异常终止），操作系统都会自动检测你已经打开的文件，自行关闭应该关闭的文件，因此也能正常持久化到磁盘文件。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200529100636.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529100636.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094519" style="zoom:80%;"><blockquote><p>咨询式锁定是很关键的，也就是你不自己调用<code>fcntl()</code>，你是不会被阻塞的，也就是说Linux给你提供了互斥访问的途径，你自己不用或者使用不当，还是会导致出现问题，这也是Linux“策略和机制相分离”的设计方法。它是一个重要的设计思路，当系统不能大包大揽时，系统提供“机制”，把“策略”留给程序员，简化了操作系统的设计，程序员正确操作，应该完成的功能也都能实现。这是一个典型的合理的“甩锅”行为。因特网和Linux设计上都遵循了这样的理念。SUID，bash中的条件判断，四则运算，都是相同的理念，它们简化了自己，仅提供“机制”，把“策略”留给应用程序，不失必备功能。C语言也一样，printf在C语言里也会是个函数，与语言本身无关，C语言自己设计得很简单，以至于常用C语言的程序员，不需要查阅任何手册，都能把语法记下来。C++，你试试？</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200529101032.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529101032.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094606" style="zoom:80%;"><blockquote><p>注意是以命令行参数方式传递，<code>exec()</code>虽然会清空原来的代码段，但是对文件描述符和信号的处理有所不同。</p><p>关于<code>fork()</code>和<code>exec()</code>父子进程对文件描述符和信号的继承问题总结如下：</p><ul><li><p>信号</p><ul><li><p>仅fork时子进程会继承父进程fork之前所设置的信号处理方式。</p></li><li><p>当有exec加载新程序时</p><ul><li>子进程继承的处理方式是忽略或默认处理方式时，exec新程序后设置依然有效。</li><li>如果子进程继承是捕获处理方式时，exec新程序后将被还原为默认处理方式。</li></ul></li></ul></li><li><p>文件描述符</p><p>当你用fork建立一个子进程，父进程的所有内容会被“完完整整”的复制到子进程中。子进程是父进程的一个clone体，除了pid不同，其余一切相同。在fork后父、子进程对于每一个打开的文件描述符共享同一个文件表项，此时可能有多个文件描述符项指向同一文件表项。即使exec也会保留文件描述符，但是有时子进程不需要继承父进程的文件描述符，并且有时在exec后子进程继承下来的文件描述符有的是毫无意义的，Linux使用close_on_exec标志位来实现。当父进程打开文件时，只需要应用程序设置FD_CLOSEXEC标志位，则当fork后exec其他程序的时候，内核自动会将其继承的父进程FD关闭。因此原则上只要你不设置这个标志位，你fork子进程后，exec新程序依然可以用你在父进程或者原来的子进程中打开的文件。</p></li></ul></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200529101043.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529101043.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094713" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200529102311.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200529102311.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-29_094803" style="zoom:80%;"><h2 id="十五、Socket编程"><a href="#十五、Socket编程" class="headerlink" title="十五、Socket编程"></a>十五、Socket编程</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200603082808.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603082808.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_081900" style="zoom:80%;"><blockquote><ul><li><code>bind</code>设置本地端点名，也可以用在客户端程序，不会阻塞；</li><li><code>listen</code>仅仅是给内核一个通知，开始监听到达的连接请求，不会阻塞；</li><li><code>connect</code>建立连接，设定远端端点名，进程阻塞，直到TCP连接建立（第二次握手）；</li><li><code>accept</code>接受一个连接请求，阻塞等待新连接的到来，直到TCP三次握手结束返回；</li></ul></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200603083359.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083359.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082405" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603083428.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083428.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082415" style="zoom:80%;"><blockquote><p>不执行<code>signal(SIGCLD,SIG_ING)</code>会产生僵尸进程。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200603083519.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083519.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082433" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603083527.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083527.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082526" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603083537.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083537.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082543" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603083546.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603083546.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_082554" style="zoom:80%;"><details><summary> <p>所有的习题：</p> </summary>              <div class="content">              <p><a href="/2020/04/28/Linux-MOOC%E4%B9%A0%E9%A2%98-1~5%E7%AB%A0/">Linux MOOC习题 1~5章</a></p><p><a href="/2020/04/29/Linux-MOOC%E4%B9%A0%E9%A2%98-6~10%E7%AB%A0/">Linux MOOC习题 6~10章</a></p><p><a href="/2020/05/07/Linux-MOOC%E4%B9%A0%E9%A2%98-11~15%E7%AB%A0/">Linux MOOC习题 11~15章</a></p>              </div>            </details>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己随便整理了一下在学习Linux网课时遇到的一些习题，易错点之类的，接上文&lt;a href=&quot;/2020/04/29/Linux-MOOC%E4%B9%A0%E9%A2%98-6~10%E7%AB%A0/&quot;&gt;Linux MOOC习题 6~10章&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://666wxy666.github.io/categories/Linux/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/categories/Linux/%E4%B9%A0%E9%A2%98/"/>
    
    
      <category term="Linux" scheme="https://666wxy666.github.io/tags/Linux/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/tags/%E4%B9%A0%E9%A2%98/"/>
    
      <category term="易错点" scheme="https://666wxy666.github.io/tags/%E6%98%93%E9%94%99%E7%82%B9/"/>
    
      <category term="网课" scheme="https://666wxy666.github.io/tags/%E7%BD%91%E8%AF%BE/"/>
    
      <category term="MOOC" scheme="https://666wxy666.github.io/tags/MOOC/"/>
    
  </entry>
  
  <entry>
    <title>现代交换原理 MOOC习题 5~6章</title>
    <link href="https://666wxy666.github.io/2020/06/20/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/"/>
    <id>https://666wxy666.github.io/2020/06/20/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/</id>
    <published>2020-06-19T16:00:00.000Z</published>
    <updated>2020-09-02T02:08:03.112Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。接上一部分<a href="/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/">现代交换原理 MOOC习题 1~4章</a>。</p><a id="more"></a><h2 id="第五章-信令与协议"><a href="#第五章-信令与协议" class="headerlink" title="第五章 信令与协议"></a>第五章 信令与协议</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200518094712.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518094712.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094257" style="zoom:80%;"><blockquote><p>通话所需的媒体资源可以理解为控制呼叫的接续和拆线和通信网管理和维护的信息资源。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518094755.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518094755.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="QQ图片20200518094332" style="zoom:80%;"><blockquote><p>通信网中为用户建立连接和拆除连接，需要网中各个相关设备协调工作，为此在各个设备间传输的控制信号和规约称为信令。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095101.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095101.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094308" style="zoom:80%;"><blockquote><p>路由标记供MTP3级进行消息寻址和路由，而MTP3的路由标记是由信令点编码实现的。</p></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095738.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095738.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200518094345" style="zoom:80%;"><blockquote><ol start="4"><li><p>电信网（现代通信网）的三大支撑网络：同步网，管理网，信令网。</p></li><li><p>SIP与普通电话用户进行通话时要进行协议转换，SIP-&gt;七号信令。SIP协议中SDP的媒体端口号由网关（中继网关）保存。中继网关是分组网和电路网边界设备，实现不同媒体协议的转换。</p><p>注意中继网关（Trunk Gateway）跟代理服务器（Proxy Server）不是一个东西。</p><p>中继网关也叫落地设备，简称TG。用于VOIP网络电话系统或呼叫中心、软交换等，将模拟信号与数字信号相互转换。是voip解决方案的重要组成部分，它位于NGN网络的边缘接入层，连接PSTN和voip网络，实现IP包转TDM的功能。 承载着IP域与电路域的语音汇接任务。</p></li><li><p>常识问题。</p></li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200518095251.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518095251.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_094440" style="zoom:80%;"><blockquote><ol start="7"><li><p>显然错误，MTP1的通路也要经过TST交换网络。</p></li><li><p>错误，不多解释。</p></li><li><p>模拟用户信令：主要包括用户向交换机发送的监视信令和选择信令，交换机向用户发送的铃流和忙音等音信号。**<em>用于PSTN**</em>。</p><ul><li>状态信令：用户线的忙闲状态，如主、被叫的摘、挂机状态；</li><li>地址信令：主叫所拨的被叫号码，直流脉冲或双音频；</li><li>铃流和信号音：交换机向用户发送的信号。振铃信号、信号音、来电显示的FSK信号；</li></ul><p>数字用户信令：通过消息的形式传送以上信息，**<em>用于ISDN用户**</em>。例如：DSS1 30B+D</p><p>在用户线上传输的信令叫用户线信令，No.7信令是专为电话局之间交互控制信息而设计的，所以是局间信令，也就是在中继线上交互的信令，以数字信号方式传送。它跟能否携带电话号码没关系。</p></li></ol></blockquote><h2 id="第六章-移动交换"><a href="#第六章-移动交换" class="headerlink" title="第六章 移动交换"></a>第六章 移动交换</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200531205352.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531205352.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_205201" style="zoom:80%;"><blockquote><p>MSC是移动交换中心，主要功能有：</p><ol><li>信道的管理和分配；</li><li>呼叫的处理和控制；</li><li>用户位置信息的登记与管理；</li><li>越区切换和漫游的控制；</li><li>号码的登记和管理；</li><li>服务类型的鉴权；</li><li>用户的鉴权；</li><li>提供链路接口；</li></ol></blockquote><img src="https://gitee.com/wxy_666/images/raw/master/20200531210710.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210710.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_205837" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210722.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210722.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210158" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210742.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210742.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210414" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210756.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210756.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210611" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200531210809.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200531210809.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-31_210653" style="zoom:80%;"><blockquote><p>相关签约信息及4G位置信息不是存在MME中，而是HSS。</p></blockquote><details><summary> <p>所有的习题：</p> </summary>              <div class="content">              <p><a href="/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/">现代交换原理 MOOC习题 1~4章</a></p><p><a href="/2020/05/18/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-5~6%E7%AB%A0/">现代交换原理 MOOC习题 5~6章</a></p>              </div>            </details>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己随便整理了一下在学习“现代交换原理”网课时遇到的一些习题，易错点之类的。接上一部分&lt;a href=&quot;/2020/05/07/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86-MOOC%E4%B9%A0%E9%A2%98-1~4%E7%AB%A0/&quot;&gt;现代交换原理 MOOC习题 1~4章&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/categories/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/%E4%B9%A0%E9%A2%98/"/>
    
    
      <category term="习题" scheme="https://666wxy666.github.io/tags/%E4%B9%A0%E9%A2%98/"/>
    
      <category term="易错点" scheme="https://666wxy666.github.io/tags/%E6%98%93%E9%94%99%E7%82%B9/"/>
    
      <category term="网课" scheme="https://666wxy666.github.io/tags/%E7%BD%91%E8%AF%BE/"/>
    
      <category term="MOOC" scheme="https://666wxy666.github.io/tags/MOOC/"/>
    
      <category term="现代交换原理" scheme="https://666wxy666.github.io/tags/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>大数据 习题</title>
    <link href="https://666wxy666.github.io/2020/06/18/%E5%A4%A7%E6%95%B0%E6%8D%AE-%E4%B9%A0%E9%A2%98/"/>
    <id>https://666wxy666.github.io/2020/06/18/%E5%A4%A7%E6%95%B0%E6%8D%AE-%E4%B9%A0%E9%A2%98/</id>
    <published>2020-06-17T16:00:00.000Z</published>
    <updated>2020-09-02T02:05:35.690Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>自己随便整理了一下在学习“大数据”时遇到的一些习题，易错点之类的。</p><a id="more"></a><h2 id="1、关于Spark中task，block，partition，split，core的关系"><a href="#1、关于Spark中task，block，partition，split，core的关系" class="headerlink" title="1、关于Spark中task，block，partition，split，core的关系"></a>1、关于Spark中task，block，partition，split，core的关系</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507215355.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507215355.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="第5讲-第4章-大数据处理-Spark框架" style="zoom: 67%;"><blockquote><p>每一个过程的任务数，对应一个inputSplit, Partition输入可能以多个文件的形式存储在HDFS上，每个File都包含了很多块，称为Block。</p><p>当Spark读取这些文件作为输入时，会根据具体数据格式对应的InputFormat进行解析，一般是将若干个Block合并成一个输入分片，称为InputSplit，注意InputSplit不能跨越文件。</p><p>随后将为这些输入分片生成具体的Task。InputSplit与Task是一一对应的关系。随后这些具体的Task每个都会被分配到集群上的某个节点的某个Executor去执行。</p><ul><li><p>每个节点可以起一个或多个Executor。</p></li><li><p>每个Executor由若干core组成，每个Executor的每个core一次只能执行一个Task。</p><p>注意： 这里的core是虚拟的core而不是机器的物理CPU核，可以理解为就是Executor的一个工作线程。 </p></li><li><p>每个Task执行的结果就是生成了目标RDD的一个partiton。</p><p>Task被执行的并发度 = Executor数目$\times$每个Executor核数（=core总个数）</p></li><li><p>至于partition的数目：</p><ul><li>对于数据读入阶段，例如sc.textFile，输入文件被划分为多少InputSplit就会需要多少初始Task。</li><li>在Map阶段partition数目保持不变。</li><li>在Reduce阶段，RDD的聚合会触发shuffle操作，聚合后的RDD的partition数目跟具体操作有关，例如repartition操作会聚合成指定分区数，还有一些算子是可配置的。</li><li>RDD在计算的时候，每个分区都会起一个task，所以rdd的分区数目决定了总的task数目。申请的计算节点（Executor）数目和每个计算节点核数，决定了你同一时刻可以并行执行的task。<br>比如：<br>RDD有100个分区，那么计算的时候就会生成100个task，你的资源配置为10个计算节点，每个2个核，同一时刻可以并行的task数目为20，计算这个RDD就需要5个轮次。如果计算资源不变，你有101个task的话，就需要6个轮次，在最后一轮中，只有一个task在执行，其余核都在空转。如果资源不变，你的RDD只有2个分区，那么同一时刻只有2个task运行，其余18个核空转，造成资源浪费。这就是在spark调优中，增大RDD分区数目，增大任务并行度的原因。</li></ul></li></ul></blockquote><h2 id="2、HDFS体系架构"><a href="#2、HDFS体系架构" class="headerlink" title="2、HDFS体系架构"></a>2、HDFS体系架构</h2><p>HDFS采用了主从（Master/Slave）结构 模型，一个HDFS集群是由一个 NameNode和若干个 DataNode 组成的。其中 NameNode 作为主服务器，管理文件系统的命名空间和客户端对文件的 访问操作；集群中的 DataNode 管理存储的数据。HDFS 允许用户以文件的形 式存储数据。从内部来看，文件被分成 若干个数据块，而且这若干个数据块存 放在一组 DataNode 上。NameNode 执行文件系统的命名空间操作，比如打开、关闭、重命名文件或目录等，它也负责数据块到具体 DataNode 的映射。 DataNode 负责处理文件系统客户端的文件读写请求，并在 NameNode 的统 一调度下进行数据块的创建、删除和复制工作。</p><h2 id="3、HDFS的读操作流程"><a href="#3、HDFS的读操作流程" class="headerlink" title="3、HDFS的读操作流程"></a>3、HDFS的读操作流程</h2><ol><li>初始化FileSystem，然后客户端用函数 open()打开文件。</li><li>FileSystem调用元数据节点，得到数据 块信息，并对每一个数据块、元数据节点返回，保存数据块的数据节点地址。 </li><li>客户端调用Stream的read()函数开始读 取数据。 </li><li>FSDataInputStream连接保存此文件第 一个数据块的最近的数据节点Datanode， data从数据节点读到客户端。 </li><li>当第一个数据块读取完毕时， FSDataInputStream关闭和此数据节点的 连接，然后连接此文件下一个数据块的 最近的数据节点。 </li><li>当客户端读取完毕数据的时候，调用 FSDataInputStream的close()函数，关闭连接。</li></ol><h2 id="4、HDFS的写操作流程"><a href="#4、HDFS的写操作流程" class="headerlink" title="4、HDFS的写操作流程"></a>4、HDFS的写操作流程</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507220050.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507220050.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Pag4" style="zoom:80%;"><h2 id="5、习题"><a href="#5、习题" class="headerlink" title="5、习题"></a>5、习题</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200507215507.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507215507.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Page1" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507215615.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507215615.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Page2" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507215630.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507215630.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Page3" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200507220134.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200507220134.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="第3讲-第2章-大数据存储-NoSQL数据库" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603095741.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603095741.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_091537" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603095754.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603095754.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_095449" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603095804.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603095804.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_095457" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200603095810.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200603095810.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-03_095505" style="zoom:80%;">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自己随便整理了一下在学习“大数据”时遇到的一些习题，易错点之类的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="习题" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E4%B9%A0%E9%A2%98/"/>
    
    
      <category term="习题" scheme="https://666wxy666.github.io/tags/%E4%B9%A0%E9%A2%98/"/>
    
      <category term="易错点" scheme="https://666wxy666.github.io/tags/%E6%98%93%E9%94%99%E7%82%B9/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="HDFS" scheme="https://666wxy666.github.io/tags/HDFS/"/>
    
      <category term="MapReduce" scheme="https://666wxy666.github.io/tags/MapReduce/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 DNN 手写识别</title>
    <link href="https://666wxy666.github.io/2020/06/11/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-DNN-%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/"/>
    <id>https://666wxy666.github.io/2020/06/11/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-DNN-%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/</id>
    <published>2020-06-10T16:00:00.000Z</published>
    <updated>2020-09-02T02:06:57.356Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典深度神经网络DNN的应用手写识别的思路样例。</p><a id="more"></a><h2 id="一、题目"><a href="#一、题目" class="headerlink" title="一、题目"></a>一、题目</h2><p>请描述一个深度神经网络模型解决实际问题的例子。</p><p>包括问题描述，输入输出数据，训练、测试数据集，深度网络模型结构图，损失函数，训练方法，以及其他需要说明的内容。</p><h2 id="二、问题描述"><a href="#二、问题描述" class="headerlink" title="二、问题描述"></a>二、问题描述</h2><p>下面将描述一个深度神经网络的典型经典例子：手写数字识别（OCR）。</p><p>⼈类视觉系统是世界上众多奇迹之一。下面的手写数字序列：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><p>大多数人毫不费力就能够认出这些数字为 504192。识别手写数字不是一件简单的事。尽管⼈类在理解我们眼睛展示出来的信息上非常擅长，但如果你尝试写出计算机程序来识别诸如上面的数字，就会明显感受到视觉模式识别的困难。看起来人类一下子就能完成的任务变得特别困难。关于我们识别形状——“9 顶上有一个圈，右下方则是一条竖线”这样的简单直觉——实际上算法上就很难轻易表达出来了。而在你试着让这些识别规则越发精准时，就会很快陷入各种混乱的异常或者特殊情形的困境中。实现一个可以识别手写数字的神经网络。这个神经网络不需要人类帮助便可以超过 96% 的准确率识别数字。实际上，最优的商业神经网络已经足够好到被银行和邮局分别用在账单核查和识别地址上了。</p><h2 id="二、输入输出数据"><a href="#二、输入输出数据" class="headerlink" title="二、输入输出数据"></a>二、输入输出数据</h2><img src="https://gitee.com/wxy_666/images/raw/master/20200605100130.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100130.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><h3 id="1、输入数据"><a href="#1、输入数据" class="headerlink" title="1、输入数据"></a>1、输入数据</h3><p>一系列手写的数字，例如：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><h3 id="2、输出数据"><a href="#2、输出数据" class="headerlink" title="2、输出数据"></a>2、输出数据</h3><p>识别出的数字：504192</p><h2 id="三、训练、测试数据集"><a href="#三、训练、测试数据集" class="headerlink" title="三、训练、测试数据集"></a>三、训练、测试数据集</h2><p>使用经典的<em>MNIST</em> 数据集作为数据源。MNIST 数据分为两个部分。第一部分包含 60,000 幅用于训练数据的图像。这些图像扫描⾃250 ⼈的手写样本。这些图像是28 × 28 ⼤小的灰度图像。第二部分是 10,000 幅用于测试数据的图像，同样是 28 × 28 的灰度图像。</p><h3 id="训练集测试集样例"><a href="#训练集测试集样例" class="headerlink" title="训练集测试集样例"></a>训练集测试集样例</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200605100239.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100239.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="fc73217ae57f451a89badc801a903bb742e42eabd9434ecc8089efe19a66c076" style="zoom:80%;"><p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103228.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103228.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="神经网络与深度学习1"></p><h2 id="四、深度网络模型结构图"><a href="#四、深度网络模型结构图" class="headerlink" title="四、深度网络模型结构图"></a>四、深度网络模型结构图</h2><p>我们可以把识别手写数字的问题分成两个子问题。首先，我们希望有个方式把包含许多数字的图像分成一系列单独的图像，每个包含单个数字。例如，我们想要把图像</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601103924.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits" style="zoom:80%;"><p>分成六个单独的图像</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601104635.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601104635.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="digits_separate" style="zoom:80%;"><p>一旦图像被分割，那么程序需要把每个单独的数字分类。例如，我们想要我们的程序能识别上面的第一个数字是 5。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601104811.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601104811.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="mnist_first_digit" style="zoom:80%;"><p>有很多途径可以解决分割的问题。一种方法是尝试不同比分割方式，用数字分类器对每一个切分片段打分。如果数字分类器对每一个片段的置信度都较高，那么这个分割方式就能得到较高的分数；如果数字分类器在一或多个片段中出现问题，那么这种分割方式就会得到较低的分数。这种方法的思想是，如果分类器有问题，那么很可能是由于图像分割出错导致的。这种思想以及它的变化形式能够比较好地解决分割问题。因此，与其关心分割问题，我们不如把精力集中在解决第二个问题即分类单独的数字。</p><p>我们可以使用一个三层神经网络来识别单个数字：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601105123.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601105123.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200601105123061" style="zoom:80%;"><p>标准的DNN的模型结构：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605101604.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605101604.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1" style="zoom:80%;"><p>网络的输入层包含给输入像素的值进行编码的神经元。我们给网络的训练数据会有很多扫描得到的 28 × 28 的手写数字的图像组成，所有输入层包含有 784 = 28 × 28个神经元。为了简化，上图中我已经忽略了 784 中⼤部分的输入神经元。输入像素是灰度级的，值为 0.0 表示白色，值为 1.0 表示黑色，中间数值表示逐渐暗淡的灰色。</p><p>网络的中间层是隐藏层。我们用 n 来表示神经元的数量，我们将给 n 实验不同的数值。示例中用一个小的隐藏层来说明，仅仅包含 n = 15 个神经元。</p><p>网络的输出层包含有 10 个神经元。如果第一个神经元激活，即输出$\approx1$，那么表明网络认为数字是一个 0。如果第二个神经元激活，就表明网络认为数字是一个 1。依此类推。更确切地说，我们把输出神经元的输出赋予编号 0 到 9，并计算出那个神经元有最高的激活值。比如，如果编号为 6 的神经元激活，那么我们的网络会猜到输入的数字是 6。其它神经元相同。</p><p>这里使用 10 个输出神经元，因为任务是能让神经网络告诉我们哪个数字（0, 1, 2, . . . , 9 ）能和输入图片匹配，但是使用 4 个输出神经元，即把每一个当做一个二进制值，结果取决于它的输出更靠近 0 还是 1 。四个神经元足够编码这个问题了，因为 24 = 16 ⼤于 10 种可能的输入。但是10 个输出神经元的神经网络比 4 个的识别效果更好。</p><p>在上述的三层神经网络加一个额外的一层就可以实现按位表示数字。额外的一层把原来的输出层转化为一个二进制表示：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601105740.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601105740.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200601105739985" style="zoom:80%;"><p>将上述网络详细展开来说，我们可以选择两个大小为100的隐层和一个大小为10的输出层，因为MNIST数据集是手写0到9的灰度图像，类别有10个，所以最后的输出大小是10。隐层的激活函数可以使用ReLU，最后输出层的激活函数是Softmax，所以最后的输出层相当于一个分类器。加上一个输入层的话，多层感知器的结构是：输入层–&gt;隐层–&gt;隐层–&gt;输出层。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605100555.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100555.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="cb69f928778c4299b75814179607a89eea770bdc409d4e08a87e2975cb96b19b" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200605100939.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605100939.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="123" style="zoom:67%;"><h2 id="五、损失函及训练方法"><a href="#五、损失函及训练方法" class="headerlink" title="五、损失函及训练方法"></a>五、损失函及训练方法</h2><p>我们使用DNN反向传播算法和梯度下降算法进行学习训练。我们将用符号$x$来表示一个训练输入。为了方便，把每个训练输入$x$看作一个表示$28\times28=784$维的向量。每个向量中的项目代表图像中单个像素的灰度值。我们用$y=y(x)$表示对应的期望输出，这里$y$是一个 10 维的向量。例如，如果有一个特定的画成6的训练图像$x$，那么$y(x) = (0, 0, 0, 0, 0, 0, 1, 0, 0, 0)^T$则是网络的期望输出。</p><p>我们希望有一个算法，能让我们找到权重和偏置，以⾄于网络的输出$y(x)$能够拟合所有的训练输入$x$。为了量化我们如何实现这个目标，我们定义一个代价损失函数：<br>$$<br>C(w,b)\equiv{\frac{1}{2n}}\sum_x||y(x)-a||^2<br>$$<br>这里$w$表示所有的网络中权重的集合，$b$是所有的偏置，$n$是训练输入数据的个数，$a$是表示当输入为 $x$时输出的向量，输出$a$取决于$x$，$w$和$b$，求和则是在总的训练输入$x$上进行的。符号$||v||$是指向量 v 的模。我们的训练算法的目的是最小化权重和偏置的代价函数$C(w,b)$。换句话说，我们想要找到一系列能让代价尽可能小的权重和偏置。</p><p>也可以使用的是交叉熵损失函数，该函数在分类任务上比较常用。定义了一个损失函数之后，还有对它求平均值，训练程序必须返回平均损失作为第一个返回值，因为它会被后面反向传播算法所用到。同时我们还可以定义一个准确率函数，这个可以在我们训练的时候输出分类的准确率。<br>$$<br>H(p,q)=-\sum_{i=1}^{n}p(x_i)\log(q(x_i))<br>$$</p><p>梯度下降算法的基本步骤：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200605102348.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200605102348.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="20200601112017" style="zoom:80%;"><h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>上述神经网络在测试集的准确度能达到95%左右，非常准确。</p><p><img src="https://gitee.com/wxy_666/images/raw/master/20200601113522.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601113522.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="regularized_full"></p><p>相较于SVM，准确度和性能均有较大提升。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200601113339.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200601113339.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="more_data_comparison" style="zoom:80%;"><p>深度神经网络（Deep Neural Networks，DNN）是一个非常有前景和创新的研究方向。除了手写识别（OCR），还有各个行业的经典样例，比如：图像方面的黑白照片变彩色照片的图像着色（LetThereBeColor）、图像风格化，将一幅图像的内容与另一幅图像的风格相结合（neural-style）、通过深度学习极大提高模糊图片的分辨率（srez）、实时捕获面部表情，调换到另外一个人的面部（Face2Face）、雅虎出品的成人图片分类器（open_nsfw）、成人视频分类器（Miles Deep）等等，就不一一列举了。总之深度神经网络和深度学习给出了在图像识别、语音识别和自然语言处理领域中众多问题的最好解决方案，重要性不言而喻。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典深度神经网络DNN的应用手写识别的思路样例。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="DNN" scheme="https://666wxy666.github.io/tags/DNN/"/>
    
      <category term="手写识别" scheme="https://666wxy666.github.io/tags/%E6%89%8B%E5%86%99%E8%AF%86%E5%88%AB/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Python可视化 Matplotlib可视化</title>
    <link href="https://666wxy666.github.io/2020/06/10/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Python%E5%8F%AF%E8%A7%86%E5%8C%96-Matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <id>https://666wxy666.github.io/2020/06/10/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Python%E5%8F%AF%E8%A7%86%E5%8C%96-Matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96/</id>
    <published>2020-06-09T16:00:00.000Z</published>
    <updated>2020-09-02T02:04:55.801Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Python的Matplotlib实现数据可视化。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：1</li><li>系统版本：Centos 7.5</li><li>Anaconda版本：4.4.0</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>通过创建Kafka topic，使用Kafka Producer产生消息，然后通过编写spark<br>Streaming程序处理这些消息。</li><li>主要步骤：<ul><li>Matplotlib的介绍</li><li>基本绘图函数</li><li>图表的修饰项介绍</li><li>子图绘制</li><li>图像的保存</li></ul></li></ul><h2 id="三、实验步骤："><a href="#三、实验步骤：" class="headerlink" title="三、实验步骤："></a>三、实验步骤：</h2><h3 id="3-1Matplotlib的介绍："><a href="#3-1Matplotlib的介绍：" class="headerlink" title="3.1Matplotlib的介绍："></a>3.1Matplotlib的介绍：</h3><p>在Python中，主要运用matplotlib库进行数据可视化。matplotlib是Python最著名的绘图库，它提供了一整套和matlab相似的命令API，十分适合交互式地进行制图。而且也可以方便地将它作为绘图控件，嵌入GUI应用程序中。</p><h3 id="3-2基本绘图函数："><a href="#3-2基本绘图函数：" class="headerlink" title="3.2基本绘图函数："></a>3.2基本绘图函数：</h3><p>matplotlib的pyplot子库提供了和matlab类似的绘图API，方便用户快速绘制2D图表。pyplot模块中常见的用来绘制图形的主要有以下几种函数：</p><p>3.2.1<strong>plot</strong>:常用于绘制线型图，该方法具有可变长参数，参数color指定颜色，参数linestyle设置线的样式、参数marker设置标记类型，结果返回一个lines.Line2D对象的列表，lines.Line2D对象的属性可通过plot的关键字参数设置。</p><p>3.2.2<strong>scatter</strong>: 用于绘制散点图；</p><p>3.2.3<strong>hist</strong>:用于绘制直方图，其参数中较为重要的是bins，该参数指定bin(箱子)的个数，即柱状图中柱子的总数，该值默认为10；</p><p>3.2.4<strong>show</strong>: 显示图像。</p><h3 id="3-3图表的修饰项介绍："><a href="#3-3图表的修饰项介绍：" class="headerlink" title="3.3图表的修饰项介绍："></a>3.3图表的修饰项介绍：</h3><p>对于大多数的图表装饰项，其主要实现方式主要有使用过程型的pyplot接口和面向对象的原生matplotlib API两种，分别对应的是函数编程和对象编程两种思想。</p><p>3.3.1<strong>title</strong>：设置或者获取图表标题；</p><p>3.3.2<strong>xlim</strong>：设置或者获取X轴范围；</p><p>3.3.3<strong>xlabel</strong>：设置或者获取X轴标签；</p><p>3.3.4**xticks(&lt;刻度&gt;,&lt;标签&gt;)**：设置或者获取X轴刻度和刻度标签；</p><p>3.3.5**text(x,y,z)**：将文本z绘制在图表的指定坐标(x,y)</p><p>3.3.6<strong>legend</strong>：自动创建图例，可以通过设置loc参数指定图例的位置。需要事先在添加图像时设置label参数。</p><p>3.3.7**twinx(ax)**：返回一个与子图对象ax的x轴一致y轴在右侧的子图对象ax2，用于绘制双轴图表。使用实例方法的形式为<code>ax2=ax.twinx()</code>。</p><p>3.3.8除了上面特别说明的，其它方法各自对应子图对象的的两个实例方法，以xlim为例，就是Axes.get_xlim和Axes.set_xlim。</p><h3 id="3-4子图绘制："><a href="#3-4子图绘制：" class="headerlink" title="3.4子图绘制："></a>3.4子图绘制：</h3><p>简单类型的Artists为标准的绘图元件，例如Line2D、Rectangle、Text、AxesImage等等。而<strong>容器类型</strong>则可以包含许多简单类型的Artists，使它们组织成一个整体，例如Axis、Axes、Figure等。</p><p>3.4.1<strong>figure</strong>：用来创建一个绘图对象，通常也可以不创建绘图对象而调用plot之类的函数直接绘图，matplotlib会自动创建一个绘图对象。通过figsize参数可以指定绘图对象的宽度和高度。如果需要同时绘制多幅图表的话，可以是给figure传递一个整数参数指定图表的序号，如果所指定序号的绘图对象已经存在的话，将不创建新的对象，而只是让它成为当前绘图对象；</p><p>3.4.2<strong>subplot</strong>：创建一个新的Figure，并返回一个含有已创建的subplot对象的NumPy数组。该方法的调用形式为：subplot(numRows,numCols, plotNum)，将整个绘图区域等分为numRows行、numCols列个<strong>子区域</strong>，然后按照从左到右，从上到下的顺序对每个子区域进行编号，左上的子区域的编号为1。如果numRows，numCols和plotNum的值都小于10，可以把它们缩写为一个整数，例如 subplot(321)和subplot(3,2,1)是相同的；对于绘图对象有add_subplot方法用于添加subplot对象；</p><p>3.4.3<strong>subplots</strong>：创建一个包含多个子图的Figure，返回Figure和一个或多个ax（子图）对象，可以通过设置sharex/sharey参数指定共享x轴/y轴；</p><p>3.4.4<strong>axes</strong>：同样往图表添加子图，不同之处在于子图可以设定在绘图区域的任意位置，axes的参数是一个形如[left,bottom, width,height]的列表，这些数值分别指定所创建的Axes对象相对于绘图对象的位置和大小，取值范围都在0到1之间。对于绘图对象有add_axes方法用于添加subplot对象。</p><h3 id="3-5图像的保存："><a href="#3-5图像的保存：" class="headerlink" title="3.5图像的保存："></a>3.5图像的保存：</h3><p>利用<code>plt.savefig</code>可以将当前图表保存到文件，该方法相当于Figure对象的实例方法savefig。具体参数如下：</p><p>3.5.1 fname：含有文件路径的字符串或Python的文件型对象；</p><p>3.5.2 dpi：图像分辨率（每英寸点数），默认为100；</p><p>3.5.3 facecolor，edgecolor，图像的背景色，默认为”w”，即白色；</p><p>3.5.4 format：显式设置文件格式（”png”、”pdf”、”svg”等）；</p><p>3.5.5 bbox_inches：图表需要保存的部分。</p><h3 id="3-6Matplotlib-绘图示例"><a href="#3-6Matplotlib-绘图示例" class="headerlink" title="3.6Matplotlib 绘图示例"></a>3.6Matplotlib 绘图示例</h3><p>3.6.1执行如下命令打开编程环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">ipython</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123119.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123119.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_110843" style="zoom:80%;"><p>3.6.2绘制世界人口与年份的关系图：</p><p>3.6.2.1导入实验所需的库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.dates <span class="keyword">as</span> mdates</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123234.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123234.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_111044" style="zoom:80%;"><p>3.6.2.2year 和pop为年份和对应的全世界人口数辆（单位10亿）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yearInt = [<span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2007</span>, <span class="number">2008</span>, <span class="number">2009</span>, <span class="number">2010</span>, <span class="number">2011</span>, <span class="number">2012</span>, <span class="number">2013</span>, <span class="number">2014</span>, <span class="number">2015</span>, <span class="number">2016</span>, <span class="number">2017</span>, <span class="number">2018</span>, <span class="number">2019</span>, <span class="number">2020</span>]</span><br><span class="line">year = [str(item) <span class="keyword">for</span> item <span class="keyword">in</span> yearInt]  <span class="comment"># 将yearInt中的数字转换成str</span></span><br><span class="line">pop = [<span class="number">6.49</span>, <span class="number">6.558</span>, <span class="number">6.656</span>, <span class="number">6.725</span>, <span class="number">6.804</span>, <span class="number">6.884</span>, <span class="number">6.965</span>, <span class="number">7.043</span>, <span class="number">7.125</span>, <span class="number">7.207</span>, <span class="number">7.356</span>, <span class="number">7.380</span>, <span class="number">7.405</span>, <span class="number">7.440</span>, <span class="number">7.468</span>, <span class="number">8.020</span>]</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123248.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123248.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_114653" style="zoom:80%;"><p>3.6.2.3绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xs = [datetime.strptime(d, <span class="string">'%Y'</span>).date() <span class="keyword">for</span> d <span class="keyword">in</span> year]  <span class="comment"># 将year中的每个如'2005'的字符串转换成只包含年的日期</span></span><br><span class="line">plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="string">'%Y'</span>))  <span class="comment"># gca()获得坐标轴；</span></span><br><span class="line">plt.gca().xaxis.set_major_locator(mdates.YearLocator())  <span class="comment"># 年份</span></span><br><span class="line">plt.plot(xs, pop)  <span class="comment"># 绘制图表</span></span><br><span class="line">plt.gcf().autofmt_xdate()  <span class="comment"># 将x轴的日期自动旋转角度</span></span><br><span class="line">plt.show()  <span class="comment"># 显示图表</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123256.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123256.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115550" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123321.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123321.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115609" style="zoom:80%;"><h3 id="3-7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项"><a href="#3-7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项" class="headerlink" title="3.7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项"></a>3.7在上一幅图表中添加另一条关于中国人品与年份关系的线，并对新图添加对应的修饰项</h3><p>3.7.1添加中国人口数量关系</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.figure()</span><br><span class="line">pop_cn = [<span class="number">1.30756</span>, <span class="number">1.31448</span>, <span class="number">1.32129</span>, <span class="number">1.32802</span>, <span class="number">1.33450</span>, <span class="number">1.34091</span>, <span class="number">1.34735</span>, <span class="number">1.35404</span>, <span class="number">1.36072</span>, <span class="number">1.36782</span>, <span class="number">1.36790</span>, <span class="number">1.36801</span>,</span><br><span class="line">          <span class="number">1.36813</span>, <span class="number">1.36832</span>, <span class="number">1.36845</span>, <span class="number">1.36860</span>]</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123409.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123409.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_115923" style="zoom:80%;"><p>3.7.2绘制人口数量和年份关系；year与pop仍然用之前的数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">plt.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123441.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120014" style="zoom:80%;"><p>3.7.3添加修饰项</p><p>3.7.3.1添加x，y轴标签</p><p>3.7.3.2添加注解。注解点为(2008, 6.725)，内容为年(2013)</p><p>3.7.3.3添加图例，loc=1,表示图例出现在恰当的位置</p><p>3.7.3.4添加title</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel(<span class="string">'year'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Population'</span>)</span><br><span class="line">plt.text(<span class="string">'2008'</span>, <span class="number">6.725</span>, <span class="string">'2013'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"World Population Summary"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123531.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123531.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120228" style="zoom:80%;"><p>3.7.4显示图片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123539.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123539.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120321" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123546.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123546.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120300" style="zoom:80%;"><h3 id="3-8子图的绘制："><a href="#3-8子图的绘制：" class="headerlink" title="3.8子图的绘制："></a>3.8子图的绘制：</h3><p>利用plt.subplots函数创建包含多个子图的绘图对象，还可以设置子图个数。</p><p>3.8.1绘制x轴共享子图，</p><p>3.8.1.1子图个数设置为2，并且共享x轴</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f, (ax1, ax2) = plt.subplots(<span class="number">2</span>, sharex=<span class="literal">True</span>)  <span class="comment"># f是Figure对象；ax1,ax2分别是Axes</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123723.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123723.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120441" style="zoom:80%;"><p>3.8.1.2使用散点图绘制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax1.scatter(year, pop)  <span class="comment"># 绘制散点图</span></span><br><span class="line">ax2.scatter(year, pop_cn)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123731.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123731.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120452" style="zoom:80%;"><p>3.8.1.3添加修饰项：标题，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax1.set_title(<span class="string">'World Population Summary'</span>)  <span class="comment"># 设置标题</span></span><br><span class="line">ax2.set_title(<span class="string">"China Population Summary"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123737.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123737.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120501" style="zoom:80%;"><p>3.8.1.4显示图像</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123745.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123745.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120725" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123752.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123752.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120708" style="zoom:80%;"><p>3.8.2绘制双y轴子图，共享x轴。</p><p>3.8.2.1创建绘图对象fig</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123926.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123926.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120843" style="zoom:80%;"><p>3.8.2.2使用fig.add_subplot函数为绘图对象fig添加两个子图，ax4通过使用ax3的twinx方法创建，且与ax3共享x中，放置在y轴右侧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)  <span class="comment"># 参数是1个3位的整数或3个分隔的整数，描述子图的位置，分别是nrows,ncols,index</span></span><br><span class="line">ax4 = ax3.twinx()  <span class="comment"># 创建一个x轴，并创建一个与原y轴处于相对位置的新y轴</span></span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123932.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123932.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120854" style="zoom:80%;"><p>3.8.2.3绘制子图ax3， ax4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123937.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123937.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_120905" style="zoom:80%;"><p>3.8.2.4添加修饰项：添加x,y轴标签、 标题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123942.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123942.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121021" style="zoom:80%;"><p>3.8.2.5显示图像</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602123949.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123949.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121101" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602123955.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602123955.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121049" style="zoom:80%;"><h3 id="3-9图像的保存："><a href="#3-9图像的保存：" class="headerlink" title="3.9图像的保存："></a>3.9图像的保存：</h3><p>3.9.1代码使用双y轴的代码，代码末尾show（）方法改成保存方法即可</p><p>3.9.2使用plt.savfig()函数保存图像</p><p>3.9.2.1制定保存的名称，格式，像素，以及是否修渐空白区域。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4 = ax3.twinx()</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.savefig(<span class="string">'figure.pdf'</span>, dpi=<span class="number">400</span>, bbox_inches=<span class="string">'tight'</span>)  <span class="comment"># 去除空白区域</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200602124041.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124041.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121228" style="zoom: 80%;"><p>3.9.2.2点击关闭弹出的效果图</p><p>3.9.2.3查看保存的文件：打开火狐浏览器，地址栏键入如下内容（生成图片的绝对路径）</p><img src="https://gitee.com/wxy_666/images/raw/master/20200602124053.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124053.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121449" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200602124102.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200602124102.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-06-02_121529" style="zoom:80%;"><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="所有的代码汇总plt-py"><a href="#所有的代码汇总plt-py" class="headerlink" title="所有的代码汇总plt.py"></a>所有的代码汇总plt.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: plt_5</span></span><br><span class="line"><span class="string">@Description: </span></span><br><span class="line"><span class="string">@Version: </span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-06-02 11:46</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-06-02 11:46</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.dates <span class="keyword">as</span> mdates</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">yearInt = [<span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2007</span>, <span class="number">2008</span>, <span class="number">2009</span>, <span class="number">2010</span>, <span class="number">2011</span>, <span class="number">2012</span>, <span class="number">2013</span>, <span class="number">2014</span>, <span class="number">2015</span>, <span class="number">2016</span>, <span class="number">2017</span>, <span class="number">2018</span>, <span class="number">2019</span>, <span class="number">2020</span>]</span><br><span class="line">year = [str(item) <span class="keyword">for</span> item <span class="keyword">in</span> yearInt]  <span class="comment"># 将yearInt中的数字转换成str</span></span><br><span class="line">pop = [<span class="number">6.49</span>, <span class="number">6.558</span>, <span class="number">6.656</span>, <span class="number">6.725</span>, <span class="number">6.804</span>, <span class="number">6.884</span>, <span class="number">6.965</span>, <span class="number">7.043</span>, <span class="number">7.125</span>, <span class="number">7.207</span>, <span class="number">7.356</span>, <span class="number">7.380</span>, <span class="number">7.405</span>, <span class="number">7.440</span>, <span class="number">7.468</span>, <span class="number">8.020</span>]</span><br><span class="line">xs = [datetime.strptime(d, <span class="string">'%Y'</span>).date() <span class="keyword">for</span> d <span class="keyword">in</span> year]  <span class="comment"># 将year中的每个如'2005'的字符串转换成只包含年的日期</span></span><br><span class="line">plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="string">'%Y'</span>))  <span class="comment"># gca()获得坐标轴；</span></span><br><span class="line">plt.gca().xaxis.set_major_locator(mdates.YearLocator())  <span class="comment"># 年份</span></span><br><span class="line">plt.plot(xs, pop)  <span class="comment"># 绘制图表</span></span><br><span class="line">plt.gcf().autofmt_xdate()  <span class="comment"># 将x轴的日期自动旋转角度</span></span><br><span class="line">plt.show()  <span class="comment"># 显示图表</span></span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line">pop_cn = [<span class="number">1.30756</span>, <span class="number">1.31448</span>, <span class="number">1.32129</span>, <span class="number">1.32802</span>, <span class="number">1.33450</span>, <span class="number">1.34091</span>, <span class="number">1.34735</span>, <span class="number">1.35404</span>, <span class="number">1.36072</span>, <span class="number">1.36782</span>, <span class="number">1.36790</span>, <span class="number">1.36801</span>,</span><br><span class="line">          <span class="number">1.36813</span>, <span class="number">1.36832</span>, <span class="number">1.36845</span>, <span class="number">1.36860</span>]</span><br><span class="line">plt.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">plt.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">plt.xlabel(<span class="string">'year'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Population'</span>)</span><br><span class="line">plt.text(<span class="string">'2008'</span>, <span class="number">6.725</span>, <span class="string">'2013'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">1</span>)</span><br><span class="line">plt.title(<span class="string">"World Population Summary"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">f, (ax1, ax2) = plt.subplots(<span class="number">2</span>, sharex=<span class="literal">True</span>)  <span class="comment"># f是Figure对象；ax1,ax2分别是Axes</span></span><br><span class="line">ax1.scatter(year, pop)  <span class="comment"># 绘制散点图</span></span><br><span class="line">ax2.scatter(year, pop_cn)</span><br><span class="line">ax1.set_title(<span class="string">'World Population Summary'</span>)  <span class="comment"># 设置标题</span></span><br><span class="line">ax2.set_title(<span class="string">"China Population Summary"</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)  <span class="comment"># 参数是1个3位的整数或3个分隔的整数，描述子图的位置，分别是nrows,ncols,index</span></span><br><span class="line">ax4 = ax3.twinx()  <span class="comment"># 创建一个x轴，并创建一个与原y轴处于相对位置的新y轴</span></span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax3.plot(year, pop, color=<span class="string">"g"</span>, label=<span class="string">"World population"</span>)</span><br><span class="line">ax3.set_ylabel(<span class="string">'World population'</span>)</span><br><span class="line">ax3.set_title(<span class="string">"Double Y axis"</span>)</span><br><span class="line">ax4 = ax3.twinx()</span><br><span class="line">ax4.plot(year, pop_cn, linestyle=<span class="string">"--"</span>, color=<span class="string">"r"</span>, label=<span class="string">"China population"</span>)</span><br><span class="line">ax4.set_ylabel(<span class="string">'China population'</span>)</span><br><span class="line">ax4.set_xlabel(<span class="string">'Year'</span>)</span><br><span class="line">plt.savefig(<span class="string">'figure.pdf'</span>, dpi=<span class="number">400</span>, bbox_inches=<span class="string">'tight'</span>)  <span class="comment"># 去除空白区域</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Python的Matplotlib实现数据可视化。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="可视化" scheme="https://666wxy666.github.io/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
      <category term="iPython" scheme="https://666wxy666.github.io/tags/iPython/"/>
    
      <category term="Matplotlib" scheme="https://666wxy666.github.io/tags/Matplotlib/"/>
    
  </entry>
  
  <entry>
    <title>Linux 上机实战4 SimpleShell</title>
    <link href="https://666wxy666.github.io/2020/06/01/Linux-%E4%B8%8A%E6%9C%BA%E5%AE%9E%E6%88%984-SimpleShell/"/>
    <id>https://666wxy666.github.io/2020/06/01/Linux-%E4%B8%8A%E6%9C%BA%E5%AE%9E%E6%88%984-SimpleShell/</id>
    <published>2020-05-31T16:00:00.000Z</published>
    <updated>2020-09-02T02:01:19.978Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本文是关于Linux中的一个简单的shell，支持运行多个命令以[;]分割，支持管道和重定向，支持CTRL-C终止内部命令而不终止simple shell本身，有完善的错误处理及醒目的颜色提示。</strong></p><a id="more"></a><h2 id="一、实验环境"><a href="#一、实验环境" class="headerlink" title="一、实验环境"></a>一、实验环境</h2><p>硬件：</p><ul><li>Intel i7 7700HQ，内存16GB；</li></ul><p>软件：</p><ul><li><p>基于Arch Linux的Manjaro</p></li><li><p>Linux内核：Linux 5.4.39-1-MANJARO x86_64</p></li><li><p>C语言</p></li></ul><h2 id="二、基本步骤"><a href="#二、基本步骤" class="headerlink" title="二、基本步骤"></a>二、基本步骤</h2><ol><li><p>编写代码grep+wc.c（代码源码见附件grep+wc.c或本文最后的附录）：</p><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_212437.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_212437.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_212437" style="zoom:80%;"></li></ol><ol start="2"><li><p>编译</p><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_211357.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_211357.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_211357" style="zoom:80%;"></li><li><p>在grep+wc.c的基础上进行拓展，编写代码simple_shell.c（代码源码见附件simple_shell.c或本文最后的附录）：</p><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_21306.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_21306.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_21306" style="zoom:80%;"><p>在编写时遇到了一个棘手的问题，就是关于“子进程对父进程信号的继承情况”。总结一下就是：</p><ul><li><p>仅fork时子进程会继承父进程fork之前所设置的信号处理方式。</p></li><li><p>当有exec加载新程序时</p><ul><li>子进程继承的处理方式是忽略或默认处理方式时，exec新程序后设置依然有效。</li><li>如果子进程继承是捕获处理方式时，exec新程序后将被还原为默认处理方式。</li></ul></li></ul><p>详细请查看这位大佬的文章<a href="https://blog.csdn.net/qq_43648751/article/details/104623880" target="_blank" rel="external nofollow noopener noreferrer">子进程对父进程信号的继承情况详细分析（信号）【linux】（zs）</a>。</p></li><li><p>编译</p><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_210259.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_210259.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_210259" style="zoom:80%;"></li></ol><h2 id="三、测试样例"><a href="#三、测试样例" class="headerlink" title="三、测试样例"></a>三、测试样例</h2><h3 id="0、在Shell（zsh）里运行所给命令"><a href="#0、在Shell（zsh）里运行所给命令" class="headerlink" title="0、在Shell（zsh）里运行所给命令"></a>0、在Shell（zsh）里运行所给命令</h3><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214711.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214711.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214711" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214739.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214739.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214739" style="zoom:80%;"><h3 id="1、grep-wc"><a href="#1、grep-wc" class="headerlink" title="1、grep+wc"></a>1、grep+wc</h3><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213548.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213548.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_213548" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213619.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213619.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_213619" style="zoom:80%;"><h3 id="2、simple-shell"><a href="#2、simple-shell" class="headerlink" title="2、simple_shell"></a>2、simple_shell</h3><h4 id="1-特殊命令"><a href="#1-特殊命令" class="headerlink" title="1.特殊命令"></a>1.特殊命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213811.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_213811.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_213811" style="zoom:80%;"><h4 id="2-普通命令"><a href="#2-普通命令" class="headerlink" title="2.普通命令"></a>2.普通命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214038.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214038.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214038" style="zoom:80%;"><h4 id="3-重定向命令"><a href="#3-重定向命令" class="headerlink" title="3.重定向命令"></a>3.重定向命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214206.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214206.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214206" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214238.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214238.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214238" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214321.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214321.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214321" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214356.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214356.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214356" style="zoom:80%;"><h4 id="4-管道命令"><a href="#4-管道命令" class="headerlink" title="4.管道命令"></a>4.管道命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214436.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214436.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214436" style="zoom:80%;"><h4 id="5-综合命令"><a href="#5-综合命令" class="headerlink" title="5.综合命令"></a>5.综合命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214527.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214527.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214527" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214606.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_214606.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_214606" style="zoom:80%;"><h4 id="6-错误命令"><a href="#6-错误命令" class="headerlink" title="6.错误命令"></a>6.错误命令</h4><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_215944.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_215944.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_215944" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_220012.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_220012.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_220012" style="zoom:80%;"><h4 id="7-CTRL-C"><a href="#7-CTRL-C" class="headerlink" title="7.CTRL-C"></a>7.CTRL-C</h4><p>输入<code>find / -name hello</code>，在运行期间输入<code>CTRL-C</code>杀死正在运行的find程序。可以发现find命令停止，但是Simple Shell并没有退出（输入exit可以正常退出）。</p><img src="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_220213.png" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/Screenshot_20200521_220213.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot_20200521_220213" style="zoom:80%;"><h2 id="四、项目地址"><a href="#四、项目地址" class="headerlink" title="四、项目地址"></a>四、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/Linux_Projects" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=Linux_Projects&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=Linux_Projects&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a><div class="btns rounded center grid1">            <a class="button" href="https://github.com/666WXY666/Linux_Projects/tree/master/%E7%AE%80%E5%8C%96%E7%9A%84Shell" target="_blank" rel="external nofollow noopener noreferrer" title="源码仓库"><i class="fas fa-download"></i>源码仓库</a>          </div><h2 id="五、附录"><a href="#五、附录" class="headerlink" title="五、附录"></a>五、附录</h2><p><strong><em>PS:程序源码均有详细的注释</em></strong></p><h3 id="1、grep-wc-c"><a href="#1、grep-wc-c" class="headerlink" title="1、grep+wc.c"></a>1、grep+wc.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: grep -v usr &lt; /etc/passwd | wc –l &gt; r.txt; cat r.txt</span></span><br><span class="line"><span class="comment"> * @Version: 1.0</span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-21 09:44:26</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-05-21 21:23:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sv;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    pipe(fd);</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 输入重定向</span></span><br><span class="line">        <span class="keyword">int</span> fd0 = <span class="number">-1</span>;</span><br><span class="line">        fd0 = <span class="built_in">open</span>(<span class="string">"/etc/passwd"</span>, O_RDONLY);</span><br><span class="line">        <span class="keyword">if</span> (fd0 != <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            dup2(fd0, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">close</span>(fd0);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 管道输入端</span></span><br><span class="line">        dup2(fd[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">// 执行管道前的命令</span></span><br><span class="line">        execlp(<span class="string">"grep"</span>, <span class="string">"grep"</span>, <span class="string">"-v"</span>, <span class="string">"usr"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 输出重定向</span></span><br><span class="line">            <span class="keyword">int</span> fd1 = <span class="number">-1</span>;</span><br><span class="line">            fd1 = <span class="built_in">open</span>(<span class="string">"r.txt"</span>, O_CREAT | O_WRONLY | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">            <span class="keyword">if</span> (fd1 != <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                dup2(fd1, <span class="number">1</span>);</span><br><span class="line">                <span class="built_in">close</span>(fd1);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 管道输出端</span></span><br><span class="line">            dup2(fd[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">            <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">            <span class="comment">// 执行管道后的命令</span></span><br><span class="line">            execlp(<span class="string">"wc"</span>, <span class="string">"wc"</span>, <span class="string">"-l"</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">    wait(&amp;sv);</span><br><span class="line">    wait(&amp;sv);</span><br><span class="line">    <span class="comment">// 执行第二个命令</span></span><br><span class="line">    execlp(<span class="string">"cat"</span>, <span class="string">"cat"</span>, <span class="string">"r.txt"</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、simple-shell-c"><a href="#2、simple-shell-c" class="headerlink" title="2、simple_shell.c"></a>2、simple_shell.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> * @Description: Simple Shell</span></span><br><span class="line"><span class="comment"> * @Version: 1.0</span></span><br><span class="line"><span class="comment"> * @Author: 苇名一心</span></span><br><span class="line"><span class="comment"> * @Date: 2020-05-21 09:44:26</span></span><br><span class="line"><span class="comment"> * @LastEditors: 苇名一心</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2020-05-21 21:56:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NONE <span class="meta-string">"\e[0m"</span>   <span class="comment">// 复原</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RED <span class="meta-string">"\e[0;31m"</span> <span class="comment">// ERROR</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> version[] = <span class="string">"1.0"</span>; <span class="comment">// 版本号</span></span><br><span class="line"><span class="keyword">int</span> pipe_flag = <span class="number">0</span>;      <span class="comment">// 是否使用管道</span></span><br><span class="line"><span class="keyword">static</span> jmp_buf env;</span><br><span class="line"><span class="keyword">int</span> sv;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CTRL-C回调函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sig_handler</span><span class="params">(<span class="keyword">int</span> sig)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pipe_flag)</span><br><span class="line">    &#123;</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    siglongjmp(env, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印帮助</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">help</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"**********************************************************\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%27sHELP%27s\n**********************************************************\n"</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Simple Shell %s by 苇名一心 May 21 2020\n"</span>, version);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Usage: [COMMAND] [OPTION]... (&lt; [INFILE]) (| [COMMAND] [OPTION]... (&gt; [OUTFILE])) (;...;...)\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Simple shell with redirect and pipe(Can also run multiple commands)\nSpecial commands:\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\thelp\tDisplay this help and continue\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\texit\tExit simple shell\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"**********************************************************\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="number">256</span>], *argv1[<span class="number">256</span>], **p, *argv2[<span class="number">256</span>], *buf, *<span class="built_in">end</span>, *cmd2, *in, *out;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">// CTRL-C信号自行处理</span></span><br><span class="line">    signal(SIGINT, sig_handler);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;)</span><br><span class="line">    &#123;</span><br><span class="line">        sigsetjmp(env, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 打印提示符</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"=&gt; "</span>);</span><br><span class="line">        <span class="comment">// 获取命令</span></span><br><span class="line">        <span class="keyword">if</span> (fgets(<span class="built_in">buffer</span>, <span class="keyword">sizeof</span>(<span class="built_in">buffer</span>), <span class="built_in">stdin</span>) == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//没有输入任何命令</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strlen</span>(<span class="built_in">buffer</span>) == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 命令最后加;用于判断</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">buffer</span>[<span class="built_in">strlen</span>(<span class="built_in">buffer</span>) - <span class="number">2</span>] != <span class="string">';'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">buffer</span>[<span class="built_in">strlen</span>(<span class="built_in">buffer</span>) - <span class="number">1</span>] = <span class="string">';'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取每一条;分割的命令，依次执行</span></span><br><span class="line">        <span class="keyword">for</span> (buf = <span class="built_in">buffer</span>; <span class="built_in">end</span> = <span class="built_in">strstr</span>(buf, <span class="string">";"</span>); buf = <span class="built_in">end</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            *<span class="built_in">end</span>++ = <span class="string">'\0'</span>;</span><br><span class="line">            pipe_flag = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 获取管道命令，输入重定向文件和输出重定向文件</span></span><br><span class="line">            <span class="comment">// note:必须先获取管道命令，in和out在进行分词操作，因为分词会修改buf，导致获取管道命令，in和out出错</span></span><br><span class="line">            cmd2 = <span class="built_in">strstr</span>(buf, <span class="string">"|"</span>);</span><br><span class="line">            in = <span class="built_in">strstr</span>(buf, <span class="string">"&lt;"</span>);</span><br><span class="line">            out = <span class="built_in">strstr</span>(buf, <span class="string">"&gt;"</span>);</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                *in++ = <span class="string">'\0'</span>;</span><br><span class="line">                in = strtok(in, <span class="string">" \t\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                *out++ = <span class="string">'\0'</span>;</span><br><span class="line">                out = strtok(out, <span class="string">" \t\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cmd2 != <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                pipe_flag = <span class="number">1</span>;</span><br><span class="line">                *cmd2++ = <span class="string">'\0'</span>;</span><br><span class="line">                <span class="keyword">for</span> (p = &amp;argv2[<span class="number">0</span>], *p = strtok(cmd2, <span class="string">" \t\n"</span>); *p != <span class="literal">NULL</span>; *++p = strtok(<span class="literal">NULL</span>, <span class="string">" \t\n"</span>))</span><br><span class="line">                    ;</span><br><span class="line">                <span class="keyword">if</span> (argv2[<span class="number">0</span>] == <span class="literal">NULL</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** No command 2 input!\n"</span> NONE);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (p = &amp;argv1[<span class="number">0</span>], *p = strtok(buf, <span class="string">" \t\n"</span>); *p != <span class="literal">NULL</span>; *++p = strtok(<span class="literal">NULL</span>, <span class="string">" \t\n"</span>))</span><br><span class="line">                ;</span><br><span class="line">            <span class="comment">// 没有命令输入</span></span><br><span class="line">            <span class="keyword">if</span> (argv1[<span class="number">0</span>] == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** No command 1 input!\n"</span> NONE);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 输入了exit</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv1[<span class="number">0</span>], <span class="string">"exit"</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// 输入了help</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv1[<span class="number">0</span>], <span class="string">"help"</span>) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                help();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 使用了管道</span></span><br><span class="line">            <span class="keyword">if</span> (pipe_flag)</span><br><span class="line">            &#123;</span><br><span class="line">                pipe(fd);</span><br><span class="line">                <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 输入重定向</span></span><br><span class="line">                    <span class="keyword">int</span> fd0 = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (in != <span class="literal">NULL</span>)</span><br><span class="line">                        fd0 = <span class="built_in">open</span>(in, O_RDONLY);</span><br><span class="line">                    <span class="keyword">if</span> (fd0 != <span class="number">-1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        dup2(fd0, <span class="number">0</span>);</span><br><span class="line">                        <span class="built_in">close</span>(fd0);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (in != <span class="literal">NULL</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** No such file or directory: %s\n"</span> NONE, in);</span><br><span class="line">                        help();</span><br><span class="line">                        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 管道输入端</span></span><br><span class="line">                    dup2(fd[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">                    <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">                    <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">                    <span class="comment">// 执行管道前的命令</span></span><br><span class="line">                    execvp(argv1[<span class="number">0</span>], argv1);</span><br><span class="line">                    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** Bad command 1: %m\n"</span> NONE);</span><br><span class="line">                    help();</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 输出重定向</span></span><br><span class="line">                        <span class="keyword">int</span> fd1 = <span class="number">-1</span>;</span><br><span class="line">                        <span class="keyword">if</span> (out != <span class="literal">NULL</span>)</span><br><span class="line">                            fd1 = <span class="built_in">open</span>(out, O_CREAT | O_WRONLY | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">                        <span class="keyword">if</span> (fd1 != <span class="number">-1</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            dup2(fd1, <span class="number">1</span>);</span><br><span class="line">                            <span class="built_in">close</span>(fd1);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 管道输出端</span></span><br><span class="line">                        dup2(fd[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">                        <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">                        <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">                        <span class="comment">// 执行管道后的命令</span></span><br><span class="line">                        execvp(argv2[<span class="number">0</span>], argv2);</span><br><span class="line">                        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** Bad command 2: %m\n"</span> NONE);</span><br><span class="line">                        help();</span><br><span class="line">                        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">close</span>(fd[<span class="number">0</span>]);</span><br><span class="line">                <span class="built_in">close</span>(fd[<span class="number">1</span>]);</span><br><span class="line">                wait(&amp;sv);</span><br><span class="line">                wait(&amp;sv);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 没有使用管道</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> fd0 = <span class="number">-1</span>, fd1 = <span class="number">-1</span>;</span><br><span class="line">                    <span class="comment">// 输入重定向</span></span><br><span class="line">                    <span class="keyword">if</span> (in != <span class="literal">NULL</span>)</span><br><span class="line">                        fd0 = <span class="built_in">open</span>(in, O_RDONLY);</span><br><span class="line">                    <span class="keyword">if</span> (fd0 != <span class="number">-1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        dup2(fd0, <span class="number">0</span>);</span><br><span class="line">                        <span class="built_in">close</span>(fd0);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (in != <span class="literal">NULL</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** No such file or directory: %s\n"</span> NONE, in);</span><br><span class="line">                        help();</span><br><span class="line">                        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 输出重定向</span></span><br><span class="line">                    <span class="keyword">if</span> (out != <span class="literal">NULL</span>)</span><br><span class="line">                        fd1 = <span class="built_in">open</span>(out, O_CREAT | O_WRONLY | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">                    <span class="keyword">if</span> (fd1 != <span class="number">-1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        dup2(fd1, <span class="number">1</span>);</span><br><span class="line">                        <span class="built_in">close</span>(fd1);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 执行命令</span></span><br><span class="line">                    execvp(argv1[<span class="number">0</span>], argv1);</span><br><span class="line">                    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">"** Bad command 1: %m\n"</span> NONE);</span><br><span class="line">                    help();</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                wait(&amp;sv);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是关于Linux中的一个简单的shell，支持运行多个命令以[;]分割，支持管道和重定向，支持CTRL-C终止内部命令而不终止simple shell本身，有完善的错误处理及醒目的颜色提示。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://666wxy666.github.io/categories/Linux/"/>
    
      <category term="上机实战" scheme="https://666wxy666.github.io/categories/Linux/%E4%B8%8A%E6%9C%BA%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="C" scheme="https://666wxy666.github.io/tags/C/"/>
    
      <category term="Linux" scheme="https://666wxy666.github.io/tags/Linux/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="Shell" scheme="https://666wxy666.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>机器学习 实验 K-Means聚类</title>
    <link href="https://666wxy666.github.io/2020/05/17/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-K-Means%E8%81%9A%E7%B1%BB/"/>
    <id>https://666wxy666.github.io/2020/05/17/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E9%AA%8C-K-Means%E8%81%9A%E7%B1%BB/</id>
    <published>2020-05-16T16:00:00.000Z</published>
    <updated>2020-09-02T02:06:46.893Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于经典聚类算法K-Means的代码实现。</p><a id="more"></a><h2 id="一、实验目标"><a href="#一、实验目标" class="headerlink" title="一、实验目标"></a>一、实验目标</h2><p>数据说明：目标是对 cluster.dat 里的数据进行聚类分析。其中，cluster.dat 包含了若干二维输入数据（但不包含其输出）。</p><ul><li><p>使用 K-means 模型进行聚类，尝试使用不同的类别个数 K，并分析聚类结果。 </p></li><li><p>按照 8:2 的比例随机将数据划分为训练集和测试集，至少尝试 3 个不同的 K 值，并画出不同 K 下的聚类结果，及不同模型在训练集和测试集上的损失。对结果进行讨论，发现能解释数据的最好的 K值。</p></li></ul><h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><ul><li>语言：Python 3.7（Anaconda3）</li><li>IDE：PyCharm 2020.1.1 (Professional Edition)</li><li>Packages：<ul><li>numpy：1.18.1</li><li>matplotlib：3.1.3</li></ul></li></ul><h2 id="三、算法原理"><a href="#三、算法原理" class="headerlink" title="三、算法原理"></a>三、算法原理</h2><p>聚类是一种典型无监督学习，K-means算法是聚类的经典算法。目标是将原始数据集划分为k个簇，最小化损失函数（目标函数）是：<br>$$<br>SSE=\sum_{n=1}^{N}\sum_{k=1}^{K}r_{nk}dist(x_n-\mu_k)<br>$$</p><ul><li>$\mu_k$表示簇$C_k$的中心点（或其他能代表$C_k$的点）。</li><li>$x_n$被划分到簇$C_k$则$r_{nk}=1$，否则$r_{nk}=0$。</li><li>目标是找到簇的中心点$\mu_k$及簇的划分$r_{nk}$使得目标函数SSE最小。</li></ul><p>要解决上述问题就需要遍历所有可能的簇划分，显然这是不合适的。K-means算法使用了贪心策略求一个近似解，具体步骤如下：</p><ol><li>将全部数据随机分为k类，计算每类的重心作为初始点。</li><li>计算所有数据点与各个簇中心之间的距离，将数据点划到与它距离最近的簇中。</li><li>根据簇中已有的样本点，重新计算簇中心（一般使用重心）。</li><li>重复2、3，直到数据点的簇划分不在变化或者达到了规定的最大迭代次数。</li></ol><p>这是k-means算法的基本步骤，但是，这个算法有个很严重的问题，就是在将数据点划到与它距离最近的簇后，由于初始簇心选择不当，可能产生空簇，导致计算簇中心无法进行（簇的size=0，除数为0），我的解决方法是在计算簇心时，如果簇的size=0就先忽略，后面单独处理。计算完非空簇心后，依次选取与自己簇中心最远、次远……的点（因为距离自己的簇心越远，这个点分到该簇的概率越低）作为空簇的簇心，直到没有空簇，即所有的簇都有簇心，然后继续算法。</p><h2 id="四、算法流程图"><a href="#四、算法流程图" class="headerlink" title="四、算法流程图"></a>四、算法流程图</h2><p>这只是算法函数（algorithm）和其他一些部分的流程图，不是整个程序的流程图，整个程序要更复杂。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524095524.svg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524095524.svg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="程序流程图" style="zoom: 67%;"><h2 id="五、实验结果及分析"><a href="#五、实验结果及分析" class="headerlink" title="五、实验结果及分析"></a>五、实验结果及分析</h2><ol><li><p>输入k的范围是[2,10]，测试集所占比例为0.2，最大迭代次数为20。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524104752.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104752.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104724" style="zoom:50%;"></li><li><p>聚类结果</p><table><thead><tr><th align="center">k=2</th><th align="center">k=3</th><th align="center">k=4</th></tr></thead><tbody><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104824.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104824.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104436" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104838.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104838.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104447" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104853.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104853.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104456" style="zoom: 67%;"></td></tr><tr><td align="center"><strong>k=5</strong></td><td align="center"><strong>k=6</strong></td><td align="center"><strong>k=7</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104910.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104910.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104505" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104921.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104921.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104521" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104933.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104933.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104543" style="zoom:67%;"></td></tr><tr><td align="center"><strong>k=8</strong></td><td align="center"><strong>k=9</strong></td><td align="center"><strong>k=10</strong></td></tr><tr><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524104954.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524104954.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104555" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524105001.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105001.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104607" style="zoom:67%;"></td><td align="center"><img src="https://gitee.com/wxy_666/images/raw/master/20200524105008.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105008.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104617" style="zoom:67%;"></td></tr></tbody></table></li></ol><ol start="3"><li><p>k从2~10的数据集、训练集和测试集的SSE如图：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200524105029.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200524105029.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-24_104656" style="zoom: 67%;"></li><li><p>可以发现k=2~4时SSE下降较快，k=4~10时下降较慢，由于我们的目标是使SSE减小，因此由图可以得出k=4为解释数据较好的k。并且在k=2时，重复实验甚至会出现完全不同的聚类结果，说明k=2太小。在k&gt;=6之后，SSE基本不下降，说明k再加大没有多大意义。</p></li></ol><h2 id="六、项目地址"><a href="#六、项目地址" class="headerlink" title="六、项目地址"></a>六、项目地址</h2><p>本项目的源码、可执行程序均已经存放于我的Github，欢迎下载查看：</p><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/kmeans" target="_blank"><img src="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=kmeans&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.vercel.app/api/pin/?username=666WXY666&repo=kmeans&show_owner=true" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></a><h2 id="七、附录"><a href="#七、附录" class="headerlink" title="七、附录"></a>七、附录</h2><p>kmeans.py：</p><ol start="0"><li><p>基本配置、全局参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Copyright: Copyright (c) 2020 苇名一心 All Rights Reserved.</span></span><br><span class="line"><span class="string">@Project: kmeans</span></span><br><span class="line"><span class="string">@Description: k-means算法</span></span><br><span class="line"><span class="string">@Version: 1.0</span></span><br><span class="line"><span class="string">@Author: 苇名一心</span></span><br><span class="line"><span class="string">@Date: 2020-05-22 21:25</span></span><br><span class="line"><span class="string">@LastEditors: 苇名一心</span></span><br><span class="line"><span class="string">@LastEditTime: 2020-05-22 21:25</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 全局变量</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">'font.sans-serif'</span>] = [<span class="string">'SimHei'</span>]</span><br><span class="line"><span class="comment"># 显示负号</span></span><br><span class="line">plt.rcParams[<span class="string">'axes.unicode_minus'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 簇个数范围</span></span><br><span class="line">k_min = <span class="number">1</span></span><br><span class="line">k_max = <span class="number">1</span></span><br><span class="line">max_iteration = <span class="number">10</span>  <span class="comment"># 最大迭代次数</span></span><br><span class="line">test_rate = <span class="number">0.2</span>  <span class="comment"># 训练集所占比例</span></span><br><span class="line">all_point_num = <span class="number">0</span></span><br><span class="line">data_x = []  <span class="comment"># 点的x坐标列表</span></span><br><span class="line">data_y = []  <span class="comment"># 点的y坐标列表</span></span><br><span class="line">data_SSE_list = []  <span class="comment"># 数据集损失目标函数列表</span></span><br><span class="line">train_SSE_list = []  <span class="comment"># 训练集损失目标函数列表</span></span><br><span class="line">test_SSE_list = []  <span class="comment"># 测试集损失目标函数列表</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>读入数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 读入数据</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_data</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> all_point_num</span><br><span class="line">    <span class="keyword">global</span> test_rate</span><br><span class="line">    <span class="keyword">global</span> max_iteration</span><br><span class="line">    <span class="keyword">global</span> k_min</span><br><span class="line">    <span class="keyword">global</span> k_max</span><br><span class="line">    data = open(path)  <span class="comment"># 打开数据文件</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        <span class="comment"># 将数据文件的每一行按空格分隔，分别添加到x,y列表</span></span><br><span class="line">        data_x.append(float(line.split()[<span class="number">0</span>]))</span><br><span class="line">        data_y.append(float(line.split()[<span class="number">1</span>]))</span><br><span class="line">        all_point_num += <span class="number">1</span></span><br><span class="line">    print(<span class="string">"请输入k的范围（空格分隔，例如2 5，代表闭区间[2,5]）："</span>, end=<span class="string">""</span>)</span><br><span class="line">    k_min, k_max = map(int, input().split())</span><br><span class="line">    <span class="keyword">if</span> k_min &gt; k_max <span class="keyword">or</span> k_min &lt; <span class="number">1</span> <span class="keyword">or</span> k_max &lt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 簇的个数输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"请输入测试集所占比例："</span>, end=<span class="string">""</span>)</span><br><span class="line">    test_rate = float(input())</span><br><span class="line">    <span class="keyword">if</span> test_rate &lt; <span class="number">0</span> <span class="keyword">or</span> test_rate &gt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 测试集所占比例输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"请输入最大迭代次数："</span>, end=<span class="string">""</span>)</span><br><span class="line">    max_iteration = int(input())</span><br><span class="line">    <span class="keyword">if</span> max_iteration &lt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"ERROR: 最大迭代次数输入错误！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>算法计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 算法</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">algorithm</span><span class="params">(x, y, k)</span>:</span></span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    n = <span class="number">0</span>  <span class="comment"># 迭代次数</span></span><br><span class="line">    SSE = <span class="number">0</span>  <span class="comment"># 损失（目标）函数</span></span><br><span class="line">    point_array = np.array([x, y])  <span class="comment"># 生成点的numpy数组，例如三个点(1，-1),(2，-2),(3，-3)生成[[ 1  2  3 ][ -1 -2 -3 ]]</span></span><br><span class="line">    point_num = point_array.shape[<span class="number">1</span>]  <span class="comment"># 获取点的个数，所给的数据集为1000个点，取0.8为800个</span></span><br><span class="line">    <span class="comment"># 如果点的个数&lt;簇的个数，则报错异常退出</span></span><br><span class="line">    <span class="keyword">if</span> point_num &lt; k:</span><br><span class="line">        print(<span class="string">"ERROR: 点的个数&lt;簇的个数！"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    distance = np.zeros(k)  <span class="comment"># 初始化k维0向量，用来存储这个点到的k个簇中心的距离</span></span><br><span class="line">    point_distance = np.zeros(point_num)  <span class="comment"># 初始化point_num维0向量，用来存储每个点到其簇中心的距离</span></span><br><span class="line">    center = np.zeros((<span class="number">2</span>, k))  <span class="comment"># 生成2*k的零矩阵，初始化k个簇的中心点，后面将先计算每个簇的重心作为初始簇中心</span></span><br><span class="line">    point_k1 = np.arange(<span class="number">0</span>, k, <span class="number">1</span>)  <span class="comment"># 先生成0~k-1的数组，保证每个簇至少有一个点</span></span><br><span class="line">    point_k2 = np.random.randint(<span class="number">0</span>, k, size=point_num - k)  <span class="comment"># 将剩下的点随机分到任意一个簇，返回长度为point_num-k的向量，每个为0~k-1的随机整数</span></span><br><span class="line">    point_k = np.concatenate((point_k1, point_k2))  <span class="comment"># 将前两个数组合成为一个</span></span><br><span class="line">    np.random.shuffle(point_k)  <span class="comment"># 最后再打乱一次point_k数组，保证随机性</span></span><br><span class="line">    point_k_bak = point_k.copy()  <span class="comment"># point_k的备份，用于判断前后两次迭代是否发生变化</span></span><br><span class="line">    <span class="comment"># 输出相关信息</span></span><br><span class="line">    print(<span class="string">"点个数为："</span>, point_num, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 开始K-means算法的迭代</span></span><br><span class="line">    <span class="comment"># 只要迭代次数没有超过最大迭代次数上限max_iteration并且两次迭代的结果还有变化，就继续迭代</span></span><br><span class="line">    <span class="keyword">while</span> n &lt;= max_iteration:</span><br><span class="line">        <span class="comment"># 计算每个簇的中心</span></span><br><span class="line">        size = np.bincount(point_k, minlength=k)  <span class="comment"># 计算每个簇的规模，k维向量，每一维为每个簇里点的个数</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(k):  <span class="comment"># 对于k个簇中的每一个簇i</span></span><br><span class="line">            <span class="comment"># 不是空簇，防止出现除数为0，空簇下面单独处理</span></span><br><span class="line">            <span class="keyword">if</span> size[i] != <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># point_sum是一个二维向量，代表i簇中的所有点的x,y坐标值的和</span></span><br><span class="line">                point_sum = np.zeros(<span class="number">2</span>)  <span class="comment"># 初始化为0</span></span><br><span class="line">                <span class="comment"># 计算i簇中的所有点的x,y坐标值的和</span></span><br><span class="line">                <span class="keyword">for</span> point <span class="keyword">in</span> range(point_num):  <span class="comment"># 对于每一个点point</span></span><br><span class="line">                    <span class="keyword">if</span> point_k[point] == i:  <span class="comment"># 如果这个点point属于簇i</span></span><br><span class="line">                        point_sum = point_sum + point_array[:, point]  <span class="comment"># 将这个点的x,y坐标加到point_sum上</span></span><br><span class="line">                        <span class="comment"># note: array[:, i]就是取array的第i列，刚好就是这个点</span></span><br><span class="line">                <span class="comment"># 求平均数，因此要/这个簇中点的个数size[i]</span></span><br><span class="line">                <span class="comment"># 将计算出的簇中心存在center矩阵中的第i列，代表第i个簇的中心点</span></span><br><span class="line">                center[:, i] = point_sum / size[i]</span><br><span class="line">        <span class="comment"># 对所有的空簇单独处理</span></span><br><span class="line">        <span class="comment"># 处理方式为把与自己所在的簇中心距离最大的点作为空簇的簇中心</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> np.where(size == <span class="number">0</span>)[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># 将距离最大的点的所在簇改为空簇的簇号</span></span><br><span class="line">            point_k[np.argmax(point_distance)] = c</span><br><span class="line">            <span class="comment"># 将空簇中心改为这个点</span></span><br><span class="line">            center[:, c] = point_array[:, np.argmax(point_distance)]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将每一个点分到与簇中心最近的簇</span></span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> range(point_num):  <span class="comment"># 对于每一个点point</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(k):  <span class="comment"># 对于k个簇中的每一个簇i</span></span><br><span class="line">                <span class="comment"># 计算该点point到该簇i的距离</span></span><br><span class="line">                <span class="comment"># note: 使用矩阵的2范式，来计算欧氏距离</span></span><br><span class="line">                <span class="comment">#  point_array[:, point] - center[:, i]得到向量[p_x-c_x, p_y-c_y]</span></span><br><span class="line">                <span class="comment">#  对该向量求2范式刚好是欧式距离sqrt((p_x-c_x)^2+(p_y-c_y)^2)</span></span><br><span class="line">                distance[i] = np.linalg.norm(point_array[:, point] - center[:, i])</span><br><span class="line">            <span class="comment"># 使用numpy的argmin()返回distance中最小值的下标，也就是点point到簇中心距离最小的簇</span></span><br><span class="line">            point_k[point] = np.argmin(distance)</span><br><span class="line">            <span class="comment"># 将该点到其簇中心的距离记录下来</span></span><br><span class="line">            point_distance[point] = distance[point_k[point]]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 迭代次数+1</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 判断两次迭代是否有变化，没有变化就跳出迭代循环</span></span><br><span class="line">        <span class="keyword">if</span> (point_k == point_k_bak).all():</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 将point_k备份</span></span><br><span class="line">        point_k_bak = point_k.copy()</span><br><span class="line">        <span class="comment"># 输出每次迭代目标函数值</span></span><br><span class="line">        SSE = np.sum(point_distance)</span><br><span class="line">        print(<span class="string">"n="</span>, n - <span class="number">1</span>, <span class="string">"，SSE="</span>, SSE, sep=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出相关信息</span></span><br><span class="line">    print(<span class="string">"总迭代次数为："</span>, n - <span class="number">1</span>, sep=<span class="string">""</span>)</span><br><span class="line">    print(<span class="string">"每个簇的中心："</span>, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        print(<span class="string">"("</span>, center[<span class="number">0</span>, i], <span class="string">","</span>, center[<span class="number">1</span>, i], <span class="string">")"</span>, sep=<span class="string">""</span>)</span><br><span class="line">    print(<span class="string">"==================================================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> SSE, point_k</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>画图展示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 画图展示</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 根据每个点所在的簇，获取点的颜色，返回一个列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_color_list</span><span class="params">(point_k, k)</span>:</span></span><br><span class="line">    <span class="comment"># 随机生成k个颜色</span></span><br><span class="line">    RGB = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>]</span><br><span class="line">    colors = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; k:</span><br><span class="line">        color = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">            color += RGB[random.randint(<span class="number">0</span>, <span class="number">14</span>)]</span><br><span class="line">        <span class="comment"># 只有随机产生的颜色不相同，才加到colors中，颜色个数+1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"#"</span> + color <span class="keyword">not</span> <span class="keyword">in</span> colors <span class="keyword">and</span> color != <span class="string">"FFFFFF"</span>:</span><br><span class="line">            colors.append(<span class="string">"#"</span> + color)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 对每个点，根据point_k中记录的点所在的簇，将颜色添加到列表中</span></span><br><span class="line">    color_list = []</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> point_k:</span><br><span class="line">        color_list.append(colors[c])</span><br><span class="line">    <span class="keyword">return</span> color_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画散点图展示聚类结果（数据集，训练集、测试集）</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(x, y, result, x1, y1, result1, x2, y2, result2, k)</span>:</span></span><br><span class="line">    <span class="comment"># 数据集图</span></span><br><span class="line">    plt.subplot(<span class="number">131</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means数据集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    <span class="comment"># note: scatter函数支持传入颜色列表，对每一个点使用列表相应下标对应的颜色</span></span><br><span class="line">    plt.scatter(x, y, c=get_color_list(result, k))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练集图</span></span><br><span class="line">    plt.subplot(<span class="number">132</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means训练集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    plt.scatter(x1, y1, c=get_color_list(result1, k))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试集图</span></span><br><span class="line">    plt.subplot(<span class="number">133</span>)</span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means测试集"</span>)</span><br><span class="line">    <span class="comment"># 绘制散点图</span></span><br><span class="line">    plt.scatter(x2, y2, c=get_color_list(result2, k))</span><br><span class="line">    <span class="comment"># 展示散点图</span></span><br><span class="line"></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 画折线图展示SSE对比</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_SSE</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 设置标题</span></span><br><span class="line">    plt.title(<span class="string">"K-Means在不同k下的损失"</span>)</span><br><span class="line">    <span class="comment"># 设置x轴坐标</span></span><br><span class="line">    plt.xlim(k_min - <span class="number">1</span>, k_max + <span class="number">2</span>)</span><br><span class="line">    plt.xlabel(<span class="string">"k"</span>)  <span class="comment"># 设置x轴标注</span></span><br><span class="line">    plt.ylabel(<span class="string">"SSE"</span>)  <span class="comment"># 设置y轴标注</span></span><br><span class="line">    <span class="comment"># 绘制K-Means在不同k下训练集和测试集的损失</span></span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), data_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'blue'</span>, marker=<span class="string">'v'</span>, ms=<span class="number">4</span>, label=<span class="string">'数据集'</span>)</span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), train_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'red'</span>, marker=<span class="string">'s'</span>, ms=<span class="number">4</span>, label=<span class="string">'训练集'</span>)</span><br><span class="line">    plt.plot(range(k_min, k_max + <span class="number">1</span>), test_SSE_list, lw=<span class="number">1</span>, c=<span class="string">'green'</span>, marker=<span class="string">'o'</span>, label=<span class="string">'测试集'</span>)</span><br><span class="line">    plt.legend()  <span class="comment"># 图例</span></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>开始运行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 开始运行</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 读入数据</span></span><br><span class="line">read_data(<span class="string">"cluster.dat"</span>)</span><br><span class="line"><span class="comment"># 划分训练集和测试集</span></span><br><span class="line">train_x, test_x, train_y, test_y = train_test_split(data_x, data_y, test_size=test_rate, random_state=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 对k从2~5进行聚类</span></span><br><span class="line"><span class="keyword">for</span> k_num <span class="keyword">in</span> range(k_min, k_max + <span class="number">1</span>):</span><br><span class="line">    print(<span class="string">"###################################################"</span>)</span><br><span class="line">    print(<span class="string">"簇个数为："</span>, k_num, sep=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 数据集</span></span><br><span class="line">    print(<span class="string">"数据集："</span>)</span><br><span class="line">    data_SSE, data_result = algorithm(data_x, data_y, k_num)</span><br><span class="line">    data_SSE_list.append(data_SSE)</span><br><span class="line">    <span class="comment"># 训练集</span></span><br><span class="line">    print(<span class="string">"训练集："</span>)</span><br><span class="line">    train_SSE, train_result = algorithm(train_x, train_y, k_num)</span><br><span class="line">    train_SSE_list.append(train_SSE)</span><br><span class="line">    <span class="comment"># 测试集</span></span><br><span class="line">    print(<span class="string">"测试集："</span>)</span><br><span class="line">    test_SSE, test_result = algorithm(test_y, test_y, k_num)</span><br><span class="line">    test_SSE_list.append(test_SSE)</span><br><span class="line">    <span class="comment"># 输出平均SSE</span></span><br><span class="line">    print(<span class="string">"数据集最终平均损失函数AVG_SSE："</span>, data_SSE / all_point_num)</span><br><span class="line">    print(<span class="string">"训练集最终平均损失函数AVG_SSE："</span>, train_SSE / (all_point_num * (<span class="number">1</span> - test_rate)))</span><br><span class="line">    print(<span class="string">"测试集最终平均损失函数AVG_SSE："</span>, test_SSE / (all_point_num * test_rate))</span><br><span class="line">    <span class="comment"># 画图</span></span><br><span class="line">    show(data_x, data_y, data_result, train_x, train_y, train_result, test_x, test_y, test_result, k_num)</span><br><span class="line"><span class="comment"># 画图展示SSE</span></span><br><span class="line">show_SSE()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于经典聚类算法K-Means的代码实现。&lt;/p&gt;
    
    </summary>
    
    
      <category term="机器学习" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%AE%9E%E9%AA%8C/"/>
    
    
      <category term="Python" scheme="https://666wxy666.github.io/tags/Python/"/>
    
      <category term="机器学习" scheme="https://666wxy666.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="实验" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E9%AA%8C/"/>
    
      <category term="K-Means" scheme="https://666wxy666.github.io/tags/K-Means/"/>
    
      <category term="聚类" scheme="https://666wxy666.github.io/tags/%E8%81%9A%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>大数据实战 Spark Streaming 实时计算Kafka数据</title>
    <link href="https://666wxy666.github.io/2020/05/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Streaming-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97Kafka%E6%95%B0%E6%8D%AE/"/>
    <id>https://666wxy666.github.io/2020/05/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98-Spark-Streaming-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97Kafka%E6%95%B0%E6%8D%AE/</id>
    <published>2020-05-13T16:00:00.000Z</published>
    <updated>2020-09-02T02:04:41.714Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>本文是关于大数据通过Spark Streaming实现流计算Kafka数据进行单词计数。</p><a id="more"></a><h2 id="一、实验环境："><a href="#一、实验环境：" class="headerlink" title="一、实验环境："></a>一、实验环境：</h2><ul><li>虚拟机数量：3(一主两从，主机名分别为：master、slave01、slave02)</li><li>系统版本：Centos 7.5</li><li>Zookeeper版本： Apache Zookeeper 3.4.10</li><li>Kafka版本：kafka_2.11-0.10.2.1</li><li>Spark版本：Apache Spark 2.1.1</li></ul><h2 id="二、实验内容："><a href="#二、实验内容：" class="headerlink" title="二、实验内容："></a>二、实验内容：</h2><ul><li>通过创建Kafka topic，使用Kafka Producer产生消息，然后通过编写spark<br>Streaming程序处理这些消息。</li><li>主要步骤：<ul><li>创建Spark Streaming项目工程</li><li>编写streaming程序</li><li>启动Zookeeper，Kafka集群</li><li>创建topic</li><li>启动Kafka生产者</li><li>准备作业环境</li><li>提交作业</li></ul></li></ul><h2 id="三、实验步骤："><a href="#三、实验步骤：" class="headerlink" title="三、实验步骤："></a>三、实验步骤：</h2><h3 id="3-1打开IDEA软件"><a href="#3-1打开IDEA软件" class="headerlink" title="3.1打开IDEA软件"></a>3.1打开IDEA软件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">cd idea-IC-172.4574.19/</span><br><span class="line">bin/idea.sh &amp;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200518184342.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184342.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_160617" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200518184356.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184356.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_160648" style="zoom:80%;"><h3 id="3-2创建项目"><a href="#3-2创建项目" class="headerlink" title="3.2创建项目"></a>3.2创建项目</h3><p>3.2.1创建同之前章节结构一致的项目spark_test, 设置语言级别为8。</p><p>3.2.2点击 Create New Project，进入如下图界面，按照图标依次点击，最后点击next。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211601.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185224" style="zoom:80%;"><p>3.2.3依次输入GroupId和ArtifactId和Version的值，随后点击next。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211619.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185405" style="zoom:80%;"><p>3.2.4进入如下界面，设置本地Maven项目的setting.xml文件和warehouse仓库，点击next按钮。</p><p>3.2.4.1本地setting.xml文件在/home/zkpk/apache-maven-3.5.0/conf目录下。</p><p>3.2.4.2本地仓库文件夹warehouse在/home/zkpk/apache-maven-3.5.0/warehouse。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211646.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185452" style="zoom:80%;"><p>3.2.5进入如下界面，输入工程名称spark_test，然后点击next，OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185533" style="zoom:80%;"><img src="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423211810.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_185546" style="zoom:80%;"><p>3.2.6工程创建完成后会自动打开一个名为zkpk的xml文件，按照以下修改：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.zkpk.lab<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkpk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">inceptionYear</span>&gt;</span>2008<span class="tag">&lt;/<span class="name">inceptionYear</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scala.version</span>&gt;</span>2.11.11<span class="tag">&lt;/<span class="name">scala.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spark.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">spark.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hadoop.version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">hadoop.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kafka.version</span>&gt;</span>0.10.2.1<span class="tag">&lt;/<span class="name">kafka.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>scala-tools.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Scala-Tools Maven2 Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://scala-tools.org/repo-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka-0-10_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spark.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;kafka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main/scala<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>testCompile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">args</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span>-target:jvm-1.5<span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-eclipse-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">downloadSources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">downloadSources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">buildcommand</span>&gt;</span>ch.epfl.lamp.sdt.core.scalabuilder<span class="tag">&lt;/<span class="name">buildcommand</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">buildcommands</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">projectnature</span>&gt;</span>ch.epfl.lamp.sdt.core.scalanature<span class="tag">&lt;/<span class="name">projectnature</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">additionalProjectnatures</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>org.eclipse.jdt.launching.JRE_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpathContainer</span>&gt;</span>ch.epfl.lamp.sdt.launching.SCALA_CONTAINER<span class="tag">&lt;/<span class="name">classpathContainer</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">classpathContainers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-scala-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scalaVersion</span>&gt;</span>$&#123;scala.version&#125;<span class="tag">&lt;/<span class="name">scalaVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.2.7保存修改的pom.xml文件后，点击工程名，依次选择Maven——&gt;Reimport，即可根据pom.xml文件导入依赖包。</p><p>3.2.8设置语言环境language level，点击菜单栏中的file，选择Project Structure，弹出如下对话框，选择Modules，选择Language level为8，然后点击Apply，点击OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212331.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190537" style="zoom:80%;"><p>3.2.9设置Java Compiler环境，点击菜单栏中的file，选择Setting，弹出如下对话框，依次选择Build，Execution——&gt;Compiler——&gt;Java Compiler，设置图中的Project bytecode version为1.8，设置图中的Target bytecode version为1.8，然后依次点击Apply和OK。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200423212433.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-04-23_190657" style="zoom:80%;"><p>至此，Spark Maven工程创建完毕。</p><p>3.2.10在项目sclaa文件下的org.zkpk.lab下新建“kafka_streaming”Object。</p><p>创建完成后的工程结构：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184547.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184547.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_163207" style="zoom:80%;"><h3 id="3-3编写scala代码"><a href="#3-3编写scala代码" class="headerlink" title="3.3编写scala代码"></a>3.3编写scala代码</h3><p>下面是部分代码截图，具体代码在本文的附录中。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184610.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184610.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170115" style="zoom:80%;"><h3 id="3-4使用maven打包程序"><a href="#3-4使用maven打包程序" class="headerlink" title="3.4使用maven打包程序"></a>3.4使用maven打包程序</h3><p>开始打包。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184749.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184749.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170203" style="zoom:80%;"><p>打包完成。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184800.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184800.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170204" style="zoom:80%;"><h3 id="3-5启动Zookeeper集群"><a href="#3-5启动Zookeeper集群" class="headerlink" title="3.5启动Zookeeper集群"></a>3.5启动Zookeeper集群</h3><p>3.5.1分别登录master和slave01、slave02节点，进入zookeeper安装目录，启动服务。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518184917.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518184917.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170527" style="zoom:80%;"><p>3.5.2在三个节点上分别运行<code>bin/zkServer.sh status</code>命令查看状态，出现follower或leader表示ZK启动成功。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518185007.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518185007.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_170817" style="zoom:80%;"><h3 id="3-6启动Kafka集群"><a href="#3-6启动Kafka集群" class="headerlink" title="3.6启动Kafka集群"></a>3.6启动Kafka集群</h3><p>在 master 和 slave01、slave02节点分别启动 Kafka。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518185051.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518185051.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171119" style="zoom:80%;"><h3 id="3-7创建Kafka-topic"><a href="#3-7创建Kafka-topic" class="headerlink" title="3.7创建Kafka topic"></a>3.7创建Kafka topic</h3><p>名称需要和代码中保持一致。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191546.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191546.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171340" style="zoom:80%;"><h3 id="3-8在一个终端上启动一个生产者-准备生产"><a href="#3-8在一个终端上启动一个生产者-准备生产" class="headerlink" title="3.8在一个终端上启动一个生产者,准备生产"></a>3.8在一个终端上启动一个生产者,准备生产</h3><img src="https://gitee.com/wxy_666/images/raw/master/20200518191639.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191639.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171502" style="zoom:80%;"><h3 id="3-9使用spark-submit提交spark-应用"><a href="#3-9使用spark-submit提交spark-应用" class="headerlink" title="3.9使用spark-submit提交spark 应用"></a>3.9使用spark-submit提交spark 应用</h3><p>3.9.1将生成的jar包文件复制到/home/zkpk下。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191855.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191855.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_171718" style="zoom:80%;"><p>3.9.2提交sparkjob之前需要将spark-streaming-kafka-0-10_2.11-2.1.0，kafka-clients-0.10.2.这两个jar添加到spark_home/jars/路径下，否则程序提交会报错。</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518191929.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191929.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_172111" style="zoom:80%;"><p>3.9.3新开一个终端，在/home/zkpk目录下提交程序。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --class org.zkpk.lab.kafka_streaming zkpk-1.0.jar</span><br></pre></td></tr></table></figure><img src="https://gitee.com/wxy_666/images/raw/master/20200518191955.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518191955.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174524" style="zoom:80%;"><h3 id="3-10输入内容，查看结果"><a href="#3-10输入内容，查看结果" class="headerlink" title="3.10输入内容，查看结果"></a>3.10输入内容，查看结果</h3><p>切换到之前的Kafka生产者终端中输入如下内容，然后切换到sparkStreaming任务界面查看结果。</p><ul><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192227.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192227.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174619" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192249.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192249.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174609" style="zoom:80%;"></li><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192408.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192408.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174732" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192418.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192418.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174721" style="zoom:80%;"></li><li><p>输入：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192431.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192431.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174825" style="zoom:80%;"><p>结果：</p><img src="https://gitee.com/wxy_666/images/raw/master/20200518192450.jpg" class="lazyload" data-srcset="https://gitee.com/wxy_666/images/raw/master/20200518192450.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2020-05-18_174817" style="zoom:80%;"></li></ul><h2 id="四、附录"><a href="#四、附录" class="headerlink" title="四、附录"></a>四、附录</h2><h3 id="kafka-streaming-scala"><a href="#kafka-streaming-scala" class="headerlink" title="kafka_streaming.scala"></a>kafka_streaming.scala</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.zkpk.lab</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.<span class="type">StringDeserializer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.<span class="type">LocationStrategies</span>.<span class="type">PreferConsistent</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.<span class="type">ConsumerStrategies</span>.<span class="type">Subscribe</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">kafka_streaming</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">"local[2]"</span>).setAppName(<span class="string">"kafka_test"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(conf, <span class="type">Seconds</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> kafkaParams = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Object</span>](</span><br><span class="line">      <span class="string">"bootstrap.servers"</span> -&gt; <span class="string">"master:9092"</span>,</span><br><span class="line">      <span class="string">"key.deserializer"</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">"value.deserializer"</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">"group.id"</span> -&gt; <span class="string">"example"</span>,</span><br><span class="line">      <span class="string">"auto.offset.reset"</span> -&gt; <span class="string">"latest"</span>,</span><br><span class="line">      <span class="string">"enable.auto.commit"</span> -&gt; (<span class="literal">false</span>: java.lang.<span class="type">Boolean</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> topics = <span class="type">List</span>(<span class="string">"test_kafka"</span>).toSet</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream = <span class="type">KafkaUtils</span>.createDirectStream</span><br><span class="line">      [<span class="type">String</span>,<span class="type">String</span>](</span><br><span class="line">        ssc,</span><br><span class="line">        <span class="type">PreferConsistent</span>,</span><br><span class="line">        <span class="type">Subscribe</span>[<span class="type">String</span>,<span class="type">String</span>](topics,kafkaParams)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> lines = stream.map(_.value)</span><br><span class="line">    <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>))</span><br><span class="line">    <span class="keyword">val</span> wordcounts = words.map((_,<span class="number">1</span>)).reduceByKey(_+_)</span><br><span class="line">    wordcounts.print()</span><br><span class="line"></span><br><span class="line">    ssc.start()</span><br><span class="line">    ssc.awaitTermination()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文是关于大数据通过Spark Streaming实现流计算Kafka数据进行单词计数。&lt;/p&gt;
    
    </summary>
    
    
      <category term="大数据" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="实战" scheme="https://666wxy666.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="实战" scheme="https://666wxy666.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="大数据" scheme="https://666wxy666.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="Spark" scheme="https://666wxy666.github.io/tags/Spark/"/>
    
      <category term="单词计数" scheme="https://666wxy666.github.io/tags/%E5%8D%95%E8%AF%8D%E8%AE%A1%E6%95%B0/"/>
    
      <category term="Scala" scheme="https://666wxy666.github.io/tags/Scala/"/>
    
      <category term="流计算" scheme="https://666wxy666.github.io/tags/%E6%B5%81%E8%AE%A1%E7%AE%97/"/>
    
      <category term="Streaming" scheme="https://666wxy666.github.io/tags/Streaming/"/>
    
      <category term="Kafka" scheme="https://666wxy666.github.io/tags/Kafka/"/>
    
  </entry>
  
</feed>
