<!DOCTYPE html>
<html lang="zh-CN">
    <head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/#6.0.0-alpha.0">
  <meta name="generator" content="Hexo 5.4.2">
  <meta name="Volantis" content="6.0.0-alpha.0">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
  <link rel="canonical" href="https://666wxy666.github.io/2020/09/03/操作系统-进程线程管理通信与同步互斥/">
  <!-- 渲染优化 -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
      <link rel="dns-prefetch" href="https://unpkg.com">
      <link rel="preconnect" href="https://unpkg.com" crossorigin>
      <link rel="dns-prefetch" href="https://cdn.bootcdn.net">
      <link rel="preconnect" href="https://cdn.bootcdn.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Security-Policy" content=" default-src 'self' https:; block-all-mixed-content; base-uri 'self' https:; form-action 'self' https:; worker-src 'self' https:; connect-src 'self' https: *; img-src 'self' data: https: *; media-src 'self' https: *; font-src 'self' data: https: *; frame-src 'self' https: *; manifest-src 'self' https: *; child-src https:; script-src 'self' https: 'unsafe-inline' *; style-src 'self' https: 'unsafe-inline' *; ">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <!-- import head_begin begin -->
  <!-- import head_begin end -->
  <!-- Custom Files headBegin begin-->
  
  <!-- Custom Files headBegin end-->
    <link rel="shortcut icon" type="image/x-icon" href="https://gcore.jsdelivr.net/gh/666WXY666/cdn/img/favicon/favicon.ico">
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="preload" href="https://gcore.jsdelivr.net/gh/666WXY666/cdn@master/fonts/Noto_Serif_SC/NotoSerifSC-Regular.otf" as="font" type="font/otf" crossorigin="anonymous">
<link rel="preload" href="https://gcore.jsdelivr.net/gh/666WXY666/cdn@master/fonts/Noto_Serif_SC/NotoSerifSC-Regular.otf" as="font" type="font/otf" crossorigin="anonymous">

  <!-- feed -->
      <link rel="alternate" href="/atom.xml" title="Sekiro's Blog" type="application/atom+xml">
  <!-- 页面元数据 -->
  <title>操作系统 进程线程管理通信与同步互斥 - Sekiro's Blog</title>
  <meta name="keywords" content="C++,Linux,操作系统,进程,线程,同步互斥,计算机,IT,学习交流,Blog,博客">
  <meta desc name="description" content="本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。 - Sekiro - Sekiro's Blog">
  
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统 进程线程管理通信与同步互斥">
<meta property="og:url" content="https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/index.html">
<meta property="og:site_name" content="Sekiro&#39;s Blog">
<meta property="og:description" content="本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
<meta property="article:published_time" content="2020-09-03T00:00:00.000Z">
<meta property="article:modified_time" content="2022-11-11T12:01:29.407Z">
<meta property="article:author" content="Sekiro">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="操作系统">
<meta property="article:tag" content="进程">
<meta property="article:tag" content="线程">
<meta property="article:tag" content="同步互斥">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
  <style>
    /* 首屏样式 */
    #safearea {
  display: none;
}
:root {
  --color-site-body: #f4f4f4;
  --color-site-bg: #f4f4f4;
  --color-site-inner: #fff;
  --color-site-footer: #666;
  --color-card: #fff;
  --color-text: #444;
  --color-block: #f6f6f6;
  --color-inlinecode: #c74f00;
  --color-codeblock: #fff7ea;
  --color-h1: #3a3a3a;
  --color-h2: #3a3a3a;
  --color-h3: #333;
  --color-h4: #444;
  --color-h5: #555;
  --color-h6: #666;
  --color-p: #444;
  --color-list: #666;
  --color-list-hl: #30ad91;
  --color-meta: #888;
  --color-read-bkg: #e0d8c8;
  --color-read-post: #f8f1e2;
  --color-copyright-bkg: #f5f5f5;
}
* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  outline: none;
  margin: 0;
  padding: 0;
}
*::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
*::-webkit-scrollbar-track-piece {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #3dd9b6;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
html {
  color: var(--color-text);
  width: 100%;
  height: 100%;
  font-family: "Noto Serif SC", UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  font-size: 16px;
}
html >::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
html >::-webkit-scrollbar-track-piece {
  background: transparent;
}
html >::-webkit-scrollbar-thumb {
  background: #3dd9b6;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
html >::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
body {
  background-color: var(--color-site-body);
  text-rendering: optimizelegibility;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  line-height: 1.6;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}
body.modal-active {
  overflow: hidden;
}
@media screen and (max-width: 680px) {
  body.modal-active {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
a {
  color: #2092ec;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
a:hover {
  color: #ff5722;
}
a:active,
a:hover {
  outline: 0;
}
ul,
ol {
  padding-left: 0;
}
ul li,
ol li {
  list-style: none;
}
header {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
img {
  border: 0;
  background: none;
  max-width: 100%;
}
svg:not(:root) {
  overflow: hidden;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  height: 0;
  border: 0;
  border-radius: 1px;
  -webkit-border-radius: 1px;
  border-bottom: 1px solid rgba(68,68,68,0.1);
}
button,
input {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
  text-transform: none;
  -webkit-appearance: button;
  cursor: pointer;
}
@supports (backdrop-filter: blur(20px)) {
  .blur {
    background: rgba(255,255,255,0.9) !important;
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.shadow {
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.shadow.floatable {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.shadow.floatable:hover {
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
}
#l_cover {
  min-height: 64px;
}
.cover-wrapper {
  top: 0;
  left: 0;
  max-width: 100%;
  height: 100vh;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  align-self: center;
  align-content: center;
  color: var(--color-site-inner);
  padding: 0 16px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  position: relative;
  overflow: hidden;
  margin-bottom: -100px;
}
.cover-wrapper .cover-body {
  z-index: 1;
  position: relative;
  width: 100%;
  height: 100%;
}
.cover-wrapper#full {
  height: calc(100vh + 100px);
  padding-bottom: 100px;
}
.cover-wrapper#half {
  max-height: 640px;
  min-height: 400px;
  height: calc(36vh - 64px + 200px);
}
.cover-wrapper #scroll-down {
  width: 100%;
  height: 64px;
  position: absolute;
  bottom: 100px;
  text-align: center;
  cursor: pointer;
}
.cover-wrapper #scroll-down .scroll-down-effects {
  color: #fff;
  font-size: 24px;
  line-height: 64px;
  position: absolute;
  width: 24px;
  left: calc(50% - 12px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  animation: scroll-down-effect 1.5s infinite;
  -webkit-animation: scroll-down-effect 1.5s infinite;
  -khtml-animation: scroll-down-effect 1.5s infinite;
  -moz-animation: scroll-down-effect 1.5s infinite;
  -o-animation: scroll-down-effect 1.5s infinite;
  -ms-animation: scroll-down-effect 1.5s infinite;
}
@-moz-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  margin-top: 64px;
  margin-bottom: 100px;
}
.cover-wrapper .cover-body,
.cover-wrapper .cover-body .top,
.cover-wrapper .cover-body .bottom {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  max-width: 100%;
}
.cover-wrapper .cover-body .bottom {
  margin-top: 32px;
}
.cover-wrapper .cover-body .title {
  font-family: "Noto Serif SC", "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
  font-size: 3.125rem;
  line-height: 1.2;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cover-wrapper .cover-body .subtitle {
  font-size: 20px;
}
.cover-wrapper .cover-body .logo {
  max-height: 120px;
  max-width: calc(100% - 4 * 16px);
}
@media screen and (min-height: 1024px) {
  .cover-wrapper .cover-body .title {
    font-size: 3rem;
  }
  .cover-wrapper .cover-body .subtitle {
    font-size: 1.05rem;
  }
  .cover-wrapper .cover-body .logo {
    max-height: 150px;
  }
}
.cover-wrapper .cover-body .m_search {
  position: relative;
  max-width: calc(100% - 16px);
  width: 320px;
  vertical-align: middle;
}
.cover-wrapper .cover-body .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  width: 100%;
}
.cover-wrapper .cover-body .m_search .icon,
.cover-wrapper .cover-body .m_search .input {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.cover-wrapper .cover-body .m_search .icon {
  position: absolute;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  line-height: 2.5rem;
  width: 32px;
  top: 0;
  left: 5px;
  color: rgba(68,68,68,0.75);
}
.cover-wrapper .cover-body .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  height: 2.5rem;
  width: 100%;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  font-size: 0.875rem;
  -webkit-appearance: none;
  padding-left: 36px;
  border-radius: 1.4rem;
  -webkit-border-radius: 1.4rem;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: none;
  color: var(--color-text);
}
@media screen and (max-width: 500px) {
  .cover-wrapper .cover-body .m_search .input {
    padding-left: 36px;
  }
}
.cover-wrapper .cover-body .m_search .input:hover {
  background: rgba(255,255,255,0.8);
}
.cover-wrapper .cover-body .m_search .input:focus {
  background: #fff;
}
.cover-wrapper .list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  -khtml-flex-wrap: wrap;
  -moz-flex-wrap: wrap;
  -o-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  align-items: stretch;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.cover-wrapper .list-h a {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 0;
  -ms-flex: 1 0;
  flex: 1 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  font-weight: 600;
}
.cover-wrapper .list-h a img {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  border-radius: 2px;
  -webkit-border-radius: 2px;
  margin: 4px;
  min-width: 40px;
  max-width: 44px;
}
@media screen and (max-width: 768px) {
  .cover-wrapper .list-h a img {
    min-width: 36px;
    max-width: 40px;
  }
}
@media screen and (max-width: 500px) {
  .cover-wrapper .list-h a img {
    margin: 2px 4px;
    min-width: 32px;
    max-width: 36px;
  }
}
@media screen and (max-width: 375px) {
  .cover-wrapper .list-h a img {
    min-width: 28px;
    max-width: 32px;
  }
}
.cover-wrapper {
  max-width: 100%;
}
.cover-wrapper.search .bottom .menu {
  margin-top: 16px;
}
.cover-wrapper.search .bottom .menu .list-h a {
  white-space: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  align-items: baseline;
  padding: 2px;
  margin: 4px;
  color: var(--color-site-inner);
  opacity: 0.75;
  -webkit-opacity: 0.75;
  -moz-opacity: 0.75;
  text-shadow: 0 1px 2px rgba(0,0,0,0.05);
  border-bottom: 2px solid transparent;
}
.cover-wrapper.search .bottom .menu .list-h a i {
  margin-right: 4px;
}
.cover-wrapper.search .bottom .menu .list-h a p {
  font-size: 0.9375rem;
}
.cover-wrapper.search .bottom .menu .list-h a:hover,
.cover-wrapper.search .bottom .menu .list-h a.active,
.cover-wrapper.search .bottom .menu .list-h a:active {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
  border-bottom: 2px solid var(--color-site-inner);
}
.cover-wrapper.dock .menu,
.cover-wrapper.featured .menu,
.cover-wrapper.focus .menu {
  border-radius: 6px;
  -webkit-border-radius: 6px;
}
.cover-wrapper.dock .menu .list-h a,
.cover-wrapper.featured .menu .list-h a,
.cover-wrapper.focus .menu .list-h a {
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  line-height: 24px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  border-bottom: none;
  text-align: center;
  align-content: flex-end;
  color: rgba(68,68,68,0.7);
  font-size: 1.5rem;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h a,
  .cover-wrapper.featured .menu .list-h a,
  .cover-wrapper.focus .menu .list-h a {
    padding: 12px 8px;
  }
}
.cover-wrapper.dock .menu .list-h a i,
.cover-wrapper.featured .menu .list-h a i,
.cover-wrapper.focus .menu .list-h a i {
  margin: 8px;
}
.cover-wrapper.dock .menu .list-h a p,
.cover-wrapper.featured .menu .list-h a p,
.cover-wrapper.focus .menu .list-h a p {
  font-size: 0.875rem;
}
.cover-wrapper.dock .menu .list-h a.active,
.cover-wrapper.featured .menu .list-h a.active,
.cover-wrapper.focus .menu .list-h a.active {
  background: var(--color-card);
  backdrop-filter: none;
}
.cover-wrapper.dock .menu .list-h a.active i,
.cover-wrapper.featured .menu .list-h a.active i,
.cover-wrapper.focus .menu .list-h a.active i,
.cover-wrapper.dock .menu .list-h a.active i+p,
.cover-wrapper.featured .menu .list-h a.active i+p,
.cover-wrapper.focus .menu .list-h a.active i+p {
  color: #3dd9b6;
}
.cover-wrapper.dock .menu .list-h a.active img+p,
.cover-wrapper.featured .menu .list-h a.active img+p,
.cover-wrapper.focus .menu .list-h a.active img+p {
  color: var(--color-text);
}
.cover-wrapper.dock .menu .list-h a:hover,
.cover-wrapper.featured .menu .list-h a:hover,
.cover-wrapper.focus .menu .list-h a:hover {
  background: var(--color-card);
}
.cover-wrapper.dock .top {
  margin-bottom: 48px;
}
.cover-wrapper.dock .menu {
  background: rgba(255,255,255,0.5);
  position: absolute;
  bottom: 0;
  max-width: 100%;
}
.cover-wrapper.dock .menu .list-h {
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  margin: 4px;
}
.cover-wrapper.dock .menu .list-h a+a {
  margin-left: 4px;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h {
    overflow-x: scroll;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar {
    height: 0;
    width: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-track-piece {
    background: transparent;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb {
    background: #3dd9b6;
    cursor: pointer;
    border-radius: 0;
    -webkit-border-radius: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb:hover {
    background: #ff5722;
  }
}
@supports (backdrop-filter: blur(20px)) {
  .cover-wrapper.dock .menu {
    background: rgba(255,255,255,0.5);
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.cover-wrapper #parallax-window {
  position: absolute;
  width: 100%;
  height: 100%;
  background: transparent;
}
.parallax-mirror {
  animation-delay: 0s;
  animation-duration: 0.5s;
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
  animation-name: fadeIn;
}
@-moz-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --color-mode: 'dark';
  }
  :root:not([color-scheme]) {
    --color-site-body: #121212;
    --color-read-bkg: #1f1f1f;
    --color-read-post: #262626;
    --color-site-bg: #1f1f1f;
    --color-site-inner: rgba(238,238,238,0.871);
    --color-site-footer: rgba(170,170,170,0.871);
    --color-card: #262626;
    --color-text: rgba(238,238,238,0.871);
    --color-block: #434343;
    --color-codeblock: #1f1f1f;
    --color-inlinecode: #d56d28;
    --color-h1: rgba(255,255,255,0.871);
    --color-h2: rgba(255,255,255,0.871);
    --color-h3: rgba(255,255,255,0.6);
    --color-h4: rgba(255,255,255,0.6);
    --color-h5: rgba(255,255,255,0.6);
    --color-h6: rgba(255,255,255,0.6);
    --color-p: rgba(217,217,217,0.871);
    --color-list: rgba(217,217,217,0.871);
    --color-list-hl: #63e0c4;
    --color-meta: rgba(191,191,191,0.871);
    --color-link: rgba(191,191,191,0.871);
    --color-copyright-bkg: #21252b;
  }
  :root:not([color-scheme]) img {
    filter: brightness(70%) !important;
  }
  :root:not([color-scheme]) .blur {
    background: rgba(31,31,31,0.9) !important;
  }
  :root:not([color-scheme]) .white-box.blur {
    background: rgba(38,38,38,0.9) !important;
  }
  :root:not([color-scheme]) .nav-main .u-search-input {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a:hover {
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) .article blockquote {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .article-title a {
    color: var(--color-h1) !important;
  }
  :root:not([color-scheme]) details>summary {
    color: var(--color-p) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) details {
    border: 1px solid var(--color-site-bg) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) #u-search .modal,
  :root:not([color-scheme]) #u-search .modal-header,
  :root:not([color-scheme]) #u-search .modal-body {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #u-search .modal-body .modal-results .result:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:focus {
    background: var(--color-site-body) !important;
  }
}
[color-scheme='dark'] {
  --color-site-body: #121212;
  --color-read-bkg: #1f1f1f;
  --color-read-post: #262626;
  --color-site-bg: #1f1f1f;
  --color-site-inner: rgba(238,238,238,0.871);
  --color-site-footer: rgba(170,170,170,0.871);
  --color-card: #262626;
  --color-text: rgba(238,238,238,0.871);
  --color-block: #434343;
  --color-codeblock: #1f1f1f;
  --color-inlinecode: #d56d28;
  --color-h1: rgba(255,255,255,0.871);
  --color-h2: rgba(255,255,255,0.871);
  --color-h3: rgba(255,255,255,0.6);
  --color-h4: rgba(255,255,255,0.6);
  --color-h5: rgba(255,255,255,0.6);
  --color-h6: rgba(255,255,255,0.6);
  --color-p: rgba(217,217,217,0.871);
  --color-list: rgba(217,217,217,0.871);
  --color-list-hl: #63e0c4;
  --color-meta: rgba(191,191,191,0.871);
  --color-link: rgba(191,191,191,0.871);
  --color-copyright-bkg: #21252b;
}
[color-scheme='dark'] img {
  filter: brightness(70%) !important;
}
[color-scheme='dark'] .blur {
  background: rgba(31,31,31,0.9) !important;
}
[color-scheme='dark'] .white-box.blur {
  background: rgba(38,38,38,0.9) !important;
}
[color-scheme='dark'] .nav-main .u-search-input {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a {
  background: var(--color-block) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a:hover {
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] .article blockquote {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .article-title a {
  color: var(--color-h1) !important;
}
[color-scheme='dark'] details>summary {
  color: var(--color-p) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] details {
  border: 1px solid var(--color-site-bg) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] #u-search .modal,
[color-scheme='dark'] #u-search .modal-header,
[color-scheme='dark'] #u-search .modal-body {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #u-search .modal-body .modal-results .result:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:focus {
  background: var(--color-site-body) !important;
}
@media screen and (max-width: 500px) {
  [color-scheme='dark'] .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}
@font-face {
  font-family: 'Noto Serif SC';
  src: url("https://gcore.jsdelivr.net/gh/666WXY666/cdn@master/fonts/Noto_Serif_SC/NotoSerifSC-Regular.otf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
@font-face {
  font-family: 'Noto Serif SC';
  src: url("https://gcore.jsdelivr.net/gh/666WXY666/cdn@master/fonts/Noto_Serif_SC/NotoSerifSC-Regular.otf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
.l_header {
  position: fixed;
  z-index: 1000;
  top: 0;
  width: 100%;
  height: 64px;
  background: var(--color-card);
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.l_header.auto {
  transition: opacity 0.4s ease;
  -webkit-transition: opacity 0.4s ease;
  -khtml-transition: opacity 0.4s ease;
  -moz-transition: opacity 0.4s ease;
  -o-transition: opacity 0.4s ease;
  -ms-transition: opacity 0.4s ease;
  visibility: hidden;
}
.l_header.auto.show {
  opacity: 1 !important;
  -webkit-opacity: 1 !important;
  -moz-opacity: 1 !important;
  visibility: visible;
}
.l_header .container {
  margin-left: 16px;
  margin-right: 16px;
}
.l_header #wrapper {
  height: 100%;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.l_header #wrapper .nav-main,
.l_header #wrapper .nav-sub {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  justify-content: space-between;
  -webkit-justify-content: space-between;
  -khtml-justify-content: space-between;
  -moz-justify-content: space-between;
  -o-justify-content: space-between;
  -ms-justify-content: space-between;
  align-items: center;
}
.l_header #wrapper .nav-main {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.l_header #wrapper.sub .nav-main {
  transform: translateY(-64px);
  -webkit-transform: translateY(-64px);
  -khtml-transform: translateY(-64px);
  -moz-transform: translateY(-64px);
  -o-transform: translateY(-64px);
  -ms-transform: translateY(-64px);
}
.l_header #wrapper .nav-sub {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
  height: 64px;
  width: calc(100% - 2 * 16px);
  position: absolute;
}
.l_header #wrapper .nav-sub ::-webkit-scrollbar {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (min-width: 2048px) {
  .l_header #wrapper .nav-sub {
    max-width: 55vw;
    margin: auto;
  }
}
.l_header #wrapper.sub .nav-sub {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
}
.l_header #wrapper .title {
  position: relative;
  color: var(--color-text);
  padding-left: 24px;
  max-height: 64px;
}
.l_header #wrapper .nav-main .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 0;
  line-height: 64px;
  padding: 0 24px;
  font-size: 1.25rem;
  font-family: "Noto Serif SC", "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
}
.l_header #wrapper .nav-main .title img {
  height: 64px;
}
.l_header .nav-sub {
  max-width: 1080px;
  margin: auto;
}
.l_header .nav-sub .title {
  font-weight: bold;
  font-family: "Noto Serif SC", UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  line-height: 1.2;
  max-height: 64px;
  white-space: normal;
  flex-shrink: 1;
}
.l_header .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  line-height: 64px;
  align-items: center;
}
.l_header .switcher .s-toc {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (max-width: 768px) {
  .l_header .switcher .s-toc {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
  }
}
.l_header .switcher >li {
  height: 48px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  margin: 2px;
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li {
    margin: 0 1px;
    height: 48px;
  }
}
.l_header .switcher >li >a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  padding: 0.85em 1.1em;
  border-radius: 100px;
  -webkit-border-radius: 100px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  color: #3dd9b6;
}
.l_header .switcher >li >a:hover {
  border: none;
}
.l_header .switcher >li >a.active,
.l_header .switcher >li >a:active {
  border: none;
  background: var(--color-site-bg);
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li >a {
    width: 36px;
    height: 48px;
  }
}
.l_header .nav-sub .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
}
.l_header .m_search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  height: 64px;
  width: 240px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (max-width: 1024px) {
  .l_header .m_search {
    width: 44px;
    min-width: 44px;
  }
  .l_header .m_search input::placeholder {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
  }
  .l_header .m_search:hover {
    width: 240px;
  }
  .l_header .m_search:hover input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (min-width: 500px) {
  .l_header .m_search:hover .input {
    width: 100%;
  }
  .l_header .m_search:hover .input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search {
    min-width: 0;
  }
  .l_header .m_search input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.l_header .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  width: 100%;
  align-items: center;
}
.l_header .m_search .icon {
  position: absolute;
  width: 36px;
  left: 5px;
  color: var(--color-meta);
}
@media screen and (max-width: 500px) {
  .l_header .m_search .icon {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
.l_header .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding-top: 8px;
  padding-bottom: 8px;
  line-height: 1.3;
  width: 100%;
  color: var(--color-text);
  background: #fafafa;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  padding-left: 40px;
  font-size: 0.875rem;
  border-radius: 8px;
  -webkit-border-radius: 8px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (min-width: 500px) {
  .l_header .m_search .input:focus {
    box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search .input {
    background: var(--color-block);
    padding-left: 8px;
    border: none;
  }
  .l_header .m_search .input:hover,
  .l_header .m_search .input:focus {
    border: none;
  }
}
@media (max-width: 500px) {
  .l_header .m_search {
    left: 0;
    width: 0;
    overflow: hidden;
    position: absolute;
    background: #fff;
    transition: all 0.28s ease;
    -webkit-transition: all 0.28s ease;
    -khtml-transition: all 0.28s ease;
    -moz-transition: all 0.28s ease;
    -o-transition: all 0.28s ease;
    -ms-transition: all 0.28s ease;
  }
  .l_header .m_search .input {
    border-radius: 32px;
    -webkit-border-radius: 32px;
    margin-left: 16px;
    padding-left: 16px;
  }
  .l_header.z_search-open .m_search {
    width: 100%;
  }
  .l_header.z_search-open .m_search .input {
    width: calc(100% - 120px);
  }
}
ul.m-pc >li>a {
  color: inherit;
  border-bottom: 2px solid transparent;
}
ul.m-pc >li>a:active,
ul.m-pc >li>a.active {
  border-bottom: 2px solid #3dd9b6;
}
ul.m-pc li:hover >ul.list-v,
ul.list-v li:hover >ul.list-v {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.nav-list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  align-items: stretch;
}
ul.nav-list-h>li {
  position: relative;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  height: 100%;
  line-height: 2.4;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
ul.nav-list-h>li >a {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 600;
}
ul.list-v {
  z-index: 1;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: absolute;
  background: var(--color-card);
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  margin-top: -6px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  padding: 8px 0;
}
ul.list-v.show {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.list-v hr {
  margin-top: 8px;
  margin-bottom: 8px;
}
ul.list-v >li {
  white-space: nowrap;
  word-break: keep-all;
}
ul.list-v >li.header {
  font-size: 0.78125rem;
  font-weight: bold;
  line-height: 2em;
  color: var(--color-meta);
  margin: 8px 16px 4px;
}
ul.list-v >li.header i {
  margin-right: 8px;
}
ul.list-v >li ul {
  margin-left: 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: -40px;
}
ul.list-v .aplayer-container {
  min-height: 64px;
  padding: 6px 16px;
}
ul.list-v >li>a {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  color: var(--color-list);
  font-size: 0.875rem;
  font-weight: bold;
  line-height: 36px;
  padding: 0 20px 0 16px;
  text-overflow: ellipsis;
  margin: 0 4px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
@media screen and (max-width: 1024px) {
  ul.list-v >li>a {
    line-height: 40px;
  }
}
ul.list-v >li>a >i {
  margin-right: 8px;
}
ul.list-v >li>a:active,
ul.list-v >li>a.active {
  color: var(--color-list-hl);
}
ul.list-v >li>a:hover {
  color: var(--color-list-hl);
  background: var(--color-site-bg);
}
.l_header .menu >ul>li>a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding: 0 8px;
}
.l_header .menu >ul>li>a >i {
  margin-right: 4px;
}
.l_header ul.nav-list-h>li {
  color: var(--color-list);
  line-height: 64px;
}
.l_header ul.nav-list-h>li >a {
  max-height: 64px;
  overflow: hidden;
  color: inherit;
}
.l_header ul.nav-list-h>li >a:active,
.l_header ul.nav-list-h>li >a.active {
  color: #3dd9b6;
}
.l_header ul.nav-list-h>li:hover>a {
  color: var(--color-list-hl);
}
.l_header ul.nav-list-h>li i.music {
  animation: rotate-effect 1.5s linear infinite;
  -webkit-animation: rotate-effect 1.5s linear infinite;
  -khtml-animation: rotate-effect 1.5s linear infinite;
  -moz-animation: rotate-effect 1.5s linear infinite;
  -o-animation: rotate-effect 1.5s linear infinite;
  -ms-animation: rotate-effect 1.5s linear infinite;
}
@-moz-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-webkit-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-o-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
.menu-phone li ul.list-v {
  right: calc(100% - 0.5 * 16px);
}
.menu-phone li ul.list-v ul {
  right: calc(100% - 0.5 * 16px);
}
#wrapper {
  max-width: 1080px;
  margin: auto;
}
@media screen and (min-width: 2048px) {
  #wrapper {
    max-width: 55vw;
  }
}
#wrapper .menu {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 1;
  -ms-flex: 1 1;
  flex: 1 1;
  margin: 0 16px 0 0;
}
#wrapper .menu .list-v ul {
  left: calc(100% - 0.5 * 16px);
}
.menu-phone {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: 16px;
  right: 8px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.menu-phone ul {
  right: calc(100% - 0.5 * 16px);
}
@media screen and (max-width: 500px) {
  .menu-phone {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: block;
  }
}
.l_header {
  max-width: 65vw;
  left: calc((100% - 65vw) * 0.5);
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
@media screen and (max-width: 2048px) {
  .l_header {
    max-width: 1112px;
    left: calc((100% - 1112px) * 0.5);
  }
}
@media screen and (max-width: 1112px) {
  .l_header {
    left: 0;
    border-radius: 0;
    -webkit-border-radius: 0;
    max-width: 100%;
  }
}
@media screen and (max-width: 500px) {
  .l_header .container {
    margin-left: 0;
    margin-right: 0;
  }
  .l_header #wrapper .nav-main .title {
    padding-left: 16px;
    padding-right: 16px;
  }
  .l_header #wrapper .nav-sub {
    width: 100%;
  }
  .l_header #wrapper .nav-sub .title {
    overflow-y: scroll;
    margin-top: 2px;
    padding: 8px 16px;
  }
  .l_header #wrapper .switcher {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
    margin-right: 8px;
  }
  .l_header .menu {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
@media screen and (max-width: 500px) {
  .list-v li {
    max-width: 270px;
  }
}
#u-search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 60px 20px;
  z-index: 1001;
}
@media screen and (max-width: 680px) {
  #u-search {
    padding: 0px;
  }
}
@media screen and (prefers-color-scheme: dark) and (max-width: 500px) {
  .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}

  </style>
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
    <script>
      let userColorScheme=localStorage.getItem("color-scheme")
      if(userColorScheme){
        document.documentElement.setAttribute("color-scheme", userColorScheme);
      }
    </script>
  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
    '.kill-t{'+
      'font-size: 2rem;'+
    '}'+
    '.kill-c{'+
      'font-size: 1.2rem;'+
    '}'+
		'#l_header,#l_body{'+
			'display: none;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        `<span class="kill-t"><b>抱歉，您的浏览器无法访问本站</b></span><br/>`+
        `<span class="kill-c">微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</span><br/>`+
        `<a target="_blank" rel="noopener" href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong>了解详情 ></strong></a>`+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
    .kill-t{
      font-size: 2rem;
    }
    .kill-c{
      font-size: 1.2rem;
    }
		#l_header,#l_body{
			display: none;
		}
	</style>
    <div class="kill-noscript">
        <span class="kill-t"><b>抱歉，您的浏览器无法访问本站</b></span><br>
        <span class="kill-c">本页面需要浏览器支持（启用）JavaScript</span><br>
        <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a>
    </div>
</noscript>


  <script>
  /************这个文件存放不需要重载的全局变量和全局函数*********/
  window.volantis = {}; // volantis 全局变量
  volantis.debug = "env"; // 调试模式
  volantis.dom = {}; // 页面Dom see: /source/js/app.js etc.
  /******************** volantis.EventListener ********************************/
  // 事件监听器 see: /source/js/app.js
  volantis.EventListener = {}
  // 这里存放pjax切换页面时将被移除的事件监听器
  volantis.EventListener.list = []
  //构造方法
  function volantisEventListener(type, f, ele) {
    this.type = type
    this.f = f
    this.ele = ele
  }
  // 移除事件监听器
  volantis.EventListener.remove = () => {
    volantis.EventListener.list.forEach(function (i) {
      i.ele.removeEventListener(i.type, i.f, false)
    })
    volantis.EventListener.list = []
  }
  /******************** volantis.dom.$ ********************************/
  // 注：这里没有选择器，也没有forEach一次只处理一个dom，这里重新封装主题常用的dom方法，返回的是dom对象，对象包含了以下方法，同时保留dom的原生API
  function volantisDom(ele) {
    if (!ele) ele = document.createElement("div")
    this.ele = ele;
    // ==============================================================
    this.ele.find = (c) => {
      let q = this.ele.querySelector(c)
      if (q)
        return new volantisDom(q)
    }
    // ==============================================================
    this.ele.hasClass = (c) => {
      return this.ele.className.match(new RegExp('(\\s|^)' + c + '(\\s|$)'));
    }
    this.ele.addClass = (c) => {
      this.ele.classList.add(c);
      return this.ele
    }
    this.ele.removeClass = (c) => {
      this.ele.classList.remove(c);
      return this.ele
    }
    this.ele.toggleClass = (c) => {
      if (this.ele.hasClass(c)) {
        this.ele.removeClass(c)
      } else {
        this.ele.addClass(c)
      }
      return this.ele
    }
    // ==============================================================
    // 参数 r 为 true 表示pjax切换页面时事件监听器将被移除，false不移除
    this.ele.on = (c, f, r = 1) => {
      this.ele.addEventListener(c, f, false)
      if (r) {
        volantis.EventListener.list.push(new volantisEventListener(c, f, this.ele))
      }
      return this.ele
    }
    this.ele.click = (f, r) => {
      this.ele.on("click", f, r)
      return this.ele
    }
    this.ele.scroll = (f, r) => {
      this.ele.on("scroll", f, r)
      return this.ele
    }
    // ==============================================================
    this.ele.html = (c) => {
      // if(c=== undefined){
      //   return this.ele.innerHTML
      // }else{
      this.ele.innerHTML = c
      return this.ele
      // }
    }
    // ==============================================================
    this.ele.hide = (c) => {
      this.ele.style.display = "none"
      return this.ele
    }
    this.ele.show = (c) => {
      this.ele.style.display = "block"
      return this.ele
    }
    // ==============================================================
    return this.ele
  }
  volantis.dom.$ = (ele) => {
    return !!ele ? new volantisDom(ele) : null;
  }
  /******************** RunItem ********************************/
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = () => {
          volantis.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) => {
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index, 1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }
  /******************** Pjax ********************************/
  // /layout/_plugins/pjax/index.ejs
  // volantis.pjax.send(callBack[,"callBackName"]) 传入pjax:send回调函数
  // volantis.pjax.push(callBack[,"callBackName"]) 传入pjax:complete回调函数
  // volantis.pjax.error(callBack[,"callBackName"]) 传入pjax:error回调函数
  volantis.pjax = {};
  volantis.pjax.method = {
    complete: new RunItem(),
    error: new RunItem(),
    send: new RunItem(),
  };
  volantis.pjax = Object.assign(volantis.pjax, {
    push: volantis.pjax.method.complete.push,
    error: volantis.pjax.method.error.push,
    send: volantis.pjax.method.send.push,
  });
  /******************** RightMenu ********************************/
  // volantis.rightmenu.handle(callBack[,"callBackName"]) 外部菜单项控制
  // 可在 volantis.mouseEvent 处获取右键事件
  volantis.rightmenu = {};
  volantis.rightmenu.method = {
    handle: new RunItem(),
  }
  volantis.rightmenu = Object.assign(volantis.rightmenu, {
    handle: volantis.rightmenu.method.handle.push,
  });
  /********************  Dark Mode  ********************************/
  // /layout/_partial/scripts/darkmode.ejs
  // volantis.dark.mode 当前模式 dark or light
  // volantis.dark.toggle() 暗黑模式触发器
  // volantis.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  volantis.dark = {};
  volantis.dark.method = {
    toggle: new RunItem(),
  };
  volantis.dark = Object.assign(volantis.dark, {
    push: volantis.dark.method.toggle.push,
  });
  /********************  Message  ********************************/
  // VolantisApp.message
  /********************  isMobile  ********************************/
  // /source/js/app.js
  // volantis.isMobile
  // volantis.isMobileOld
  /********************脚本动态加载函数********************************/
  // volantis.js(src, cb)  cb 可以传入onload回调函数 或者 JSON对象 例如: volantis.js("src", ()=>{}) 或 volantis.js("src", {defer:true,onload:()=>{}})
  // volantis.css(src)

  // 返回Promise对象，如下方法同步加载资源，这利于处理文件资源之间的依赖关系，例如：APlayer 需要在 MetingJS 之前加载
  // (async () => {
  //     await volantis.js("...theme.plugins.aplayer.js.aplayer...")
  //     await volantis.js("...theme.plugins.aplayer.js.meting...")
  // })();

  // 已经加入了setTimeout
  volantis.js = (src, cb) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }
  volantis.css = (src) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  }
  /********************按需加载的插件********************************/
  // volantis.import.jQuery().then(()=>{})
  volantis.import = {
    jQuery: () => {
      if (typeof jQuery == "undefined") {
        return volantis.js("https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js")
      } else {
        return new Promise(resolve => {
          resolve()
        });
      }
    }
  }
  /********************** requestAnimationFrame ********************************/
  // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
  // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
  volantis.requestAnimationFrame = (fn) => {
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
    }
    window.requestAnimationFrame(fn)
  }
  /************************ layoutHelper *****************************************/
  volantis.layoutHelper = (helper, html, opt) => {
    opt = Object.assign({ clean: false, pjax: true }, opt)
    function myhelper(helper, html, clean) {
      volantis.tempDiv = document.createElement("div");
      volantis.tempDiv.innerHTML = html;
      let layoutHelper = document.querySelector("#layoutHelper-" + helper)
      if (layoutHelper) {
        if (clean) {
          layoutHelper.innerHTML = ""
        }
        layoutHelper.append(volantis.tempDiv);
      }
    }
    myhelper(helper, html, opt.clean)
    if (opt.pjax) {
      volantis.pjax.push(() => {
        myhelper(helper, html, opt.clean)
      }, "layoutHelper-" + helper)
    }
  }
  /****************************** 滚动事件处理 ****************************************/
  volantis.scroll = {
    engine: new RunItem(),
    unengine: new RunItem(),
  };
  volantis.scroll = Object.assign(volantis.scroll, {
    push: volantis.scroll.engine.push,
  });
  // 滚动条距离顶部的距离
  volantis.scroll.getScrollTop = () => {
    let scrollPos;
    if (window.pageYOffset) {
      scrollPos = window.pageYOffset;
    } else if (document.compatMode && document.compatMode != 'BackCompat') {
      scrollPos = document.documentElement.scrollTop;
    } else if (document.body) {
      scrollPos = document.body.scrollTop;
    }
    return scrollPos;
  }
  volantis.scroll.scrollHeight = function () {
    return Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight,
    )
  }
  volantis.scroll.offsetHeight = function () {
    return Math.max(
      document.body.offsetHeight,
      document.documentElement.offsetHeight,
      document.body.clientHeight,
      document.documentElement.clientHeight
    )
  }
  volantis.scroll.progress = function () {
    return volantis.scroll.getScrollTop() / (volantis.scroll.scrollHeight() - volantis.scroll.offsetHeight())
  }
  // 使用 requestAnimationFrame 处理滚动事件
  // `volantis.scroll.del` 中存储了一个数值, 该数值检测一定时间间隔内滚动条滚动的位移, 数值的检测频率是浏览器的刷新频率. 数值为正数时, 表示向下滚动. 数值为负数时, 表示向上滚动.
  volantis.scroll.handleScrollEvents = () => {
    volantis.scroll.lastScrollTop = volantis.scroll.getScrollTop()
    function loop() {
      const scrollTop = volantis.scroll.getScrollTop();
      if (volantis.scroll.lastScrollTop !== scrollTop) {
        volantis.scroll.del = scrollTop - volantis.scroll.lastScrollTop;
        volantis.scroll.lastScrollTop = scrollTop;
        // if (volantis.scroll.del > 0) {
        //   console.log("向下滚动");
        // } else {
        //   console.log("向上滚动");
        // }
        // 注销过期的unengine未滚动事件
        volantis.scroll.unengine.list = []
        volantis.scroll.engine.start();
      } else {
        volantis.scroll.unengine.start();
      }
      volantis.requestAnimationFrame(loop)
    }
    volantis.requestAnimationFrame(loop)
  }
  volantis.scroll.handleScrollEvents()
  volantis.scroll.ele = null;
  // 触发页面滚动至目标元素位置
  volantis.scroll.to = (ele, option = {}) => {
    if (!ele) return;
    volantis.scroll.ele = ele;
    // 默认配置
    opt = {
      top: ele.getBoundingClientRect().top + document.documentElement.scrollTop,
      behavior: "smooth"
    }
    // 定义配置
    if ("top" in option) {
      opt.top = option.top
    }
    if ("behavior" in option) {
      opt.behavior = option.behavior
    }
    if ("addTop" in option) {
      opt.top += option.addTop
    }
    if (!("observerDic" in option)) {
      option.observerDic = 100
    }
    // 滚动
    window.scrollTo(opt);
    // 监视器
    // 监视并矫正元素滚动到指定位置
    // 用于处理 lazyload 引起的 cls 导致的定位失败问题
    // option.observer = false
    if (option.observer) {
      setTimeout(() => {
        if (volantis.scroll.ele != ele) {
          return
        }
        volantis.scroll.unengine.push(() => {
          let me = ele.getBoundingClientRect().top
          if (!(me >= -option.observerDic && me <= option.observerDic)) {
            volantis.scroll.to(ele, option)
          }
          volantis.scroll.unengine.remove("unengineObserver")
        }, "unengineObserver")
      }, 1000)
    }
  }
  /********************** Content Visibility ********************************/
  // 见 source/css/first.styl 如果遇到任何问题 删除 .post-story 即可
  // 一个元素被声明 content-visibility 属性后 如果元素不在 viewport 中 浏览器不会计算其后代元素样式和属性 从而节省 Style & Layout 耗时
  // content-visibility 的副作用: 锚点失效 等等(实验初期 暂不明确), 使用此方法清除样式
  volantis.cleanContentVisibility = () => {
    if (document.querySelector(".post-story")) {
      console.log("cleanContentVisibility");
      document.querySelectorAll(".post-story").forEach(e => {
        e.classList.remove("post-story")
      })
    }
  }
  /******************************************************************************/
  /******************************************************************************/
  /******************************************************************************/
  //图像加载出错时的处理
  function errorImgAvatar(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/avatar/round/3442075.svg";
    img.onerror = null;
  }
  function errorImgCover(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/cover/76b86c0226ffd.svg";
    img.onerror = null;
  }
  /******************************************************************************/
</script>
<script>
  volantis.GLOBAL_CONFIG ={
    root: '/',
    debug: "env",
    default: {"avatar":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/avatar/round/3442075.svg","link":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/link/8f277b4ee0ecd.svg","cover":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/cover/76b86c0226ffd.svg","image":"https://unpkg.com/volantis-static@0.0.1660614606622/media/placeholder/image/2659360.svg"},
    lastupdate: new Date(1668168141898),
    cdn: {
      izitoast_css: 'https://cdn.bootcdn.net/ajax/libs/izitoast/1.4.0/css/iziToast.min.css',
      izitoast_js: 'https://cdn.bootcdn.net/ajax/libs/izitoast/1.4.0/js/iziToast.min.js',
      fancybox_css: 'https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/4.0.31/fancybox.min.css',
      fancybox_js: 'https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/4.0.31/fancybox.umd.min.js'
    },
    sidebar: {
      for_page: ["blogger","announcement","lastupdate","category","tagcloud","webinfo"],
      for_post: ["toc"],
      webinfo: {
        lastupd: {
          enable: true,
          friendlyShow: true
        },
        runtime: {
          data: "2020/02/10",
          unit: "天"
        }
      }
    },
    plugins: {
      message: {"enable":true,"icon":{"default":"fa-solid fa-info-circle light-blue","quection":"fa-solid fa-question-circle light-blue"},"time":{"default":5000,"quection":20000},"position":"topRight","transitionIn":"bounceInLeft","transitionOut":"fadeOutRight","titleColor":"var(--color-text)","messageColor":"var(--color-text)","backgroundColor":"var(--color-card)","zindex":2147483647,"copyright":{"enable":true,"title":"知识共享许可协议","message":"请遵守 CC BY-NC-SA 4.0 协议。","icon":"far fa-copyright light-blue"},"aplayer":{"enable":true,"play":"fa-solid fa-play","pause":"fa-solid fa-pause"},"rightmenu":{"enable":true,"notice":true}},
      
      aplayer: {
        id: 80230515,
        enable:true
      },
      
      
      rightmenus: {"enable":true,"order":["plugins.navigation","hr","plugins.inputBox","plugins.seletctText","plugins.elementCheck","plugins.elementImage","menus.link","hr","menus.darkMode","plugins.articlePage","music"],"options":{"iconPrefix":"fa-solid","articleShowLink":true,"musicAlwaysShow":true},"plugins":{"navigation":[{"id":"left","name":"转到上一页","icon":"fa-solid fa-arrow-left","event":"history.back()","group":"navigation"},{"id":"right","name":"转到下一页","icon":"fa-solid fa-arrow-right","event":"history.forward()","group":"navigation"},{"id":"redo","name":"刷新当前页面","icon":"fa-solid fa-redo","event":"window.location.reload()","group":"navigation"},{"id":"up","name":"回到顶部","icon":"fa-solid fa-arrow-up","event":"VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)","group":"navigation"}],"inputBox":[{"id":"copyPaste","name":"粘贴文本","icon":"fa-solid fa-paste","event":"copyPaste","group":"inputBox"},{"id":"copyAll","name":"全选文本","icon":"fa-solid fa-object-ungroup","event":"copyAll","group":"inputBox"},{"id":"copyCut","name":"剪切文本","icon":"fa-solid fa-cut","event":"copyCut","group":"inputBox"}],"seletctText":[{"id":"copyText","name":"复制文本","icon":"fa-solid fa-copy","event":"copyText","group":"seletctText"},{"id":"searchWord","name":"站内搜索","icon":"fa-solid fa-search","event":"OpenSearch(__text__)","group":"seletctText"},{"id":"bingSearch","name":"必应搜索","icon":"fa-solid fa-search","event":"window.open(`https://cn.bing.com/search?q=${__text__}`)","group":"seletctText"}],"elementCheck":[{"id":"openTab","name":"新标签页打开","icon":"fa-solid fa-external-link-square-alt","event":"window.open(__link__)","group":"elementCheck"},{"id":"copyLink","name":"复制链接地址","icon":"fa-solid fa-link","event":"copyLink","group":"elementCheck"}],"elementImage":[{"id":"copyImg","name":"复制图片","icon":"fa-solid fa-image","event":"copyImg","group":"elementImage"},{"id":"googleImg","name":"谷歌识图","icon":"fa-solid fa-images","event":"window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)","group":"elementImage"}],"articlePage":[{"id":"printMode","name":"打印页面","icon":"fa-solid fa-print","event":"printMode","group":"articlePage"},{"id":"readMode","name":"阅读模式","icon":"fa-solid fa-book-open","event":"readMode","group":"articlePage"}]},"menus":{"link":[{"id":"help","name":"常见问题","icon":"fa-solid fa-question","link":"https://volantis.js.org/faqs/","group":"link"},{"id":"examples","name":"示例博客","icon":"fa-solid fa-rss","link":"https://volantis.js.org/examples/","group":"link"},{"id":"contributors","name":"加入社区","icon":"fa-solid fa-fan","link":"https://volantis.js.org/contributors/","group":"link"},"hr",{"id":"source_docs","name":"本站源码","icon":"fa-solid fa-code-branch","link":"https://github.com/volantis-x/volantis-docs/","group":"link"},{"id":"source_theme","name":"主题源码","icon":"fa-solid fa-code-branch","link":"https://github.com/volantis-x/hexo-theme-volantis/","group":"link"}],"darkMode":[{"id":"darkMode","name":"暗黑模式","icon":"fa-solid fa-moon","event":"volantis.dark.toggle()","group":"darkMode"}]}}
      
    },
    search: {
      

      
        dataPath: (("/" || "/").endsWith("/") ? "/" || "/" : "//" || "/") + "content.json",
      

      
    },
    languages: {
      
        search: {
          hits_empty: "找不到您查询的内容：${query}",
          hits_stats: "找到 ${hits} 条结果，用时 ${time} 毫秒",
        }
      
    }
  }
</script>
  <!-- import head_end begin -->
  <!-- import head_end end -->
  <!-- Custom Files headEnd begin-->
  
  <!-- Custom Files headEnd end-->
</head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- Custom Files bodyBegin end-->
    <header itemscope itemtype="http://schema.org/WPHeader" id="l_header" class="l_header auto shadow floatable blur show" style="opacity: 0">
  <div class="container">
  <div id="wrapper">
    <div class="nav-sub">
      <p class="title"></p>
      <ul class="switcher nav-list-h m-phone" id="pjax-header-nav-list">
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href="/">
          
            <img no-lazy class="logo" src="https://gcore.jsdelivr.net/gh/666WXY666/cdn@10.7/img/logo/logo-round.png">
          
          
          
        </a>
      

			<div class="menu navigation">
				<ul class="nav-list-h m-pc">
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" title="博客" active-action="action-home">
                  <i class="fa-solid fa-rss fa-fw"></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="内容">
                  <i class="fas fa-fan fa-spin fa-fw"></i>内容
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/bb/" title="随笔" active-action="action-bb">
                  <i class="fas fa-comment-dots faa-tada fa-fw"></i>随笔
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/shuoshuo/" title="说说" active-action="action-shuoshuo">
                  <i class="fas fa-comments faa-tada fa-fw"></i>说说
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/categories/" title="分类" active-action="action-categories">
                  <i class="fas fa-folder-open faa-tada fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/tags/" title="标签" active-action="action-tags">
                  <i class="fas fa-tags faa-tada fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/archives/" title="归档" active-action="action-archives">
                  <i class="fas fa-archive faa-tada fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="百宝箱">
                  <i class="fas fa-heartbeat faa-tada fa-fw"></i>百宝箱
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/gallery/" title="画廊" active-action="action-gallery">
                  <i class="fas fa-images faa-tada fa-fw"></i>画廊
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/color/" title="调色板" active-action="action-color">
                  <i class="fas fa-palette faa-tada fa-fw"></i>调色板
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="http://emojihomepage.com/" title="表情" active-action="action-http:emojihomepagecom">
                  <i class="fas fa-laugh faa-tada fa-fw"></i>表情
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="小游戏">
                  <i class="fas fa-gamepad faa-tada fa-fw"></i>小游戏
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/mf/" title="转转魔方" active-action="action-gamesmf">
                  <i class="fas fa-cube faa-tada fa-fw"></i>转转魔方
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/2048/" title="2048" active-action="action-games2048">
                  <i class="fas fa-border-all faa-tada fa-fw"></i>2048
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/periodic-table/" title="元素周期表" active-action="action-gamesperiodic-table">
                  <i class="fas fa-atom faa-tada fa-fw"></i>元素周期表
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/cat/" title="抓住小猫" active-action="action-gamescat">
                  <i class="fas fa-cat faa-tada fa-fw"></i>抓住小猫
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/snake/" title="贪吃蛇" active-action="action-gamessnake">
                  <i class="fas fa-dragon faa-tada fa-fw"></i>贪吃蛇
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/gomoku/" title="五子棋" active-action="action-gamesgomoku">
                  <i class="fas fa-chess-board faa-tada fa-fw"></i>五子棋
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/plane/" title="纸飞机" active-action="action-gamesplane">
                  <i class="fas fa-paper-plane faa-tada fa-fw"></i>纸飞机
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.goodoldtetris.com/" title="俄罗斯方块" active-action="action-https:wwwgoodoldtetriscom">
                  <i class="fas fa-cubes faa-tada fa-fw"></i>俄罗斯方块
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://aidn.jp/mikutap/" title="mikutap" active-action="action-https:aidnjpmikutap">
                  <i class="fas fa-music faa-tada fa-fw"></i>mikutap
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://lines.frvr.com/" title="彩虹连线" active-action="action-https:linesfrvrcom">
                  <i class="fas fa-check faa-tada fa-fw"></i>彩虹连线
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://bejeweled.shiraha.cn/" title="宝石迷阵" active-action="action-https:bejeweledshirahacn">
                  <i class="fas fa-gem faa-tada fa-fw"></i>宝石迷阵
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.mazegenerator.net/" title="迷宫生成" active-action="action-http:wwwmazegeneratornet">
                  <i class="fas fa-dungeon faa-tada fa-fw"></i>迷宫生成
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://travellings.link/" title="开往" active-action="action-https:travellingslink">
                  <i class="fas fa-subway faa-tada fa-fw"></i>开往
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class="fas fa-moon fa-fw"></i>关灯
                </a>
              </li><li>
            
          
          
            
            
              </li><li>
                <a class="menuitem flat-box faa-parent animated-hover" title="更多">
                  <i class="fas fa-ellipsis-v faa-tada fa-fw"></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/friends/" title="朋友" active-action="action-friends">
                  <i class="fas fa-link faa-tada fa-fw"></i>朋友
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/about/" title="关于" active-action="action-about">
                  <i class="fas fa-info-circle faa-tada fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="有疑问">
                  <i class="fas fa-question faa-tada fa-fw"></i>有疑问
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/" title="我的Github主页" active-action="action-https:githubcom666WXY666">
                  <i class="fab fa-github faa-tada fa-fw"></i>我的Github主页
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://gitee.com/wxy_666/" title="我的Gitee主页" active-action="action-https:giteecomwxy_666">
                  <i class="fab fa-git-alt faa-tada fa-fw"></i>我的Gitee主页
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/666WXY666.github.io/" title="本站源码" active-action="action-https:githubcom666WXY666666WXY666githubio">
                  <i class="fas fa-code faa-tada fa-fw"></i>本站源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/666WXY666.github.io/issues/" title="向我提问" active-action="action-https:githubcom666WXY666666WXY666githubioissues">
                  <i class="fas fa-question-circle faa-tada fa-fw"></i>向我提问
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search...">
        </form>
      </div>
      

			<ul class="switcher nav-list-h m-phone">
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" title="博客" active-action="action-home">
                  <i class="fa-solid fa-rss fa-fw"></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="内容">
                  <i class="fas fa-fan fa-spin fa-fw"></i>内容
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/bb/" title="随笔" active-action="action-bb">
                  <i class="fas fa-comment-dots faa-tada fa-fw"></i>随笔
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/shuoshuo/" title="说说" active-action="action-shuoshuo">
                  <i class="fas fa-comments faa-tada fa-fw"></i>说说
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/categories/" title="分类" active-action="action-categories">
                  <i class="fas fa-folder-open faa-tada fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/tags/" title="标签" active-action="action-tags">
                  <i class="fas fa-tags faa-tada fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/archives/" title="归档" active-action="action-archives">
                  <i class="fas fa-archive faa-tada fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="百宝箱">
                  <i class="fas fa-heartbeat faa-tada fa-fw"></i>百宝箱
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/gallery/" title="画廊" active-action="action-gallery">
                  <i class="fas fa-images faa-tada fa-fw"></i>画廊
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/color/" title="调色板" active-action="action-color">
                  <i class="fas fa-palette faa-tada fa-fw"></i>调色板
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="http://emojihomepage.com/" title="表情" active-action="action-http:emojihomepagecom">
                  <i class="fas fa-laugh faa-tada fa-fw"></i>表情
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="小游戏">
                  <i class="fas fa-gamepad faa-tada fa-fw"></i>小游戏
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/mf/" title="转转魔方" active-action="action-gamesmf">
                  <i class="fas fa-cube faa-tada fa-fw"></i>转转魔方
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/2048/" title="2048" active-action="action-games2048">
                  <i class="fas fa-border-all faa-tada fa-fw"></i>2048
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/periodic-table/" title="元素周期表" active-action="action-gamesperiodic-table">
                  <i class="fas fa-atom faa-tada fa-fw"></i>元素周期表
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/cat/" title="抓住小猫" active-action="action-gamescat">
                  <i class="fas fa-cat faa-tada fa-fw"></i>抓住小猫
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/snake/" title="贪吃蛇" active-action="action-gamessnake">
                  <i class="fas fa-dragon faa-tada fa-fw"></i>贪吃蛇
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/gomoku/" title="五子棋" active-action="action-gamesgomoku">
                  <i class="fas fa-chess-board faa-tada fa-fw"></i>五子棋
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/games/plane/" title="纸飞机" active-action="action-gamesplane">
                  <i class="fas fa-paper-plane faa-tada fa-fw"></i>纸飞机
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.goodoldtetris.com/" title="俄罗斯方块" active-action="action-https:wwwgoodoldtetriscom">
                  <i class="fas fa-cubes faa-tada fa-fw"></i>俄罗斯方块
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://aidn.jp/mikutap/" title="mikutap" active-action="action-https:aidnjpmikutap">
                  <i class="fas fa-music faa-tada fa-fw"></i>mikutap
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://lines.frvr.com/" title="彩虹连线" active-action="action-https:linesfrvrcom">
                  <i class="fas fa-check faa-tada fa-fw"></i>彩虹连线
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://bejeweled.shiraha.cn/" title="宝石迷阵" active-action="action-https:bejeweledshirahacn">
                  <i class="fas fa-gem faa-tada fa-fw"></i>宝石迷阵
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.mazegenerator.net/" title="迷宫生成" active-action="action-http:wwwmazegeneratornet">
                  <i class="fas fa-dungeon faa-tada fa-fw"></i>迷宫生成
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://travellings.link/" title="开往" active-action="action-https:travellingslink">
                  <i class="fas fa-subway faa-tada fa-fw"></i>开往
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class="fas fa-moon fa-fw"></i>关灯
                </a>
              </li><li>
            
          
            
              
            
              </li><li>
                <a class="menuitem flat-box faa-parent animated-hover" title="更多">
                  <i class="fas fa-ellipsis-v faa-tada fa-fw"></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/friends/" title="朋友" active-action="action-friends">
                  <i class="fas fa-link faa-tada fa-fw"></i>朋友
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/about/" title="关于" active-action="action-about">
                  <i class="fas fa-info-circle faa-tada fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" title="有疑问">
                  <i class="fas fa-question faa-tada fa-fw"></i>有疑问
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/" title="我的Github主页" active-action="action-https:githubcom666WXY666">
                  <i class="fab fa-github faa-tada fa-fw"></i>我的Github主页
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://gitee.com/wxy_666/" title="我的Gitee主页" active-action="action-https:giteecomwxy_666">
                  <i class="fab fa-git-alt faa-tada fa-fw"></i>我的Gitee主页
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/666WXY666.github.io/" title="本站源码" active-action="action-https:githubcom666WXY666666WXY666githubio">
                  <i class="fas fa-code faa-tada fa-fw"></i>本站源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/666WXY666/666WXY666.github.io/issues/" title="向我提问" active-action="action-https:githubcom666WXY666666WXY666githubioissues">
                  <i class="fas fa-question-circle faa-tada fa-fw"></i>向我提问
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
      <!-- see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs -->
      <div id="none" class="cover-wrapper post dock" style="display: none;">
        
  <div id="parallax-window"></div>

<div class="cover-body">
  <div class="top">
    
    
      <p class="title">Sekiro's Blog</p>
    
    
  </div>
  <div class="bottom">
    <div class="menu navigation">
      <div class="list-h">
        
          
            <a href="/" active-action="action-home">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>博客</p>
            </a>
          
            <a href="/bb/" active-action="action-bb">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1fab6.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1fab6.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>随笔</p>
            </a>
          
            <a href="/shuoshuo/" active-action="action-shuoshuo">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f3d6.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f3d6.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>说说</p>
            </a>
          
            <a href="/categories/" active-action="action-categories">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c2.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c2.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>分类</p>
            </a>
          
            <a href="/tags/" active-action="action-tags">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4cc.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4cc.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>标签</p>
            </a>
          
            <a href="/archives/" active-action="action-archives">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4da.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4da.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>归档</p>
            </a>
          
            <a href="/friends/" active-action="action-friends">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f37b.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f37b.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>朋友</p>
            </a>
          
            <a href="/about/" active-action="action-about">
              <img src="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4a1.svg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4a1.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>关于</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
    
  
</div>

      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class>
  <article itemscope itemtype="http://schema.org/Article" class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="https://666wxy666.github.io/2020/09/03/操作系统-进程线程管理通信与同步互斥/">
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sekiro's Blog">
  </span>
  <span hidden itemprop="post" itemscope itemtype="http://schema.org/Post">
    <meta itemprop="name" content="Sekiro's Blog">
    <meta itemprop="description" content="经验分享和技术交流">
  </span>
  


  
    <span hidden>
      <meta itemprop="image" content="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png">
    </span>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        操作系统 进程线程管理通信与同步互斥
      </h1>
      <div class="new-meta-box">
        
          
            
<div class="new-meta-item author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a itemprop="url" class="author" href="/" rel="nofollow">
    <img itemprop="image" src="https://gcore.jsdelivr.net/gh/666WXY666/cdn/img/avatar/avatar.gif" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666WXY666/cdn/img/avatar/avatar.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
    <p itemprop="name">Sekiro</p>
  </a>
</div>

          
        
          
            
  
  
  
  <div class="new-meta-item category">
    <i class="fa-solid fa-folder-open fa-fw" aria-hidden="true"></i>
    <a class="category-link" href="/categories/C-C/">C/C++</a><span class="sep"></span><a class="category-link" href="/categories/C-C/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/C-C/" itemprop="url"><span itemprop="name">C/C++</span></a>
      </span>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/C-C/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url"><span itemprop="name">操作系统</span></a>
      </span>
    
  </div>
  



          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2020-09-03T00:00:00+00:00">
  <a class="notlink">
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2020年9月3日</p>
  </a>
</div>

          
        
          
            


<div class="new-meta-item browse">
  <a class="notlink">
    <p>
      <i class="fa-solid fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="busuanzi_value_page_pv">
        <i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i>
      </span>
        
      <span>次浏览</span>
    </p>
  </a>
</div>


          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <p>本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验<em>（长文警告）</em>。</p>
<span id="more"></span>



<h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol>
<li>以OpenEuler等Linux操作系统为实验对象，加深对Linux进程、线程概念的理解，掌握利用Linux系统调用创建、管理进程的方法，掌握利用POSIX线程（Pthread）库创建管理线程的方法，认识进程、线程并发执行的实质；</li>
<li>深入理解Linux内核提供的消息队列、共享内存、管道、软中断四种进程间通信机制，掌握利用系统调用实现进程间通信；</li>
<li>了解Pthread线程库提供的线程间通信机制，掌握使用Pthread API实现线程间通信的方法；</li>
<li>深入理解Linux系统提供的多种进程同步互斥机制，掌握使用信号量实现进程间的同步互斥的方法；</li>
<li>了解Pthread提供的线程同步互斥机制，掌握使用互斥变量和条件变量实现多线程间的同步互斥的方法</li>
</ol>
<h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><p>硬件：</p>
<ul>
<li>Intel i7 7700HQ，内存16GB</li>
</ul>
<p>软件：</p>
<ul>
<li>虚拟机：VMware Workstation Pro 15.5.6</li>
<li>Linux系统：华为openEuler-20.03-LTS-x86_64</li>
<li>Pthread线程库，POSIX接口</li>
<li>gcc编译</li>
<li>C语言</li>
</ul>
<h2 id="三、实验内容"><a href="#三、实验内容" class="headerlink" title="三、实验内容"></a>三、实验内容</h2><p>在Linux环境下，采用C&#x2F;C++&#x2F;Java（或其它语言）编程，完成以下实验内容。</p>
<h3 id="1、第一组-进程的创建与管理"><a href="#1、第一组-进程的创建与管理" class="headerlink" title="1、第一组 进程的创建与管理"></a>1、第一组 进程的创建与管理</h3><ol>
<li><p>阅读Linux内核源码，分析Linux进程的组成，观察进PCB&#x2F;task_struc等进程管理数据结构；</p>
</li>
<li><p>利用Linux内核提供的<code>fork()</code>、<code>exec()</code>、<code>wait()</code>等系统调用，创建管理多个进程，观察父子进程的结构和并发行为，掌握睡眠、撤销等进程控制方法；</p>
</li>
<li><p>掌握<code>ps</code>、<code>top</code>、<code>pstree –h</code>、<code>vmstat</code>、<code>strace</code>、<code>ltrace</code>、<code>sleep x</code>、<code>kill</code>、<code>jobs</code>等命令的功能和使用方式；</p>
</li>
</ol>
<h3 id="2、第二组-线程的创建与管理"><a href="#2、第二组-线程的创建与管理" class="headerlink" title="2、第二组 线程的创建与管理"></a>2、第二组 线程的创建与管理</h3><ol>
<li><p>了解POSIX 线程标准库（Pthread线程库）定义的线程结构和提供的线程管理API；</p>
</li>
<li><p>利用Pthread线程库API，创建管理多个线程，观察线程的结构和并发执行行为；</p>
</li>
</ol>
<h3 id="3、第三-x2F-四组-进程-x2F-线程通信"><a href="#3、第三-x2F-四组-进程-x2F-线程通信" class="headerlink" title="3、第三&#x2F;四组 进程&#x2F;线程通信"></a>3、第三&#x2F;四组 进程&#x2F;线程通信</h3><ol>
<li><p>了解Linux提供的消息队列、共享内存、管道、软中断Signal等四种通信机制，编程实现进程间通信；</p>
</li>
<li><p>线程通信</p>
<p>了解Linux所支持的线程机制，在一个进程内创建多个主从线程，采用参数传递机制，实现线程间通信；</p>
</li>
</ol>
<h3 id="4、第五组-进程-x2F-线程同步互斥"><a href="#4、第五组-进程-x2F-线程同步互斥" class="headerlink" title="4、第五组 进程&#x2F;线程同步互斥"></a>4、第五组 进程&#x2F;线程同步互斥</h3><p>要求：参照2019-2020学年操作系统期末考试信号量题目，设计实现三个进程&#x2F;线程A、B、C，分别模拟题目所描述的生产产品A、B、C的三个worker，观察并记录进程&#x2F;线程的创建和同步互斥行为。重点分析信号量设计方案是否合理、符合预期，避免设计方案导致死锁或不符合题目要求。</p>
<p>期末考试试题如下：</p>
<blockquote>
<p>An assembly line is to produce a product C with four part As, and three part Bs. The worker of machining(加工) A and worker of machining B will produce two part As and one part B independently each time. Then the two part As or one part B will be moved to the station(工作台), which can hold at most 12 of part As and part Bs altogether. Two part As must be put onto the station simultaneously. The workers must exclusively put a part on the station or get it from the station. In addition, the worker to make C must get all part of As and Bs for one product once. </p>
<p>Using semaphores to coordinate the three workers who are machining part A, part B and the product C to manufacture the product without deadlock. </p>
<p>It is required that</p>
<p>(1) definition and initial value of each semaphore, and</p>
<p>(2) the algorithm to coordinate the production process for the three workers should be given.</p>
</blockquote>
<ol>
<li><p>进程同步互斥</p>
<p>创建3个Linux进程，分别模拟生产产品A、B、C的三个worker的行为，利用Linux内核信号量，实现三者间正确的同步互斥；</p>
</li>
<li><p>线程同步互斥</p>
<p>利用Pthread API，创建3个Linux线程，分别模拟生产产品A、B、C的三个worker的行为，采用Pthread提供的信号量&#x2F;管程机制，现三者间正确的同步互斥；</p>
</li>
</ol>
<h2 id="四、实验步骤"><a href="#四、实验步骤" class="headerlink" title="四、实验步骤"></a>四、实验步骤</h2><h3 id="0、实验环境配置"><a href="#0、实验环境配置" class="headerlink" title="0、实验环境配置"></a>0、实验环境配置</h3><h4 id="0-1-Linux-操作系统安装"><a href="#0-1-Linux-操作系统安装" class="headerlink" title="0-1. Linux 操作系统安装"></a>0-1. Linux 操作系统安装</h4><ul>
<li><p>选择OpenEuler等Linux发行版本，观察所采用的内核版本，采用硬盘分区模式安装Linux系统；</p>
</li>
<li><p>也可以先在本机操作系统上安装VitualBox、VMware、Virtual PC等虚拟机软件，在虚拟机之上安装Linux系统。</p>
</li>
</ul>
<p>注意安装操作系统所需的软硬件环境和硬件配置要求。</p>
<h4 id="0-2-Pthread-线程库安装"><a href="#0-2-Pthread-线程库安装" class="headerlink" title="0-2. Pthread 线程库安装"></a>0-2. Pthread 线程库安装</h4><p>观察确认所安装的Linux发行版本带有Pthread线程库，注意：</p>
<ol>
<li>某些版本Ubuntu  Linux默认不带Pthread线程库，即使在编译的度时候 加上<code>-lpthread</code>也不行，man不到相关Pthread函知数。此时，需要在<code>/usr/lib/…</code>下导入动态库<code>libpthread.a</code>，具体方法可以查阅网上相关资料。</li>
<li>后续编程时导入头文件：<code>#include &lt;pthread.h&gt;</code></li>
</ol>
<p>因为我电脑早已经安装了VMware虚拟机，就不重新安装了，直接下载安装OpenEuler。</p>
<h5 id="1、下载OpenEuler"><a href="#1、下载OpenEuler" class="headerlink" title="1、下载OpenEuler"></a>1、下载OpenEuler</h5><ol>
<li><p>进入<a href="https://openeuler.org/zh/releases.html" target="_blank" rel="external nofollow noopener noreferrer">OpenEuler下载页面</a>，下载openEuler-20.03-LTS-x86_64-dvd.iso镜像。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132252.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132252.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_111556" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132326.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132326.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_111616" style="zoom:80%;">
</li>
<li><p>等待下载完成。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132420.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132420.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_132410" style="zoom:80%;"></li>
</ol>
<h5 id="2、创建虚拟机"><a href="#2、创建虚拟机" class="headerlink" title="2、创建虚拟机"></a>2、创建虚拟机</h5><ol>
<li><p>打开VMware Workstation Pro，选择“创建新的虚拟机”。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132611.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132611.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_132601" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132632.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132632.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112633" style="zoom:80%;">
</li>
<li><p>选择“自定义”。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132719.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132719.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112704" style="zoom:80%;">
</li>
<li><p>设置虚拟机的硬件兼容性限制，按照默认选择。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132800.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132800.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112725" style="zoom:80%;">
</li>
<li><p>选择下载好的openEuler-20.03-LTS-x86_64-dvd.iso镜像。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132854.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132854.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112750" style="zoom:80%;">
</li>
<li><p>选择Linux 操作系统。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132954.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626132954.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112826" style="zoom:80%;">
</li>
<li><p>配置虚拟机的名称，位置，处理器，内存，网络连接、控制器、磁盘等。</p>
<div galleryflag itemscope itemtype="http://schema.org/ImageGallery" class="gallery stretch" col="5" data-group="default"><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133108.jpg" data-fancybox="default" data-caption="2020-06-26_112858"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133108.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133108.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112858" style="zoom:80%;"></a><span class="image-caption">2020-06-26_112858</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133116.jpg" data-fancybox="default" data-caption="2020-06-26_112918"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133116.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133116.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112918" style="zoom:80%;"></a><span class="image-caption">2020-06-26_112918</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133123.jpg" data-fancybox="default" data-caption="2020-06-26_112938"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133123.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133123.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112938" style="zoom:80%;"></a><span class="image-caption">2020-06-26_112938</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133132.jpg" data-fancybox="default" data-caption="2020-06-26_112954"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133132.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133132.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_112954" style="zoom:80%;"></a><span class="image-caption">2020-06-26_112954</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133231.jpg" data-fancybox="default" data-caption="2020-06-26_113009"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133231.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133231.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113009" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113009</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133250.jpg" data-fancybox="default" data-caption="2020-06-26_113016"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133250.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133250.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113016" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113016</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133416.jpg" data-fancybox="default" data-caption="2020-06-26_113024"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133416.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133416.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113024" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113024</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133512.jpg" data-fancybox="default" data-caption="2020-06-26_113115"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133512.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133512.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113115" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113115</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133604.jpg" data-fancybox="default" data-caption="2020-06-26_113126"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133604.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133604.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113126" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113126</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133611.jpg" data-fancybox="default" data-caption="2020-06-26_113133"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133611.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133611.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113133" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113133</span></div></div>

</li>
<li><p>创建完成。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133817.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133817.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113152" style="zoom:80%;"></li>
</ol>
<h5 id="3、安装OpenEuler"><a href="#3、安装OpenEuler" class="headerlink" title="3、安装OpenEuler"></a>3、安装OpenEuler</h5><ol>
<li><p>启动虚拟机。</p>
<p><img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133904.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133904.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113202"></p>
</li>
<li><p>选择第一项安装OpenEuler。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133936.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626133936.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113235" style="zoom:80%;">
</li>
<li><p>等待check完毕。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134003.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134003.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113312" style="zoom:80%;">
</li>
<li><p>选择安装过程中所使用的语言。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134034.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134034.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113357" style="zoom:80%;">
</li>
<li><p>选择分区和软件模块，点击“开始安装”后，开始安装系统，在安装期间可以设置Root密码以及创建用户。</p>
<div galleryflag itemscope itemtype="http://schema.org/ImageGallery" class="gallery stretch" col="3" data-group="default"><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134155.jpg" data-fancybox="default" data-caption="2020-06-26_113456"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134155.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134155.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113456" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113456</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134341.jpg" data-fancybox="default" data-caption="2020-06-26_113619"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134341.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134341.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113619" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113619</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134350.jpg" data-fancybox="default" data-caption="2020-06-26_113643"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134350.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134350.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113643" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113643</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134418.jpg" data-fancybox="default" data-caption="2020-06-26_113726"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134418.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134418.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113726" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113726</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134431.jpg" data-fancybox="default" data-caption="2020-06-26_113805"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134431.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134431.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113805" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113805</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134504.jpg" data-fancybox="default" data-caption="2020-06-26_113813"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134504.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134504.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_113813" style="zoom:80%;"></a><span class="image-caption">2020-06-26_113813</span></div></div>

</li>
<li><p>安装完成。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134548.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134548.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_114538" style="zoom:80%;">
</li>
<li><p>重启后登录OpenEuler系统。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134624.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134624.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_114615" style="zoom:80%;">
</li>
<li><p>创建的wxy用户以及root用户均可以成功登录，安装OpenEuler完成。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134930.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134930.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_134836" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134938.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200626134938.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2020-06-26_134905" style="zoom:80%;"></li>
</ol>
<h3 id="1、第一组-进程的创建与管理-1"><a href="#1、第一组-进程的创建与管理-1" class="headerlink" title="1、第一组 进程的创建与管理"></a>1、第一组 进程的创建与管理</h3><h4 id="实验1-1-进程观察"><a href="#实验1-1-进程观察" class="headerlink" title="实验1-1. 进程观察"></a>实验1-1. 进程观察</h4><p>查阅相关资料，阅读Linux内核源码，分析Linux进程的组成，了解进程状态，观察进PCB&#x2F;task_struc等进程管理数据结构；</p>
<h4 id="实验1-2-进程创建与管理"><a href="#实验1-2-进程创建与管理" class="headerlink" title="实验1-2. 进程创建与管理"></a>实验1-2. 进程创建与管理</h4><p>参照<em><strong>“【实验指导】1. 进程创建及管理示例”</strong></em>中的程序，结合所查阅的参考资料，利用Linux内核提供的<code>fork()</code>、<code>exec()</code>、<code>wait()</code>、<code>exit()</code>、<code>kill()</code>等系统调用，创建管理多个进程，观察父子进程的结构和并发行为，掌握睡眠、撤销等进程控制方法；</p>
<p>要求：本组实验至少用到<code>fork()</code>、<code>exec()</code>、<code>wait()</code>、<code>exit()</code>、<code>kill()</code>、<code>getpid()</code>五个系统调用。</p>
<h5 id="1-2-1-fork"><a href="#1-2-1-fork" class="headerlink" title="1-2-1 fork()"></a>1-2-1 <code>fork()</code></h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">__pid_t</span> pid;</span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the parent process.\n&quot;</span>);</span><br><span class="line">        <span class="comment">/*父进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the child process.\n&quot;</span>);</span><br><span class="line">        <span class="comment">/*子进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fork error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_200044.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_200044.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_200044" style="zoom:80%;">

<ul>
<li>fork的返回值如果是&gt;0，那么就是父进程，这个&gt;0的返回值就是创建的子进程的PID；</li>
<li>fork的返回值如果是&#x3D;0，那么就是子进程；</li>
<li>fork的返回值如果是&lt;0，那么就是fork失败；</li>
</ul>
<h5 id="1-2-2-exec"><a href="#1-2-2-exec" class="headerlink" title="1-2-2 exec()"></a>1-2-2 <code>exec()</code></h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *envp[] = &#123;<span class="string">&quot;PATH=/tmp&quot;</span>, <span class="string">&quot;USER = 1ei&quot;</span>, <span class="string">&quot;STATUS = testing&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="type">char</span> *argv_execv[] = &#123;<span class="string">&quot;echo&quot;</span>, <span class="string">&quot;excuted by execv&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="type">char</span> *argv_execvp[] = &#123;<span class="string">&quot;echo&quot;</span>, <span class="string">&quot;excuted by execvp&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="type">char</span> *argv_execve[] = &#123;<span class="string">&quot;env&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execl(<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;echo&quot;</span>, <span class="string">&quot;executed by execl&quot;</span>, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execlp(<span class="string">&quot;echo&quot;</span>, <span class="string">&quot;echo&quot;</span>, <span class="string">&quot;executed by execlp&quot;</span>, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execlp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execle(<span class="string">&quot;/usr/bin/env&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="literal">NULL</span>, envp) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execv(<span class="string">&quot;/bin/echo&quot;</span>, argv_execv) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execv&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execvp(<span class="string">&quot;echo&quot;</span>, argv_execvp) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execvp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (execve(<span class="string">&quot;/usr/bin/env&quot;</span>, argv_execve, envp) &lt; <span class="number">0</span>)</span><br><span class="line">            perror(<span class="string">&quot;Err on execve&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_200606.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_200606.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_200606" style="zoom:80%;">

<p>exec用一个指定的程序文件,重新初始化一个进程。</p>
<ul>
<li><p>可指定新的命令行参数和环境参数(初始化堆栈底部)。</p>
</li>
<li><p>exec不创建新进程,只是将当前进程重新初始化了指令段和用户数据段,堆栈段以及CPU的PC指针。</p>
</li>
</ul>
<p>6种格式exec系统调用，exec前缀,后跟以下字母：</p>
<ul>
<li><p>l—list，v—vector</p>
<p>l与v:指定命令行参数的两种方式，l以表的形式，v要事先组织成一个指针数组。</p>
</li>
<li><p>e—env</p>
<p>需要指定envp来初始化进程。</p>
</li>
<li><p>p—path</p>
<p>使用环境变量PATH查找可执行文件。</p>
</li>
</ul>
<h5 id="1-2-3-wait"><a href="#1-2-3-wait" class="headerlink" title="1-2-3 wait()"></a>1-2-3 <code>wait()</code></h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">__pid_t</span> pid;</span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> status, wait_pid;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the parent process.\n&quot;</span>);</span><br><span class="line">        wait_pid = wait(&amp;status);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pid=%d,wait_pid=%d\n&quot;</span>, pid, wait_pid);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;status=%#X,WTERMSIG=%d,WEXITSTATUS=%d\n&quot;</span>, status, WTERMSIG(status), WEXITSTATUS(status));</span><br><span class="line">        <span class="comment">/*父进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;I am the child process.\n&quot;</span>);</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*子进程处理过程*/</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fork error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_203430.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_203430.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_203430" style="zoom:80%;">

<ul>
<li><p>函数返回值为已终止的子进程PID。</p>
</li>
<li><p>status中含有子进程终止的原因。</p>
<ul>
<li>TERMSIG(status)为被杀信号。</li>
<li>EXITSTATUS(status)为退出码。</li>
</ul>
</li>
</ul>
<p>子进程正常退出，且退出码为5，因此wait的status退出码刚好是5。</p>
<h5 id="1-2-4-kill"><a href="#1-2-4-kill" class="headerlink" title="1-2-4 kill()"></a>1-2-4 <code>kill()</code></h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">__pid_t</span> pid;</span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> status;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the parent process.\n&quot;</span>);</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">        kill(pid, <span class="number">5</span>);</span><br><span class="line">        wait(&amp;status);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%#X,%d,%d\n&quot;</span>, status, WTERMSIG(status), WEXITSTATUS(status));</span><br><span class="line">        <span class="comment">/*父进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;I am the child process.\n&quot;</span>);</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*子进程处理过程*/</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fork error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214107.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214107.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_214107" style="zoom:80%;">

<p>可以发现子进程被父进程杀掉了，且终止码为5，刚好wait的终止码也是5。</p>
<h5 id="1-2-5-getpid"><a href="#1-2-5-getpid" class="headerlink" title="1-2-5 getpid()"></a>1-2-5 <code>getpid()</code></h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">__pid_t</span> pid;</span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the parent process.\tpid=%d,child_pid=%d\n&quot;</span>, getpid(), pid);</span><br><span class="line">        <span class="comment">/*父进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am the child process.\t\tpid=%d,ppid=%d\n&quot;</span>, getpid(), getppid());</span><br><span class="line">        <span class="comment">/*子进程处理过程*/</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fork error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214652.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214652.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_214652" style="zoom:80%;">

<p>可以发现，父进程打印的子进程pid和子进程的pid相等，子进程打印的父进程的pid也和父进程的pid相等。</p>
<h4 id="实验1-3-进程管理命令"><a href="#实验1-3-进程管理命令" class="headerlink" title="实验1-3. 进程管理命令"></a>实验1-3. 进程管理命令</h4><p>了解<code>ps</code>、<code>top</code>、<code>pstree –h</code>、<code>vmstat</code>、<code>strace</code>、<code>ltrace</code>、<code>sleep x</code>、<code>kill</code>、<code>jobs</code>等命令的功能，使用这些命令观察进程结构和行为；</p>
<h5 id="1-3-1-ps"><a href="#1-3-1-ps" class="headerlink" title="1-3-1 ps"></a>1-3-1 <code>ps</code></h5><p>查看正在运行的进程。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214908.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_214908.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_214908" style="zoom:80%;">



<h5 id="1-3-2-top"><a href="#1-3-2-top" class="headerlink" title="1-3-2 top"></a>1-3-2 <code>top</code></h5><p>top查看进程相关信息。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215333.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215333.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_215333" style="zoom:80%;">



<h5 id="1-3-3-pstree-–h"><a href="#1-3-3-pstree-–h" class="headerlink" title="1-3-3 pstree –h"></a>1-3-3 <code>pstree –h</code></h5><p>pstree查看进程树。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215518.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215518.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_215518" style="zoom:80%;">



<h5 id="1-3-4-vmstat"><a href="#1-3-4-vmstat" class="headerlink" title="1-3-4 vmstat"></a>1-3-4 <code>vmstat</code></h5><p>vmstat可以查看系统相关信息。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215555.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215555.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_215555" style="zoom:80%;">



<h5 id="1-3-5-strace"><a href="#1-3-5-strace" class="headerlink" title="1-3-5 strace"></a>1-3-5 <code>strace</code></h5><p>先运行这个程序（ltrace、kill、jobs也是一样）：</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">__pid_t</span> pid;</span><br><span class="line">    <span class="keyword">if</span> ((pid = fork()) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;I am the parent process.\tpid=%d,child_pid=%d\n&quot;</span>, getpid(), pid);</span><br><span class="line">            sleep(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*父进程处理过程*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;I am the child process.\t\tpid=%d,ppid=%d\n&quot;</span>, getpid(), getppid());</span><br><span class="line">            sleep(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*子进程处理过程*/</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fork error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>屏幕输出：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215842.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215842.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_215842" style="zoom:80%;">

<p>strace就相当于是调试信息：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215937.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_215937.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_215937" style="zoom:80%;">



<h5 id="1-3-6-ltrace"><a href="#1-3-6-ltrace" class="headerlink" title="1-3-6 ltrace"></a>1-3-6 <code>ltrace</code></h5><p>ltrace也是同理。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220010.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220010.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_220010" style="zoom:80%;">



<h5 id="1-3-7-sleep-x"><a href="#1-3-7-sleep-x" class="headerlink" title="1-3-7 sleep x"></a>1-3-7 <code>sleep x</code></h5><p>睡眠了3s后继续输出。</p>
<p><img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220200.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220200.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_220200"></p>
<h5 id="1-3-8-kill"><a href="#1-3-8-kill" class="headerlink" title="1-3-8 kill"></a>1-3-8 <code>kill</code></h5><img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220353.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220353.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_220353" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220330.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_220330.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_220330" style="zoom:80%;">

<p>运行kill后只有父进程输出，子进程被杀掉了。</p>
<h5 id="1-3-9-jobs"><a href="#1-3-9-jobs" class="headerlink" title="1-3-9 jobs"></a>1-3-9 <code>jobs</code></h5><img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_221109.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200512_221109.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200512_221109" style="zoom:80%;">

<p>jobs查看已挂载的程序,不用携带任何参数，这里查看了正在后台运行的1-2-5程序。</p>
<h3 id="2、第二组-线程的创建与管理-1"><a href="#2、第二组-线程的创建与管理-1" class="headerlink" title="2、第二组 线程的创建与管理"></a>2、第二组 线程的创建与管理</h3><h4 id="实验2-1-Pthread线程库背景知识"><a href="#实验2-1-Pthread线程库背景知识" class="headerlink" title="实验2-1. Pthread线程库背景知识"></a>实验2-1. Pthread线程库背景知识</h4><p>了解POSIX 线程标准库（Pthread线程库）相关知识，分析Pthread线程结构，掌握所提供的线程管理API，如<code>pthread_create()</code>, <code>pthread_join()</code>, <code>pthread_self()</code>, <code>pthread_detach()</code>, <code>pthread_exit()</code>；</p>
<h4 id="实验2-2-线程创建与管理"><a href="#实验2-2-线程创建与管理" class="headerlink" title="实验2-2. 线程创建与管理"></a>实验2-2. 线程创建与管理</h4><p>参照<em><strong>“【实验指导】 2. 线程创建及管理程序示例”</strong></em>，查阅参考资料，利用Pthread API，创建和管理线程，观察线程的结构和并发执行行为；</p>
<p>要求：本组实验至少用到<code>pthread_create()</code>, <code>pthread_exit()</code>,<code>pthread_join()</code>, <code>pthread_self()</code>等四个API。</p>
<h5 id="2-2-1-pthread-create"><a href="#2-2-1-pthread-create" class="headerlink" title="2-2-1 pthread_create()"></a>2-2-1 <code>pthread_create()</code></h5><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_create</span><span class="params">(<span class="type">pthread_t</span> *thread，<span class="type">pthread_attr_t</span>*attr，<span class="type">void</span>*(*start_routine)(<span class="type">void</span> *), <span class="type">void</span> *arg)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：创建线程。</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">thread</td>
<td align="center">该参数是指向线程标识符的指针，当线程创建成功时，用来返回创建的线程ID</td>
</tr>
<tr>
<td align="center">attr</td>
<td align="center">该参数用于指定线程的属性，NULL表示使用默认属性</td>
</tr>
<tr>
<td align="center">start_routine</td>
<td align="center">该参数为一个函数指针，指向线程创建后要调用的函数，是一个以指向void的指针作为参数和返回值的函数指针，这个被线程调用的函数也被称为线程函数</td>
</tr>
<tr>
<td align="center">arg</td>
<td align="center">指向传递给线程函数的参数，NULL代表不传参数</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">成功：0<br>出错：返回错误码</td>
</tr>
</tbody></table>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mythread1</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am thread 1\n&quot;</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mythread2</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am thread 2\n&quot;</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> id1, id2;</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line"></span><br><span class="line">    res = pthread_create(&amp;id1, <span class="literal">NULL</span>, mythread1, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create pthread error!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = pthread_create(&amp;id2, <span class="literal">NULL</span>, mythread2, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create pthread error!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pthread_join(id1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(id2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_085544.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_085544.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_085544" style="zoom:80%;">

<p>可以发现，创建了两个线程：thread1和thread2。两个线程分别打印自己的信息，等带2s后继续打印。</p>
<h5 id="2-2-2-pthread-exit"><a href="#2-2-2-pthread-exit" class="headerlink" title="2-2-2 pthread_exit()"></a>2-2-2 <code>pthread_exit()</code></h5><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">pthread_exit</span><span class="params">(<span class="type">void</span> *retval)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：线程退出。</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Rretval</td>
<td align="center">线程结束时的返回值,可由其它函数如pthread_join0来获取</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">void</td>
</tr>
</tbody></table>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">create</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;New thread is create...\n&quot;</span>);</span><br><span class="line">    pthread_exit((<span class="type">void</span> *)<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    <span class="type">void</span> *temp;</span><br><span class="line">    res = pthread_create(&amp;tid, <span class="literal">NULL</span>, create, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I am the main thread!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;thread id not create...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = pthread_join(tid, &amp;temp);</span><br><span class="line">    <span class="keyword">if</span> (res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;thread is not exit...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread is exit code %ld \n&quot;</span>, (<span class="type">long</span>)temp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_093431.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_093431.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_093431" style="zoom:80%;">

<p>可以发现，子线程退出，主线程接收到了子线程的退出码6。</p>
<h5 id="2-2-3-pthread-join"><a href="#2-2-3-pthread-join" class="headerlink" title="2-2-3 pthread_join()"></a>2-2-3 <code>pthread_join()</code></h5><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">pthread_join</span><span class="params">(<span class="type">pthread_t</span> thread，<span class="type">void</span> **thread_return)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：线程等待。</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">thread</td>
<td align="center">等待退出的线程ID</td>
</tr>
<tr>
<td align="center">thread_return</td>
<td align="center">用于定义的指针，用来存储被等待线程结束时的返回值(不为NULL时)</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">成功：0<br>出错：返回错误码</td>
</tr>
</tbody></table>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">thread</span><span class="params">(<span class="type">void</span> *str)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This is the thread:%d\n&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> pth;</span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">int</span> ret = pthread_create(&amp;pth, <span class="literal">NULL</span>, thread, (<span class="type">void</span> *)(i));</span><br><span class="line">    pthread_join(pth, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;123\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This is the main:%ld\n&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_094008.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_094008.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_094008" style="zoom:80%;">

<p>可以发现主线程在调用pthread_join后等待子线程输出完毕结束后再进行的输出，相当于是主线程被阻塞。</p>
<h5 id="2-2-4-pthread-self"><a href="#2-2-4-pthread-self" class="headerlink" title="2-2-4 pthread_self()"></a>2-2-4 <code>pthread_self()</code></h5><p>函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line">Pthread_t <span class="title function_">pthread_self</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：获取调用线程的标识ID。</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">void</td>
<td align="center">无</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">返回调用该函数的线程的标识ID</td>
</tr>
</tbody></table>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">create</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;New thread...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This thread&#x27;s id is %u \n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)pthread_self());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This thread process pid is %d\n&quot;</span>, getpid());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Main thread is starting...\n&quot;</span>);</span><br><span class="line">    res = pthread_create(&amp;tid, <span class="literal">NULL</span>, create, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (res)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;thread id not create...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The main process pid is %d\n&quot;</span>, getpid());</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_094649.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_094649.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_094649" style="zoom:80%;">

<p>可以发现，子线程成功打印了自己的线程id，并且子线程的进程pid和主线程的进场pid相等，这也说明这两个线程属于同一个进程。</p>
<h5 id="2-2-5-pthread-cleanup-push-，pthread-cleanup-pop"><a href="#2-2-5-pthread-cleanup-push-，pthread-cleanup-pop" class="headerlink" title="2-2-5 pthread_cleanup_push()，pthread_cleanup_pop()"></a>2-2-5 <code>pthread_cleanup_push()</code>，<code>pthread_cleanup_pop()</code></h5><p>1、函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">pthread_cleanup_push</span><span class="params">(<span class="type">void</span> (*rtn)(<span class="type">void</span> *), <span class="type">void</span> *arg)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：将清除函数压入清除栈</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">rtn</td>
<td align="center">清除函数</td>
</tr>
<tr>
<td align="center">arg</td>
<td align="center">清除函数的参数</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">void</td>
</tr>
</tbody></table>
<p>2、函数原型：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">pthread_cleanup_pop</span><span class="params">(<span class="type">int</span> execute)</span></span><br></pre></td></tr></table></figure>

<p>函数说明：将清除函数弹出清除栈</p>
<p>参数和返回值：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">execute</td>
<td align="center">执行到pthread_cleanup_pop()时是否在弹出清理函数的同时执行该函数。<br>非0：执行；0：不执行</td>
</tr>
<tr>
<td align="center">返回值</td>
<td align="center">void</td>
</tr>
</tbody></table>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">clean</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Cleanup %s\n&quot;</span>, (<span class="type">char</span> *)arg);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">thr_fn1</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread1 start\n&quot;</span>);</span><br><span class="line">    pthread_cleanup_push((<span class="type">void</span> *)clean, <span class="string">&quot;Thread1 first handler&quot;</span>);</span><br><span class="line">    pthread_cleanup_push((<span class="type">void</span> *)clean, <span class="string">&quot;Thread1 second handler&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread1 push complete\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (arg)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="type">void</span> *)<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_cleanup_pop(<span class="number">1</span>);</span><br><span class="line">    pthread_cleanup_pop(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">thr_fn2</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread2 start\n&quot;</span>);</span><br><span class="line">    pthread_cleanup_push((<span class="type">void</span> *)clean, <span class="string">&quot;Thread2 first handler&quot;</span>);</span><br><span class="line">    pthread_cleanup_push((<span class="type">void</span> *)clean, <span class="string">&quot;Thread2 second handler&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread2 push complete\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (arg)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="type">void</span> *)<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_cleanup_pop(<span class="number">0</span>);</span><br><span class="line">    pthread_cleanup_pop(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    <span class="type">pthread_t</span> tid1, tid2;</span><br><span class="line">    <span class="type">void</span> *tret;</span><br><span class="line">    res = pthread_create(&amp;tid1, <span class="literal">NULL</span>, thr_fn1, (<span class="type">void</span> *)<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (res != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create theate error...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res = pthread_create(&amp;tid2, <span class="literal">NULL</span>, thr_fn2, (<span class="type">void</span> *)<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (res != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create theate error...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res = pthread_join(tid1, &amp;tret);</span><br><span class="line">    <span class="keyword">if</span> (res != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Thread_join error...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread1 exit code %ld\n&quot;</span>, (<span class="type">long</span>)tret);</span><br><span class="line">    res = pthread_join(tid2, &amp;tret);</span><br><span class="line">    <span class="keyword">if</span> (res != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Thread_join error...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread2 exit code %ld\n&quot;</span>, (<span class="type">long</span>)tret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_141113.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_141113.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_141113" style="zoom:80%;">

<ul>
<li>对于Thread1，传入的参数是1，因此函数thr_fn1只执行了两个pthread_cleanup_push，在pthread_cleanup_pop之前就return 1了，因此Thread1没有Cleanup输出，且返回码是1。</li>
<li>对于Thread2，传入的参数是0，因此函数thr_fn2在执行了两个pthread_cleanup_push后又执行了两个pthread_cleanup_pop，但是第一个pthread_cleanup_pop传的参数是0，第二个pthread_cleanup_pop传的参数是1，而且这个是栈的结构，第一个出栈的“Thread2 second handler”，参数为0，不清理；第二个出栈的“Thread2 first handler”，参数为1，清理。因此Thread2只有一个Cleanup输出（Thread2 first handler），且返回码是4。</li>
</ul>
<h5 id="2-2-6-综合"><a href="#2-2-6-综合" class="headerlink" title="2-2-6 综合"></a>2-2-6 综合</h5><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THREAD_NUMBER 3        <span class="comment">//线程数</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REPEAT_NUMBER 5        <span class="comment">//每个线程中的小任务数</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELAY_TIME_LEVELS 10.0 <span class="comment">//小任务之间的最大时间间隔</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">thrd_func</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> thrd_num = (<span class="type">long</span>)arg;</span><br><span class="line">    <span class="type">int</span> delay_time = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread %ld is starting\n&quot;</span>, thrd_num);</span><br><span class="line">    <span class="keyword">for</span> (count = <span class="number">0</span>; count &lt; REPEAT_NUMBER; count++)</span><br><span class="line">    &#123;</span><br><span class="line">        delay_time = (<span class="type">int</span>)(rand() * DELAY_TIME_LEVELS / (RAND_MAX)) + <span class="number">1</span>;</span><br><span class="line">        sleep(delay_time);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\tThread %ld:job %d delay=%d\n&quot;</span>, thrd_num, count, delay_time);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Thread %ld finished\n&quot;</span>, thrd_num);</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pthread_t</span> thread[THREAD_NUMBER];</span><br><span class="line">    <span class="type">long</span> no, res;</span><br><span class="line">    <span class="type">void</span> *thrd_ret;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">for</span> (no = <span class="number">0</span>; no &lt; THREAD_NUMBER; no++)</span><br><span class="line">    &#123;</span><br><span class="line">        res = pthread_create(&amp;thread[no], <span class="literal">NULL</span>, thrd_func, (<span class="type">void</span> *)no);</span><br><span class="line">        <span class="keyword">if</span> (res != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Create thread %d failed\n&quot;</span>, no);</span><br><span class="line">            <span class="built_in">exit</span>(res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Creating threads success\nWaiting for thread to finish...\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (no = <span class="number">0</span>; no &lt; THREAD_NUMBER; no++)</span><br><span class="line">    &#123;</span><br><span class="line">        res = pthread_join(thread[no], &amp;thrd_ret);</span><br><span class="line">        <span class="keyword">if</span> (!res)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Thread %d joined\n&quot;</span>, no);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Thread %d joined failed\n&quot;</span>, no);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_154240.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200513_154240.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200513_154240" style="zoom:80%;">

<p>这个综合案例就是创建了3个线程，让3个线程共用同一个执行函数。每个线程都有5次循环（可以看成5个小任务，也就是5个job），每次循环之间会随机等待1～10s的时间，意义在于模拟每个任务的到达时间是随机的，并没有任何特定的规律。最后就是三个线程相继完成了各自的任务，都成功join，最后主线程结束。</p>
<h3 id="3、第三组-进程间通信"><a href="#3、第三组-进程间通信" class="headerlink" title="3、第三组 进程间通信"></a>3、第三组 进程间通信</h3><p>了解Linux提供的消息队列（消息传递）、共享内存、管道&#x2F;命名管道、信号(signal)&#x2F;软中断四种进程间通信机制的实现原理和方法；</p>
<ol>
<li>消息队列：消息队列是消息的链接表，包括Posix消息队列system V消息队列。具有一定权限的进程通过向消息队列中写入组织成消息的数据、从队列中读取数据，实现相互间通信。消息队列克服了信号signal承载信息量少，管道pipe只能承载无格式字节流以及缓冲区大小受限等缺点；</li>
<li>共享内存：多个进程通过访问同一块内存空间，实现快速的进程间通信是最快的可用IPC形式。是针对其他通信机制运行效率较低而设计的。往往与其它通信机制，如信号量结合使用，来达到进程间的同步及互斥；</li>
<li>管道（Pipe）及命名管道（named pipe）：用于具有亲缘关系进程间的通信，命名管道克服了管道没有名字的限制，因此，除具有管道所具有的功能外，它还支持无亲缘关系进程间的通信；</li>
<li>信号（Signal：也称为软中断，是一种基于事件的通信机制，用于通知接受进程有某种事件发生。除了用于进程间通信外，进程还可以发送信号给进程本身；linux除了支持Unix早期信号语义函数sigal外，还支持语义符合Posix.1标准的信号函数sigaction；</li>
</ol>
<p>参照<em><strong>“【实验指导】 6.3 进程间通信示例”</strong></em>，查阅参考资料，<strong>选择上述四种通信方式中的一种</strong>，编程实现进程间通信，观察进程间通信过程。</p>
<p><em><strong>我选择的是消息队列（消息传递）方式。</strong></em></p>
<p>消息结构体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">my_message</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">long</span> <span class="type">int</span> message_type;</span><br><span class="line">    <span class="comment">/* The data you wish to transfer*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>相关函数：</p>
<table>
<thead>
<tr>
<th align="center">函数原型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int msgget(key_t key, int msgflg);</td>
<td align="center">创建和访问一个消息队列</td>
</tr>
<tr>
<td align="center">int msgsend(int msgid, const void *msg_ptr, size_t msg_sz, int msgflg);</td>
<td align="center">将消息添加到消息队列，即消息发送</td>
</tr>
<tr>
<td align="center">int msgrcv(int msgid, void *msg_ptr, size_t msg_st, long int msgtype, int msgflg);</td>
<td align="center">从一个消息队列获取消息，即消息接收</td>
</tr>
<tr>
<td align="center">int msgctl(int msgid, int command, struct msgid_ds *buf);</td>
<td align="center">控制消息队列</td>
</tr>
</tbody></table>
<p>代码：</p>
<p>信息发送方：msgsend.c</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_TEXT 512</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msg_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">long</span> <span class="type">int</span> msg_type;</span><br><span class="line">    <span class="type">char</span> text[MAX_TEXT];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> running = <span class="number">1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msg_st</span> <span class="title">data</span>;</span></span><br><span class="line">    <span class="type">char</span> buffer[BUFSIZ];</span><br><span class="line">    <span class="type">int</span> msgid = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立消息队列</span></span><br><span class="line">    msgid = msgget((<span class="type">key_t</span>)<span class="number">1234</span>, <span class="number">0666</span> | IPC_CREAT);</span><br><span class="line">    <span class="keyword">if</span> (msgid == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;msgget failed with error: %d\n&quot;</span>, errno);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向消息队列中写消息，直到写入end</span></span><br><span class="line">    <span class="keyword">while</span> (running)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//输入数据</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Enter some text: &quot;</span>);</span><br><span class="line">        fgets(buffer, BUFSIZ, <span class="built_in">stdin</span>);</span><br><span class="line">        data.msg_type = <span class="number">1</span>; <span class="comment">//注意2</span></span><br><span class="line">        <span class="built_in">strcpy</span>(data.text, buffer);</span><br><span class="line">        <span class="comment">//向队列发送数据</span></span><br><span class="line">        <span class="keyword">if</span> (msgsnd(msgid, (<span class="type">void</span> *)&amp;data, MAX_TEXT, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;msgsnd failed\n&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//输入end结束输入</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strncmp</span>(buffer, <span class="string">&quot;end&quot;</span>, <span class="number">3</span>) == <span class="number">0</span>)</span><br><span class="line">            running = <span class="number">0</span>;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>消息接受方：msgreceive.c</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msg_st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">long</span> <span class="type">int</span> msg_type;</span><br><span class="line">    <span class="type">char</span> text[BUFSIZ];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> running = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> msgid = <span class="number">-1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">msg_st</span> <span class="title">data</span>;</span></span><br><span class="line">    <span class="type">long</span> <span class="type">int</span> msgtype = <span class="number">0</span>; <span class="comment">//注意1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立消息队列</span></span><br><span class="line">    msgid = msgget((<span class="type">key_t</span>)<span class="number">1234</span>, <span class="number">0666</span> | IPC_CREAT);</span><br><span class="line">    <span class="keyword">if</span> (msgid == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;msgget failed with error: %d\n&quot;</span>, errno);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从队列中获取消息，直到遇到end消息为止</span></span><br><span class="line">    <span class="keyword">while</span> (running)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (msgrcv(msgid, (<span class="type">void</span> *)&amp;data, BUFSIZ, msgtype, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;msgrcv failed with errno: %d\n&quot;</span>, errno);</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;You wrote: %s\n&quot;</span>, data.text);</span><br><span class="line">        <span class="comment">//遇到end结束</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strncmp</span>(data.text, <span class="string">&quot;end&quot;</span>, <span class="number">3</span>) == <span class="number">0</span>)</span><br><span class="line">            running = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除消息队列</span></span><br><span class="line">    <span class="keyword">if</span> (msgctl(msgid, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;msgctl(IPC_RMID) failed\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>在第一个终端中编译运行msgsend.c：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_144833.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_144833.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_144833" style="zoom:80%;">

<p>新开一个终端编译运行msgreceive.c：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145014.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145014.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_145014" style="zoom:80%;">

<p>在第一个终端的发送进程中输入，能在第二个终端的接收进程中显示：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145215.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145215.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_145215" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145256.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145256.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_145256" style="zoom:80%;">

<p>在发送进程中输入end，接收进程接收到了end信号，就会删除消息队列，退出进程；发送进程也会在退出。</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145548.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145548.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_145548" style="zoom:80%;">

<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145619.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_145619.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_145619" style="zoom:80%;">

<p>在同一个终端，发送进程后台运行也是同样的道理。但是如果开两个接收进程，一个发送进程，那么就会出现接收进程争抢使用消息队列的情况，并且每个消息只会被使用一次，不会出现被重复消费的情况。因此最后的end消息因为只会被一个接收方拿到，且将消息队列删除，发送方和接收方1正常退出，但是导致另一个接收方2找不到消息队列，出错退出。</p>
<p>msgsend：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150046.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150046.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_150046" style="zoom:80%;">

<p>msgreceive1：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150252.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150252.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_150252" style="zoom:80%;">

<p>msgreceive2：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150315.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_150315.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_150315" style="zoom:80%;">



<h3 id="4、第四组-线程间通信"><a href="#4、第四组-线程间通信" class="headerlink" title="4、第四组 线程间通信"></a>4、第四组 线程间通信</h3><p>了解Linux中的线程概念、线程通信机制、线程间同步互斥模式，以及多线程编程方式；</p>
<p>参照<em><strong>“【实验指导】 6.2.7 Linux c&#x2F;c++线程间参数传递”</strong></em>中的<em><strong>【示例2-3-3】～【示例2-3-5】</strong></em>，编程实现线程间参数传递。</p>
<h4 id="示例2-3-3-向新建的线程传递字符串"><a href="#示例2-3-3-向新建的线程传递字符串" class="headerlink" title="示例2-3-3 向新建的线程传递字符串"></a>示例2-3-3 向新建的线程传递字符串</h4><p>代码：</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">create</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *str;</span><br><span class="line">    str = (<span class="type">char</span> *)arg;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The parameter passed from main is %s\n&quot;</span>, str);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> error;</span><br><span class="line">    <span class="type">pthread_t</span> id1;</span><br><span class="line">    <span class="type">char</span> *str1 = <span class="string">&quot;Hello!&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *attr = str1;</span><br><span class="line">    error = pthread_create(&amp;id1, <span class="literal">NULL</span>, create, (<span class="type">void</span> *)attr);</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This pthread is not created!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pthread is created..\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>运行结果：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_171450.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_171450.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_171450" style="zoom:80%;">

<p>可以发现Hello字符串已经传到了子线程，并在子线程打印输出。</p>
<h4 id="示例2-3-4-向新建的线程传递字符串"><a href="#示例2-3-4-向新建的线程传递字符串" class="headerlink" title="示例2-3-4 向新建的线程传递字符串"></a>示例2-3-4 向新建的线程传递字符串</h4><p>代码：</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">member</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    <span class="type">char</span> *s;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">create</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">member</span> *<span class="title">temp</span>;</span></span><br><span class="line">    temp = (<span class="keyword">struct</span> member *)arg;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;member-&gt;a = %d\n&quot;</span>, temp-&gt;a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;member-&gt;s = %s\n&quot;</span>, temp-&gt;s);</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> error;</span><br><span class="line">    <span class="type">pthread_t</span> id1;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">member</span> *<span class="title">p</span>;</span></span><br><span class="line">    p = (<span class="keyword">struct</span> member *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> member));</span><br><span class="line">    p-&gt;a = <span class="number">1</span>;</span><br><span class="line">    p-&gt;s = <span class="string">&quot;Robben!&quot;</span>;</span><br><span class="line">    error = pthread_create(&amp;id1, <span class="literal">NULL</span>, create, (<span class="type">void</span> *)p);</span><br><span class="line">    <span class="keyword">if</span> (error)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pthread is not created!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pthread is created!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>运行结果：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_171737.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_171737.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_171737" style="zoom:80%;">

<p>可以发现，结构体member传递到了子线程中，member中的int型a和char*型s，在子线程中被输出。</p>
<h4 id="示例2-3-5-验证新建立的线程可以共享进程中的数据"><a href="#示例2-3-5-验证新建立的线程可以共享进程中的数据" class="headerlink" title="示例2-3-5 验证新建立的线程可以共享进程中的数据"></a>示例2-3-5 验证新建立的线程可以共享进程中的数据</h4><p>代码：</p>
<details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">create</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;New pthread...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %d\n&quot;</span>, a);</span><br><span class="line">    a = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">void</span> *)<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> error;</span><br><span class="line">    <span class="type">pthread_t</span> id1;</span><br><span class="line">    a = <span class="number">10</span>;</span><br><span class="line">    error = pthread_create(&amp;id1, <span class="literal">NULL</span>, create, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;new thread is not created!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %d\n&quot;</span>, a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;New thread is created...\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<p>运行结果：</p>
<img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_172426.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200517_172426.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200517_172426" style="zoom:80%;">

<p>可以发现，定义了一个静态变量<code>a=5</code>，在主线程创建子线程之前a被赋值为10，然后主线程创建子线程，子线程读取a，读取到的是重新赋值后的a（10）,因此子线程中输出a &#x3D; 10。然后子线程中将a修改为-1，因为主线程等待（sleep）了1s，因此主线程拿到的a是子线程修改后的a（-1），因此主线程中输出a &#x3D; -1。这也证明了新建立的线程可以共享进程中的数据，同一进程中的主线程和子线程可以共享进程中的静态数据。</p>
<h3 id="5、第五组-进程-x2F-线程间同步与互斥（二选一）"><a href="#5、第五组-进程-x2F-线程间同步与互斥（二选一）" class="headerlink" title="5、第五组 进程&#x2F;线程间同步与互斥（二选一）"></a>5、第五组 进程&#x2F;线程间同步与互斥（二选一）</h3><ol>
<li><p>针对2019-2020学年操作系统期末考试信号量题目，定义合理的锁和信号量，设计生产产品A、B、C的三个worker三个进程&#x2F;线程A、B、C的业务流程和同步互斥机制。</p>
<p><strong>要求：给出具体的设计方案，并单独提交设计方案，类似期末考试答题形式；</strong></p>
</li>
<li><p>参照<em><strong>“【实验指导】 6.5 进程间同步互斥示例”</strong></em>，根据上一步的设计方案，利用semget、semctl、semop等信号量原语，以进程方式编程实现该设计方案；</p>
<p>观察分析程序运行结果，重点分析信号量设计方案是否合理、程序运行是否符合预期，应避免设计方案导致死锁或不符合题目要求。</p>
</li>
<li><p>参照<em><strong>“【实验指导】 6.6 线程间同步互斥示例”</strong></em>，根据第一步的设计方案，利用Pthread提供的<code>pthread_mutex_init()</code>、<code>pthread_mutex_lock()</code>、<code>pthread_mutex_unlock()</code>等线程同步互斥API，以线程方式编程实现该设计方案；</p>
<p>观察分析程序运行结果。重点分析信号量设计方案是否合理、程序运行是否符合预期，应避免设计方案导致死锁或不符合题目要求。</p>
</li>
</ol>
<p>要求：</p>
<ul>
<li><strong>基于进程和基于线程的同步互斥实现方案二选一，完成其中一个即可；</strong></li>
<li>不论采用进程方式、还是线程方式，模拟A、B、C三个worker的三个进程&#x2F;线程A、B、C应当多次循环反复执行，便于观察同步互斥效应；</li>
<li>根据设计方案，给出程序代码，程序运行结果，结果分析。</li>
</ul>
<p><em><strong>我选择的是基于进程的同步互斥实现方案。</strong></em></p>
<h4 id="1、设计方案"><a href="#1、设计方案" class="headerlink" title="1、设计方案"></a>1、设计方案</h4><h5 id="方案1（采用二元互斥信号量-整形变量，效率比方案2高）："><a href="#方案1（采用二元互斥信号量-整形变量，效率比方案2高）：" class="headerlink" title="方案1（采用二元互斥信号量+整形变量，效率比方案2高）："></a>方案1（采用二元互斥信号量+整形变量，效率比方案2高）：</h5><h6 id="整型变量"><a href="#整型变量" class="headerlink" title="整型变量"></a>整型变量</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> count_A=<span class="number">0</span>; <span class="comment">// 当前工作台中已有的A的数量</span></span><br><span class="line"><span class="type">int</span> count_B=<span class="number">0</span>; <span class="comment">// 当前工作台中已有的B的数量</span></span><br><span class="line"><span class="type">int</span> empty=<span class="number">12</span>; <span class="comment">// 工作台中空位数量，empty=12-(count_A+count_B)</span></span><br></pre></td></tr></table></figure>

<h6 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h6><p>经分析题目，发现共需要4个信号量，分别为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">semaphore MUTEX_STATION = <span class="number">0</span> <span class="comment">// 二元信号量，控制对工作台和count_A、count_B、empty的互斥访问（取/放零件）</span></span><br><span class="line">semaphore SUSPEND_A = <span class="number">1</span>     <span class="comment">// 控制台无足够空位时，挂起worker A</span></span><br><span class="line">semaphore SUSPEND_B = <span class="number">2</span>     <span class="comment">// 控制台无足够空位时，挂起worker B</span></span><br><span class="line">semaphore SUSPEND_C = <span class="number">3</span>     <span class="comment">// 控制台无足够零件时，挂起worker C</span></span><br></pre></td></tr></table></figure>

<h6 id="WorkerA"><a href="#WorkerA" class="headerlink" title="WorkerA"></a>WorkerA</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">WorkerA()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">	<span class="comment">// 生产2个A</span></span><br><span class="line">	P(MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_A、empty和控制台的访问权</span></span><br><span class="line">        <span class="keyword">if</span> (count_A &lt;= <span class="number">7</span> &amp;&amp; empty &gt;= <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 同时放入工作台2个A</span></span><br><span class="line">            </span><br><span class="line">            count_A += <span class="number">2</span>; <span class="comment">//修改count_A</span></span><br><span class="line">            empty -= <span class="number">2</span>; <span class="comment">//修改empty</span></span><br><span class="line">            </span><br><span class="line">            V(MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A和empty的访问权</span></span><br><span class="line">            V(SUSPEND_C, <span class="number">1</span>);     <span class="comment">//控制台放入新零件，解挂/唤醒worker C</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台和count_A、empty的访问权</span></span><br><span class="line">            P(sem_id, SUSPEND_A, <span class="number">-1</span>);    <span class="comment">//控制台无足够空位，或不允许再放入A，转入waiting态，挂起自身</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="WorkerB"><a href="#WorkerB" class="headerlink" title="WorkerB"></a>WorkerB</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">WorkerB()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 生产1个B</span></span><br><span class="line">        P(MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_B、empty和控制台的访问权</span></span><br><span class="line">        <span class="keyword">if</span> (count_B &lt;= <span class="number">7</span> &amp;&amp; empty &gt;= <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 放入工作台1个B</span></span><br><span class="line">            </span><br><span class="line">            count_B += <span class="number">1</span>; <span class="comment">//修改count_B</span></span><br><span class="line">            empty -= <span class="number">1</span>; <span class="comment">//修改empty</span></span><br><span class="line"></span><br><span class="line">            V(MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_B和empty的访问权</span></span><br><span class="line">            V(SUSPEND_C, <span class="number">1</span>);     <span class="comment">//控制台放入新零件，解挂/唤醒worker C</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            V(MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台和count_B、empty的访问权</span></span><br><span class="line">            P(SUSPEND_B, <span class="number">-1</span>);    <span class="comment">//控制台无足够空位，或不允许再放入B，转入waiting态，挂起自身</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="WorkerC"><a href="#WorkerC" class="headerlink" title="WorkerC"></a>WorkerC</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">WorkerC()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P(MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_A、count_B和控制台的访问权</span></span><br><span class="line">        <span class="comment">// 有足够多的A、B用于装配</span></span><br><span class="line">        <span class="keyword">if</span> (count_A &gt;= <span class="number">4</span> &amp;&amp; count_B &gt;= <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 同时从工作台取出4个A、3个B</span></span><br><span class="line"></span><br><span class="line">            count_A -= <span class="number">4</span>; <span class="comment">//修改count_A</span></span><br><span class="line">            count_B -= <span class="number">3</span>; <span class="comment">//修改count_B</span></span><br><span class="line">            empty += <span class="number">7</span>; <span class="comment">//修改empty</span></span><br><span class="line"></span><br><span class="line">            V(MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A、count_B的控制权</span></span><br><span class="line">            V(SUSPEND_A, <span class="number">1</span>);     <span class="comment">//控制台新增空位，解挂A</span></span><br><span class="line">            V(SUSPEND_B, <span class="number">1</span>);     <span class="comment">//控制台新增空位，解挂B</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生产1个C</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            V(MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A、count_B的控制权</span></span><br><span class="line">            P(SUSPEND_C, <span class="number">-1</span>);    <span class="comment">//控制台无足够零件，转入waiting态，挂起自身</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="编程实现"><a href="#编程实现" class="headerlink" title="编程实现"></a>编程实现</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_SEMAPHORE 4 <span class="comment">// 信号量个数</span></span></span><br><span class="line"><span class="comment">// 信号量ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUTEX_STATION 0 <span class="comment">// 二元信号量，控制对工作台和count_A、count_B、empty的互斥访问（取/放零件）</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUSPEND_A 1     <span class="comment">// 控制台无足够空位时，挂起worker A</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUSPEND_B 2     <span class="comment">// 控制台无足够空位时，挂起worker B</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUSPEND_C 3     <span class="comment">// 控制台无足够零件时，挂起worker C</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEM_KEY 0x11223344  <span class="comment">// 信号量组的KEY</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHM_KEY1 0x11223355 <span class="comment">// 共享内存的KEY1</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHM_KEY2 0x11223366 <span class="comment">// 共享内存的KEY2</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NONE <span class="string">&quot;\e[0m&quot;</span>      <span class="comment">// 复原</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RED <span class="string">&quot;\e[0;31m&quot;</span>    <span class="comment">// ERROR</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YELLOW <span class="string">&quot;\e[1;33m&quot;</span> <span class="comment">// WorkerA</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PINK <span class="string">&quot;\e[1;35m&quot;</span>   <span class="comment">// WorkerB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GREEN <span class="string">&quot;\e[1;32m&quot;</span>  <span class="comment">// WorkerC</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CYAN <span class="string">&quot;\e[0;36m&quot;</span>   <span class="comment">// Share Memory</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 12</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *buf;</span><br><span class="line"><span class="type">int</span> *info; <span class="comment">// 用于记录信息的3个整形变量</span></span><br><span class="line"><span class="type">int</span> i, sv, sem_id, shm_id, info_shm_id, C_num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">semun</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> val;               <span class="comment">// SETVAL使用的值</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span> *<span class="title">buf</span>;</span>  <span class="comment">// IPC_STAT、IPC_SET 使用缓存区</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> *<span class="built_in">array</span>; <span class="comment">// GETALL,、SETALL 使用的数组</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">seminfo</span> *__<span class="title">buf</span>;</span> <span class="comment">// IPC_INFO(Linux特有) 使用缓存区</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 对信号量做减1操作，即P（wait）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">P</span><span class="params">(<span class="type">int</span> sem_id, <span class="type">int</span> sem_num, <span class="type">int</span> op)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (op &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">sem_buf</span>;</span></span><br><span class="line">        sem_buf.sem_num = sem_num;</span><br><span class="line">        sem_buf.sem_op = op; <span class="comment">//P()</span></span><br><span class="line">        sem_buf.sem_flg = SEM_UNDO;</span><br><span class="line">        <span class="keyword">if</span> (semop(sem_id, &amp;sem_buf, <span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            perror(RED <span class="string">&quot;Semaphore P&quot;</span> NONE);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Semaphore P&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对信号量做减1操作，即V（signal）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">V</span><span class="params">(<span class="type">int</span> sem_id, <span class="type">int</span> sem_num, <span class="type">int</span> op)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (op &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">sem_buf</span>;</span></span><br><span class="line">        sem_buf.sem_num = sem_num;</span><br><span class="line">        sem_buf.sem_op = op; <span class="comment">//V()</span></span><br><span class="line">        sem_buf.sem_flg = SEM_UNDO;</span><br><span class="line">        <span class="keyword">if</span> (semop(sem_id, &amp;sem_buf, <span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            perror(RED <span class="string">&quot;Semaphore V&quot;</span> NONE);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Semaphore V&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 展示共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_shm</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(CYAN <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BUF_SIZE - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c,&quot;</span>, buf[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c]\n\n&quot;</span> NONE, buf[BUF_SIZE - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建并初始化信号量和共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">create_ipc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> <span class="title">semun</span> <span class="title">arg</span>[<span class="title">NUM_SEMAPHORE</span>];</span></span><br><span class="line">    arg[MUTEX_STATION].val = <span class="number">1</span>;</span><br><span class="line">    arg[SUSPEND_A].val = <span class="number">0</span>;</span><br><span class="line">    arg[SUSPEND_B].val = <span class="number">0</span>;</span><br><span class="line">    arg[SUSPEND_C].val = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 创建信号量</span></span><br><span class="line">    <span class="keyword">if</span> ((sem_id = semget(SEM_KEY, NUM_SEMAPHORE, IPC_CREAT | IPC_EXCL | <span class="number">0666</span>)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Create Semaphores&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Create Semaphores: OK\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Sem_id = %d\n&quot;</span>, sem_id);</span><br><span class="line">    <span class="comment">// 初始化信号量</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUM_SEMAPHORE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        semctl(sem_id, i, SETVAL, arg[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUM_SEMAPHORE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The Sem[%d] = %d\n&quot;</span>, i, semctl(sem_id, i, GETVAL, <span class="literal">NULL</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建Info共享内存，用于记录信息</span></span><br><span class="line">    info_shm_id = shmget(SHM_KEY2, <span class="number">3</span> * <span class="keyword">sizeof</span>(<span class="type">int</span>), IPC_CREAT | IPC_EXCL | <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span> (info_shm_id == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Create Info Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Create Info Share Memory: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 初始化Info共享内存</span></span><br><span class="line">    info = (<span class="type">int</span> *)shmat(info_shm_id, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 获取指向共享内存段的指针</span></span><br><span class="line">    <span class="keyword">if</span> (info == (<span class="type">int</span> *)<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Attach Info Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    info[<span class="number">0</span>] = <span class="number">0</span>;  <span class="comment">// 当前工作台中已有的A的数量（count_A）</span></span><br><span class="line">    info[<span class="number">1</span>] = <span class="number">0</span>;  <span class="comment">// 当前工作台中已有的B的数量（count_B）</span></span><br><span class="line">    info[<span class="number">2</span>] = <span class="number">12</span>; <span class="comment">// 工作台中空位数量（empty=12-(count_A+count_B)）</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Attach Info Share Memory: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 展示info共享内存</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;count_A=%d, count_B=%d, empty=%d\n\n&quot;</span>, info[<span class="number">0</span>], info[<span class="number">1</span>], info[<span class="number">2</span>]);</span><br><span class="line">    <span class="comment">// 创建Buffer共享内存</span></span><br><span class="line">    shm_id = shmget(SHM_KEY1, BUF_SIZE * <span class="keyword">sizeof</span>(<span class="type">char</span>), IPC_CREAT | IPC_EXCL | <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span> (shm_id == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Create Buffer Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Create Buffer Share Memory: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 初始化Buffer共享内存</span></span><br><span class="line">    buf = (<span class="type">char</span> *)shmat(shm_id, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 获取指向共享内存段的指针</span></span><br><span class="line">    <span class="keyword">if</span> (buf == (<span class="type">char</span> *)<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Attach Buffer Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BUF_SIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Initialize QUEUE: OK\n&quot;</span>);</span><br><span class="line">    show_shm();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除信号量和共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">remove_ipc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 删除信号量</span></span><br><span class="line">    <span class="keyword">if</span> (semctl(sem_id, <span class="number">0</span>, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        perror(RED <span class="string">&quot;Remove Semaphores&quot;</span> NONE);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove Semaphores: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除共享内存</span></span><br><span class="line">    <span class="keyword">if</span> (shmctl(shm_id, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        perror(RED <span class="string">&quot;Remove Buffer Share Memory&quot;</span> NONE);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove Buffer Share Memory: OK\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (shmctl(info_shm_id, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        perror(RED <span class="string">&quot;Remove Info Share Memory&quot;</span> NONE);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove Info Share Memory: OK\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CTRL-C回调函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sig_handler</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    remove_ipc();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;EXIT: OK\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="comment">// 创建并初始化信号量和共享内存</span></span><br><span class="line">    create_ipc();</span><br><span class="line">    <span class="comment">// WorkerA</span></span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sleep(<span class="number">1</span> + random() % <span class="number">10</span>);     <span class="comment">// 生产2个A</span></span><br><span class="line">            P(sem_id, MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_A、empty和控制台的访问权</span></span><br><span class="line">            <span class="comment">// 还能再生产放置2个A，最多可放7+2=9个A，以便至少给B留下12-9=3个空位，防止工作台中没有足够多的B，导致worker C无法同时取出3个B</span></span><br><span class="line">            <span class="keyword">if</span> (info[<span class="number">0</span>] &lt;= <span class="number">7</span> &amp;&amp; info[<span class="number">2</span>] &gt;= <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 同时放入工作台2个A</span></span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">char</span> *c;</span><br><span class="line">                    c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                    *c = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(YELLOW <span class="string">&quot;Worker A puts 2 As to the station\n&quot;</span> NONE);</span><br><span class="line">                show_shm();</span><br><span class="line"></span><br><span class="line">                info[<span class="number">0</span>] += <span class="number">2</span>; <span class="comment">//修改count_A</span></span><br><span class="line">                info[<span class="number">2</span>] -= <span class="number">2</span>; <span class="comment">//修改empty</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 展示info共享内存</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;count_A=%d, count_B=%d, empty=%d\n\n&quot;</span>, info[<span class="number">0</span>], info[<span class="number">1</span>], info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A和empty的访问权</span></span><br><span class="line">                V(sem_id, SUSPEND_C, <span class="number">1</span>);     <span class="comment">//控制台放入新零件，解挂/唤醒worker C</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台和count_A、empty的访问权</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Worker A suspended\n\n&quot;</span>);</span><br><span class="line">                P(sem_id, SUSPEND_A, <span class="number">-1</span>); <span class="comment">//控制台无足够空位，或不允许再放入A，转入waiting态，挂起自身</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// WorkerB</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sleep(<span class="number">1</span> + random() % <span class="number">10</span>);     <span class="comment">// 生产1个B</span></span><br><span class="line">            P(sem_id, MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_B、empty和控制台的访问权</span></span><br><span class="line">            <span class="comment">// 还能再生产并放置1个B，最多可放7+1=8个B，以便至少给A留下12-8=4个空位，防止工作台中没有足够多的A，导致worker C无法同时取出4个A</span></span><br><span class="line">            <span class="keyword">if</span> (info[<span class="number">1</span>] &lt;= <span class="number">7</span> &amp;&amp; info[<span class="number">2</span>] &gt;= <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 放入工作台1个B</span></span><br><span class="line">                <span class="type">char</span> *c;</span><br><span class="line">                c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                *c = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                <span class="built_in">printf</span>(PINK <span class="string">&quot;Worker B puts 1 B to the station\n&quot;</span> NONE);</span><br><span class="line">                show_shm();</span><br><span class="line"></span><br><span class="line">                info[<span class="number">1</span>] += <span class="number">1</span>; <span class="comment">//修改count_B</span></span><br><span class="line">                info[<span class="number">2</span>] -= <span class="number">1</span>; <span class="comment">//修改empty</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 展示info共享内存</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;count_A=%d, count_B=%d, empty=%d\n\n&quot;</span>, info[<span class="number">0</span>], info[<span class="number">1</span>], info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_B和empty的访问权</span></span><br><span class="line">                V(sem_id, SUSPEND_C, <span class="number">1</span>);     <span class="comment">//控制台放入新零件，解挂/唤醒worker C</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台和count_B、empty的访问权</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Worker B suspended\n\n&quot;</span>);</span><br><span class="line">                P(sem_id, SUSPEND_B, <span class="number">-1</span>); <span class="comment">//控制台无足够空位，或不允许再放入B，转入waiting态，挂起自身</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// WorkerC</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            P(sem_id, MUTEX_STATION, <span class="number">-1</span>); <span class="comment">// 申请对count_A、count_B和控制台的访问权</span></span><br><span class="line">            <span class="comment">// 有足够多的A、B用于装配</span></span><br><span class="line">            <span class="keyword">if</span> (info[<span class="number">0</span>] &gt;= <span class="number">4</span> &amp;&amp; info[<span class="number">1</span>] &gt;= <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 同时从工作台取出4个A、3个B</span></span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">char</span> *c;</span><br><span class="line">                    c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">                    *c = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">char</span> *c;</span><br><span class="line">                    c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">                    *c = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(GREEN <span class="string">&quot;Worker C gets 4 As and 3 Bs from the station\n&quot;</span> NONE);</span><br><span class="line">                show_shm();</span><br><span class="line"></span><br><span class="line">                info[<span class="number">0</span>] -= <span class="number">4</span>; <span class="comment">//修改count_A</span></span><br><span class="line">                info[<span class="number">1</span>] -= <span class="number">3</span>; <span class="comment">//修改count_B</span></span><br><span class="line">                info[<span class="number">2</span>] += <span class="number">7</span>; <span class="comment">//修改empty</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 展示info共享内存</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;count_A=%d, count_B=%d, empty=%d\n\n&quot;</span>, info[<span class="number">0</span>], info[<span class="number">1</span>], info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A、count_B的控制权</span></span><br><span class="line">                V(sem_id, SUSPEND_A, <span class="number">1</span>);     <span class="comment">//控制台新增空位，解挂A</span></span><br><span class="line">                V(sem_id, SUSPEND_B, <span class="number">1</span>);     <span class="comment">//控制台新增空位，解挂B</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 生产1个C</span></span><br><span class="line">                <span class="built_in">printf</span>(GREEN <span class="string">&quot;Worker C is producing C-%d......\n\n&quot;</span> NONE, ++C_num);</span><br><span class="line">                sleep(<span class="number">1</span> + random() % <span class="number">10</span>);</span><br><span class="line">                <span class="built_in">printf</span>(GREEN <span class="string">&quot;C-%d is produced\n\n&quot;</span> NONE, C_num);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                V(sem_id, MUTEX_STATION, <span class="number">1</span>); <span class="comment">//释放对控制台、count_A、count_B的控制权</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Worker C suspended\n\n&quot;</span>);</span><br><span class="line">                P(sem_id, SUSPEND_C, <span class="number">-1</span>); <span class="comment">//控制台无足够零件，转入waiting态，挂起自身</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Main</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// CTRL-C信号自行处理</span></span><br><span class="line">        signal(SIGINT, sig_handler);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;THANKS\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h5 id="方案2（采用多元信号量，效率不如方案1高）："><a href="#方案2（采用多元信号量，效率不如方案1高）：" class="headerlink" title="方案2（采用多元信号量，效率不如方案1高）："></a>方案2（采用多元信号量，效率不如方案1高）：</h5><h6 id="信号量-1"><a href="#信号量-1" class="headerlink" title="信号量"></a>信号量</h6><p>经分析题目，发现共需要6个信号量，分别为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">semaphore MUTEX = <span class="number">1</span>;      <span class="comment">// 用于WorkerA、WorkerB和WorkerC对Station的互斥访问</span></span><br><span class="line">semaphore A_FULL = <span class="number">0</span>;     <span class="comment">// 用于限制WorkerC取A</span></span><br><span class="line">semaphore A_EMPTY = <span class="number">9</span>;    <span class="comment">// 用于限制WorkerA生产A的数量</span></span><br><span class="line">semaphore B_FULL = <span class="number">0</span>;     <span class="comment">// 用于限制WorkerC取B</span></span><br><span class="line">semaphore B_EMPTY = <span class="number">8</span>;    <span class="comment">// 用于限制WorkerB生产B的数量</span></span><br><span class="line">semaphore ALL_EMPTY = <span class="number">12</span>; <span class="comment">// 用于限制整个Station的生产数量</span></span><br></pre></td></tr></table></figure>

<p>分析：</p>
<ol>
<li>WorkerA最多生产9个A，如果生产A的个数大于9，则B的个数就会小于3，导致C永远从Station中拿不到4个A和3个B，产生死锁。但是由于WorkerA一次生产2个A，则WorkerA最多生产8（2×4）个A，因此使用信号量A_EMPTY来控制。A_EMPTY初始值可以设置为8，但是A_EMPTY初始值也可以设置为9，都是可以的。</li>
<li>同理，WorkerB最多生产8个B，如果生产B的个数大于8，则A的个数就会小于4，导致C永远从Station中拿不到4个A和3个B，产生死锁。因此使用信号量B_EMPTY来控制。</li>
<li>WorkerA和WorkerB一起最多生产12个A和B，因此使用信号量B_EMPTY来控制。</li>
<li>需要一个互斥量MUTEX，用于WorkerA、WorkerB和WorkerC对Station的互斥访问。</li>
</ol>
<h6 id="WorkerA-1"><a href="#WorkerA-1" class="headerlink" title="WorkerA"></a>WorkerA</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WorkerA()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 生产2个A</span></span><br><span class="line">        P(A_EMPTY,<span class="number">-2</span>);</span><br><span class="line">        P(ALL_EMPTY,<span class="number">-2</span>);</span><br><span class="line">        P(MUTEX,<span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// 同时放入工作台2个A</span></span><br><span class="line">        V(MUTEX,<span class="number">1</span>);</span><br><span class="line">        V(A_FULL,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="WorkerB-1"><a href="#WorkerB-1" class="headerlink" title="WorkerB"></a>WorkerB</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WorkerB()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 生产1个B</span></span><br><span class="line">        P(B_EMPTY,<span class="number">-1</span>);</span><br><span class="line">        P(ALL_EMPTY,<span class="number">-1</span>);</span><br><span class="line">        P(MUTEX,<span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// 放入工作台1个B</span></span><br><span class="line">        V(MUTEX,<span class="number">1</span>);</span><br><span class="line">        V(B_FULL,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="WorkerC-1"><a href="#WorkerC-1" class="headerlink" title="WorkerC"></a>WorkerC</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">WorkerC()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P(A_FULL,<span class="number">-4</span>);</span><br><span class="line">        P(B_FULL,<span class="number">-3</span>);</span><br><span class="line">        P(MUTEX,<span class="number">-1</span>);</span><br><span class="line">        <span class="comment">// 同时从工作台取出4个A、3个B</span></span><br><span class="line">        V(MUTEX,<span class="number">1</span>);</span><br><span class="line">        V(ALL_EMPTY,<span class="number">7</span>);</span><br><span class="line">        V(B_EMPTY,<span class="number">3</span>);</span><br><span class="line">        V(A_EMPTY,<span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 生产1个C</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h6 id="编程实现-1"><a href="#编程实现-1" class="headerlink" title="编程实现"></a>编程实现</h6><details><summary> 点击查看代码 </summary>
              <div class="content">
              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_SEMAPHORE 6 <span class="comment">// 信号量个数</span></span></span><br><span class="line"><span class="comment">// 信号量ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUTEX 0     <span class="comment">// 用于WorkerA、WorkerB和WorkerC对Station的互斥访问</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> A_FULL 1    <span class="comment">// 用于限制WorkerC取A</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> A_EMPTY 2   <span class="comment">// 用于限制WorkerA生产A的数量</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> B_FULL 3    <span class="comment">// 用于限制WorkerC取B</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> B_EMPTY 4   <span class="comment">// 用于限制WorkerB生产B的数量</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALL_EMPTY 5 <span class="comment">// 用于限制整个Station的生产数量</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SEM_KEY 0x11223344 <span class="comment">// 信号量组的KEY</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHM_KEY 0x11223355 <span class="comment">// 共享内存的KEY</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NONE <span class="string">&quot;\e[0m&quot;</span>      <span class="comment">// 复原</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RED <span class="string">&quot;\e[0;31m&quot;</span>    <span class="comment">// ERROR</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YELLOW <span class="string">&quot;\e[1;33m&quot;</span> <span class="comment">// WorkerA</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PINK <span class="string">&quot;\e[1;35m&quot;</span>   <span class="comment">// WorkerB</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GREEN <span class="string">&quot;\e[1;32m&quot;</span>  <span class="comment">// WorkerC</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CYAN <span class="string">&quot;\e[0;36m&quot;</span>   <span class="comment">// Share Memory</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUF_SIZE 12 <span class="comment">// 工作台大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *buf;</span><br><span class="line"><span class="type">int</span> i, sv, sem_id, shm_id, C_num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">semun</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> val;               <span class="comment">// SETVAL使用的值</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">semid_ds</span> *<span class="title">buf</span>;</span>  <span class="comment">// IPC_STAT、IPC_SET 使用缓存区</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> *<span class="built_in">array</span>; <span class="comment">// GETALL,、SETALL 使用的数组</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">seminfo</span> *__<span class="title">buf</span>;</span> <span class="comment">// IPC_INFO(Linux特有) 使用缓存区</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 对信号量做减1操作，即P（wait）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">P</span><span class="params">(<span class="type">int</span> sem_id, <span class="type">int</span> sem_num, <span class="type">int</span> op)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">sem_buf</span>;</span></span><br><span class="line">    sem_buf.sem_num = sem_num;</span><br><span class="line">    sem_buf.sem_op = op; <span class="comment">//P()</span></span><br><span class="line">    sem_buf.sem_flg = SEM_UNDO;</span><br><span class="line">    <span class="keyword">if</span> (semop(sem_id, &amp;sem_buf, <span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Semaphore P&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对信号量做减1操作，即V（signal）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">V</span><span class="params">(<span class="type">int</span> sem_id, <span class="type">int</span> sem_num, <span class="type">int</span> op)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">sem_buf</span>;</span></span><br><span class="line">    sem_buf.sem_num = sem_num;</span><br><span class="line">    sem_buf.sem_op = op; <span class="comment">//V()</span></span><br><span class="line">    sem_buf.sem_flg = SEM_UNDO;</span><br><span class="line">    <span class="keyword">if</span> (semop(sem_id, &amp;sem_buf, <span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Semaphore V&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 展示共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">show_shm</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(CYAN <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BUF_SIZE - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c,&quot;</span>, buf[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c]\n\n&quot;</span> NONE, buf[BUF_SIZE - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建并初始化信号量和共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">create_ipc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> <span class="title">semun</span> <span class="title">arg</span>[<span class="title">NUM_SEMAPHORE</span>];</span></span><br><span class="line">    arg[MUTEX].val = <span class="number">1</span>;</span><br><span class="line">    arg[A_FULL].val = <span class="number">0</span>;</span><br><span class="line">    arg[A_EMPTY].val = <span class="number">9</span>;</span><br><span class="line">    arg[B_FULL].val = <span class="number">0</span>;</span><br><span class="line">    arg[B_EMPTY].val = <span class="number">8</span>;</span><br><span class="line">    arg[ALL_EMPTY].val = <span class="number">12</span>;</span><br><span class="line">    <span class="comment">// 创建信号量</span></span><br><span class="line">    <span class="keyword">if</span> ((sem_id = semget(SEM_KEY, NUM_SEMAPHORE, IPC_CREAT | IPC_EXCL | <span class="number">0666</span>)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Create Semaphores&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Create Semaphores: OK\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Sem_id = %d\n&quot;</span>, sem_id);</span><br><span class="line">    <span class="comment">// 初始化信号量</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUM_SEMAPHORE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        semctl(sem_id, i, SETVAL, arg[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; NUM_SEMAPHORE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The Sem[%d] = %d\n&quot;</span>, i, semctl(sem_id, i, GETVAL, <span class="literal">NULL</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建共享内存</span></span><br><span class="line">    shm_id = shmget(SHM_KEY, BUF_SIZE * <span class="keyword">sizeof</span>(<span class="type">char</span>), IPC_CREAT | IPC_EXCL | <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span> (shm_id == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Create Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Create Share Memory: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 初始化共享内存</span></span><br><span class="line">    buf = (<span class="type">char</span> *)shmat(shm_id, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 获取指向共享内存段的指针</span></span><br><span class="line">    <span class="keyword">if</span> (buf == (<span class="type">char</span> *)<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(RED <span class="string">&quot;Attach Share Memory&quot;</span> NONE);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; BUF_SIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Initialize QUEUE: OK\n&quot;</span>);</span><br><span class="line">    show_shm();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除信号量和共享内存</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">remove_ipc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 删除信号量</span></span><br><span class="line">    <span class="keyword">if</span> (semctl(sem_id, <span class="number">0</span>, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        perror(RED <span class="string">&quot;Remove Semaphores&quot;</span> NONE);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove Semaphores: OK\n&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除共享内存</span></span><br><span class="line">    <span class="keyword">if</span> (shmctl(shm_id, IPC_RMID, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">        perror(RED <span class="string">&quot;Remove Share Memory&quot;</span> NONE);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Remove Share Memory: OK\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CTRL-C回调函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sig_handler</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    remove_ipc();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;EXIT: OK\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="comment">// 创建并初始化信号量和共享内存</span></span><br><span class="line">    create_ipc();</span><br><span class="line">    <span class="comment">// WorkerA</span></span><br><span class="line">    <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sleep(<span class="number">1</span> + random() % <span class="number">10</span>); <span class="comment">// 生产2个A</span></span><br><span class="line"></span><br><span class="line">            P(sem_id, A_EMPTY, <span class="number">-2</span>);</span><br><span class="line">            P(sem_id, ALL_EMPTY, <span class="number">-2</span>);</span><br><span class="line">            P(sem_id, MUTEX, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 同时放入工作台2个A</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">char</span> *c;</span><br><span class="line">                c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                *c = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(YELLOW <span class="string">&quot;Worker A puts 2 As to the station\n&quot;</span> NONE);</span><br><span class="line">            show_shm();</span><br><span class="line"></span><br><span class="line">            V(sem_id, MUTEX, <span class="number">1</span>);</span><br><span class="line">            V(sem_id, A_FULL, <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// WorkerB</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sleep(<span class="number">1</span> + random() % <span class="number">10</span>); <span class="comment">// 生产1个B</span></span><br><span class="line"></span><br><span class="line">            P(sem_id, B_EMPTY, <span class="number">-1</span>);</span><br><span class="line">            P(sem_id, ALL_EMPTY, <span class="number">-1</span>);</span><br><span class="line">            P(sem_id, MUTEX, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 放入工作台1个B</span></span><br><span class="line">            <span class="type">char</span> *c;</span><br><span class="line">            c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            *c = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(PINK <span class="string">&quot;Worker B puts 1 B to the station\n&quot;</span> NONE);</span><br><span class="line">            show_shm();</span><br><span class="line"></span><br><span class="line">            V(sem_id, MUTEX, <span class="number">1</span>);</span><br><span class="line">            V(sem_id, B_FULL, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// WorkerC</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fork() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            P(sem_id, A_FULL, <span class="number">-4</span>);</span><br><span class="line">            P(sem_id, B_FULL, <span class="number">-3</span>);</span><br><span class="line">            P(sem_id, MUTEX, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 同时从工作台取出4个A、3个B</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">char</span> *c;</span><br><span class="line">                c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">                *c = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">char</span> *c;</span><br><span class="line">                c = <span class="built_in">strchr</span>(buf, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">                *c = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(GREEN <span class="string">&quot;Worker C gets 4 As and 3 Bs from the station\n&quot;</span> NONE);</span><br><span class="line">            show_shm();</span><br><span class="line"></span><br><span class="line">            V(sem_id, MUTEX, <span class="number">1</span>);</span><br><span class="line">            V(sem_id, ALL_EMPTY, <span class="number">7</span>);</span><br><span class="line">            V(sem_id, B_EMPTY, <span class="number">3</span>);</span><br><span class="line">            V(sem_id, A_EMPTY, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生产1个C</span></span><br><span class="line">            <span class="built_in">printf</span>(GREEN <span class="string">&quot;Worker C is producing C-%d......\n\n&quot;</span> NONE, ++C_num);</span><br><span class="line">            sleep(<span class="number">1</span> + random() % <span class="number">10</span>);</span><br><span class="line">            <span class="built_in">printf</span>(GREEN <span class="string">&quot;C-%d is produced\n\n&quot;</span> NONE, C_num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Main</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// CTRL-C信号自行处理</span></span><br><span class="line">        signal(SIGINT, sig_handler);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        wait(&amp;sv);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;THANKS\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>

<h4 id="2、运行结果及分析"><a href="#2、运行结果及分析" class="headerlink" title="2、运行结果及分析"></a>2、运行结果及分析</h4><p>两种方案的运行情况只选择了其中一种方案的运行结果，如果工作时间一致的话，两种方案的运行情况基本一致，但是因为使用了随机工作时间，每次运行的结果可能不一样，因此只选择了其中的一次运行结果。</p>
<h5 id="1、编译"><a href="#1、编译" class="headerlink" title="1、编译"></a>1、编译</h5><img src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205104.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200528_205104" style="zoom:80%;">

<h5 id="2、运行"><a href="#2、运行" class="headerlink" title="2、运行"></a>2、运行</h5><h6 id="方案一："><a href="#方案一：" class="headerlink" title="方案一："></a>方案一：</h6><div galleryflag itemscope itemtype="http://schema.org/ImageGallery" class="gallery stretch" col="3" data-group="default"><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193414.jpg" data-fancybox="default" data-caption="Screenshot_20200713_190946"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193414.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193414.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200713_190946" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200713_190946</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193440.jpg" data-fancybox="default" data-caption="Screenshot_20200713_191031"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193440.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193440.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200713_191031" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200713_191031</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193450.jpg" data-fancybox="default" data-caption="Screenshot_20200713_191049"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193450.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193450.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200713_191049" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200713_191049</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193500.jpg" data-fancybox="default" data-caption="Screenshot_20200713_191112"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193500.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193500.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200713_191112" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200713_191112</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193510.jpg" data-fancybox="default" data-caption="undefined"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193510.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193510.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:80%;"></a><span></span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193521.jpg" data-fancybox="default" data-caption="Screenshot_20200713_191253"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193521.jpg" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/20200713193521.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200713_191253" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200713_191253</span></div></div>

<h6 id="方案二："><a href="#方案二：" class="headerlink" title="方案二："></a>方案二：</h6><div galleryflag itemscope itemtype="http://schema.org/ImageGallery" class="gallery stretch" col="2" data-group="default"><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205211.png" data-fancybox="default" data-caption="Screenshot_20200528_205211"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205211.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205211.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200528_205211" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200528_205211</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205258.png" data-fancybox="default" data-caption="Screenshot_20200528_205258"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205258.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205258.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200528_205258" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200528_205258</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205330.png" data-fancybox="default" data-caption="Screenshot_20200528_205330"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205330.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205330.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Screenshot_20200528_205330" style="zoom:80%;"></a><span class="image-caption">Screenshot_20200528_205330</span></div><div class="fancybox"><a class="fancybox" pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="external nofollow noopener noreferrer" href="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205411.png" data-fancybox="default" data-caption="undefined"><img fancybox itemprop="contentUrl" src="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205411.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/666wxy666/images/Screenshot_20200528_205411.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:80%;"></a><span></span></div></div>

<h5 id="3、分析"><a href="#3、分析" class="headerlink" title="3、分析"></a>3、分析</h5><p>从运行结果来看，完全没有死锁现象，程序完全正常运行，输出结果也正常，创建和初始化信号量和共享内存，释放和删除信号量和共享内存都正常结束。</p>
<p>方案一的输出中有count_A、count_B、和empty的值，以及Worker A、Worker B和Worker C在进入阻塞状态时的输出，整个过程比较清晰。</p>
<p>方案二的基本过程在输出中，共享内存的状态也很清晰：</p>
<p>2A-B-2A-B-2A-B-C-2A-B-2A-B-2A-B-C-2A-B-2A-B-B-C-2A-B-2A-B-B-C-2A……</p>
<p>方案一和方案二多次运行都没有产生死锁，并且因为设置了随机等待时间模拟生产，每次的结果都有所不同，但都符合预期。但是经过分析，方案二可能会导致Worker A和Worker B都等待Worker C，但是此时工作台却还有一个空位的情况，但是并没有产生死锁，只是效率相较于方案一会低一些。</p>
<h2 id="五、实验总结"><a href="#五、实验总结" class="headerlink" title="五、实验总结"></a>五、实验总结</h2><p>这次操作系统课程设计的5组实验，虽然难度可能不是那么高，但是结合了操作系统理论课所学的知识，很有实践意义。经过这5组实验，我首先认识了华为最新的OpenEuler开源Linux操作系统，学习了Linux操作系统的安装、基本操作和使用。这次实验还加深了我对操作系统进程、线程概念和消息队列、共享内存、管道、软中断四种进程间通信机制的理解，掌握了利用Linux系统调用创建、管理进程的方法、利用POSIX线程（Pthread）库创建管理线程的方法和实现进程间通信和线程间通信的方法，深刻地认识了进程、线程并发执行的实质，并掌握了编程使用互斥变量和条件变量实现多线程间的同步互斥。</p>
<p>在实验的过程中，也遇到了各种各样的小问题，比如Linux的命令报错啊，编程gcc编译不通过等等，但经过上网查找资料和与同学讨论交流，都完美解决了问题，总体上看实验过程比较顺利。经过这次的课程设计，明显加深了对操作系统理论课知识的理解，并拓展了很多新的知识和内容，让我受益匪浅。</p>
<h2 id="六、项目源码"><a href="#六、项目源码" class="headerlink" title="六、项目源码"></a>六、项目源码</h2><p>本项目的源码已经存放于我的Github，欢迎下载查看：</p>
<a class="ghcard" rel="external nofollow noopener noreferrer" target="_blank" href="https://github.com/666WXY666/czxt-CompExpSource"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=666WXY666&repo=czxt-CompExpSource&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.xaoxuu.com/api/pin/?username=666WXY666&repo=czxt-CompExpSource&show_owner=true" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></a>


  </div>
  
  
    
    <div class="footer">
       <!-- 参考资料、相关资料等 -->
      
       <!-- 相关文章 -->
      
      <!-- 版权声明组件 -->
      
      <!-- 打赏组件 -->
      
    </div>
  
  
    


  <div class="article-meta" id="bottom">
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2022-11-11T12:01:29+00:00">
  <a class="notlink">
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2022年11月11日</p>
  </a>
</div>

        
      
        
          
  
  
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/C/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>C++</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Linux/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>Linux</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>操作系统</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E8%BF%9B%E7%A8%8B/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>进程</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>线程</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>同步互斥</p></a></div>
  <span hidden itemprop="keywords">C++ Linux 操作系统 进程 线程 同步互斥</span>
  


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title rel="external nofollow noopener noreferrer" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/&title=操作系统 进程线程管理通信与同步互斥 - Sekiro's Blog&summary=本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。">
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qq.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title rel="external nofollow noopener noreferrer" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/&title=操作系统 进程线程管理通信与同步互斥 - Sekiro's Blog&summary=本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。">
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qzone.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/qzone.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title rel="external nofollow noopener noreferrer" target="_blank" href="http://service.weibo.com/share/share.php?url=https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/&title=操作系统 进程线程管理通信与同步互斥 - Sekiro's Blog&summary=本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。">
          
            <img src="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/weibo.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/logo/128/weibo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class="prev" href="/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%AF%BB%E8%80%85%E5%86%99%E8%80%85(%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85)/">
          <p class="title"><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>操作系统 读者写者(生产者消费者)</p>
          <p class="content">本文是操作系统进程同步互斥关于读者写者(生产者消费者)的基本实验。




一、需求本课程实验内容引自《Windows 内核实验教程》(陈向群、林斌等编著，机械工业出版社，2002.9)。
在W...</p>
        </a>
      
      
        <a class="next" href="/2020/09/02/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90-LL1/">
          <p class="title">编译原理 语法分析 LL1<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class="content">本文是编译原理C语言LL1语法分析器的简单实现项目。




一、需求

拓展需求：还能自动够造LL1文法的first集和follow集，为LL1文法自动构造预测分析表。
二、运行环境电脑硬件配...</p>
        </a>
      
    </div>
  
  <!-- 文章推荐 -->
  
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow floatable blur" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/index.html#comments">
    </span>
    <p ct><i class="fa-solid fa-comments"></i> 评论</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id="l_side" itemscope itemtype="http://schema.org/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky pjax">

  
  


  <section class="widget toc-wrapper desktop mobile " id="toc-div">
    
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class="name">本文目录</span>
    
  </header>


    <div class="content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="toc-text">一、实验目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-text">二、实验环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9"><span class="toc-text">三、实验内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AC%AC%E4%B8%80%E7%BB%84-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-text">1、第一组 进程的创建与管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%BB%84-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-text">2、第二组 线程的创建与管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%AC%AC%E4%B8%89-x2F-%E5%9B%9B%E7%BB%84-%E8%BF%9B%E7%A8%8B-x2F-%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1"><span class="toc-text">3、第三&#x2F;四组 进程&#x2F;线程通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%AC%AC%E4%BA%94%E7%BB%84-%E8%BF%9B%E7%A8%8B-x2F-%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5"><span class="toc-text">4、第五组 进程&#x2F;线程同步互斥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4"><span class="toc-text">四、实验步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0%E3%80%81%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">0、实验环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-1-Linux-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85"><span class="toc-text">0-1. Linux 操作系统安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0-2-Pthread-%E7%BA%BF%E7%A8%8B%E5%BA%93%E5%AE%89%E8%A3%85"><span class="toc-text">0-2. Pthread 线程库安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BDOpenEuler"><span class="toc-text">1、下载OpenEuler</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">2、创建虚拟机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%AE%89%E8%A3%85OpenEuler"><span class="toc-text">3、安装OpenEuler</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AC%AC%E4%B8%80%E7%BB%84-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86-1"><span class="toc-text">1、第一组 进程的创建与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C1-1-%E8%BF%9B%E7%A8%8B%E8%A7%82%E5%AF%9F"><span class="toc-text">实验1-1. 进程观察</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C1-2-%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-text">实验1-2. 进程创建与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-fork"><span class="toc-text">1-2-1 fork()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-exec"><span class="toc-text">1-2-2 exec()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-wait"><span class="toc-text">1-2-3 wait()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-4-kill"><span class="toc-text">1-2-4 kill()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-5-getpid"><span class="toc-text">1-2-5 getpid()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C1-3-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-text">实验1-3. 进程管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-ps"><span class="toc-text">1-3-1 ps</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-top"><span class="toc-text">1-3-2 top</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-pstree-%E2%80%93h"><span class="toc-text">1-3-3 pstree –h</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-4-vmstat"><span class="toc-text">1-3-4 vmstat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-5-strace"><span class="toc-text">1-3-5 strace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-6-ltrace"><span class="toc-text">1-3-6 ltrace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-7-sleep-x"><span class="toc-text">1-3-7 sleep x</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-8-kill"><span class="toc-text">1-3-8 kill</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-9-jobs"><span class="toc-text">1-3-9 jobs</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%AC%AC%E4%BA%8C%E7%BB%84-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86-1"><span class="toc-text">2、第二组 线程的创建与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C2-1-Pthread%E7%BA%BF%E7%A8%8B%E5%BA%93%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-text">实验2-1. Pthread线程库背景知识</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C2-2-%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-text">实验2-2. 线程创建与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-pthread-create"><span class="toc-text">2-2-1 pthread_create()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-pthread-exit"><span class="toc-text">2-2-2 pthread_exit()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-pthread-join"><span class="toc-text">2-2-3 pthread_join()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-4-pthread-self"><span class="toc-text">2-2-4 pthread_self()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-5-pthread-cleanup-push-%EF%BC%8Cpthread-cleanup-pop"><span class="toc-text">2-2-5 pthread_cleanup_push()，pthread_cleanup_pop()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-6-%E7%BB%BC%E5%90%88"><span class="toc-text">2-2-6 综合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%AC%AC%E4%B8%89%E7%BB%84-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-text">3、第三组 进程间通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%AC%AC%E5%9B%9B%E7%BB%84-%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-text">4、第四组 线程间通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-3-3-%E5%90%91%E6%96%B0%E5%BB%BA%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%A0%E9%80%92%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">示例2-3-3 向新建的线程传递字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-3-4-%E5%90%91%E6%96%B0%E5%BB%BA%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%A0%E9%80%92%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">示例2-3-4 向新建的线程传递字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-3-5-%E9%AA%8C%E8%AF%81%E6%96%B0%E5%BB%BA%E7%AB%8B%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%8F%AF%E4%BB%A5%E5%85%B1%E4%BA%AB%E8%BF%9B%E7%A8%8B%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">示例2-3-5 验证新建立的线程可以共享进程中的数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%AC%AC%E4%BA%94%E7%BB%84-%E8%BF%9B%E7%A8%8B-x2F-%E7%BA%BF%E7%A8%8B%E9%97%B4%E5%90%8C%E6%AD%A5%E4%B8%8E%E4%BA%92%E6%96%A5%EF%BC%88%E4%BA%8C%E9%80%89%E4%B8%80%EF%BC%89"><span class="toc-text">5、第五组 进程&#x2F;线程间同步与互斥（二选一）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-text">1、设计方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%A1%881%EF%BC%88%E9%87%87%E7%94%A8%E4%BA%8C%E5%85%83%E4%BA%92%E6%96%A5%E4%BF%A1%E5%8F%B7%E9%87%8F-%E6%95%B4%E5%BD%A2%E5%8F%98%E9%87%8F%EF%BC%8C%E6%95%88%E7%8E%87%E6%AF%94%E6%96%B9%E6%A1%882%E9%AB%98%EF%BC%89%EF%BC%9A"><span class="toc-text">方案1（采用二元互斥信号量+整形变量，效率比方案2高）：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%A1%882%EF%BC%88%E9%87%87%E7%94%A8%E5%A4%9A%E5%85%83%E4%BF%A1%E5%8F%B7%E9%87%8F%EF%BC%8C%E6%95%88%E7%8E%87%E4%B8%8D%E5%A6%82%E6%96%B9%E6%A1%881%E9%AB%98%EF%BC%89%EF%BC%9A"><span class="toc-text">方案2（采用多元信号量，效率不如方案1高）：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%8F%8A%E5%88%86%E6%9E%90"><span class="toc-text">2、运行结果及分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E8%AF%91"><span class="toc-text">1、编译</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E8%BF%90%E8%A1%8C"><span class="toc-text">2、运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E5%88%86%E6%9E%90"><span class="toc-text">3、分析</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-text">五、实验总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81"><span class="toc-text">六、项目源码</span></a></li></ol>
    </div>
  </section>

  

</div>


<!-- 没有 pjax 占位会报错 万恶的 pjax -->

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<pjax>
<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  //  see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs
  
    // header
    var l_header=document.getElementById("l_header");
    
    l_header.classList.add("show");
    
    
      // cover
      var cover_wrapper=document.querySelector('#l_cover .cover-wrapper');
      var scroll_down=document.getElementById('scroll-down');
      cover_wrapper.id="none";
      cover_wrapper.style.display="none";
      scroll_down.style.display="none";
    
  
</script>
</pjax>
        </div>
        
  
  <footer class="footer clearfix" itemscope itemtype="http://schema.org/WPFooter">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    
      <meting-js theme="#1BCDFC" autoplay="false" volume="0.7" loop="all" order="list" fixed="false" list-max-height="320px" server="netease" type="playlist" id="80230515" list-folded="true">
      </meting-js>
    
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="http://schema.org/Thing">
          
            
              <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="mailto:1293739194@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://github.com/666WXY666/" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
          
            
          
            
          
            
          
            
              <a href="https://www.notion.so/666wxy666/" class="social fas fa-pen-square flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://gitee.com/wxy_666" class="social fab fa-git-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://space.bilibili.com/7429248" class="social fas fa-bold flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://www.zhihu.com/people/666wxy666" class="social fab fa-zhihu flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=74040689" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#6.0.0-alpha.0" target="_blank" class="codename" rel="external nofollow noopener noreferrer">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class="copyright">
        <p><a href="/">Copyright © since 2020 Sekiro</a></p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // 页面选择器 将dom对象缓存起来 see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // 页面主体
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // 向上
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // 整个导航栏
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1个
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // 搜索按钮   移动端 1个
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // 移动端导航栏
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // 搜索框 桌面端 移动端 1个
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  手机端 子菜单 多个
</script>

<script>
  
  volantis.css("https://cdn.bootcdn.net/ajax/libs/font-awesome/6.1.1/css/all.min.css");
  
  
  volantis.css("https://unpkg.com/font-awesome-animation@1.1.1/css/font-awesome-animation.min.css");
  
  
  volantis.css("https://cdn.bootcdn.net/ajax/libs/node-waves/0.7.6/waves.min.css");
  
</script>

<!-- required -->


<!-- internal -->

<script src="/js/app.js"></script>



  













<div id="rightmenu-wrapper">
  <ul class="list-v rightmenu" id="rightmenu-content">
    
  <li class="navigation menuNavigation-Content">


    <a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa-solid fa-arrow-left fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa-solid fa-arrow-right fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa-solid fa-redo fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)"><i class="fa-solid fa-arrow-up fa-fw"></i></a>


  </li>


    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyPaste" data-event="copyPaste" data-group="inputBox">
      <i class="fa-solid fa-paste fa-fw"></i>
      粘贴文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyAll" data-event="copyAll" data-group="inputBox">
      <i class="fa-solid fa-object-ungroup fa-fw"></i>
      全选文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyCut" data-event="copyCut" data-group="inputBox">
      <i class="fa-solid fa-cut fa-fw"></i>
      剪切文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyText" data-event="copyText" data-group="seletctText">
      <i class="fa-solid fa-copy fa-fw"></i>
      复制文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="searchWord" data-event="OpenSearch(__text__)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      站内搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="bingSearch" data-event="window.open(`https://cn.bing.com/search?q=${__text__}`)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      必应搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="openTab" data-event="window.open(__link__)" data-group="elementCheck">
      <i class="fa-solid fa-external-link-square-alt fa-fw"></i>
      新标签页打开
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyLink" data-event="copyLink" data-group="elementCheck">
      <i class="fa-solid fa-link fa-fw"></i>
      复制链接地址
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyImg" data-event="copyImg" data-group="elementImage">
      <i class="fa-solid fa-image fa-fw"></i>
      复制图片
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="googleImg" data-event="window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)" data-group="elementImage">
      <i class="fa-solid fa-images fa-fw"></i>
      谷歌识图
    </span>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="help" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/faqs/" data-group="link">
      <i class="fa-solid fa-question fa-fw"></i>
      常见问题
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="examples" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/examples/" data-group="link">
      <i class="fa-solid fa-rss fa-fw"></i>
      示例博客
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="contributors" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/contributors/" data-group="link">
      <i class="fa-solid fa-fan fa-fw"></i>
      加入社区
    </a>
  </li>



    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_docs" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/volantis-docs/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      本站源码
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_theme" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      主题源码
    </a>
  </li>



    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="darkMode" data-event="volantis.dark.toggle()" data-group="darkMode">
      <i class="fa-solid fa-moon fa-fw"></i>
      暗黑模式
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="printMode" data-event="printMode" data-group="articlePage">
      <i class="fa-solid fa-print fa-fw"></i>
      打印页面
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="readMode" data-event="readMode" data-group="articlePage">
      <i class="fa-solid fa-book-open fa-fw"></i>
      阅读模式
    </span>
  </li>


<div id="menuMusic">
  <li class="music name menuOption-Content">
    <p class="nav music-title fix-cursor-default"></p>
  </li>
  <li class="music ctrl">
    <a class="nav icon-only backward fix-cursor-default" title="backward">
      <i class="fa-solid fa-step-backward fa-fw"></i>
    </a>
    <a class="nav icon-only toggle fix-cursor-default" title="toggle">
      <i class="fa-solid fa-play fa-fw"></i>
    </a>
    <a class="nav icon-only forward fix-cursor-default" title="forward">
      <i class="fa-solid fa-step-forward fa-fw"></i>
    </a>
  </li>
  <li class="music volume">
    <div class="nav volume">
      <div class="aplayer-volume-bar-wrap">
        <div class="aplayer-volume-bar fix-cursor-pointer">
          <div class="aplayer-volume"></div>
          <i class="left fa-solid fa-volume-off fa-fw"></i>
          <i class="right fa-solid fa-volume-up fa-fw"></i>
        </div>
      </div>
    </div>
  </li>
</div>

  </ul>
</div>
<script src="/js/plugins/rightMenus.js"></script>
<script>
  const RightMenusFunction = {};
  












  //RightMenusFunction['copyPaste'] = (fun) => {fun()}





  //RightMenusFunction['copyAll'] = (fun) => {fun()}





  //RightMenusFunction['copyCut'] = (fun) => {fun()}





  //RightMenusFunction['copyText'] = (fun) => {fun()}





  RightMenusFunction['searchWord'] = (__text__) => {OpenSearch(__text__)}





  RightMenusFunction['bingSearch'] = (__text__) => {window.open(`https://cn.bing.com/search?q=${__text__}`)}





  RightMenusFunction['openTab'] = (__link__) => {window.open(__link__)}





  //RightMenusFunction['copyLink'] = (fun) => {fun()}





  //RightMenusFunction['copyImg'] = (fun) => {fun()}





  RightMenusFunction['googleImg'] = (__link__) => {window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)}



















  RightMenusFunction['darkMode'] = () => {volantis.dark.toggle()}





  //RightMenusFunction['printMode'] = (fun) => {fun()}





  //RightMenusFunction['readMode'] = (fun) => {fun()}





</script>



<!-- rightmenu要在darkmode之前（ToggleButton） darkmode要在comments之前（volantis.dark.push）-->

  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "color-scheme";
const rootElementDarkModeAttributeName = "color-scheme";
const setLS = (k, v) => {
    localStorage.setItem(k, v);
};
const removeLS = (k) => {
    localStorage.removeItem(k);
};
const getLS = (k) => {
    return localStorage.getItem(k);
};
const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};
const validColorModeKeys = {
  dark: true,
  light: true,
};
const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);
  getCustomDarkMode();
  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};
const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};
/**
 * get target mode
 */
 const getCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  if(currentSetting=="dark"){
    volantis.dark.mode="light";
  }else{
    volantis.dark.mode="dark";
  }
  // console.log(volantis.dark.mode)
};
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};
/**
 * 暗黑模式触发器
 */
volantis.dark.toggle=()=>{
  const mode = toggleCustomDarkMode();
  applyCustomDarkModeSettings(mode);
  // 使用 volantis.dark.push 方法传入volantis.dark.toggle回调函数 参见layout/_partial/scripts/global.ejs
  volantis.dark.method.toggle.start();
}
/**
 * bind event for toggle button
 */

function bindToggleButton() {
  var btn= document.querySelectorAll("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn")
  btn.forEach(function (e) {
    volantis.dom.$(e).on('click',volantis.dark.toggle);
  })
}
applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", ()=>{
  volantis.requestAnimationFrame(bindToggleButton)
});
volantis.pjax.push(bindToggleButton);

const darkModelListeners={
  dark:(mediaQueryList )=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "dark";
    }
    volantis.dark.method.toggle.start();
  },
  light:(mediaQueryList)=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "light";
    }
    volantis.dark.method.toggle.start();
  }
}
window.matchMedia('(prefers-color-scheme: dark)').addListener(darkModelListeners.dark)
window.matchMedia('(prefers-color-scheme: light)').addListener(darkModelListeners.light)
</script>




<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
  volantis.pjax.push(()=>{
    loadIssuesJS();
  })

</script>




  <script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.1.0/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1660614606622/libs/flying-pages/flying-pages.min.js"></script>







  <script>
  volantis.css("https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.css");

  
    (async () => {
      // APlayer 需要在  MetingJS 之前加载
      await volantis.js("https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.js")
      await volantis.js("https://unpkg.com/meting@2/dist/Meting.min.js")
    
      // 右键 music 需要在 APlayer  MetingJS 之后加载
      await volantis.js('/js/plugins/aplayer.js')
    
    })();

    function SetAPlayerPlugin(){
      let Metings = document.querySelectorAll('meting-js');
      if (Metings.length === 0) {return;};
      if (Metings[0].aplayer && Metings[0].aplayer.on) {
        // improve the accessibility https://web.dev/button-name/
        document.querySelectorAll(".aplayer-icon-menu").forEach(e=>{
          e.setAttribute("aria-label","Aplayer Menu")
        })
        // message see: /layout/_plugins/message/script.ejs
        
          try {
            setTimeout(() => {
              Metings.forEach((item, index) => {
                const aplayerItem = item.aplayer; if(!aplayerItem) return;
                const rightAplayerCheck = 'true' === 'true'
                  && item.meta.id === '80230515';
                if(rightAplayerCheck) RightMenuAplayer.checkAPlayer();
                if(aplayerItem.events.events.play.every(item => {return item.name !== 'messagePlay'})) {
                  aplayerItem.on('play', function messagePlay() {
                    let index = aplayerItem.list.index;
                    let title = aplayerItem.list.audios[index].title;
                    let artist = aplayerItem.list.audios[index].artist;
                    setTimeout(() => {
                      VolantisApp.message('音乐通知', title + ' - ' + artist, {
                        icon: 'fa-solid fa-play',
                        transitionIn: 'flipInX',
                        transitionOut: 'flipOutX'
                      });
                    }, 100)
                  });
                }
                if(aplayerItem.events.events.pause.every(item => {return item.name !== 'messagePause'})) {
                  aplayerItem.on('pause', function messagePause() {
                    let index = aplayerItem.list.index;
                    let title = aplayerItem.list.audios[index].title;
                    let artist = aplayerItem.list.audios[index].artist;
                    setTimeout(() => {
                      // 歌曲播放结束也会触发 pause 事件，为了避免错误提示，等待一会儿
                      if(aplayerItem.paused) {
                        VolantisApp.message('音乐通知', title + ' - ' + artist, {
                          icon: 'fa-solid fa-pause',
                          transitionIn: 'flipInX',
                          transitionOut: 'flipOutX'
                        });
                      }
                    }, 100)
                  });
                }
              });
            }, 500)
          } catch (error) { console.error(error); }
        
      }else{
        volantis.requestAnimationFrame(SetAPlayerPlugin)
      }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      SetAPlayerPlugin();
    });
    volantis.pjax.push(SetAPlayerPlugin);
  
</script>




      <script>
  volantis.layoutHelper("comments",`<div id="giscus_container"></div>`)

  volantis.giscus = {};

  function check_giscus() {
    if (volantis.dark.mode === "dark") {
      volantis.giscus.Theme = 'dark';
    } else {
      volantis.giscus.Theme = 'light';
    }

    return document.getElementById("giscus_container");
  }

  function pjax_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;
    let cfg = Object.assign({"repo":"666WXY666/giscus","repo-id":"R_kgDOIah7VQ","category":"Announcements","category-id":"DIC_kwDOIah7Vc4CSfjE","mapping":"pathname","reactions-enabled":"1","emit-metadata":"0","lang":"zh-CN","theme":{"light":"light","dark":"dark"}},pdata.commentConfig)
    const script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    Object.keys(cfg).forEach(k=>{
      if (k != "theme") {
        script.setAttribute('data-'+k, cfg[k]);
      }
    })
    script.setAttribute('data-theme', volantis.giscus.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;

    const message = {
      setConfig: {
        theme: volantis.giscus.Theme
      }
    };
    const giscusIframe = document.querySelector('iframe.giscus-frame');
    giscusIframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  pjax_giscus();
  volantis.pjax.push(pjax_giscus);
  volantis.dark.push(dark_giscus);
</script>

    




  <script defer src="https://cdn.dusays.com/bsz.js" data-pjax></script>


<!-- optional -->

  <script>
  async function loadSearchScript() {
    
        
    
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // 打开并搜索 字符串 s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // 访问含有 ?s=xxx  的链接时打开搜索 // 与搜索引擎 structured data 相关: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // 搜索输入框获取焦点时加载搜索
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/node-waves/0.7.6/waves.min.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  Waves.attach('.flat-btn', ['waves-button']);
  Waves.attach('.float-btn', ['waves-button', 'waves-float']);
  Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
  Waves.attach('.flat-box', ['waves-block']);
  Waves.attach('.float-box', ['waves-block', 'waves-float']);
  Waves.attach('.waves-image');
  Waves.init();
});
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1660614606622/libs/comment_typing/comment_typing.js"></script>




  <script>



  function pjax_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(pjax_highlightjs_copyCode)
  volantis.pjax.push(pjax_highlightjs_copyCode)

</script>




  
<!-- Global site tag (gtag.js) - Google Analytics -->
<!-- https://github.com/volantis-x/hexo-theme-volantis/issues/63 -->
<script>
	setTimeout(function() {
	  volantis.js("https://www.googletagmanager.com/gtag/js?id=UA-162450234-2");
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'UA-162450234-2');
	}, 1000);
	// 关于谷歌统计对 SPA 页面的处理：
	// 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
	// https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
	volantis.pjax.push(()=>{
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('config', 'UA-162450234-2', {'page_path': document.location.pathname});
	},'google_analytics')
</script>



<!-- baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  setTimeout(function() {
    volantis.js("https://hm.baidu.com/hm.js?93c49980dcbfb8920e167f85129d6917")
  }, 1000);
})();
// 关于百度统计对 SPA 页面的处理：
// 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
// 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
volantis.pjax.push(()=>{_hmt.push(['_trackPageview', document.location.pathname]);},'baidu_analytics')
</script>










  <script src="https://code.tidio.co/3dyc8kvptqufebrcpcvbn3k1smkpzirq.js" async></script>





  <script>
  let imgs = ["https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/006.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/042.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/005.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/052.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/051.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/004.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/002.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/046.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/035.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/012.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/025.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/033.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/001.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/016.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/054.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/038.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/003.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/056.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/034.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/019.webp","https://unpkg.com/volantis-static@0.0.1660614606622/media/wallpaper/minimalist/2020/039.webp"];
  let index = 0;
  let IntervalParallax = null;

  function parallax(){
    let ParallaxWindow = document.querySelector("#parallax-window");
    
    Parallax.window = ParallaxWindow;
    Parallax.options.fade = 1500;
    Parallax.cache = 1;
    next_parallax();
    Parallax.init();
    if (imgs.length>1) {
      IntervalParallax = setInterval(function () {
        next_parallax();
      }, '10000');
    }
  }

  function next_parallax() {
    if (typeof Parallax == "undefined") {
      return
    }
    
      if (!document.querySelector("#full")&&!document.querySelector("#half")) {
        return
      }
    
    if (imgs.length>=1) {
      Parallax.options.src = imgs[index % imgs.length];
      Parallax.start();
      index++;
      if (Parallax.cache) {
        fetch(imgs[index % imgs.length] +"?t=" + new Date().getTime());
        if (index == imgs.length) {
          Parallax.cache = 0;
        }
      }
    }
  }
  var runningOnBrowser = typeof window !== "undefined";
  var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
  if (!isBot) {
    volantis.js('/js/plugins/parallax.js').then(()=>{
      parallax()
    })
    volantis.pjax.send(()=>{
      clearInterval(IntervalParallax)
    },"clearIntervalParallax");
    volantis.pjax.push(parallax);
  }
</script>




  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://cdn.bootcdn.net/ajax/libs/Swiper/8.3.2/swiper-bundle.min.css");
    volantis.js("https://cdn.bootcdn.net/ajax/libs/Swiper/8.3.2/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  volantis.pjax.push(() => {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    if (typeof volantis.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>



  <script>
  volantis.css("https://cdn.bootcdn.net/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.min.css");
  volantis.js("https://cdn.bootcdn.net/ajax/libs/pace/1.2.4/pace.min.js").then(() => {
    Pace.options.restartOnPushState = false;
    volantis.pjax.send(Pace.restart);
    // 阅读进度
    volantis.scroll.push(() => {
      Pace.stop();
      Pace.trigger('start');
      Pace.bar.update(volantis.scroll.progress() * 100);
    },"阅读进度")
    // todo：配置项开关, 哪些页面添加阅读进度
  })
</script>


<!-- pjax 标签必须存在于所有页面 否则 pjax error -->
<pjax>

</pjax>

<script>
  function listenSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    const targets = []
    const sections = Array.from(navItems).forEach((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        link.getAttribute("href") ? decodeURI(link.getAttribute("href")).replace("#", "") : link.getAttribute("toc-action").split("toc-")[1] // 兼容 hexo-blog-encrypt
      );
      targets.push(target)
      // 解除 a 标签 href 的 锚点定位, a 标签 href 的 锚点定位 会随机启用?? 产生错位???
      if (link.getAttribute("href")) {
        link.setAttribute("toc-action", "toc-" + decodeURI(link.getAttribute("href")).replace("#", ""))
        link.removeAttribute("href")
      }
      // 配置 点击 触发新的锚点定位
      if (target && target.id) {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          // 这里的 addTop 是通过错位使得 toc 自动展开.
          volantis.scroll.to(target, { addTop: 5, observer: true })
          // Anchor id
          history.pushState(null, document.title, "#" + target.id);
        });
      }
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // 方案一：
    volantis.activateNavIndex = 0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    if (targets[0]) {
      volantis.scroll.push(() => {
        if (targets[0].getBoundingClientRect().top >= 0) {
          volantis.activateNavIndex = 0
        } else if (targets[targets.length - 1].getBoundingClientRect().top < 0) {
          volantis.activateNavIndex = targets.length - 1
        } else {
          for (let index = 0; index < targets.length; index++) {
            const target0 = targets[index];
            const target1 = targets[(index + 1) % targets.length];
            if (target0.getBoundingClientRect().top < 0 && target1.getBoundingClientRect().top >= 0) {
              volantis.activateNavIndex = index
              break;
            }
          }
        }
        activateNavByIndex(navItems[volantis.activateNavIndex])
      })
    }

    // 方案二：
    // IntersectionObserver 不是完美精确到像素级别 也不是低延时性的
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", () => {
    volantis.requestAnimationFrame(listenSidebarTOC)
  });
  volantis.pjax.push(listenSidebarTOC);
</script>





<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // 页面加载完毕 样式加载失败，或是当前网速慢，或是开启了省流模式
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"http://schema.org","@type":"Organization","name":"Sekiro's Blog","url":"https://666wxy666.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"http://schema.org","@type":"Person","name":"Sekiro","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://666wxy666.github.io/","sameAs":["https://github.com/volantis-x"],"description":"经验分享和技术交流"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://666wxy666.github.io/","name":"Sekiro's Blog"}},{"@type":"ListItem","position":2,"item":{"@id":"https://666wxy666.github.io/categories/C-C/","name":"C/C++"}},{"@type":"ListItem","position":2,"item":{"@id":"https://666wxy666.github.io/categories/C-C/操作系统/","name":"操作系统"}},{"@type":"ListItem","position":3,"item":{"@id":"https://666wxy666.github.io/2020/09/03/操作系统-进程线程管理通信与同步互斥/","name":"操作系统 进程线程管理通信与同步互斥"}}]},{"@context":"http://schema.org","@type":"WebSite","name":"Sekiro's Blog","url":"https://666wxy666.github.io/","keywords":"计算机,IT,学习交流,Blog,博客","description":"经验分享和技术交流","author":{"@type":"Person","name":"Sekiro","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://666wxy666.github.io/","description":"经验分享和技术交流"},"publisher":{"@type":"Organization","name":"Sekiro's Blog","url":"https://666wxy666.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"https://666wxy666.github.io?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"http://schema.org","@type":"BlogPosting","headline":"操作系统 进程线程管理通信与同步互斥","description":"本文是操作系统课程设计关于进程线程管理通信与同步互斥的综合实验（长文警告）。","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/"},"author":{"@type":"Person","name":"Sekiro","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"https://666wxy666.github.io/"},"publisher":{"@type":"Organization","name":"Sekiro's Blog","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"https://666wxy666.github.io/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E9%80%9A%E4%BF%A1%E4%B8%8E%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/","wordCount":38,"datePublished":"2020-09-03T00:00:00.000Z","dateModified":"2022-11-11T12:01:29.407Z","articleSection":"C/C++","keywords":"C++,Linux,操作系统,进程,线程,同步互斥","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1660614606622/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}}]</script>



      
        <!--
  pjax重载区域接口：
  1.  <pjax></pjax> 标签 pjax 标签必须存在于所有页面 否则 pjax error
  2.  script[data-pjax]
  3.  .pjax-reload script
  4.  .pjax
-->



<script src="https://cdn.bootcdn.net/ajax/libs/pjax/0.2.8/pjax.min.js"></script>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox]):not([onclick="return false;"]):not([onclick="return!1"]):not([target="_blank"]):not([target="view_window"]):not([href$=".xml"])',
        // 这里的 selectors 需要保证每个页面都含有相同的数目
        selectors: [
          "head title",
          "head meta[name=keywords]",
          "head meta[name=description]",
          
          "#l_main",
          "#pjax-header-nav-list",
          ".pjax",
          "pjax", // <pjax></pjax> 标签
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000,
        
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var excludeList = [""];
        if (excludeList[0] != "") {
          excludeList.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      // 这里的 script 不需要保证每个页面都含有相同的数目
      document.querySelectorAll('script[data-pjax], .pjax-reload script').forEach(e=>{
        const code = e.text || e.textContent || e.innerHTML || '';
        const script = document.createElement('script');
        Object.keys(e.attributes).forEach(i=>{
          script.setAttribute(e.attributes[i].nodeName,e.attributes[i].nodeValue)
        })
        if (code) {
          script.appendChild(document.createTextNode(code));
        }
        e.parentNode.replaceChild(script, e);
      });

      // 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.complete.start();
    });

    document.addEventListener('pjax:error', function (e) {
      if(volantis.debug === "pjax") {
        console.error(e);
        console.log('pjax error: \n' + JSON.stringify(e));
      }else{
        // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
        volantis.pjax.method.error.start();
        window.location.href = e.triggerElement.href;
      }
    });
</script>

      
    </div>
    <!-- import body_end begin-->
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    
    <!-- Custom Files bodyEnd end-->
  <script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>